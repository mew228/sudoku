module.exports=[72749,(t,e,i)=>{"use strict";var r,a=t.e&&t.e.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t){void 0===t&&(t="="),this._paddingCharacter=t}return t.prototype.encodedLength=function(t){return this._paddingCharacter?(t+2)/3*4|0:(8*t+5)/6|0},t.prototype.encode=function(t){for(var e="",i=0;i<t.length-2;i+=3){var r=t[i]<<16|t[i+1]<<8|t[i+2];e+=this._encodeByte(r>>>18&63),e+=this._encodeByte(r>>>12&63),e+=this._encodeByte(r>>>6&63),e+=this._encodeByte(r>>>0&63)}var a=t.length-i;if(a>0){var r=t[i]<<16|(2===a?t[i+1]<<8:0);e+=this._encodeByte(r>>>18&63),e+=this._encodeByte(r>>>12&63),2===a?e+=this._encodeByte(r>>>6&63):e+=this._paddingCharacter||"",e+=this._paddingCharacter||""}return e},t.prototype.maxDecodedLength=function(t){return this._paddingCharacter?t/4*3|0:(6*t+7)/8|0},t.prototype.decodedLength=function(t){return this.maxDecodedLength(t.length-this._getPaddingLength(t))},t.prototype.decode=function(t){if(0===t.length)return new Uint8Array(0);for(var e=this._getPaddingLength(t),i=t.length-e,r=new Uint8Array(this.maxDecodedLength(i)),a=0,o=0,s=0,n=0,d=0,h=0,l=0;o<i-4;o+=4)n=this._decodeChar(t.charCodeAt(o+0)),d=this._decodeChar(t.charCodeAt(o+1)),h=this._decodeChar(t.charCodeAt(o+2)),l=this._decodeChar(t.charCodeAt(o+3)),r[a++]=n<<2|d>>>4,r[a++]=d<<4|h>>>2,r[a++]=h<<6|l,s|=256&n,s|=256&d,s|=256&h,s|=256&l;if(o<i-1&&(n=this._decodeChar(t.charCodeAt(o)),d=this._decodeChar(t.charCodeAt(o+1)),r[a++]=n<<2|d>>>4,s|=256&n,s|=256&d),o<i-2&&(h=this._decodeChar(t.charCodeAt(o+2)),r[a++]=d<<4|h>>>2,s|=256&h),o<i-3&&(l=this._decodeChar(t.charCodeAt(o+3)),r[a++]=h<<6|l,s|=256&l),0!==s)throw Error("Base64Coder: incorrect characters for decoding");return r},t.prototype._encodeByte=function(t){var e=t;return e+=65,e+=25-t>>>8&6,e+=51-t>>>8&-75,e+=61-t>>>8&-15,String.fromCharCode(e+=62-t>>>8&3)},t.prototype._decodeChar=function(t){return 256+((42-t&t-44)>>>8&-256+t-43+62)+((46-t&t-48)>>>8&-256+t-47+63)+((47-t&t-58)>>>8&-256+t-48+52)+((64-t&t-91)>>>8&-256+t-65+0)+((96-t&t-123)>>>8&-256+t-97+26)},t.prototype._getPaddingLength=function(t){var e=0;if(this._paddingCharacter){for(var i=t.length-1;i>=0&&t[i]===this._paddingCharacter;i--)e++;if(t.length<4||e>2)throw Error("Base64Coder: incorrect padding")}return e},t}();i.Coder=o;var s=new o;i.encode=function(t){return s.encode(t)},i.decode=function(t){return s.decode(t)};var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype._encodeByte=function(t){var e=t;return e+=65,e+=25-t>>>8&6,e+=51-t>>>8&-75,e+=61-t>>>8&-13,String.fromCharCode(e+=62-t>>>8&49)},e.prototype._decodeChar=function(t){return 256+((44-t&t-46)>>>8&-256+t-45+62)+((94-t&t-96)>>>8&-256+t-95+63)+((47-t&t-58)>>>8&-256+t-48+52)+((64-t&t-91)>>>8&-256+t-65+0)+((96-t&t-123)>>>8&-256+t-97+26)},e}(o);i.URLSafeCoder=n;var d=new n;i.encodeURLSafe=function(t){return d.encode(t)},i.decodeURLSafe=function(t){return d.decode(t)},i.encodedLength=function(t){return s.encodedLength(t)},i.maxDecodedLength=function(t){return s.maxDecodedLength(t)},i.decodedLength=function(t){return s.decodedLength(t)}},26900,(t,e,i)=>{!function(i,r){var a={};r(a);var o=a.default;for(var s in a)o[s]=a[s];if("object"==typeof e.exports)e.exports=o;else if("function"==typeof define&&define.amd)t.r,void 0!==o&&t.v(o);else i.sha256=o}(t.e,function(t){"use strict";t.__esModule=!0,t.digestLength=32,t.blockSize=64;var e=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]);function i(t,i,r,a,o){for(var s,n,d,h,l,u,c,p,f,m,g,y,w;o>=64;){for(m=0,s=i[0],n=i[1],d=i[2],h=i[3],l=i[4],u=i[5],c=i[6],p=i[7];m<16;m++)g=a+4*m,t[m]=(255&r[g])<<24|(255&r[g+1])<<16|(255&r[g+2])<<8|255&r[g+3];for(m=16;m<64;m++)y=((f=t[m-2])>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,w=((f=t[m-15])>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,t[m]=(y+t[m-7]|0)+(w+t[m-16]|0);for(m=0;m<64;m++)y=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&u^~l&c)|0)+(p+(e[m]+t[m]|0)|0)|0,w=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&n^s&d^n&d)|0,p=c,c=u,u=l,l=h+y|0,h=d,d=n,n=s,s=y+w|0;i[0]+=s,i[1]+=n,i[2]+=d,i[3]+=h,i[4]+=l,i[5]+=u,i[6]+=c,i[7]+=p,a+=64,o-=64}return a}var r=function(){function e(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return e.prototype.reset=function(){return this.state[0]=0x6a09e667,this.state[1]=0xbb67ae85,this.state[2]=0x3c6ef372,this.state[3]=0xa54ff53a,this.state[4]=0x510e527f,this.state[5]=0x9b05688c,this.state[6]=0x1f83d9ab,this.state[7]=0x5be0cd19,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},e.prototype.clean=function(){for(var t=0;t<this.buffer.length;t++)this.buffer[t]=0;for(var t=0;t<this.temp.length;t++)this.temp[t]=0;this.reset()},e.prototype.update=function(t,e){if(void 0===e&&(e=t.length),this.finished)throw Error("SHA256: can't update because hash was finished.");var r=0;if(this.bytesHashed+=e,this.bufferLength>0){for(;this.bufferLength<64&&e>0;)this.buffer[this.bufferLength++]=t[r++],e--;64===this.bufferLength&&(i(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(e>=64&&(r=i(this.temp,this.state,t,r,e),e%=64);e>0;)this.buffer[this.bufferLength++]=t[r++],e--;return this},e.prototype.finish=function(t){if(!this.finished){var e=this.bytesHashed,r=this.bufferLength,a=e/0x20000000|0,o=e<<3,s=e%64<56?64:128;this.buffer[r]=128;for(var n=r+1;n<s-8;n++)this.buffer[n]=0;this.buffer[s-8]=a>>>24&255,this.buffer[s-7]=a>>>16&255,this.buffer[s-6]=a>>>8&255,this.buffer[s-5]=a>>>0&255,this.buffer[s-4]=o>>>24&255,this.buffer[s-3]=o>>>16&255,this.buffer[s-2]=o>>>8&255,this.buffer[s-1]=o>>>0&255,i(this.temp,this.state,this.buffer,0,s),this.finished=!0}for(var n=0;n<8;n++)t[4*n+0]=this.state[n]>>>24&255,t[4*n+1]=this.state[n]>>>16&255,t[4*n+2]=this.state[n]>>>8&255,t[4*n+3]=this.state[n]>>>0&255;return this},e.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},e.prototype._saveState=function(t){for(var e=0;e<this.state.length;e++)t[e]=this.state[e]},e.prototype._restoreState=function(t,e){for(var i=0;i<this.state.length;i++)this.state[i]=t[i];this.bytesHashed=e,this.finished=!1,this.bufferLength=0},e}();t.Hash=r;var a=function(){function t(t){this.inner=new r,this.outer=new r,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var e=new Uint8Array(this.blockSize);if(t.length>this.blockSize)new r().update(t).finish(e).clean();else for(var i=0;i<t.length;i++)e[i]=t[i];for(var i=0;i<e.length;i++)e[i]^=54;this.inner.update(e);for(var i=0;i<e.length;i++)e[i]^=106;this.outer.update(e),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var i=0;i<e.length;i++)e[i]=0}return t.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},t.prototype.clean=function(){for(var t=0;t<this.istate.length;t++)this.ostate[t]=this.istate[t]=0;this.inner.clean(),this.outer.clean()},t.prototype.update=function(t){return this.inner.update(t),this},t.prototype.finish=function(t){return this.outer.finished?this.outer.finish(t):(this.inner.finish(t),this.outer.update(t,this.digestLength).finish(t)),this},t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},t}();function o(t){var e=new r().update(t),i=e.digest();return e.clean(),i}function s(t,e){var i=new a(t).update(e),r=i.digest();return i.clean(),r}t.HMAC=a,t.hash=o,t.default=o,t.hmac=s;var n=new Uint8Array(t.digestLength);t.hkdf=function(t,e,i,r){void 0===e&&(e=n),void 0===r&&(r=32);for(var o=new Uint8Array([1]),d=new a(s(e,t)),h=new Uint8Array(d.digestLength),l=h.length,u=new Uint8Array(r),c=0;c<r;c++)l===h.length&&(!function(t,e,i,r){var a=r[0];if(0===a)throw Error("hkdf: cannot expand more");e.reset(),a>1&&e.update(t),i&&e.update(i),e.update(r),e.finish(t),r[0]++}(h,d,i,o),l=0),u[c]=h[l++];return d.clean(),h.fill(0),o.fill(0),u},t.pbkdf2=function(t,e,i,r){for(var o=new a(t),s=o.digestLength,n=new Uint8Array(4),d=new Uint8Array(s),h=new Uint8Array(s),l=new Uint8Array(r),u=0;u*s<r;u++){var c=u+1;n[0]=c>>>24&255,n[1]=c>>>16&255,n[2]=c>>>8&255,n[3]=c>>>0&255,o.reset(),o.update(e),o.update(n),o.finish(h);for(var p=0;p<s;p++)d[p]=h[p];for(var p=2;p<=i;p++){o.reset(),o.update(h).finish(h);for(var f=0;f<s;f++)d[f]^=h[f]}for(var p=0;p<s&&u*s+p<r;p++)l[u*s+p]=d[p]}for(var u=0;u<s;u++)d[u]=h[u]=0;for(var u=0;u<4;u++)n[u]=0;return o.clean(),l}})},12428,t=>{"use strict";var e,i,r,a=t.i(47909),o=t.i(74017),s=t.i(96250),n=t.i(59756),d=t.i(61916),h=t.i(74677),l=t.i(69741),u=t.i(16795),c=t.i(87718),p=t.i(95169),f=t.i(47587),m=t.i(66012),g=t.i(70101),y=t.i(26937),w=t.i(10372),_=t.i(93695);t.i(52474);var v=t.i(220),E=Object.defineProperty,b="@liveblocks/core",I="3.14.0",A="u">typeof globalThis?globalThis:t.g;function O(t){console.error(t)}function S(t,e,i){let r=Symbol.for(t),a=i?`${e||"dev"} (${i})`:e||"dev";A[r]?A[r]===a||O(`Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See https://liveblocks.io/docs/errors/dupes 

Conflicts:
- ${t} ${A[r]} (already loaded)
- ${t} ${a} (trying to load this now)`):A[r]=a,e&&I&&e!==I&&O(`Cross-linked versions of Liveblocks found, which will cause issues! See https://liveblocks.io/docs/errors/cross-linked 

Conflicts:
- ${b} is at ${I}
- ${t} is at ${e}

Always upgrade all Liveblocks packages to the same version number.`)}function T(t){return JSON.parse(JSON.stringify(t))}Symbol("kSinks"),Symbol("kTrigger"),Symbol();var C=class t{#t;#e;constructor(t,e){this.#e=e,this.#t=t}static with(e){return t.fromAlreadySorted([],e)}static from(e,i){let r=new t([],i);for(let t of e)r.add(t);return r}static fromAlreadySorted(e,i){return new t(e,i)}clone(){return new t(this.#t.slice(),this.#e)}add(t){let e=function(t,e,i){let r=0,a=t.length;for(;r<a;){let o=r+(a-r>>1);i(e,t[o])?a=o:r=o+1}return r}(this.#t,t,this.#e);return this.#t.splice(e,0,t),e}clear(){let t=this.#t.length>0;return this.#t.length=0,t}removeBy(t,e=1/0){let i=0;for(let r=0;r<this.#t.length;r++)if(t(this.#t[r])){if(this.#t.splice(r,1),++i>=e)break;r--}return i>0}remove(t){let e=this.#t.indexOf(t);return e>=0&&(this.#t.splice(e,1),!0)}removeAt(t){if(t<0||t>=this.#t.length)return;let[e]=this.#t.splice(t,1);return e}reposition(t){let e=this.#t.indexOf(t);if(e<0)throw Error("Cannot reposition item that is not in the list");let i=this.#t[e-1],r=this.#t[e+1],a=void 0===i||this.#e(i,t),o=void 0===r||this.#e(t,r);if(a&&o)return e;let s=e;for(;s>0&&this.#e(t,this.#t[s-1]);)this.#t[s]=this.#t[s-1],s--;if(s<e)return this.#t[s]=t,s;for(;s<this.#t.length-1&&!this.#e(t,this.#t[s+1]);)this.#t[s]=this.#t[s+1],s++;return s!==e&&(this.#t[s]=t),s}at(t){return this.#t[t]}get length(){return this.#t.length}*filter(t){for(let e of this.#t)t(e)&&(yield e)}*findAllRight(t){for(let e=this.#t.length-1;e>=0;e--){let i=this.#t[e];t(i,e)&&(yield i)}}[Symbol.iterator](){return this.#t[Symbol.iterator]()}*iterReversed(){for(let t=this.#t.length-1;t>=0;t--)yield this.#t[t]}find(t,e){let i=this.findIndex(t,e);return i>-1?this.#t.at(i):void 0}findIndex(t,e=0){for(let i=Math.max(0,e);i<this.#t.length;i++)if(t(this.#t[i],i))return i;return -1}findRight(t,e){let i=this.findIndexRight(t,e);return i>-1?this.#t.at(i):void 0}findIndexRight(t,e=this.#t.length-1){for(let i=Math.min(e,this.#t.length-1);i>=0;i--)if(t(this.#t[i],i))return i;return -1}get rawArray(){return this.#t}};function k(t){let e=t.editedAt?new Date(t.editedAt):void 0,i=new Date(t.createdAt),r=t.reactions.map(t=>({...t,createdAt:new Date(t.createdAt)}));if(t.body)return{...t,reactions:r,createdAt:i,editedAt:e};{let a=new Date(t.deletedAt);return{...t,reactions:r,createdAt:i,editedAt:e,deletedAt:a}}}function R(t){let e=new Date(t.createdAt),i=new Date(t.updatedAt),r=t.comments.map(t=>k(t));return{...t,createdAt:e,updatedAt:i,comments:r}}function x(t){let e=new Date(t.notifiedAt),i=t.readAt?new Date(t.readAt):null;if("activities"in t){let r=t.activities.map(t=>({...t,createdAt:new Date(t.createdAt)}));return{...t,notifiedAt:e,readAt:i,activities:r}}return{...t,notifiedAt:e,readAt:i}}function P(t){let e=new Date(t.createdAt);return{...t,createdAt:e}}function D(t){let e=new Date(t.createdAt),i=new Date(t.updatedAt),r=t.members.map(t=>({...t,addedAt:new Date(t.addedAt)}));return{...t,createdAt:e,updatedAt:i,members:r}}function $(t,e){throw Error(e)}function L(t,e="Expected value to be non-nullable"){return t}var N={},U={error:()=>K,errorWithTitle:()=>B,warn:()=>M,warnWithTitle:()=>z};for(var j in U)E(N,j,{get:U[j],enumerable:!0});var M=console.warn,K=console.error,z=console.warn,B=console.error;function H(t){return null!==t&&"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)}function W(t){return H(t)&&"string"==typeof t.startsWith}function q(t){return H(t)&&("number"==typeof t.lt||"number"==typeof t.gt||"number"==typeof t.lte||"number"==typeof t.gte)}var G=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((t,e)=>t+=(e&=63)<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e<63?"_":"-",""),F=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function J(t){let e=[],i=Object.entries(t),r=[],a=[],o=[];return i.forEach(([t,e])=>{if(!F.test(t))throw Error("Key must only contain letters, numbers, _");V(e)?r.push([t,e]):H(e)&&(W(e)||q(e)?a.push([t,e]):o.push([t,e]))}),e=[...Y(r),...X(a)],o.forEach(([t,i])=>{let r=Object.entries(i),a=[],o=[];r.forEach(([e,i])=>{if(Q(e))throw Error("Key cannot be empty");V(i)?a.push([Z(t,e),i]):(W(i)||q(i))&&o.push([Z(t,e),i])}),e=[...e,...Y(a),...X(o)]}),e.map(({key:t,operator:e,value:i})=>`${t}${e}${tt(i)}`).join(" ")}var Y=t=>{let e=[];return t.forEach(([t,i])=>{e.push({key:t,operator:":",value:i})}),e},X=t=>{let e=[];return t.forEach(([t,i])=>{"startsWith"in i&&"string"==typeof i.startsWith&&e.push({key:t,operator:"^",value:i.startsWith}),"lt"in i&&"number"==typeof i.lt&&e.push({key:t,operator:"<",value:i.lt}),"gt"in i&&"number"==typeof i.gt&&e.push({key:t,operator:">",value:i.gt}),"gte"in i&&"number"==typeof i.gte&&e.push({key:t,operator:">=",value:i.gte}),"lte"in i&&"number"==typeof i.lte&&e.push({key:t,operator:"<=",value:i.lte})}),e},V=t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t,Z=(t,e)=>e?`${t}[${tt(e)}]`:t,Q=t=>!t||""===t.toString().trim();function tt(t){let e=JSON.stringify(t);return"string"!=typeof t||e.includes("'")?e:`'${e.slice(1,-1).replace(/\\"/g,'"')}'`}function te(t,e,i){let r=new URL(e,t);return void 0!==i&&(r.search=(i instanceof URLSearchParams?i:function(t){let e=new URLSearchParams;for(let[i,r]of Object.entries(t))null!=r&&e.set(i,r.toString());return e}(i)).toString()),r.toString()}function ti(t,...e){return t.reduce((t,i,r)=>t+encodeURIComponent(e[r-1]??"")+i)}Object.freeze({UPDATE_PRESENCE:100,USER_JOINED:101,USER_LEFT:102,BROADCASTED_EVENT:103,ROOM_STATE:104,STORAGE_STATE_V7:200,STORAGE_CHUNK:210,STORAGE_STREAM_END:211,UPDATE_STORAGE:201,UPDATE_YDOC:300,THREAD_CREATED:400,THREAD_DELETED:407,THREAD_METADATA_UPDATED:401,THREAD_UPDATED:408,COMMENT_CREATED:402,COMMENT_EDITED:403,COMMENT_DELETED:404,COMMENT_REACTION_ADDED:405,COMMENT_REACTION_REMOVED:406,COMMENT_METADATA_UPDATED:409,REJECT_STORAGE_OP:299});var tr=((e=tr||{})[e.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",e[e.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",e[e.UNEXPECTED_CONDITION=1011]="UNEXPECTED_CONDITION",e[e.TRY_AGAIN_LATER=1013]="TRY_AGAIN_LATER",e[e.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",e[e.NOT_ALLOWED=4001]="NOT_ALLOWED",e[e.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",e[e.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",e[e.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",e[e.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",e[e.ROOM_ID_UPDATED=4006]="ROOM_ID_UPDATED",e[e.KICKED=4100]="KICKED",e[e.TOKEN_EXPIRED=4109]="TOKEN_EXPIRED",e[e.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",e);Symbol(),Object.freeze({}),Array.from(new Set("null")),Array.from(new Set("true")),Array.from(new Set("false")),Array.from(new Set("nulltruefalse")),Symbol("*");var ta=((i=ta||{}).Read="room:read",i.Write="room:write",i.PresenceWrite="room:presence:write",i.CommentsWrite="comments:write",i.CommentsRead="comments:read",i);(function(){let t=new Set;function e(e){return t.add(e),()=>t.delete(e)}function i(t){let i=e(e=>(i(),t(e)));return i}async function r(t){let i;return new Promise(r=>{i=e(e=>{(void 0===t||t(e))&&r(e)})}).finally(()=>i?.())}return{notify:function(e){let i=!1;for(let r of t)r(e),i=!0;return i},subscribe:e,subscribeOnce:i,count:function(){return t.size},waitUntil:r,dispose(){t.clear()},observable:{subscribe:e,subscribeOnce:i,waitUntil:r}}})().observable,Date.now();var to=Symbol("notification-settings-plain");function ts(t){let e={[to]:{value:t,enumerable:!1}};for(let t of["email","slack","teams","webPush"])e[t]={enumerable:!0,get(){let e=this[to][t];return void 0===e?(K(`In order to use the '${t}' channel, please set up your project first. For more information: https://liveblocks.io/docs/errors/enable-a-notification-channel`),null):e}};return void 0!==e?Object.create(null,e):Object.create(null)}var tn=tl(0),td=tl(1),th=tn+tl(-1);function tl(t){let e=32+(t<0?95+t:t);if(e<32||e>126)throw Error(`Invalid n value: ${t}`);return String.fromCharCode(e)}function tu(t,e){if(void 0!==t&&void 0!==e){var i=t,r=e;if(i<r)return tp(i,r);if(i>r)return tp(r,i);throw Error("Cannot compute value between two equal positions")}if(void 0!==t)return function(t){for(let e=0;e<t.length;e++){let i=t.charCodeAt(e);if(i<32||i>126)return t+td}for(;t.length>1&&32===t.charCodeAt(t.length-1);)t=t.slice(0,-1);if(0===t.length||t===tn)return td;let e=2;t.length>2&&(e=2+3*Math.ceil((t.length-2)/3));let i=tc(t,e);if(null!==i)return i;let r=tc(t,e+=3);return null!==r?r:t+td}(t);if(void 0===e)return td;{var a=e;let t=a.length-1;for(let e=0;e<=t;e++){let i=a.charCodeAt(e);if(!(i<=32))if(e!==t)return a.substring(0,e+1);else if(33===i)return a.substring(0,e)+th;else return a.substring(0,e)+String.fromCharCode(i-1)}return td}}function tc(t,e){let i=[];for(let r=0;r<e;r++)r<t.length?i.push(t.charCodeAt(r)-32):i.push(0);let r=1;for(let t=e-1;t>=0&&r;t--){let e=i[t]+r;e>=95?(i[t]=0,r=1):(i[t]=e,r=0)}if(r)return null;let a="";for(let t of i)a+=String.fromCharCode(t+32);for(;a.length>1&&32===a.charCodeAt(a.length-1);)a=a.slice(0,-1);return a}function tp(t,e){let i=0,r=t.length,a=e.length;for(;;){let n=i<r?t.charCodeAt(i):32,d=i<a?e.charCodeAt(i):126;if(n===d){i++;continue}if(d-n!=1){var o,s;return o=t,((s=i)<o.length?o.substring(0,s):o+tn.repeat(s-o.length))+String.fromCharCode(d+n>>1)}{let e=i+1,r=t.substring(0,e);return r.length<e&&(r+=tn.repeat(e-r.length)),r+tp(t.substring(e),"")}}}function tf(t){return!function(t){if(""===t)return!1;let e=t.length-1,i=t.charCodeAt(e);if(i<33||i>126)return!1;for(let i=0;i<e;i++){let e=t.charCodeAt(i);if(e<32||e>126)return!1}return!0}(t)?function(t){let e=[];for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);e.push(r<32?32:r>126?126:r)}for(;e.length>0&&32===e[e.length-1];)e.length--;return e.length>0?String.fromCharCode(...e):td}(t):t}var tm=Object.freeze({INIT:0,SET_PARENT_KEY:1,CREATE_LIST:2,UPDATE_OBJECT:3,CREATE_OBJECT:4,DELETE_CRDT:5,DELETE_OBJECT_KEY:6,CREATE_MAP:7,CREATE_REGISTER:8});function tg(t,e,i=tf(e)){return Object.freeze({type:"HasParent",node:t,key:e,pos:i})}var ty=Object.freeze({type:"NoParent"}),tw=class{#i;#r;#a=ty;_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return $(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return $(this.parent,"Unknown state")}}get _pool(){return this.#i}get roomId(){return this.#i?this.#i.roomId:null}get _id(){return this.#r}get parent(){return this.#a}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return $(this.parent,"Unknown state")}}_apply(t,e){if(t.type===tm.DELETE_CRDT&&"HasParent"===this.parent.type)return this.parent.node._detachChild(this);return{modified:!1}}_setParentLink(t,e){switch(this.parent.type){case"HasParent":if(this.parent.node!==t)throw Error("Cannot set parent: node already has a parent");this.#a=tg(t,e);return;case"Orphaned":case"NoParent":this.#a=tg(t,e);return;default:return $(this.parent,"Unknown state")}}_attach(t,e){if(this.#r||this.#i)throw Error("Cannot attach node: already attached");e.addNode(t,this),this.#r=t,this.#i=e}_detach(){switch(this.#i&&this.#r&&this.#i.deleteNode(this.#r),this.parent.type){case"HasParent":this.#a=function(t,e=tf(t)){return Object.freeze({type:"Orphaned",oldKey:t,oldPos:e})}(this.parent.key,this.parent.pos);break;case"NoParent":this.#a=ty;break;case"Orphaned":break;default:$(this.parent,"Unknown state")}this.#i=void 0}_toOpsWithOpId(t,e,i){return this._toOps(t,e).map(t=>({opId:i.generateOpId(),...t}))}#o;#s;#n;invalidate(){(void 0!==this.#o||void 0!==this.#n)&&(this.#o=void 0,this.#n=void 0,"HasParent"===this.parent.type&&this.parent.node.invalidate())}toTreeNode(t){return(void 0===this.#n||this.#s!==t)&&(this.#s=t,this.#n=this._toTreeNode(t)),this.#n}toImmutable(){return void 0===this.#o&&(this.#o=this._toImmutable()),this.#o}},t_=Object.freeze({OBJECT:0,LIST:1,MAP:2,REGISTER:3});function tv(t){return t[1].type===t_.OBJECT}function tE(t){return t[1].type===t_.LIST}function tb(t){return t[1].type===t_.MAP}function tI(t){return t[1].type===t_.REGISTER}var tA=class t extends tw{#t;constructor(t){super(),this.#t=t}get data(){return this.#t}static _deserialize([e,i],r,a){let o=new t(i.data);return o._attach(e,a),o}_toOps(t,e){if(void 0===this._id)throw Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:tm.CREATE_REGISTER,id:this._id,parentId:t,parentKey:e,data:this.data}]}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveRegister if parent is missing");return{type:t_.REGISTER,parentId:L(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(t){throw Error("Method not implemented.")}_detachChild(t){throw Error("Method not implemented.")}_apply(t,e){return super._apply(t,e)}_toTreeNode(t){return{type:"Json",id:this._id??G(),key:t,payload:this.#t}}_toImmutable(){return this.#t}clone(){return T(this.data)}};function tO(t,e){return t._parentPos<e._parentPos}var tS=class t extends tw{#d;#h;#l;constructor(t){let e;super(),this.#h=new WeakSet,this.#l=new Map;const i=[];for(const r of t){const t=tu(e),a=tB(r);a._setParentLink(this,t),i.push(a),e=t}this.#d=C.fromAlreadySorted(i,tO)}static _deserialize([e,i],r,a){let o=new t([]);o._attach(e,a);let s=r.get(e);if(void 0===s)return o;for(let t of s){let e=t[1],i=tj(t,r,a);i._setParentLink(o,e.parentKey),o.#u(i)}return o}_toOps(t,e){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=[],r={id:this._id,type:tm.CREATE_LIST,parentId:t,parentKey:e};for(let t of(i.push(r),this.#d)){let e=t._getParentKeyOrThrow();for(let r of tD(t._toOps(this._id,e),void 0))i.push(r)}return i}#u(t){let e=this.#d.add(t);return this.invalidate(),e}#c(t,e){t._setParentLink(this,e),this.#d.reposition(t),this.invalidate()}#p(t,e){let i=L(this.#d.at(t));this.#c(i,e)}_indexOfPosition(t){return this.#d.findIndex(e=>e._getParentKeyOrThrow()===t)}_attach(t,e){for(let i of(super._attach(t,e),this.#d))i._attach(e.generateId(),e)}_detach(){for(let t of(super._detach(),this.#d))t._detach()}#f(t){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:e,parentKey:i}=t,r=tN(t);r._attach(e,this._pool),r._setParentLink(this,i);let a=t.deletedId,o=this._indexOfPosition(i);if(-1!==o){let e=L(this.#d.removeAt(o));if(e._id===a)return e._detach(),this.#d.add(r),{modified:tC(this,[tk(o,r)]),reverse:[]};{this.#h.add(e),this.#d.remove(e),this.#d.add(r);let i=[tk(o,r)],a=this.#m(t.deletedId);return a&&i.push(a),{modified:tC(this,i),reverse:[]}}}{let e=[],a=this.#m(t.deletedId);return a&&e.push(a),this.#u(r),e.push(tx(this._indexOfPosition(i),r)),{reverse:[],modified:tC(this,e)}}}#g(t){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let e=[],i=this.#m(t.deletedId);i&&e.push(i);let r=this.#l.get(t.parentKey);if(void 0!==r)if(r!==t.opId)return 0===e.length?{modified:!1}:{modified:tC(this,e),reverse:[]};else this.#l.delete(t.parentKey);let a=this._indexOfPosition(t.parentKey),o=this.#d.find(e=>e._id===t.id);if(void 0!==o){if(o._parentKey===t.parentKey)return{modified:e.length>0&&tC(this,e),reverse:[]};if(-1!==a){let t=L(this.#d.removeAt(a));this.#h.add(t),e.push(tR(a,t))}let i=this.#d.findIndex(t=>t===o);this.#c(o,t.parentKey);let r=this.#d.findIndex(t=>t===o);return r!==i&&e.push(tP(i,r,o)),{modified:e.length>0&&tC(this,e),reverse:[]}}{let i=this._pool.getNode(t.id);if(i&&this.#h.has(i)){i._setParentLink(this,t.parentKey),this.#h.delete(i);let r=this.#u(i);return{modified:tC(this,[-1===a?tx(r,i):tk(r,i),...e]),reverse:[]}}{-1!==a&&L(this.#d.removeAt(a));let{newItem:i,newIndex:r}=this.#y(t,t.parentKey);return{modified:tC(this,[-1===a?tx(r,i):tk(r,i),...e]),reverse:[]}}}}#m(t){if(void 0===t||void 0===this._pool)return null;let e=this._pool.getNode(t);if(void 0===e)return null;let i=this._detachChild(e);return!1===i.modified?null:i.modified.updates[0]}#w(t){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let e=tf(t.parentKey),i=this._indexOfPosition(e);-1!==i&&this.#_(i,e);let{newItem:r,newIndex:a}=this.#y(t,e);return{modified:tC(this,[tx(a,r)]),reverse:[]}}#v(t){let e=this.#d.find(e=>e._id===t.id),i=tf(t.parentKey),r=this._indexOfPosition(i);if(e)if(e._parentKey===i)return{modified:!1};else{let t=this.#d.findIndex(t=>t===e);-1!==r&&this.#_(r,i),this.#c(e,i);let a=this._indexOfPosition(i);return a===t?{modified:!1}:{modified:tC(this,[tP(t,a,e)]),reverse:[]}}{let e=L(this._pool).getNode(t.id);if(e&&this.#h.has(e))return e._setParentLink(this,i),this.#h.delete(e),this.#u(e),{modified:tC(this,[tx(this._indexOfPosition(i),e)]),reverse:[]};{-1!==r&&this.#_(r,i);let{newItem:e,newIndex:a}=this.#y(t,i);return{modified:tC(this,[tx(a,e)]),reverse:[]}}}}#E(t){let{id:e,parentKey:i}=t,r=tN(t);if(this._pool?.getNode(e)!==void 0)return{modified:!1};r._attach(e,L(this._pool)),r._setParentLink(this,i);let a=this._indexOfPosition(i),o=i;return -1!==a&&(o=tu(this.#d.at(a)?._parentPos,this.#d.at(a+1)?._parentPos),r._setParentLink(this,o)),this.#u(r),{modified:tC(this,[tx(this._indexOfPosition(o),r)]),reverse:[{type:tm.DELETE_CRDT,id:e}]}}#b(t){let{id:e,parentKey:i}=t,r=tN(t);if(this._pool?.getNode(e)!==void 0)return{modified:!1};this.#l.set(i,L(t.opId));let a=this._indexOfPosition(i);if(r._attach(e,L(this._pool)),r._setParentLink(this,i),-1!==a){let e=this.#d.at(a);e._detach(),this.#d.remove(e),this.#d.add(r);let o=tD(e._toOps(L(this._id),i),t.id),s=[tk(a,r)],n=this.#m(t.deletedId);return n&&s.push(n),{modified:tC(this,s),reverse:o}}{this.#u(r),this.#m(t.deletedId);let a=this._indexOfPosition(i);return{reverse:[{type:tm.DELETE_CRDT,id:e}],modified:tC(this,[tx(a,r)])}}}_attachChild(t,e){let i;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");return!1!==(i="set"===t.intent?1===e?this.#f(t):2===e?this.#g(t):this.#b(t):1===e?this.#w(t):2===e?this.#v(t):this.#E(t)).modified&&this.invalidate(),i}_detachChild(t){if(t){let e=L(t._parentKey),i=t._toOps(L(this._id),e),r=this.#d.findIndex(e=>e===t);if(-1===r)return{modified:!1};let a=this.#d.at(r);return this.#d.remove(t),this.invalidate(),t._detach(),{modified:tC(this,[tR(r,a)]),reverse:i}}return{modified:!1}}#I(t,e){if(this.#h.has(e))return this.#h.delete(e),e._setParentLink(this,t),{modified:tC(this,[tx(this.#u(e),e)]),reverse:[]};if(t===e._parentKey)return{modified:!1};let i=this._indexOfPosition(t);if(-1===i){let i=this.#d.findIndex(t=>t===e);this.#c(e,t);let r=this.#d.findIndex(t=>t===e);return r===i?{modified:!1}:{modified:tC(this,[tP(i,r,e)]),reverse:[]}}{this.#p(i,tu(t,this.#d.at(i+1)?._parentPos));let r=this.#d.findIndex(t=>t===e);this.#c(e,t);let a=this.#d.findIndex(t=>t===e);return a===r?{modified:!1}:{modified:tC(this,[tP(r,a,e)]),reverse:[]}}}#A(t,e){let i=L(e._parentKey);if(this.#h.has(e)){let i=this._indexOfPosition(t);if(this.#h.delete(e),-1!==i){let e=this.#d.at(i);e._setParentLink(this,tu(t,this.#d.at(i+1)?._parentPos)),this.#d.reposition(e)}return e._setParentLink(this,t),{modified:tC(this,[tx(this.#u(e),e)]),reverse:[]}}{if(t===i)return{modified:!1};let r=this.#d.findIndex(t=>t===e),a=this._indexOfPosition(t);-1!==a&&this.#p(a,tu(t,this.#d.at(a+1)?._parentPos)),this.#c(e,t);let o=this.#d.findIndex(t=>t===e);return r===o?{modified:!1}:{modified:tC(this,[tP(r,o,e)]),reverse:[]}}}#O(t,e){let i=L(e._parentKey),r=this.#d.findIndex(t=>t===e),a=this._indexOfPosition(t),o=t;-1!==a&&(o=tu(t,this.#d.at(a+1)?._parentPos)),this.#c(e,o);let s=this.#d.findIndex(t=>t===e);return r===s?{modified:!1}:{modified:tC(this,[tP(r,s,e)]),reverse:[{type:tm.SET_PARENT_KEY,id:L(e._id),parentKey:i}]}}_setChildKey(t,e,i){return 1===i?this.#I(t,e):2===i?this.#A(t,e):this.#O(t,e)}_apply(t,e){return super._apply(t,e)}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveList if parent is missing");return{type:t_.LIST,parentId:L(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this.#d.length}push(t){return this._pool?.assertStorageIsWritable(),this.insert(t,this.length)}insert(t,e){if(this._pool?.assertStorageIsWritable(),e<0||e>this.#d.length)throw Error(`Cannot insert list item at index "${e}". index should be between 0 and ${this.#d.length}`);let i=tu(this.#d.at(e-1)?._parentPos,this.#d.at(e)?._parentPos),r=tB(t);if(r._setParentLink(this,i),this.#u(r),this._pool&&this._id){let t=this._pool.generateId();r._attach(t,this._pool),this._pool.dispatch(r._toOpsWithOpId(this._id,i,this._pool),[{type:tm.DELETE_CRDT,id:t}],new Map([[this._id,tC(this,[tx(e,r)])]]))}}move(t,e){if(this._pool?.assertStorageIsWritable(),e<0)throw Error("targetIndex cannot be less than 0");if(e>=this.#d.length)throw Error("targetIndex cannot be greater or equal than the list length");if(t<0)throw Error("index cannot be less than 0");if(t>=this.#d.length)throw Error("index cannot be greater or equal than the list length");let i=null,r=null;t<e?(r=e===this.#d.length-1?void 0:this.#d.at(e+1)?._parentPos,i=this.#d.at(e)._parentPos):(r=this.#d.at(e)._parentPos,i=0===e?void 0:this.#d.at(e-1)?._parentPos);let a=tu(i,r),o=this.#d.at(t),s=o._getParentKeyOrThrow();if(this.#p(t,a),this._pool&&this._id){let i=new Map([[this._id,tC(this,[tP(t,e,o)])]]);this._pool.dispatch([{type:tm.SET_PARENT_KEY,id:L(o._id),opId:this._pool.generateOpId(),parentKey:a}],[{type:tm.SET_PARENT_KEY,id:L(o._id),parentKey:s}],i)}}delete(t){if(this._pool?.assertStorageIsWritable(),t<0||t>=this.#d.length)throw Error(`Cannot delete list item at index "${t}". index should be between 0 and ${this.#d.length-1}`);let e=this.#d.at(t);if(e._detach(),this.#d.remove(e),this.invalidate(),this._pool){let i=e._id;if(i){let r=new Map;r.set(L(this._id),tC(this,[tR(t,e)])),this._pool.dispatch([{id:i,opId:this._pool.generateOpId(),type:tm.DELETE_CRDT}],e._toOps(L(this._id),e._getParentKeyOrThrow()),r)}}}clear(){if(this._pool?.assertStorageIsWritable(),this._pool){let t=[],e=[],i=[];for(let r of this.#d){r._detach();let a=r._id;a&&(t.push({type:tm.DELETE_CRDT,id:a,opId:this._pool.generateOpId()}),e.push(...r._toOps(L(this._id),r._getParentKeyOrThrow())),i.push(tR(0,r)))}this.#d.clear(),this.invalidate();let r=new Map;r.set(L(this._id),tC(this,i)),this._pool.dispatch(t,e,r)}else{for(let t of this.#d)t._detach();this.#d.clear(),this.invalidate()}}set(t,e){if(this._pool?.assertStorageIsWritable(),t<0||t>=this.#d.length)throw Error(`Cannot set list item at index "${t}". index should be between 0 and ${this.#d.length-1}`);let i=this.#d.at(t),r=i._getParentKeyOrThrow(),a=i._id;i._detach();let o=tB(e);if(o._setParentLink(this,r),this.#d.remove(i),this.#d.add(o),this.invalidate(),this._pool&&this._id){let e=this._pool.generateId();o._attach(e,this._pool);let s=new Map;s.set(this._id,tC(this,[tk(t,o)]));let n=tD(o._toOpsWithOpId(this._id,r,this._pool),a);this.#l.set(r,L(n[0].opId));let d=tD(i._toOps(this._id,r),e);this._pool.dispatch(n,d,s)}}toArray(){return Array.from(this.#d,t=>tz(t))}every(t){return this.toArray().every(t)}filter(t){return this.toArray().filter(t)}find(t){return this.toArray().find(t)}findIndex(t){return this.toArray().findIndex(t)}forEach(t){return this.toArray().forEach(t)}get(t){if(t<0||t>=this.#d.length)return;let e=this.#d.at(t);return e?tz(e):void 0}indexOf(t,e){return this.toArray().indexOf(t,e)}lastIndexOf(t,e){return this.toArray().lastIndexOf(t,e)}map(t){let e=[],i=0;for(let r of this.#d)e.push(t(tz(r),i)),i++;return e}some(t){return this.toArray().some(t)}[Symbol.iterator](){return new tT(this.#d)}#y(t,e){let i=tN(t);return i._attach(t.id,L(this._pool)),i._setParentLink(this,e),this.#u(i),{newItem:i,newIndex:this._indexOfPosition(e)}}#_(t,e){let i=tu(e,this.#d.length>t+1?this.#d.at(t+1)?._parentPos:void 0);this.#p(t,i)}_toTreeNode(t){let e=[],i=0;for(let t of this.#d)e.push(t.toTreeNode(i.toString())),i++;return{type:"LiveList",id:this._id??G(),key:t,payload:e}}toImmutable(){return super.toImmutable()}_toImmutable(){return Array.from(this.#d,t=>t.toImmutable())}clone(){return new t(Array.from(this.#d,t=>t.clone()))}},tT=class{#S;constructor(t){this.#S=t[Symbol.iterator]()}[Symbol.iterator](){return this}next(){let t=this.#S.next();return t.done?{done:!0,value:void 0}:{value:tz(t.value)}}};function tC(t,e){return{node:t,type:"LiveList",updates:e}}function tk(t,e){return{index:t,type:"set",item:e instanceof tA?e.data:e}}function tR(t,e){return{type:"delete",index:t,deletedItem:e instanceof tA?e.data:e}}function tx(t,e){return{index:t,type:"insert",item:e instanceof tA?e.data:e}}function tP(t,e,i){return{type:"move",index:e,item:i instanceof tA?i.data:i,previousIndex:t}}function tD(t,e){return t.map((t,i)=>0===i?{...t,intent:"set",deletedId:e}:t)}var t$=class t extends tw{#T;#C;constructor(t){if(super(),this.#C=new Map,t){const e=[];for(const[i,r]of t){const t=tB(r);t._setParentLink(this,i),e.push([i,t])}this.#T=new Map(e)}else this.#T=new Map}_toOps(t,e){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=[],r={id:this._id,type:tm.CREATE_MAP,parentId:t,parentKey:e};for(let[t,e]of(i.push(r),this.#T))for(let r of e._toOps(this._id,t))i.push(r);return i}static _deserialize([e,i],r,a){let o=new t;o._attach(e,a);let s=r.get(e);if(void 0===s)return o;for(let t of s){let e=t[1],i=tj(t,r,a);i._setParentLink(o,e.parentKey),o.#T.set(e.parentKey,i),o.invalidate()}return o}_attach(t,e){for(let[i,r]of(super._attach(t,e),this.#T))tK(r)&&r._attach(e.generateId(),e)}_attachChild(t,e){let i;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,parentKey:a,opId:o}=t,s=tN(t);if(void 0!==this._pool.getNode(r))return{modified:!1};if(2===e){let t=this.#C.get(a);if(t===o)return this.#C.delete(a),{modified:!1};if(void 0!==t)return{modified:!1}}else 1===e&&this.#C.delete(a);let n=this.#T.get(a);if(n){let t=L(this._id);i=n._toOps(t,a),n._detach()}else i=[{type:tm.DELETE_CRDT,id:r}];return s._setParentLink(this,a),s._attach(r,this._pool),this.#T.set(a,s),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[a]:{type:"update"}}},reverse:i}}_detach(){for(let t of(super._detach(),this.#T.values()))t._detach()}_detachChild(t){let e=L(this._id),i=L(t._parentKey),r=t._toOps(e,i);for(let[e,i]of this.#T)i===t&&(this.#T.delete(e),this.invalidate());return t._detach(),{modified:{node:this,type:"LiveMap",updates:{[i]:{type:"delete",deletedItem:tz(t)}}},reverse:r}}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveMap if parent is missing");return{type:t_.MAP,parentId:L(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(t){let e=this.#T.get(t);if(void 0!==e)return tz(e)}set(t,e){this._pool?.assertStorageIsWritable();let i=this.#T.get(t);i&&i._detach();let r=tB(e);if(r._setParentLink(this,t),this.#T.set(t,r),this.invalidate(),this._pool&&this._id){let e=this._pool.generateId();r._attach(e,this._pool);let a=new Map;a.set(this._id,{node:this,type:"LiveMap",updates:{[t]:{type:"update"}}});let o=r._toOpsWithOpId(this._id,t,this._pool);this.#C.set(t,L(o[0].opId)),this._pool.dispatch(o,i?i._toOps(this._id,t):[{type:tm.DELETE_CRDT,id:e}],a)}}get size(){return this.#T.size}has(t){return this.#T.has(t)}delete(t){this._pool?.assertStorageIsWritable();let e=this.#T.get(t);if(void 0===e)return!1;if(e._detach(),this.#T.delete(t),this.invalidate(),this._pool&&e._id){let i=L(this._id),r=new Map;r.set(i,{node:this,type:"LiveMap",updates:{[t]:{type:"delete",deletedItem:tz(e)}}}),this._pool.dispatch([{type:tm.DELETE_CRDT,id:e._id,opId:this._pool.generateOpId()}],e._toOps(i,t),r)}return!0}entries(){let t=this.#T.entries();return{[Symbol.iterator](){return this},next(){let e=t.next();return e.done?{done:!0,value:void 0}:{value:[e.value[0],tz(e.value[1])]}}}}[Symbol.iterator](){return this.entries()}keys(){return this.#T.keys()}values(){let t=this.#T.values();return{[Symbol.iterator](){return this},next(){let e=t.next();return e.done?{done:!0,value:void 0}:{value:tz(e.value)}}}}forEach(t){for(let e of this)t(e[1],e[0],this)}_toTreeNode(t){return{type:"LiveMap",id:this._id??G(),key:t,payload:Array.from(this.#T.entries()).map(([t,e])=>e.toTreeNode(t))}}toImmutable(){return super.toImmutable()}_toImmutable(){let t=new Map;for(let[e,i]of this.#T)t.set(e,i.toImmutable());return t}clone(){return new t(Array.from(this.#T).map(([t,e])=>[t,e.clone()]))}},tL=class t extends tw{#T;#k;static detectLargeObjects=!1;static #R(t){let e=new Map,i=null;for(let r of t)if("root"===r[0])i=r[1];else{let t=r[1],i=e.get(t.parentId);void 0!==i?i.push(r):e.set(t.parentId,[r])}if(null===i)throw Error("Root can't be null");return[i,e]}static _fromItems(e,i){let[r,a]=t.#R(e);return t._deserialize(["root",r],a,i)}constructor(t={}){super(),this.#k=new Map;const e=function(t){let e={...t};return Object.keys(t).forEach(t=>{void 0===e[t]&&delete e[t]}),e}(t);for(const t of Object.keys(e)){const i=e[t];tK(i)&&i._setParentLink(this,t)}this.#T=new Map(Object.entries(e))}_toOps(t,e){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=[],r={type:tm.CREATE_OBJECT,id:this._id,parentId:t,parentKey:e,data:{}};for(let[t,e]of(i.push(r),this.#T))if(tK(e))for(let r of e._toOps(this._id,t))i.push(r);else r.data[t]=e;return i}static _deserialize([e,i],r,a){let o=new t(i.data);return o._attach(e,a),this._deserializeChildren(o,r,a)}static _deserializeChildren(t,e,i){let r=e.get(L(t._id));if(void 0===r)return t;for(let a of r){let r=function(t,e,i){if(tv(t))return tL._deserialize(t,e,i);if(tE(t))return tS._deserialize(t,e,i);if(tb(t))return t$._deserialize(t,e,i);if(tI(t))return t[1].data;throw Error("Unexpected CRDT type")}(a,e,i),o=a[1];tM(r)&&r._setParentLink(t,o.parentKey),t.#T.set(o.parentKey,r),t.invalidate()}return t}_attach(t,e){for(let[i,r]of(super._attach(t,e),this.#T))tK(r)&&r._attach(e.generateId(),e)}_attachChild(t,e){let i;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,opId:a,parentKey:o}=t,s=tU(t);if(void 0!==this._pool.getNode(r))return this.#k.get(o)===a&&this.#k.delete(o),{modified:!1};if(0===e)this.#k.set(o,L(a));else if(void 0===this.#k.get(o));else if(this.#k.get(o)===a)return this.#k.delete(o),{modified:!1};else return{modified:!1};let n=L(this._id),d=this.#T.get(o);return tK(d)?(i=d._toOps(n,o),d._detach()):i=void 0===d?[{type:tm.DELETE_OBJECT_KEY,id:n,key:o}]:[{type:tm.UPDATE_OBJECT,id:n,data:{[o]:d}}],this.#T.set(o,s),this.invalidate(),tM(s)&&(s._setParentLink(this,o),s._attach(r,this._pool)),{reverse:i,modified:{node:this,type:"LiveObject",updates:{[o]:{type:"update"}}}}}_detachChild(t){if(t){let e=L(this._id),i=L(t._parentKey),r=t._toOps(e,i);for(let[e,i]of this.#T)i===t&&(this.#T.delete(e),this.invalidate());return t._detach(),{modified:{node:this,type:"LiveObject",updates:{[i]:{type:"delete"}}},reverse:r}}return{modified:!1}}_detach(){for(let t of(super._detach(),this.#T.values()))tK(t)&&t._detach()}_apply(t,e){return t.type===tm.UPDATE_OBJECT?this.#x(t,e):t.type===tm.DELETE_OBJECT_KEY?this.#P(t,e):super._apply(t,e)}_serialize(){let t={};for(let[e,i]of this.#T)tK(i)||(t[e]=i);return"HasParent"===this.parent.type&&this.parent.node._id?{type:t_.OBJECT,parentId:this.parent.node._id,parentKey:this.parent.key,data:t}:{type:t_.OBJECT,data:t}}#x(t,e){let i=!1,r=L(this._id),a=[],o={type:tm.UPDATE_OBJECT,id:r,data:{}};for(let e in t.data){let t=this.#T.get(e);if(tK(t)){for(let i of t._toOps(r,e))a.push(i);t._detach()}else void 0!==t?o.data[e]=t:void 0===t&&a.push({type:tm.DELETE_OBJECT_KEY,id:r,key:e})}let s={};for(let r in t.data){let a=t.data[r];if(void 0===a)continue;if(e)this.#k.set(r,L(t.opId));else if(void 0===this.#k.get(r))i=!0;else{if(this.#k.get(r)!==t.opId)continue;this.#k.delete(r);continue}let o=this.#T.get(r);tK(o)&&o._detach(),i=!0,s[r]={type:"update"},this.#T.set(r,a),this.invalidate()}return 0!==Object.keys(o.data).length&&a.unshift(o),i?{modified:{node:this,type:"LiveObject",updates:s},reverse:a}:{modified:!1}}#P(t,e){let i=t.key,r=this.#T.get(i);if(void 0===r||!e&&void 0!==this.#k.get(i))return{modified:!1};let a=L(this._id),o=[];return tK(r)?(o=r._toOps(a,t.key),r._detach()):void 0!==r&&(o=[{type:tm.UPDATE_OBJECT,id:a,data:{[i]:r}}]),this.#T.delete(i),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[t.key]:{type:"delete",deletedItem:r}}},reverse:o}}toObject(){return Object.fromEntries(this.#T)}set(t,e){this._pool?.assertStorageIsWritable(),this.update({[t]:e})}get(t){return this.#T.get(t)}delete(t){let e;this._pool?.assertStorageIsWritable();let i=this.#T.get(t);if(void 0===i)return;if(void 0===this._pool||void 0===this._id){tK(i)&&i._detach(),this.#T.delete(t),this.invalidate();return}tK(i)?(i._detach(),e=i._toOps(this._id,t)):e=[{type:tm.UPDATE_OBJECT,data:{[t]:i},id:this._id}],this.#T.delete(t),this.invalidate();let r=new Map;r.set(this._id,{node:this,type:"LiveObject",updates:{[t]:{type:"delete",deletedItem:i}}}),this._pool.dispatch([{type:tm.DELETE_OBJECT_KEY,key:t,id:this._id,opId:this._pool.generateOpId()}],e,r)}update(e){if(this._pool?.assertStorageIsWritable(),t.detectLargeObjects){let t={};for(let[e,i]of this.#T)tK(i)||(t[e]=i);for(let i of Object.keys(e)){let r=e[i];void 0!==r&&(tK(r)||(t[i]=r))}let i=JSON.stringify(t);if(4*i.length>131072){let t=new TextEncoder().encode(i).length;if(t>131072)throw Error(`LiveObject size exceeded limit: ${t} bytes > 131072 bytes. See https://liveblocks.io/docs/platform/limits#Liveblocks-Storage-limits`)}}if(void 0===this._pool||void 0===this._id){for(let t in e){let i=e[t];if(void 0===i)continue;let r=this.#T.get(t);tK(r)&&r._detach(),tK(i)&&i._setParentLink(this,t),this.#T.set(t,i),this.invalidate()}return}let i=[],r=[],a=this._pool.generateOpId(),o={},s={id:this._id,type:tm.UPDATE_OBJECT,data:{}},n={};for(let t in e){let d=e[t];if(void 0===d)continue;let h=this.#T.get(t);if(tK(h)){for(let e of h._toOps(this._id,t))r.push(e);h._detach()}else void 0===h?r.push({type:tm.DELETE_OBJECT_KEY,id:this._id,key:t}):s.data[t]=h;if(tK(d)){d._setParentLink(this,t),d._attach(this._pool.generateId(),this._pool);let e=d._toOpsWithOpId(this._id,t,this._pool),r=e.find(t=>t.parentId===this._id);for(let a of(r&&this.#k.set(t,L(r.opId)),e))i.push(a)}else o[t]=d,this.#k.set(t,a);this.#T.set(t,d),this.invalidate(),n[t]={type:"update"}}0!==Object.keys(s.data).length&&r.unshift(s),0!==Object.keys(o).length&&i.unshift({opId:a,id:this._id,type:tm.UPDATE_OBJECT,data:o});let d=new Map;d.set(this._id,{node:this,type:"LiveObject",updates:n}),this._pool.dispatch(i,r,d)}toImmutable(){return super.toImmutable()}toTreeNode(t){return super.toTreeNode(t)}_toTreeNode(t){let e=this._id??G();return{type:"LiveObject",id:e,key:t,payload:Array.from(this.#T.entries()).map(([t,i])=>tK(i)?i.toTreeNode(t):{type:"Json",id:`${e}:${t}`,key:t,payload:i})}}_toImmutable(){let t={};for(let[e,i]of this.#T)t[e]=tM(i)?i.toImmutable():i;return t}clone(){return new t(Object.fromEntries(Array.from(this.#T).map(([t,e])=>[t,tM(e)?e.clone():T(e)])))}};function tN(t){return tB(tU(t))}function tU(t){switch(t.type){case tm.CREATE_REGISTER:return t.data;case tm.CREATE_OBJECT:return new tL(t.data);case tm.CREATE_MAP:return new t$;case tm.CREATE_LIST:return new tS([]);default:return $(t,"Unknown creation Op")}}function tj(t,e,i){if(tv(t))return tL._deserialize(t,e,i);if(tE(t))return tS._deserialize(t,e,i);if(tb(t))return t$._deserialize(t,e,i);if(tI(t))return tA._deserialize(t,e,i);throw Error("Unexpected CRDT type")}function tM(t){return t instanceof tS||t instanceof t$||t instanceof tL}function tK(t){return tM(t)||t instanceof tA}function tz(t){return t instanceof tA?t.data:t instanceof tS||t instanceof t$||t instanceof tL?t:$(t,"Unknown AbstractCrdt")}function tB(t){return t instanceof tL||t instanceof t$||t instanceof tS?t:new tA(t)}var tH=Object.freeze({UPDATE_PRESENCE:100,BROADCAST_EVENT:103,FETCH_STORAGE:200,UPDATE_STORAGE:201,FETCH_YDOC:300,UPDATE_YDOC:301});function tW(t,e,i,r,a){if("number"!=typeof e||e<i||void 0!==r&&e>r)throw Error(void 0!==r?`${t} should be between ${a??i} and ${r}.`:`${t} should be at least ${a??i}.`);return e}var tq={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tG=RegExp(Object.keys(tq).map(t=>`\\${t}`).join("|"),"g"),tF={_:"\\_","*":"\\*","#":"\\#","`":"\\`","~":"\\~","!":"\\!","|":"\\|","(":"\\(",")":"\\)","{":"\\{","}":"\\}","[":"\\[","]":"\\]"},tJ=RegExp(Object.keys(tF).map(t=>`\\${t}`).join("|"),"g"),tY=((r=tY||{}).Lexical="lexical",r.TipTap="tiptap",r.BlockNote="blocknote",r);async function tX(t){let e=[];for await(let i of t)e.push(i);return e}async function tV(t,e,i){let r=new Set;for await(let a of t){r.size>=i&&await Promise.race(r);let t=(async()=>{try{await e(a)}finally{r.delete(t)}})();r.add(t)}r.size>0&&await Promise.all(r)}S(b,I,"esm"),t.i(72749),t.i(26900);var tZ=class extends TransformStream{constructor(){let t="";super({transform(e,i){if((t+=e).includes("\n")){let e=t.split("\n");for(let t=0;t<e.length-1;t++)e[t].length>0&&i.enqueue(e[t]);t=e[e.length-1]}},flush(e){t.length>0&&e.enqueue(t)}})}},tQ=class extends TransformStream{constructor(){super({transform(t,e){let i=JSON.parse(t);e.enqueue(i)}})}};function t0(t,e,i){let r=t.headers.get("X-LB-Warn");if(r){let a=`  \u26A0 [Liveblocks] ${r} (${e} ${i})`;t.ok?console.warn(a):console.error(a)}}var t1=/^[\w-]+$/;async function t2(){return void 0!==globalThis.fetch?globalThis.fetch:(await t.A(96343)).default}function t6(t){return"string"==typeof t}function t5(t,e){if(!(t6(t)&&t.length>0))throw Error(`Invalid value for field '${e}'. Please provide a non-empty string. For more information: https://liveblocks.io/docs/api-reference/liveblocks-node#authorize`)}function t4(t){return t>=200&&t<300?200:t>=500?503:t}var t3=Object.freeze(["room:write","room:read","room:presence:write","comments:write","comments:read"]),t8=Object.freeze(["room:read","room:presence:write","comments:read"]),t7=Object.freeze(["room:write","comments:write"]),t9=/^([*]|[^*]{1,128}[*]?)$/,et=class{FULL_ACCESS=t7;READ_ACCESS=t8;#D;#$;#L;#N;#U;#j=!1;#M=new Map;constructor(t,e,i,r,a){t5(e,"userId"),this.#D=t,this.#$=e,this.#L=i,this.#N=r,this.#U=a??!1}#K(t){if(this.#j)throw Error("You can no longer change these permissions.");let e=this.#M.get(t);if(e)return e;if(this.#M.size>=10)throw Error("You cannot add permissions for more than 10 rooms in a single token");return e=new Set,this.#M.set(t,e),e}allow(t,e){if("string"!=typeof t)throw Error("Room name or pattern must be a string");if(!t9.test(t))throw Error("Invalid room name or pattern");if(0===e.length)throw Error("Permission list cannot be empty");let i=this.#K(t);for(let t of e){if(!t3.includes(t))throw Error(`Not a valid permission: ${t}`);i.add(t)}return this}hasPermissions(){return this.#M.size>0}seal(){if(this.#j)throw Error("You cannot reuse Session instances. Please create a new session every time.");this.#j=!0}serializePermissions(){return Object.fromEntries(Array.from(this.#M.entries()).map(([t,e])=>[t,Array.from(e)]))}async authorize(){this.seal(),this.hasPermissions()||console.warn("Access tokens without any permission will not be supported soon, you should use wildcards when the client requests a token for resources outside a room. See https://liveblocks.io/docs/errors/liveblocks-client/access-tokens-not-enough-permissions");try{let t={userId:this.#$,permissions:this.serializePermissions(),userInfo:this.#L};void 0!==this.#N&&(t.organizationId=this.#N);let e=await this.#D(ti`/v2/authorize-user`,t);return{status:t4(e.status),body:await e.text()}}catch(t){return{status:503,body:this.#U?"Could not connect to your Liveblocks dev server. Is it running?":'Call to /v2/authorize-user failed. See "error" for more information.',error:t}}}};function ee(t){let e=new Date(t.createdAt),i=t.lastConnectionAt?new Date(t.lastConnectionAt):void 0;return{...t,createdAt:e,lastConnectionAt:i}}function ei(t){return{...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt),lastUsedAt:t.lastUsedAt?new Date(t.lastUsedAt):void 0}}function er(t){return{...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt),lastIndexedAt:new Date(t.lastIndexedAt)}}function ea(t){return{...t,createdAt:new Date(t.createdAt),lastIndexedAt:new Date(t.lastIndexedAt)}}var eo=class{#z;#B;#U;constructor(t){const e=t.secret;!function(t,e){if(!(t6(t)&&t.startsWith("sk_")))throw Error(`Invalid value for field '${e}'. Secret keys must start with 'sk_'. Please provide the secret key from your Liveblocks dashboard at https://liveblocks.io/dashboard/apikeys.`);if(!t1.test(t))throw Error(`Invalid chars found in field '${e}'. Please check that you correctly copied the secret key from your Liveblocks dashboard at https://liveblocks.io/dashboard/apikeys.`)}(e,"secret"),this.#z=e,this.#B=new URL(function(t){return"string"==typeof t&&t.startsWith("http")?t:"https://api.liveblocks.io"}(t.baseUrl)),this.#U=!!t.baseUrl&&/^https?:\/\/localhost[:/]/.test(t.baseUrl)}async #H(t,e,i){let r=te(this.#B,t),a={Authorization:`Bearer ${this.#z}`,"Content-Type":"application/json"},o=await t2(),s=await o(r,{method:"POST",headers:a,body:JSON.stringify(e),signal:i?.signal});return t0(s,"POST",t),s}async #W(t,e,i,r){let a=te(this.#B,t,i),o={Authorization:`Bearer ${this.#z}`,"Content-Type":"application/octet-stream"},s=await t2(),n=await s(a,{method:"PUT",headers:o,body:e,signal:r?.signal});return t0(n,"PUT",t),n}async #q(t,e,i){let r=te(this.#B,t,e),a={Authorization:`Bearer ${this.#z}`},o=await t2(),s=await o(r,{method:"DELETE",headers:a,signal:i?.signal});return t0(s,"DELETE",t),s}async #G(t,e,i){let r=te(this.#B,t,e),a={Authorization:`Bearer ${this.#z}`},o=await t2(),s=await o(r,{method:"GET",headers:a,signal:i?.signal});return t0(s,"GET",t),s}prepareSession(t,...e){let i=e[0];return new et(this.#H.bind(this),t,i?.userInfo,i?.organizationId??i?.tenantId,this.#U)}async identifyUser(t,...e){let i=e[0],r=ti`/v2/identify-user`,{userId:a,groupIds:o,tenantId:s,organizationId:n}="string"==typeof t?{userId:t,groupIds:void 0,tenantId:void 0,organizationId:void 0}:t;t5(a,"userId");let d={userId:a,groupIds:o,userInfo:i?.userInfo};void 0!==n?d.organizationId=n:void 0!==s&&(d.organizationId=s);try{let t=await this.#H(r,d);return{status:t4(t.status),body:await t.text()}}catch(t){return{status:503,body:this.#U?"Could not connect to your Liveblocks dev server. Is it running?":`Call to ${te(this.#B,r)} failed. See "error" for more information.`,error:t}}}async getRooms(t={},e){let i,r=ti`/v2/rooms`;"string"==typeof t.query?i=t.query:"object"==typeof t.query&&(i=J(t.query));let a={limit:t.limit,startingAfter:t.startingAfter,userId:t.userId,groupIds:t.groupIds?t.groupIds.join(","):void 0,query:i};void 0!==t.organizationId?a.organizationId=t.organizationId:void 0!==t.tenantId&&(a.organizationId=t.tenantId);let o=await this.#G(r,a,e);if(!o.ok)throw await es.from(o);let s=await o.json(),n=s.data.map(ee);return{...s,data:n}}async *iterRooms(t,e){let i,{signal:r}=e??{},a=tW("pageSize",e?.pageSize??40,20);for(;;){let{nextCursor:e,data:o}=await this.getRooms({...t,startingAfter:i,limit:a},{signal:r});for(let t of o)yield t;if(!e)break;i=e}}async createRoom(t,e,i){let{defaultAccesses:r,groupsAccesses:a,usersAccesses:o,metadata:s,tenantId:n,organizationId:d,engine:h}=e,l={id:t,defaultAccesses:r,groupsAccesses:a,usersAccesses:o,metadata:s,engine:h};void 0!==d?l.organizationId=d:void 0!==n&&(l.organizationId=n);let u=await this.#H(i?.idempotent?ti`/v2/rooms?idempotent`:ti`/v2/rooms`,l,i);if(!u.ok)throw await es.from(u);return ee(await u.json())}async getOrCreateRoom(t,e,i){return await this.createRoom(t,e,{...i,idempotent:!0})}async upsertRoom(t,e,i){let r=await this.#H(ti`/v2/rooms/${t}/upsert`,e,i);if(!r.ok)throw await es.from(r);return ee(await r.json())}async getRoom(t,e){let i=await this.#G(ti`/v2/rooms/${t}`,void 0,e);if(!i.ok)throw await es.from(i);return ee(await i.json())}async updateRoom(t,e,i){let{defaultAccesses:r,groupsAccesses:a,usersAccesses:o,metadata:s}=e,n=await this.#H(ti`/v2/rooms/${t}`,{defaultAccesses:r,groupsAccesses:a,usersAccesses:o,metadata:s},i);if(!n.ok)throw await es.from(n);return ee(await n.json())}async deleteRoom(t,e){let i=await this.#q(ti`/v2/rooms/${t}`,void 0,e);if(!i.ok)throw await es.from(i)}async prewarmRoom(t,e){let i=await this.#G(ti`/v2/rooms/${t}/prewarm`,void 0,e);if(!i.ok)throw await es.from(i)}async getActiveUsers(t,e){let i=await this.#G(ti`/v2/rooms/${t}/active_users`,void 0,e);if(!i.ok)throw await es.from(i);return await i.json()}async broadcastEvent(t,e,i){let r=await this.#H(ti`/v2/rooms/${t}/broadcast_event`,e,i);if(!r.ok)throw await es.from(r)}async setPresence(t,e,i){let r=await this.#H(ti`/v2/rooms/${t}/presence`,{userId:e.userId,data:e.data,userInfo:e.userInfo,ttl:e.ttl},i);if(!r.ok)throw await es.from(r)}async getStorageDocument(t,e="plain-lson",i){let r=await this.#G(ti`/v2/rooms/${t}/storage`,{format:e},i);if(!r.ok)throw await es.from(r);return await r.json()}async #F(t,e){let i=await this.#H(ti`/v2/rooms/${t}/request-storage-mutation`,{},e);if(!i.ok)throw await es.from(i);if("application/x-ndjson"!==i.headers.get("content-type"))throw Error("Unexpected response content type");if(null===i.body)throw Error("Unexpected null body in response");let r=i.body.pipeThrough(new TextDecoderStream).pipeThrough(new tZ).pipeThrough(new tQ)[Symbol.asyncIterator](),a=(await r.next()).value;if(!H(a)||"number"!=typeof a.actor)throw Error("Failed to obtain a unique session");let o=await tX(r);return{actor:a.actor,nodes:o}}async initializeStorageDocument(t,e,i){let r=await this.#H(ti`/v2/rooms/${t}/storage`,e,i);if(!r.ok)throw await es.from(r);return await r.json()}async deleteStorageDocument(t,e){let i=await this.#q(ti`/v2/rooms/${t}/storage`,void 0,e);if(!i.ok)throw await es.from(i)}async getYjsDocument(t,e={},i){let{format:r,key:a,type:o}=e,s=ti`v2/rooms/${t}/ydoc`,n=await this.#G(s,{formatting:r?"true":void 0,key:a,type:o},i);if(!n.ok)throw await es.from(n);return await n.json()}async sendYjsBinaryUpdate(t,e,i={},r){let a=await this.#W(ti`/v2/rooms/${t}/ydoc`,e,{guid:i.guid},r);if(!a.ok)throw await es.from(a)}async getYjsDocumentAsBinaryUpdate(t,e={},i){let r=await this.#G(ti`/v2/rooms/${t}/ydoc-binary`,{guid:e.guid},i);if(!r.ok)throw await es.from(r);return r.arrayBuffer()}async getThreads(t,e){let i,{roomId:r}=t;"string"==typeof t.query?i=t.query:"object"==typeof t.query&&(i=J(t.query));let a=await this.#G(ti`/v2/rooms/${r}/threads`,{query:i},e);if(!a.ok)throw await es.from(a);let{data:o}=await a.json();return{data:o.map(t=>R(t))}}async getThread(t,e){let{roomId:i,threadId:r}=t,a=await this.#G(ti`/v2/rooms/${i}/threads/${r}`,void 0,e);if(!a.ok)throw await es.from(a);return R(await a.json())}async getThreadParticipants(t,e){let{roomId:i,threadId:r}=t,a=await this.#G(ti`/v2/rooms/${i}/threads/${r}/participants`,void 0,e);if(!a.ok)throw await es.from(a);return await a.json()}async getThreadSubscriptions(t,e){let{roomId:i,threadId:r}=t,a=await this.#G(ti`/v2/rooms/${i}/threads/${r}/subscriptions`,void 0,e);if(!a.ok)throw await es.from(a);let{data:o}=await a.json();return{data:o.map(P)}}async getComment(t,e){let{roomId:i,threadId:r,commentId:a}=t,o=await this.#G(ti`/v2/rooms/${i}/threads/${r}/comments/${a}`,void 0,e);if(!o.ok)throw await es.from(o);return k(await o.json())}async createComment(t,e){let{roomId:i,threadId:r,data:a}=t,o=await this.#H(ti`/v2/rooms/${i}/threads/${r}/comments`,{...a,createdAt:a.createdAt?.toISOString()},e);if(!o.ok)throw await es.from(o);return k(await o.json())}async editComment(t,e){let{roomId:i,threadId:r,commentId:a,data:o}=t,s=await this.#H(ti`/v2/rooms/${i}/threads/${r}/comments/${a}`,{body:o.body,editedAt:o.editedAt?.toISOString(),metadata:o.metadata},e);if(!s.ok)throw await es.from(s);return k(await s.json())}async deleteComment(t,e){let{roomId:i,threadId:r,commentId:a}=t,o=await this.#q(ti`/v2/rooms/${i}/threads/${r}/comments/${a}`,void 0,e);if(!o.ok)throw await es.from(o)}async createThread(t,e){let{roomId:i,data:r}=t,a=await this.#H(ti`/v2/rooms/${i}/threads`,{...r,comment:{...r.comment,createdAt:r.comment.createdAt?.toISOString()}},e);if(!a.ok)throw await es.from(a);return R(await a.json())}async deleteThread(t,e){let{roomId:i,threadId:r}=t,a=await this.#q(ti`/v2/rooms/${i}/threads/${r}`,void 0,e);if(!a.ok)throw await es.from(a)}async markThreadAsResolved(t,e){let{roomId:i,threadId:r}=t,a=await this.#H(ti`/v2/rooms/${i}/threads/${r}/mark-as-resolved`,{userId:t.data.userId},e);if(!a.ok)throw await es.from(a);return R(await a.json())}async markThreadAsUnresolved(t,e){let{roomId:i,threadId:r}=t,a=await this.#H(ti`/v2/rooms/${i}/threads/${r}/mark-as-unresolved`,{userId:t.data.userId},e);if(!a.ok)throw await es.from(a);return R(await a.json())}async subscribeToThread(t,e){var i;let r,{roomId:a,threadId:o}=t,s=await this.#H(ti`/v2/rooms/${a}/threads/${o}/subscribe`,{userId:t.data.userId},e);if(!s.ok)throw await es.from(s);return r=new Date((i=await s.json()).createdAt),{...i,createdAt:r}}async unsubscribeFromThread(t,e){let{roomId:i,threadId:r}=t,a=await this.#H(ti`/v2/rooms/${i}/threads/${r}/unsubscribe`,{userId:t.data.userId},e);if(!a.ok)throw await es.from(a)}async editThreadMetadata(t,e){let{roomId:i,threadId:r,data:a}=t,o=await this.#H(ti`/v2/rooms/${i}/threads/${r}/metadata`,{...a,updatedAt:a.updatedAt?.toISOString()},e);if(!o.ok)throw await es.from(o);return await o.json()}async editCommentMetadata(t,e){let{roomId:i,threadId:r,commentId:a,data:o}=t,s=await this.#H(ti`/v2/rooms/${i}/threads/${r}/comments/${a}/metadata`,{...o,updatedAt:o.updatedAt?.toISOString()},e);if(!s.ok)throw await es.from(s);return await s.json()}async addCommentReaction(t,e){var i;let{roomId:r,threadId:a,commentId:o,data:s}=t,n=await this.#H(ti`/v2/rooms/${r}/threads/${a}/comments/${o}/add-reaction`,{...s,createdAt:s.createdAt?.toISOString()},e);if(!n.ok)throw await es.from(n);return{...i=await n.json(),createdAt:new Date(i.createdAt)}}async removeCommentReaction(t,e){let{roomId:i,threadId:r,data:a}=t,o=await this.#H(ti`/v2/rooms/${i}/threads/${r}/comments/${t.commentId}/remove-reaction`,{...a,removedAt:a.removedAt?.toISOString()},e);if(!o.ok)throw await es.from(o)}async getInboxNotification(t,e){let{userId:i,inboxNotificationId:r}=t,a=await this.#G(ti`/v2/users/${i}/inbox-notifications/${r}`,void 0,e);if(!a.ok)throw await es.from(a);return x(await a.json())}async getInboxNotifications(t,e){let i,{userId:r,tenantId:a,organizationId:o,limit:s,startingAfter:n}=t;"string"==typeof t.query?i=t.query:"object"==typeof t.query&&(i=J(t.query));let d={query:i,limit:s,startingAfter:n};void 0!==o?d.organizationId=o:void 0!==a&&(d.organizationId=a);let h=await this.#G(ti`/v2/users/${r}/inbox-notifications`,d,e);if(!h.ok)throw await es.from(h);let l=await h.json();return{...l,data:l.data.map(x)}}async *iterInboxNotifications(t,e){let i,{signal:r}=e??{},a=tW("pageSize",e?.pageSize??50,10);for(;;){let{nextCursor:e,data:o}=await this.getInboxNotifications({...t,startingAfter:i,limit:a},{signal:r});for(let t of o)yield t;if(!e)break;i=e}}async getUserRoomSubscriptionSettings(t,e){let{userId:i,tenantId:r,organizationId:a,startingAfter:o,limit:s}=t,n={startingAfter:o,limit:s};void 0!==a?n.organizationId=a:void 0!==r&&(n.organizationId=r);let d=await this.#G(ti`/v2/users/${i}/room-subscription-settings`,n,e);if(!d.ok)throw await es.from(d);return await d.json()}async getRoomSubscriptionSettings(t,e){let{userId:i,roomId:r}=t,a=await this.#G(ti`/v2/rooms/${r}/users/${i}/subscription-settings`,void 0,e);if(!a.ok)throw await es.from(a);return await a.json()}async updateRoomSubscriptionSettings(t,e){let{userId:i,roomId:r,data:a}=t,o=await this.#H(ti`/v2/rooms/${r}/users/${i}/subscription-settings`,a,e);if(!o.ok)throw await es.from(o);return await o.json()}async deleteRoomSubscriptionSettings(t,e){let{userId:i,roomId:r}=t,a=await this.#q(ti`/v2/rooms/${r}/users/${i}/subscription-settings`,void 0,e);if(!a.ok)throw await es.from(a)}async updateRoomId(t,e){let{currentRoomId:i,newRoomId:r}=t,a=await this.#H(ti`/v2/rooms/${i}/update-room-id`,{newRoomId:r},e);if(!a.ok)throw await es.from(a);return ee(await a.json())}async triggerInboxNotification(t,e){let{tenantId:i,organizationId:r,...a}=t,o={...a};void 0!==r?o.organizationId=r:void 0!==i&&(o.organizationId=i);let s=await this.#H(ti`/v2/inbox-notifications/trigger`,o,e);if(!s.ok)throw await es.from(s)}async deleteInboxNotification(t,e){let{userId:i,inboxNotificationId:r}=t,a=await this.#q(ti`/v2/users/${i}/inbox-notifications/${r}`,void 0,e);if(!a.ok)throw await es.from(a)}async deleteAllInboxNotifications(t,e){let{userId:i,tenantId:r,organizationId:a}=t,o={};void 0!==a?o.organizationId=a:void 0!==r&&(o.organizationId=r);let s=await this.#q(ti`/v2/users/${i}/inbox-notifications`,o,e);if(!s.ok)throw await es.from(s)}async getNotificationSettings(t,e){let{userId:i}=t,r=await this.#G(ti`/v2/users/${i}/notification-settings`,void 0,e);if(!r.ok)throw await es.from(r);return ts(await r.json())}async updateNotificationSettings(t,e){let{userId:i,data:r}=t,a=await this.#H(ti`/v2/users/${i}/notification-settings`,r,e);if(!a.ok)throw await es.from(a);return ts(await a.json())}async deleteNotificationSettings(t,e){let{userId:i}=t,r=await this.#q(ti`/v2/users/${i}/notification-settings`,void 0,e);if(!r.ok)throw await es.from(r)}async createGroup(t,e){let{tenantId:i,organizationId:r,...a}=t,o={...a,id:t.groupId};void 0!==r?o.organizationId=r:void 0!==i&&(o.organizationId=i);let s=await this.#H(ti`/v2/groups`,o,e);if(!s.ok)throw await es.from(s);return D(await s.json())}async getGroup(t,e){let i=await this.#G(ti`/v2/groups/${t.groupId}`,void 0,e);if(!i.ok)throw await es.from(i);return D(await i.json())}async addGroupMembers(t,e){let i=await this.#H(ti`/v2/groups/${t.groupId}/add-members`,{memberIds:t.memberIds},e);if(!i.ok)throw await es.from(i);return D(await i.json())}async removeGroupMembers(t,e){let i=await this.#H(ti`/v2/groups/${t.groupId}/remove-members`,{memberIds:t.memberIds},e);if(!i.ok)throw await es.from(i);return D(await i.json())}async deleteGroup(t,e){let i=await this.#q(ti`/v2/groups/${t.groupId}`,void 0,e);if(!i.ok)throw await es.from(i)}async getGroups(t,e){let i=await this.#G(ti`/v2/groups`,{startingAfter:t?.startingAfter,limit:t?.limit},e);if(!i.ok)throw await es.from(i);let r=await i.json();return{...r,data:r.data.map(D)}}async getUserGroups(t,e){let{userId:i,startingAfter:r,limit:a}=t,o=await this.#G(ti`/v2/users/${i}/groups`,{startingAfter:r,limit:a},e);if(!o.ok)throw await es.from(o);let s=await o.json();return{...s,data:s.data.map(D)}}async mutateStorage(t,e,i){return this.#J(t,void 0,e,i)}async massMutateStorage(t,e,i){let r=tW("concurrency",i?.concurrency??8,1,20),a=Math.max(20,4*r),{signal:o}=i??{},s=this.iterRooms(t,{pageSize:a,signal:o}),n={signal:o};await tV(s,t=>this.#J(t.id,t,e,n),r)}async #J(t,e,i,r){var a;let o,s,{signal:n,abort:d}=(a=r?.signal,o=new AbortController,{signal:a?AbortSignal.any([o.signal,a]):o.signal,abort:o.abort.bind(o)}),h=[],l=performance.now(),u=e=>{if(0===h.length||s)return;let i=performance.now();if(!(e||i-l>200))return;l=i;let r=h;h=[],s=this.#Y(t,[{type:tH.UPDATE_STORAGE,ops:r}],{signal:n}).catch(t=>{d(t)}).finally(()=>{s=void 0})};try{let{actor:r,nodes:a}=await this.#F(t,{signal:n}),o=function(t,e){let{getCurrentConnectionId:i,onDispatch:r,isStorageWritable:a=()=>!0}=e,o=0,s=0,n=new Map;return{roomId:t,nodes:n,getNode:t=>n.get(t),addNode:(t,e)=>void n.set(t,e),deleteNode:t=>void n.delete(t),generateId:()=>`${i()}:${o++}`,generateOpId:()=>`${i()}:${s++}`,dispatch(t,e,i){r?.(t,e,i)},assertStorageIsWritable:()=>{if(!a())throw Error("Cannot write to storage with a read only user, please ensure the user has write permissions")}}}(t,{getCurrentConnectionId:()=>r,onDispatch:(t,e,i)=>{if(0!==t.length){for(let e of t)h.push(e);u(!1)}}}),s=tL._fromItems(a,o),d=i({room:e,root:s});u(!0),await d}catch(t){throw d(),t}finally{await s,u(!0),await s}}async #Y(t,e,i){let r=await this.#H(ti`/v2/rooms/${t}/send-message`,{messages:e},{signal:i?.signal});if(!r.ok)throw await es.from(r)}async getAiCopilots(t={},e){let i=await this.#G(ti`/v2/ai/copilots`,{limit:t.limit,startingAfter:t.startingAfter},e);if(!i.ok)throw await es.from(i);let r=await i.json();return{...r,data:r.data.map(ei)}}async createAiCopilot(t,e){let i=await this.#H(ti`/v2/ai/copilots`,t,e);if(!i.ok)throw await es.from(i);return ei(await i.json())}async getAiCopilot(t,e){let i=await this.#G(ti`/v2/ai/copilots/${t}`,void 0,e);if(!i.ok)throw await es.from(i);return ei(await i.json())}async updateAiCopilot(t,e,i){let r=await this.#H(ti`/v2/ai/copilots/${t}`,e,i);if(!r.ok)throw await es.from(r);return ei(await r.json())}async deleteAiCopilot(t,e){let i=await this.#q(ti`/v2/ai/copilots/${t}`,void 0,e);if(!i.ok)throw await es.from(i)}async createWebKnowledgeSource(t,e){let i=await this.#H(ti`/v2/ai/copilots/${t.copilotId}/knowledge/web`,t,e);if(!i.ok)throw await es.from(i);return await i.json()}async createFileKnowledgeSource(t,e){let i=await t2(),r=await i(te(this.#B,ti`/v2/ai/copilots/${t.copilotId}/knowledge/file/${t.file.name}`),{method:"PUT",body:t.file,headers:{Authorization:`Bearer ${this.#z}`,"Content-Type":t.file.type,"Content-Length":String(t.file.size)},signal:e?.signal});if(!r.ok)throw await es.from(r);return await r.json()}async deleteFileKnowledgeSource(t,e){let i=await this.#q(ti`/v2/ai/copilots/${t.copilotId}/knowledge/file/${t.knowledgeSourceId}`,void 0,e);if(!i.ok)throw await es.from(i)}async deleteWebKnowledgeSource(t,e){let i=await this.#q(ti`/v2/ai/copilots/${t.copilotId}/knowledge/web/${t.knowledgeSourceId}`,void 0,e);if(!i.ok)throw await es.from(i)}async getKnowledgeSources(t,e){let i=await this.#G(ti`/v2/ai/copilots/${t.copilotId}/knowledge`,{limit:t.limit,startingAfter:t.startingAfter},e);if(!i.ok)throw await es.from(i);let r=await i.json();return{...r,data:r.data.map(er)}}async getKnowledgeSource(t,e){let i=await this.#G(ti`/v2/ai/copilots/${t.copilotId}/knowledge/${t.knowledgeSourceId}`,void 0,e);if(!i.ok)throw await es.from(i);return er(await i.json())}async getFileKnowledgeSourceMarkdown(t,e){let i=await this.#G(ti`/v2/ai/copilots/${t.copilotId}/knowledge/file/${t.knowledgeSourceId}`,void 0,e);if(!i.ok)throw await es.from(i);return(await i.json()).content}async getWebKnowledgeSourceLinks(t,e){let i=await this.#G(ti`/v2/ai/copilots/${t.copilotId}/knowledge/web/${t.knowledgeSourceId}/links`,{limit:t.limit,startingAfter:t.startingAfter},e);if(!i.ok)throw await es.from(i);let r=await i.json();return{...r,data:r.data.map(ea)}}},es=class t extends Error{status;details;constructor(t,e,i){super(t),this.name="LiveblocksError",this.status=e,this.details=i}toString(){let t=`${this.name}: ${this.message} (status ${this.status})`;return this.details&&(t+=`
${this.details}`),t}static async from(e){let i,r=Error();Error.captureStackTrace(r,t.from);let a="An error happened without an error message";try{i=await e.text()}catch{i=a}let o=function(t){try{return JSON.parse(t)}catch(t){return}}(i)??{message:i},s=o.message||a,n=[o.suggestion?`Suggestion: ${String(o.suggestion)}`:void 0,o.docs?`See also: ${String(o.docs)}`:void 0].filter(Boolean).join("\n")||void 0,d=new t(s,e.status,n);return d.stack=r.stack,d}};S("@liveblocks/node","3.14.0","esm");var en=t.i(89171);let ed=new eo({secret:(process.env.LIVEBLOCKS_SECRET_KEY||"").trim()||"sk_dev_dummy_key_for_build"});async function eh(t){try{let e=await t.json().catch(()=>({})),i=e.user||{uid:`anon-${Math.floor(1e4*Math.random())}`,displayName:"Player"},r=ed.prepareSession(i.uid,{userInfo:{name:i.displayName||"Unknown User"}}),{room:a}=e;a&&r.allow(a,r.FULL_ACCESS);let{status:o,body:s}=await r.authorize();return new en.NextResponse(s,{status:o})}catch(t){return console.error("Error in liveblocks auth:",t),new en.NextResponse("Authentication error",{status:500})}}t.s(["POST",()=>eh],76457);var el=t.i(76457);let eu=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/liveblocks-auth/route",pathname:"/api/liveblocks-auth",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/liveblocks-auth/route.ts",nextConfigOutput:"",userland:el}),{workAsyncStorage:ec,workUnitAsyncStorage:ep,serverHooks:ef}=eu;function em(){return(0,s.patchFetch)({workAsyncStorage:ec,workUnitAsyncStorage:ep})}async function eg(t,e,i){eu.isDev&&(0,n.addRequestMeta)(t,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/liveblocks-auth/route";r=r.replace(/\/index$/,"")||"/";let a=await eu.prepare(t,e,{srcPage:r,multiZoneDraftMode:!1});if(!a)return e.statusCode=400,e.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:s,params:E,nextConfig:b,parsedUrl:I,isDraftMode:A,prerenderManifest:O,routerServerContext:S,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,resolvedPathname:k,clientReferenceManifest:R,serverActionsManifest:x}=a,P=(0,l.normalizeAppPath)(r),D=!!(O.dynamicRoutes[P]||O.routes[k]),$=async()=>((null==S?void 0:S.render404)?await S.render404(t,e,I,!1):e.end("This page could not be found"),null);if(D&&!A){let t=!!O.routes[k],e=O.dynamicRoutes[P];if(e&&!1===e.fallback&&!t){if(b.experimental.adapterPath)return await $();throw new _.NoFallbackError}}let L=null;!D||eu.isDev||A||(L="/index"===(L=k)?"/":L);let N=!0===eu.isDev||!D,U=D&&!N;x&&R&&(0,h.setManifestsSingleton)({page:r,clientReferenceManifest:R,serverActionsManifest:x});let j=t.method||"GET",M=(0,d.getTracer)(),K=M.getActiveScopeSpan(),z={params:E,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:N,incrementalCache:(0,n.getRequestMeta)(t,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:i.waitUntil,onClose:t=>{e.on("close",t)},onAfterTaskError:void 0,onInstrumentationRequestError:(e,i,r,a)=>eu.onRequestError(t,e,r,a,S)},sharedContext:{buildId:s}},B=new u.NodeNextRequest(t),H=new u.NodeNextResponse(e),W=c.NextRequestAdapter.fromNodeNextRequest(B,(0,c.signalFromNodeResponse)(e));try{let a=async t=>eu.handle(W,z).finally(()=>{if(!t)return;t.setAttributes({"http.status_code":e.statusCode,"next.rsc":!1});let i=M.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=i.get("next.route");if(a){let e=`${j} ${a}`;t.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),t.updateName(e)}else t.updateName(`${j} ${r}`)}),s=!!(0,n.getRequestMeta)(t,"minimalMode"),h=async n=>{var d,h;let l=async({previousCacheEntry:o})=>{try{if(!s&&T&&C&&!o)return e.statusCode=404,e.setHeader("x-nextjs-cache","REVALIDATED"),e.end("This page could not be found"),null;let r=await a(n);t.fetchMetrics=z.renderOpts.fetchMetrics;let d=z.renderOpts.pendingWaitUntil;d&&i.waitUntil&&(i.waitUntil(d),d=void 0);let h=z.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(B,H,r,z.renderOpts.pendingWaitUntil),null;{let t=await r.blob(),e=(0,g.toNodeOutgoingHttpHeaders)(r.headers);h&&(e[w.NEXT_CACHE_TAGS_HEADER]=h),!e["content-type"]&&t.type&&(e["content-type"]=t.type);let i=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,a=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await t.arrayBuffer()),headers:e},cacheControl:{revalidate:i,expire:a}}}}catch(e){throw(null==o?void 0:o.isStale)&&await eu.onRequestError(t,e,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})},!1,S),e}},u=await eu.handleResponse({req:t,nextConfig:b,cacheKey:L,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:s});if(!D)return null;if((null==u||null==(d=u.value)?void 0:d.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(h=u.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||e.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&e.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&D||c.delete(w.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||e.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(B,H,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};K?await h(K):await M.withPropagatedContext(t.headers,()=>M.trace(p.BaseServerSpan.handleRequest,{spanName:`${j} ${r}`,kind:d.SpanKind.SERVER,attributes:{"http.method":j,"http.target":t.url}},h))}catch(e){if(e instanceof _.NoFallbackError||await eu.onRequestError(t,e,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})},!1,S),D)throw e;return await (0,m.sendResponse)(B,H,new Response(null,{status:500})),null}}t.s(["handler",()=>eg,"patchFetch",()=>em,"routeModule",()=>eu,"serverHooks",()=>ef,"workAsyncStorage",()=>ec,"workUnitAsyncStorage",()=>ep],12428)}];

//# sourceMappingURL=node_modules_81931bae._.js.map