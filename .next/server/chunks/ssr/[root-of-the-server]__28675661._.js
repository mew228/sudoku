module.exports=[874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},74898,(a,b,c)=>{var d=a.r(874),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?b.exports=d:(f(d,c),c.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},66181,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(f,d),f.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},f.prototype.resume=function(){this._paused=!1,this.emit("drain");var a=this._driver.messages;a._paused=!1,a.emit("drain")},f.prototype.write=function(a){return!!this.writable&&(this._driver.parse(a),!this._paused)},f.prototype.end=function(a){if(this.writable){void 0!==a&&this.write(a),this.writable=!1;var b=this._driver.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))}},f.prototype.destroy=function(){this.end()};var g=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(g,d),g.prototype.pause=function(){this._driver.io._paused=!0},g.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},g.prototype.write=function(a){return!!this.writable&&("string"==typeof a?this._driver.text(a):this._driver.binary(a),!this._paused)},g.prototype.end=function(a){void 0!==a&&this.write(a)},g.prototype.destroy=function(){},c.IO=f,c.Messages=g},86562,(a,b,c)=>{"use strict";var d=function(){this.clear()};d.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],d.prototype.clear=function(){this._sent={},this._lines=[]},d.prototype.set=function(a,b){if(void 0!==b){a=this._strip(a),b=this._strip(b);var c=a.toLowerCase();(!this._sent.hasOwnProperty(c)||this.ALLOWED_DUPLICATES.indexOf(c)>=0)&&(this._sent[c]=!0,this._lines.push(a+": "+b+"\r\n"))}},d.prototype.toString=function(){return this._lines.join("")},d.prototype._strip=function(a){return a.toString().replace(/^ */,"").replace(/ *$/,"")},b.exports=d},94255,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this._queue=[],this._queueSize=0,this._offset=0};e.prototype.put=function(a){a&&0!==a.length&&(d.isBuffer(a)||(a=d.from(a)),this._queue.push(a),this._queueSize+=a.length)},e.prototype.read=function(a){if(a>this._queueSize)return null;if(0===a)return d.alloc(0);this._queueSize-=a;var b,c,e=this._queue,f=a,g=e[0];if(g.length>=a)if(g.length===a)return e.shift();else return c=g.slice(0,a),e[0]=g.slice(a),c;for(var h=0,i=e.length;h<i&&!(f<e[h].length);h++)f-=e[h].length;return b=e.splice(0,h),f>0&&e.length>0&&(b.push(e[0].slice(0,f)),e[0]=e[0].slice(f)),d.concat(b,a)},e.prototype.eachByte=function(a,b){for(var c,d,e;this._queue.length>0;){for(d=(c=this._queue[0]).length;this._offset<d;)e=this._offset,this._offset+=1,a.call(b,c[e]);this._offset=0,this._queue.shift()}},b.exports=e},30145,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(27699).EventEmitter,f=a.r(24361),g=a.r(66181),h=a.r(86562),i=a.r(94255),j=function(a,b,c){e.call(this),j.validateOptions(c||{},["maxLength","masking","requireMasking","protocols"]),this._request=a,this._reader=new i,this._options=c||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new h,this.__queue=[],this.readyState=0,this.url=b,this.io=new g.IO(this),this.messages=new g.Messages(this),this._bindEventListeners()};f.inherits(j,e),j.isWebSocket=function(a){var b=a.headers.connection||"",c=a.headers.upgrade||"";return"GET"===a.method&&b.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===c.toLowerCase()},j.validateOptions=function(a,b){for(var c in a)if(0>b.indexOf(c))throw Error("Unrecognized option: "+c)};var k={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var a=this;this.messages.on("error",function(){}),this.on("message",function(b){var c=a.messages;c.readable&&c.emit("data",b.data)}),this.on("error",function(b){var c=a.messages;c.readable&&c.emit("error",b)}),this.on("close",function(){var b=a.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(a){return!1},setHeader:function(a,b){return!(this.readyState>0)&&(this._headers.set(a,b),!0)},start:function(){var a;if(0!==this.readyState)return!1;if(!j.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{a=this._handshakeResponse()}catch(a){return this._failHandshake(a)}return this._write(a),-1!==this._stage&&this._open(),!0},_failHandshake:function(a){var b=new h;return b.set("Content-Type","text/plain"),b.set("Content-Length",d.byteLength(a.message,"utf8")),b=["HTTP/1.1 400 Bad Request",b.toString(),a.message],this._write(d.from(b.join("\r\n"),"utf8")),this._fail("protocol_error",a.message),!1},text:function(a){return this.frame(a)},binary:function(a){return!1},ping:function(){return!1},pong:function(){return!1},close:function(a,b){return 1===this.readyState&&(this.readyState=3,this.emit("close",new j.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(a){this.frame.apply(this,a)},this),this.__queue=[],this.emit("open",new j.OpenEvent)},_queue:function(a){return this.__queue.push(a),!0},_write:function(a){var b=this.io;b.readable&&b.emit("data",a)},_fail:function(a,b){this.readyState=2,this.emit("error",Error(b)),this.close()}};for(var l in k)j.prototype[l]=k[l];j.ConnectEvent=function(){},j.OpenEvent=function(){},j.CloseEvent=function(a,b){this.code=a,this.reason=b},j.MessageEvent=function(a){this.data=a},j.PingEvent=function(a){this.data=a},j.PongEvent=function(a){this.data=a},b.exports=j},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},58726,(a,b,c)=>{function d(a){if(void 0!==a&&a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===a||this.initialize(a),this.maxHeaderSize=d.maxHeaderSize}c.HTTPParser=d,d.prototype.initialize=function(a,b){if(a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=a,this.state=a+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},d.encoding="ascii",d.maxHeaderSize=81920,d.REQUEST="REQUEST",d.RESPONSE="RESPONSE";var e=d.kOnHeaders=1,f=d.kOnHeadersComplete=2,g=d.kOnBody=3,h=d.kOnMessageComplete=4;d.prototype[e]=d.prototype[f]=d.prototype[g]=d.prototype[h]=function(){};var i=!0;Object.defineProperty(d,"kOnExecute",{get:function(){return i=!1,99}});var j=c.methods=d.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],k=j.indexOf("CONNECT");d.prototype.reinitialize=d,d.prototype.close=d.prototype.pause=d.prototype.resume=d.prototype.remove=d.prototype.free=function(){},d.prototype._compatMode0_11=!1,d.prototype.getAsyncId=function(){return 0};var l={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};d.prototype.execute=function(a,b,c){if(!(this instanceof d))throw TypeError("not a HTTPParser");b=b||0,c="number"==typeof c?c:a.length,this.chunk=a,this.offset=b;var e=this.end=b+c;try{for(;this.offset<e&&!this[this.state](););}catch(a){if(this.isUserCall)throw a;return this.hadError=!0,a}return(this.chunk=null,c=this.offset-b,l[this.state]&&(this.headerSize+=c,this.headerSize>(this.maxHeaderSize||d.maxHeaderSize)))?Error("max header size exceeded"):c};var m={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};d.prototype.finish=function(){if(!this.hadError){if(!m[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[h]())}},d.prototype.consume=d.prototype.unconsume=d.prototype.getCurrentBuffer=function(){},d.prototype.userCall=function(){this.isUserCall=!0;var a=this;return function(b){return a.isUserCall=!1,b}},d.prototype.nextRequest=function(){this.userCall()(this[h]()),this.reinitialize(this.type)},d.prototype.consumeLine=function(){for(var a=this.end,b=this.chunk,c=this.offset;c<a;c++)if(10===b[c]){var e=this.line+b.toString(d.encoding,this.offset,c);return"\r"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),this.line="",this.offset=c+1,e}this.line+=b.toString(d.encoding,this.offset,this.end),this.offset=this.end};var n=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,o=/^[ \t]+(.*[^ \t])/;d.prototype.parseHeader=function(a,b){if(-1!==a.indexOf("\r"))throw r("HPE_LF_EXPECTED");var c=n.exec(a),d=c&&c[1];if(d)b.push(d),b.push(c[2]);else{var e=o.exec(a);e&&b.length&&(b[b.length-1]&&(b[b.length-1]+=" "),b[b.length-1]+=e[1])}};var p=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;d.prototype.REQUEST_LINE=function(){var a=this.consumeLine();if(a){var b=p.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?b[1]:j.indexOf(b[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=b[2],this.info.versionMajor=+b[3],this.info.versionMinor=+b[4],this.body_bytes=0,this.state="HEADER"}};var q=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function r(a){var b=Error("Parse Error");return b.code=a,b}d.prototype.RESPONSE_LINE=function(){var a=this.consumeLine();if(a){var b=q.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");this.info.versionMajor=+b[1],this.info.versionMinor=+b[2];var c=this.info.statusCode=+b[3];this.info.statusMessage=b[4],((c/100|0)==1||204===c||304===c)&&(this.body_bytes=0),this.state="HEADER"}},d.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},d.prototype.HEADER=function(){var a=this.consumeLine();if(void 0!==a){var b=this.info;if(a)this.parseHeader(a,b.headers);else{for(var c,e,g=b.headers,h=!1,j=!1,l=0;l<g.length;l+=2)switch(g[l].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===g[l+1].toLowerCase();break;case"content-length":if(c=+g[l+1],h){if(c!==this.body_bytes)throw r("HPE_UNEXPECTED_CONTENT_LENGTH")}else h=!0,this.body_bytes=c;break;case"connection":this.connection+=g[l+1].toLowerCase();break;case"upgrade":j=!0}if(this.isChunked&&h&&(h=!1,this.body_bytes=null),j&&-1!=this.connection.indexOf("upgrade")?b.upgrade=this.type===d.REQUEST||101===b.statusCode:b.upgrade=b.method===k,this.isChunked&&b.upgrade&&(this.isChunked=!1),b.shouldKeepAlive=this.shouldKeepAlive(),2===(e=i?this.userCall()(this[f](b)):this.userCall()(this[f](b.versionMajor,b.versionMinor,b.headers,b.method,b.url,b.statusCode,b.statusMessage,b.upgrade,b.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!e)this.state="BODY_CHUNKHEAD";else{if(e||0===this.body_bytes)return this.nextRequest(),b.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},d.prototype.BODY_CHUNKHEAD=function(){var a=this.consumeLine();void 0!==a&&(this.body_bytes=parseInt(a,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},d.prototype.BODY_CHUNK=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},d.prototype.BODY_CHUNKEMPTYLINE=function(){var a=this.consumeLine();if(void 0!==a){if(""!==a)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},d.prototype.BODY_CHUNKTRAILERS=function(){var a=this.consumeLine();void 0!==a&&(a?this.parseHeader(a,this.trailers):(this.trailers.length&&this.userCall()(this[e](this.trailers,"")),this.nextRequest()))},d.prototype.BODY_RAW=function(){this.userCall()(this[g](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},d.prototype.BODY_SIZED=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(a){var b=d["kOn"+a];Object.defineProperty(d.prototype,"on"+a,{get:function(){return this[b]},set:function(a){return this._compatMode0_11=!0,k="CONNECT",this[b]=a}})})},34867,(a,b,c)=>{"use strict";var d=a.r(58726).HTTPParser,e=a.r(74898).Buffer,f={request:d.REQUEST||"request",response:d.RESPONSE||"response"},g=function(a){this._type=a,this._parser=new d(f[a]),this._complete=!1,this.headers={};var b=null,c=this;this._parser.onHeaderField=function(a,c,d){b=a.toString("utf8",c,c+d).toLowerCase()},this._parser.onHeaderValue=function(a,d,e){var f=a.toString("utf8",d,d+e);c.headers.hasOwnProperty(b)?c.headers[b]+=", "+f:c.headers[b]=f},this._parser.onHeadersComplete=this._parser[d.kOnHeadersComplete]=function(a,b,d,e,f,h){var i=arguments[0];if("object"==typeof i&&(e=i.method,f=i.url,h=i.statusCode,d=i.headers),c.method="number"==typeof e?g.METHODS[e]:e,c.statusCode=h,c.url=f,d){for(var j,k,l=0,m=d.length;l<m;l+=2)j=d[l].toLowerCase(),k=d[l+1],c.headers.hasOwnProperty(j)?c.headers[j]+=", "+k:c.headers[j]=k;c._complete=!0}}};g.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var h=process.version?process.version.match(/[0-9]+/g).map(function(a){return parseInt(a,10)}):[];0===h[0]&&12===h[1]&&(g.METHODS[16]="REPORT",g.METHODS[17]="MKACTIVITY",g.METHODS[18]="CHECKOUT",g.METHODS[19]="MERGE",g.METHODS[20]="M-SEARCH",g.METHODS[21]="NOTIFY",g.METHODS[22]="SUBSCRIBE",g.METHODS[23]="UNSUBSCRIBE",g.METHODS[24]="PATCH",g.METHODS[25]="PURGE"),g.prototype.isComplete=function(){return this._complete},g.prototype.parse=function(a){var b=this._parser.execute(a,0,a.length);if("number"!=typeof b){this.error=b,this._complete=!0;return}this._complete&&(this.body=b<a.length?a.slice(b):e.alloc(0))},b.exports=g},6073,(a,b,c)=>{"use strict";var d=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,e=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,f=RegExp(d.source+"(?:=(?:"+d.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),g=RegExp(d.source+"(?: *; *"+f.source+")*","g"),h=RegExp("^"+g.source+"(?: *, *"+g.source+")*$"),i=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,j=Object.prototype.hasOwnProperty,k=function(){this._byName={},this._inOrder=[]};k.prototype.push=function(a,b){j.call(this._byName,a)||(this._byName[a]=[]),this._byName[a].push(b),this._inOrder.push({name:a,params:b})},k.prototype.eachOffer=function(a,b){for(var c=this._inOrder,d=0,e=c.length;d<e;d++)a.call(b,c[d].name,c[d].params)},k.prototype.byName=function(a){return this._byName[a]||[]},k.prototype.toArray=function(){return this._inOrder.slice()},b.exports={parseHeader:function(a){var b=new k;if(""===a||void 0===a)return b;if(!h.test(a))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+a);return a.match(g).forEach(function(a){var c=a.match(RegExp(f.source,"g")),d=c.shift(),e={};c.forEach(function(a){var b,c=a.match(f),d=c[1];b=void 0!==c[2]?c[2]:void 0===c[3]||c[3].replace(/\\/g,""),i.test(b)&&(b=parseFloat(b)),j.call(e,d)?(e[d]=[].concat(e[d]),e[d].push(b)):e[d]=b},this),b.push(d,e)},this),b},serializeParams:function(a,b){var c=[],d=function(a,b){b instanceof Array?b.forEach(function(b){d(a,b)}):!0===b?c.push(a):"number"==typeof b?c.push(a+"="+b):e.test(b)?c.push(a+'="'+b.replace(/"/g,'\\"')+'"'):c.push(a+"="+b)};for(var f in b)d(f,b[f]);return[a].concat(c).join("; ")}}},21777,(a,b,c)=>{"use strict";var d=function(a){this._bufferSize=a,this.clear()};d.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},d.prototype.push=function(a){var b=!1,c=!1;this._ringSize<this._bufferSize?b=0===this._tail:this._ringOffset===this._ringSize&&(b=!0,c=0===this._tail),b&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,c&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=a,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},d.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},d.prototype.shift=function(){if(0!==this.length){var a=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,a}},b.exports=d},76503,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(a,b){this._session=a,this._method=b,this._queue=new d(e.QUEUE_SIZE),this._stopped=!1,this.pending=0};e.QUEUE_SIZE=8,e.prototype.call=function(a,b,c,d){if(!this._stopped){var e={error:a,message:b,callback:c,context:d,done:!1},f=!1,g=this;if(this._queue.push(e),e.error)return e.done=!0,this._stop(),this._flushQueue();var h=function(a,b){f^(f=!0)&&(a?(g._stop(),e.error=a,e.message=null):e.message=b,e.done=!0,g._flushQueue())};try{this._session[this._method](b,h)}catch(a){h(a)}}},e.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},e.prototype._flushQueue=function(){for(var a,b=this._queue;b.length>0&&b.peek().done;)(a=b.shift()).error?(this.pending=0,b.clear()):this.pending-=1,a.callback.call(a.context,a.error,a.message)},b.exports=e},52681,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(){this._complete=!1,this._callbacks=new d(e.QUEUE_SIZE)};e.QUEUE_SIZE=4,e.all=function(a){var b=new e,c=a.length,d=c;for(0===c&&b.done();d--;)a[d].then(function(){0==(c-=1)&&b.done()});return b},e.prototype.then=function(a){this._complete?a():this._callbacks.push(a)},e.prototype.done=function(){this._complete=!0;for(var a,b=this._callbacks;a=b.shift();)a()},b.exports=e},4698,(a,b,c)=>{"use strict";var d=a.r(76503),e=a.r(52681),f=function(a){this._ext=a[0],this._session=a[1],this._functors={incoming:new d(this._session,"processIncomingMessage"),outgoing:new d(this._session,"processOutgoingMessage")}};f.prototype.pending=function(a){var b=this._functors[a];b._stopped||(b.pending+=1)},f.prototype.incoming=function(a,b,c,d){this._exec("incoming",a,b,c,d)},f.prototype.outgoing=function(a,b,c,d){this._exec("outgoing",a,b,c,d)},f.prototype.close=function(){return this._closed=this._closed||new e,this._doClose(),this._closed},f.prototype._exec=function(a,b,c,d,e){this._functors[a].call(b,c,function(a,b){a&&(a.message=this._ext.name+": "+a.message),d.call(e,a,b),this._doClose()},this)},f.prototype._doClose=function(){var a=this._functors.incoming,b=this._functors.outgoing;this._closed&&a.pending+b.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},b.exports=f},67900,(a,b,c)=>{"use strict";var d=a.r(4698),e=a.r(52681),f=function(a){this._cells=a.map(function(a){return new d(a)}),this._stopped={incoming:!1,outgoing:!1}};f.prototype.processIncomingMessage=function(a,b,c){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,a,b,c)},f.prototype.processOutgoingMessage=function(a,b,c){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,a,b,c)},f.prototype.close=function(a,b){this._stopped={incoming:!0,outgoing:!0};var c=this._cells.map(function(a){return a.close()});a&&e.all(c).then(function(){a.call(b)})},f.prototype._loop=function(a,b,c,d,e,f,g){for(var h=this._cells,i=h.length,j=this;i--;)h[i].pending(a);var k=function(b,e,i){if(b===c)return f.call(g,e,i);h[b][a](e,i,function(c,e){c&&(j._stopped[a]=!0),k(b+d,c,e)})};k(b,null,e)},b.exports=f},64081,(a,b,c)=>{"use strict";var d=a.r(6073),e=a.r(67900),f=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};f.MESSAGE_OPCODES=[1,2];var g={add:function(a){if("string"!=typeof a.name)throw TypeError("extension.name must be a string");if("permessage"!==a.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof a.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof a.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof a.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(a.name))throw TypeError('An extension with name "'+a.name+'" is already registered');this._byName[a.name]=a,this._inOrder.push(a)},generateOffer:function(){var a=[],b=[],c={};return this._inOrder.forEach(function(e){var f=e.createClientSession();if(f){var g=[e,f];a.push(g),c[e.name]=g;var h=f.generateOffer();(h=h?[].concat(h):[]).forEach(function(a){b.push(d.serializeParams(e.name,a))},this)}},this),this._sessions=a,this._index=c,b.length>0?b.join(", "):null},activate:function(a){var b=d.parseHeader(a),c=[];b.eachOffer(function(a,b){var e=this._index[a];if(!e)throw Error('Server sent an extension response for unknown extension "'+a+'"');var f=e[0],g=e[1],h=this._reserved(f);if(h)throw Error("Server sent two extension responses that use the RSV"+h[0]+' bit: "'+h[1]+'" and "'+f.name+'"');if(!0!==g.activate(b))throw Error("Server sent unacceptable extension parameters: "+d.serializeParams(a,b));this._reserve(f),c.push(e)},this),this._sessions=c,this._pipeline=new e(c)},generateResponse:function(a){var b=[],c=[],f=d.parseHeader(a);return this._inOrder.forEach(function(a){var e=f.byName(a.name);if(!(0===e.length||this._reserved(a))){var g=a.createServerSession(e);g&&(this._reserve(a),b.push([a,g]),c.push(d.serializeParams(a.name,g.generateResponse())))}},this),this._sessions=b,this._pipeline=new e(b),c.length>0?c.join(", "):null},validFrameRsv:function(a){var b,c={rsv1:!1,rsv2:!1,rsv3:!1};if(f.MESSAGE_OPCODES.indexOf(a.opcode)>=0)for(var d=0,e=this._sessions.length;d<e;d++)b=this._sessions[d][0],c.rsv1=c.rsv1||b.rsv1,c.rsv2=c.rsv2||b.rsv2,c.rsv3=c.rsv3||b.rsv3;return(c.rsv1||!a.rsv1)&&(c.rsv2||!a.rsv2)&&(c.rsv3||!a.rsv3)},processIncomingMessage:function(a,b,c){this._pipeline.processIncomingMessage(a,b,c)},processOutgoingMessage:function(a,b,c){this._pipeline.processOutgoingMessage(a,b,c)},close:function(a,b){if(!this._pipeline)return a.call(b);this._pipeline.close(a,b)},_reserve:function(a){this._rsv1=this._rsv1||a.rsv1&&a.name,this._rsv2=this._rsv2||a.rsv2&&a.name,this._rsv3=this._rsv3||a.rsv3&&a.name},_reserved:function(a){return this._rsv1&&a.rsv1?[1,this._rsv1]:this._rsv2&&a.rsv2?[2,this._rsv2]:!!this._rsv3&&!!a.rsv3&&[3,this._rsv3]}};for(var h in g)f.prototype[h]=g[h];b.exports=f},46256,(a,b,c)=>{"use strict";var d=function(){},e={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var f in e)d.prototype[f]=e[f];b.exports=d},55887,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},f={read:function(){return this.data=this.data||d.concat(this._chunks,this.length)},pushFrame:function(a){this.rsv1=this.rsv1||a.rsv1,this.rsv2=this.rsv2||a.rsv2,this.rsv3=this.rsv3||a.rsv3,null===this.opcode&&(this.opcode=a.opcode),this._chunks.push(a.payload),this.length+=a.length}};for(var g in f)e.prototype[g]=f[g];b.exports=e},46987,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(24361),g=a.r(64081),h=a.r(30145),i=a.r(46256),j=a.r(55887),k=function(a,b,c){if(h.apply(this,arguments),this._extensions=new g,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var d=this._request.headers["sec-websocket-protocol"],e=this._protocols;void 0!==d&&("string"==typeof d&&(d=d.split(/ *, */)),this.protocol=d.filter(function(a){return e.indexOf(a)>=0})[0]),this.version="hybi-"+k.VERSION}};f.inherits(k,h),k.VERSION="13",k.mask=function(a,b,c){if(!b||0===b.length)return a;c=c||0;for(var d=0,e=a.length-c;d<e;d++)a[c+d]=a[c+d]^b[d%4];return a},k.generateAccept=function(a){var b=e.createHash("sha1");return b.update(a+k.GUID),b.digest("base64")},k.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var l={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(a){return this._extensions.add(a),!0},parse:function(a){this._reader.put(a);for(var b=!0;b;)switch(this._stage){case 0:(b=this._reader.read(1))&&this._parseOpcode(b[0]);break;case 1:(b=this._reader.read(1))&&this._parseLength(b[0]);break;case 2:(b=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(b);break;case 3:(b=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=b);break;case 4:(b=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(b));break;default:b=null}},text:function(a){return!(this.readyState>1)&&this.frame(a,"text")},binary:function(a){return!(this.readyState>1)&&this.frame(a,"binary")},ping:function(a,b){return!(this.readyState>1)&&(a=a||"",b&&(this._pingCallbacks[a]=b),this.frame(a,"ping"))},pong:function(a){return!(this.readyState>1)&&(a=a||"",this.frame(a,"pong"))},close:function(a,b){return(a=a||"",b=b||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new h.CloseEvent(b,a)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(a,"close",b)},this),!0)},frame:function(a,b,c){if(this.readyState<=0)return this._queue([a,b,c]);if(this.readyState>2)return!1;a instanceof Array&&(a=d.from(a)),"number"==typeof a&&(a=a.toString());var f,g,h=new j,k="string"==typeof a;h.rsv1=h.rsv2=h.rsv3=!1,h.opcode=this.OPCODES[b||(k?"text":"binary")],f=k?d.from(a,"utf8"):a,c&&(g=f,(f=d.allocUnsafe(2+g.length)).writeUInt16BE(c,0),g.copy(f,2)),h.data=f;var l=function(a){var b=new i;b.final=!0,b.rsv1=a.rsv1,b.rsv2=a.rsv2,b.rsv3=a.rsv3,b.opcode=a.opcode,b.masked=!!this._masking,b.length=a.data.length,b.payload=a.data,b.masked&&(b.maskingKey=e.randomBytes(4)),this._sendFrame(b)};return this.MESSAGE_OPCODES.indexOf(h.opcode)>=0?this._extensions.processOutgoingMessage(h,function(a,b){if(a)return this._fail("extension_error",a.message);l.call(this,b)},this):l.call(this,h),!0},_sendFrame:function(a){var b=a.length,c=b<=125?2:b<=65535?4:10,e=c+4*!!a.masked,f=d.allocUnsafe(e+b),g=a.masked?this.MASK:0;f[0]=(a.final?this.FIN:0)|(a.rsv1?this.RSV1:0)|(a.rsv2?this.RSV2:0)|(a.rsv3?this.RSV3:0)|a.opcode,b<=125?f[1]=g|b:b<=65535?(f[1]=126|g,f.writeUInt16BE(b,2)):(f[1]=127|g,f.writeUInt32BE(Math.floor(b/0x100000000),2),f.writeUInt32BE(b%0x100000000,6)),a.payload.copy(f,e),a.masked&&(a.maskingKey.copy(f,c),k.mask(f,a.maskingKey,e)),this._write(f)},_handshakeResponse:function(){var a=this._request.headers["sec-websocket-key"],b=this._request.headers["sec-websocket-version"];if(b!==k.VERSION)throw Error("Unsupported WebSocket version: "+b);if("string"!=typeof a)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",k.generateAccept(a)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var c=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);c&&this._headers.set("Sec-WebSocket-Extensions",c);var e=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return d.from(e.join("\r\n"),"utf8")},_shutdown:function(a,b,c){delete this._frame,delete this._message,this._stage=5;var d=1===this.readyState;this.readyState=2,this._extensions.close(function(){d&&this.frame(b,"close",a),this.readyState=3,c&&this.emit("error",Error(b)),this.emit("close",new h.CloseEvent(a,b))},this)},_fail:function(a,b){this.readyState>1||this._shutdown(this.ERRORS[a],b,!0)},_parseOpcode:function(a){var b=[this.RSV1,this.RSV2,this.RSV3].map(function(b){return(a&b)===b}),c=this._frame=new i;return(c.final=(a&this.FIN)===this.FIN,c.rsv1=b[0],c.rsv2=b[1],c.rsv3=b[2],c.opcode=a&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(c))?0>this.OPCODE_CODES.indexOf(c.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+c.opcode):0>this.MESSAGE_OPCODES.indexOf(c.opcode)&&!c.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+c.opcode):this._message&&this.OPENING_OPCODES.indexOf(c.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!c.rsv1+", reserved2 = "+ +!!c.rsv2+", reserved3 = "+ +!!c.rsv3)},_parseLength:function(a){var b=this._frame;if(b.masked=(a&this.MASK)===this.MASK,b.length=a&this.LENGTH,b.length>=0&&b.length<=125){if(this._stage=b.masked?3:4,!this._checkFrameLength())return}else this._stage=2,b.lengthBytes=126===b.length?2:8;if(this._requireMasking&&!b.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(a){var b=this._frame;if(b.length=this._readUInt(a),this._stage=b.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(b.opcode)&&b.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+b.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(a){var b,c,d,e,f,g=this._frame,i=g.payload=k.mask(a,g.maskingKey),l=g.opcode;if(delete this._frame,l===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(g)}if((l===this.OPCODES.text||l===this.OPCODES.binary)&&(this._message=new j,this._message.pushFrame(g)),g.final&&this.MESSAGE_OPCODES.indexOf(l)>=0)return this._emitMessage(this._message);l===this.OPCODES.close&&(c=i.length>=2?i.readUInt16BE(0):null,d=i.length>2?this._encode(i.slice(2)):null,0!==i.length&&!(null!==c&&c>=this.MIN_RESERVED_ERROR&&c<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(c)&&(c=this.ERRORS.protocol_error),(i.length>125||i.length>2&&!d)&&(c=this.ERRORS.protocol_error),this._shutdown(c||this.DEFAULT_ERROR_CODE,d||"")),l===this.OPCODES.ping&&(this.frame(i,"pong"),this.emit("ping",new h.PingEvent(i.toString()))),l===this.OPCODES.pong&&(f=(e=this._pingCallbacks)[b=this._encode(i)],delete e[b],f&&f(),this.emit("pong",new h.PongEvent(i.toString())))},_emitMessage:function(a){var a=this._message;a.read(),delete this._message,this._extensions.processIncomingMessage(a,function(a,b){if(a)return this._fail("extension_error",a.message);var c=b.data;if(b.opcode===this.OPCODES.text&&(c=this._encode(c)),null===c)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new h.MessageEvent(c))},this)},_encode:function(a){try{var b=a.toString("binary",0,a.length);if(!this.UTF8_MATCH.test(b))return null}catch(a){}return a.toString("utf8",0,a.length)},_readUInt:function(a){return 2===a.length?a.readUInt16BE(0):0x100000000*a.readUInt32BE(0)+a.readUInt32BE(4)}};for(var m in l)k.prototype[m]=l[m];b.exports=k},27520,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(88947).Stream,f=a.r(92509),g=a.r(24361),h=a.r(30145),i=a.r(86562),j=a.r(34867),k={"ws:":80,"wss:":443},l=function(a,b,c){this._client=a,this._http=new j("response"),this._origin="object"==typeof a.url?a.url:f.parse(a.url),this._url="object"==typeof b?b:f.parse(b),this._options=c||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new i,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var e=this._url.auth&&d.from(this._url.auth,"utf8").toString("base64");e&&this._headers.set("Proxy-Authorization","Basic "+e)};g.inherits(l,e);var m={setHeader:function(a,b){return 0===this._state&&(this._headers.set(a,b),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var a=this._origin,b=a.port||k[a.protocol],c=["CONNECT "+a.hostname+":"+b+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",d.from(c.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(a){if(!this.writable)return!1;if(this._http.parse(a),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new h.ConnectEvent);else{var b="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(b))}return this.end(),!this._paused},end:function(a){this.writable&&(void 0!==a&&this.write(a),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var n in m)l.prototype[n]=m[n];b.exports=l},17737,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(92509),g=a.r(24361),h=a.r(34867),i=a.r(30145),j=a.r(46987),k=a.r(27520),l=function(a,b){this.version="hybi-"+j.VERSION,j.call(this,null,a,b),this.readyState=-1,this._key=l.generateKey(),this._accept=j.generateAccept(this._key),this._http=new h("response");var c=f.parse(this.url),e=c.auth&&d.from(c.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(c.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(c.pathname||"/")+(c.search||""),this._headers.set("Host",c.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",j.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),e&&this._headers.set("Authorization","Basic "+e)};g.inherits(l,j),l.generateKey=function(){return e.randomBytes(16).toString("base64")};var m={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(a,b){return new k(this,a,b)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(a){return 3===this.readyState?void 0:this.readyState>0?j.prototype.parse.call(this,a):(this._http.parse(a),this._http.isComplete())?void(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body))):void 0},_handshakeRequest:function(){var a=this._extensions.generateOffer();a&&this._headers.set("Sec-WebSocket-Extensions",a);var b=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return d.from(b.join("\r\n"),"utf8")},_failHandshake:function(a){a="Error during WebSocket handshake: "+a,this.readyState=3,this.emit("error",Error(a)),this.emit("close",new i.CloseEvent(this.ERRORS.protocol_error,a))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var a=this._http.headers,b=a.upgrade||"",c=a.connection||"",d=a["sec-websocket-accept"]||"",e=a["sec-websocket-protocol"]||"";if(""===b)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==b.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===c)return this._failHandshake("'Connection' header is missing");if("upgrade"!==c.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(d!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==e)if(0>this._protocols.indexOf(e))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=e;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(a){return this._failHandshake(a.message)}}};for(var n in m)l.prototype[n]=m[n];b.exports=l},10950,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(24361),g=function(a,b,c){e.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};f.inherits(g,e);var h={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},parse:function(a){this.readyState>1||(this._reader.put(a),this._reader.eachByte(function(a){var b;switch(this._stage){case -1:this._body.push(a),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(a);break;case 1:if(this._length=(127&a)+128*this._length,this._closing&&0===this._length)return this.close();(128&a)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===a)this._stage=0,b=d.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new e.MessageEvent(b));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(a),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(a){if(0===this.readyState)return this._queue([a]);if(this.readyState>1)return!1;"string"!=typeof a&&(a=a.toString());var b=d.byteLength(a),c=d.allocUnsafe(b+2);return c[0]=0,c.write(a,1),c[c.length-1]=255,this._write(c),!0},_handshakeResponse:function(){var a=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"utf8")},_parseLeadingByte:function(a){(128&a)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var i in h)g.prototype[i]=h[i];b.exports=g},61123,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(10950),g=a.r(54799),h=a.r(24361),i=function(a){return parseInt((a.match(/[0-9]/g)||[]).join(""),10)},j=function(a){return(a.match(/ /g)||[]).length},k=function(a,b,c){f.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};h.inherits(k,f);var l={BODY_SIZE:8,start:function(){return!!f.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(d.from([255,0])),this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,b=a["sec-websocket-key1"],c=a["sec-websocket-key2"];if(!b)throw Error("Missing required header: Sec-WebSocket-Key1");if(!c)throw Error("Missing required header: Sec-WebSocket-Key2");var e=i(b),f=j(b),g=i(c),h=j(c);if(e%f!=0||g%h!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[e/f,g/h];var a=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var a=g.createHash("md5"),b=d.allocUnsafe(8+this.BODY_SIZE);return b.writeUInt32BE(this._keyValues[0],0),b.writeUInt32BE(this._keyValues[1],4),d.from(this._body).copy(b,8,0,this.BODY_SIZE),a.update(b),d.from(a.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var a=this._handshakeSignature();a&&(this._write(a),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(a){if(255!==a)return f.prototype._parseLeadingByte.call(this,a);this._closing=!0,this._length=0,this._stage=1}};for(var m in l)k.prototype[m]=l[m];b.exports=k},89048,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(34867),f=a.r(30145),g=a.r(10950),h=a.r(61123),i=a.r(46987),j=function(a){f.call(this,null,null,a),this._http=new e("request")};d.inherits(j,f);var k={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(a){if(this._delegate)return this._delegate.parse(a);if(this._http.parse(a),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var b=this;this._delegate=j.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(a){this._delegate.on(a,function(c){b.emit(a,c)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new f.ConnectEvent)}},_open:function(){this.__queue.forEach(function(a){this._delegate[a[0]].apply(this._delegate,a[1])},this),this.__queue=[]}};for(var l in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(a){k[a]=function(){return this._delegate?this._delegate[a].apply(this._delegate,arguments):(this.__queue.push([a,arguments]),!0)}}),k)j.prototype[l]=k[l];j.isSecureRequest=function(a){if(a.connection&&void 0!==a.connection.authorized||a.socket&&a.socket.secure)return!0;var b=a.headers;return!!b&&("on"===b.https||"on"===b["x-forwarded-ssl"]||"https"===b["x-forwarded-scheme"]||"https"===b["x-forwarded-proto"])},j.determineUrl=function(a){return(this.isSecureRequest(a)?"wss:":"ws:")+"//"+a.headers.host+a.url},j.http=function(a,b){void 0===(b=b||{}).requireMasking&&(b.requireMasking=!0);var c=a.headers,d=c["sec-websocket-version"],e=c["sec-websocket-key"],f=c["sec-websocket-key1"],j=c["sec-websocket-key2"],k=this.determineUrl(a);return d||e?new i(a,k,b):f||j?new h(a,k,b):new g(a,k,b)},b.exports=j},38398,(a,b,c)=>{"use strict";var d=a.r(30145),e=a.r(17737),f=a.r(89048);b.exports={client:function(a,b){return void 0===(b=b||{}).masking&&(b.masking=!0),new e(a,b)},server:function(a){return void 0===(a=a||{}).requireMasking&&(a.requireMasking=!0),new f(a)},http:function(){return f.http.apply(f,arguments)},isSecureRequest:function(a){return f.isSecureRequest(a)},isWebSocket:function(a){return d.isWebSocket(a)},validateOptions:function(a,b){d.validateOptions(a,b)}}},59808,(a,b,c)=>{"use strict";var d=function(a,b){for(var c in this.type=a,b)this[c]=b[c]};d.prototype.initEvent=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},d.prototype.stopPropagation=function(){},d.prototype.preventDefault=function(){},d.CAPTURING_PHASE=1,d.AT_TARGET=2,d.BUBBLING_PHASE=3,b.exports=d},1738,(a,b,c)=>{"use strict";var d=a.r(59808);b.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(a,b,c){this.on(a,b)},removeEventListener:function(a,b,c){this.removeListener(a,b)},dispatchEvent:function(a){a.target=a.currentTarget=this,a.eventPhase=d.AT_TARGET,this["on"+a.type]&&this["on"+a.type](a),this.emit(a.type,a)}}},79136,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(1738),h=a.r(59808),i=function(a){a=a||{},f.validateOptions(a,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var b=a.headers;if(b)for(var c in b)this._driver.setHeader(c,b[c]);var d=a.extensions;d&&[].concat(d).forEach(this._driver.addExtension,this._driver),this._ping=a.ping,this._pingId=0,this.readyState=i.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var e=this;this._driver.on("open",function(a){e._open()}),this._driver.on("message",function(a){e._receiveMessage(a.data)}),this._driver.on("close",function(a){e._beginClose(a.reason,a.code)}),this._driver.on("error",function(a){e._emitError(a.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){e.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){e._pingId+=1,e.ping(e._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};e.inherits(i,d),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_TIMEOUT=3e4;var j={write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.send(a),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(a){return!(this.readyState>i.OPEN)&&(a instanceof Buffer||(a=String(a)),this._driver.messages.write(a))},ping:function(a,b){return!(this.readyState>i.OPEN)&&this._driver.ping(a,b)},close:function(a,b){if(void 0===a&&(a=1e3),void 0===b&&(b=""),1e3!==a&&(a<3e3||a>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+a+" is neither.");if(this.readyState<i.CLOSING){var c=this;this._closeTimer=setTimeout(function(){c._beginClose("",1006)},i.CLOSE_TIMEOUT)}this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING),this._driver.close(b,a)},_configureStream:function(){var a=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(b){this._stream.on(b,function(){a._finalizeClose()})},this),this._stream.on("error",function(b){a._emitError("Network error: "+a.url+": "+b.message),a._finalizeClose()})},_open:function(){if(this.readyState===i.CONNECTING){this.readyState=i.OPEN,this.protocol=this._driver.protocol||"";var a=new h("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},_receiveMessage:function(a){if(this.readyState>i.OPEN)return!1;this.readable&&this.emit("data",a);var b=new h("message",{data:a});b.initEvent("message",!1,!1),this.dispatchEvent(b)},_emitError:function(a){if(!(this.readyState>=i.CLOSING)){var b=new h("error",{message:a});b.initEvent("error",!1,!1),this.dispatchEvent(b)}},_beginClose:function(a,b){this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING,this._closeParams=[a,b],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==i.CLOSED){this.readyState=i.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var a=this._closeParams?this._closeParams[0]:"",b=new h("close",{code:this._closeParams?this._closeParams[1]:1006,reason:a});b.initEvent("close",!1,!1),this.dispatchEvent(b)}}};for(var k in j)i.prototype[k]=j[k];for(var l in g)i.prototype[l]=g[l];b.exports=i},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},85053,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(4446),f=a.r(55004),g=a.r(92509),h=a.r(38398),i=a.r(79136);a.r(59808);var j={"http:":80,"https:":443,"ws:":80,"wss:":443},k=["https:","wss:"],l=function(a,b,c){c=c||{},this.url=a,this._driver=h.client(this.url,{maxLength:c.maxLength,protocols:b}),["open","error"].forEach(function(a){this._driver.on(a,function(){s.headers=s._driver.headers,s.statusCode=s._driver.statusCode})},this);var d=c.proxy||{},l=g.parse(d.origin||this.url),m=l.port||j[l.protocol],n=k.indexOf(l.protocol)>=0,o=function(){s._onConnect()},p=c.net||{},q=c.tls||{},r=d.origin?d.tls||{}:q,s=this;p.host=r.host=l.hostname,p.port=r.port=m,q.ca=q.ca||c.ca,r.servername=r.servername||l.hostname,this._stream=n?f.connect(r,o):e.connect(p,o),d.origin&&this._configureProxy(d,q),i.call(this,c)};d.inherits(l,i),l.prototype._onConnect=function(){(this._proxy||this._driver).start()},l.prototype._configureProxy=function(a,b){var c,d=g.parse(this.url),e=k.indexOf(d.protocol)>=0,h=this;if(this._proxy=this._driver.proxy(a.origin),a.headers)for(c in a.headers)this._proxy.setHeader(c,a.headers[c]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(e){var a={socket:h._stream,servername:d.hostname};for(c in b)a[c]=b[c];h._stream=f.connect(a),h._configureStream()}h._driver.io.pipe(h._stream),h._stream.pipe(h._driver.io),h._driver.start()}),this._proxy.on("error",function(a){h._driver.emit("error",a)})},b.exports=l},92173,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(86562),h=a.r(79136),i=a.r(1738),j=a.r(59808),k=function(a,b,c){this.writable=!0,c=c||{},this._stream=b.socket,this._ping=c.ping||this.DEFAULT_PING,this._retry=c.retry||this.DEFAULT_RETRY;var d=f.isSecureRequest(a)?"https:":"http:";this.url=d+"//"+a.headers.host+a.url,this.lastEventId=a.headers["last-event-id"]||"",this.readyState=h.CONNECTING;var e=new g,i=this;if(c.headers)for(var j in c.headers)e.set(j,c.headers[j]);if(this._stream&&this._stream.writable){process.nextTick(function(){i._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var k="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+e.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(k),this._stream.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i.ping()},1e3*this._ping)),["error","end"].forEach(function(a){i._stream.on(a,function(){i.close()})})}};e.inherits(k,d),k.isEventSource=function(a){return"GET"===a.method&&(a.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var l={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(a){if(!this.writable)return!1;try{return this._stream.write(a,"utf8")}catch(a){return!1}},_open:function(){if(this.readyState===h.CONNECTING){this.readyState=h.OPEN;var a=new j("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.write(a),this.close()},send:function(a,b){if(this.readyState>h.OPEN)return!1;a=String(a).replace(/(\r\n|\r|\n)/g,"$1data: ");var c="";return(b=b||{}).event&&(c+="event: "+b.event+"\r\n"),b.id&&(c+="id: "+b.id+"\r\n"),c+="data: "+a+"\r\n\r\n",this._write(c)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>h.OPEN)return!1;this.readyState=h.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var a=new j("close");return a.initEvent("close",!1,!1),this.dispatchEvent(a),!0}};for(var m in l)k.prototype[m]=l[m];for(var n in i)k.prototype[n]=i[n];b.exports=k},47760,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(38398),f=a.r(79136),g=function(a,b,c,d,g){g=g||{},this._stream=b,this._driver=e.http(a,{maxLength:g.maxLength,protocols:d});var h=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var i=function(){h._stream.removeListener("data",i)};this._stream.on("data",i),f.call(this,g),process.nextTick(function(){h._driver.start(),h._driver.io.write(c)})}};d.inherits(g,f),g.isWebSocket=function(a){return e.isWebSocket(a)},g.validateOptions=function(a,b){e.validateOptions(a,b)},g.WebSocket=g,g.Client=a.r(85053),g.EventSource=a.r(92173),b.exports=g},60350,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;var A,B,C,D,E,F,G,H,I,J,K=a.i(87924),L=a.i(72131);let M=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],N=new Set(M),O=(a,b,c)=>c>b?b:c<a?a:c,P={test:a=>"number"==typeof a,parse:parseFloat,transform:a=>a},Q={...P,transform:a=>O(0,1,a)},R={...P,default:1},S=a=>Math.round(1e5*a)/1e5,T=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,U=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,V=(a,b)=>c=>!!("string"==typeof c&&U.test(c)&&c.startsWith(a)||b&&null!=c&&Object.prototype.hasOwnProperty.call(c,b)),W=(a,b,c)=>d=>{if("string"!=typeof d)return d;let[e,f,g,h]=d.match(T);return{[a]:parseFloat(e),[b]:parseFloat(f),[c]:parseFloat(g),alpha:void 0!==h?parseFloat(h):1}},X={...P,transform:a=>Math.round(O(0,255,a))},Y={test:V("rgb","red"),parse:W("red","green","blue"),transform:({red:a,green:b,blue:c,alpha:d=1})=>"rgba("+X.transform(a)+", "+X.transform(b)+", "+X.transform(c)+", "+S(Q.transform(d))+")"},Z={test:V("#"),parse:function(a){let b="",c="",d="",e="";return a.length>5?(b=a.substring(1,3),c=a.substring(3,5),d=a.substring(5,7),e=a.substring(7,9)):(b=a.substring(1,2),c=a.substring(2,3),d=a.substring(3,4),e=a.substring(4,5),b+=b,c+=c,d+=d,e+=e),{red:parseInt(b,16),green:parseInt(c,16),blue:parseInt(d,16),alpha:e?parseInt(e,16)/255:1}},transform:Y.transform},$=a=>({test:b=>"string"==typeof b&&b.endsWith(a)&&1===b.split(" ").length,parse:parseFloat,transform:b=>`${b}${a}`}),_=$("deg"),aa=$("%"),ab=$("px"),ac=$("vh"),ad=$("vw"),ae={...aa,parse:a=>aa.parse(a)/100,transform:a=>aa.transform(100*a)},af={test:V("hsl","hue"),parse:W("hue","saturation","lightness"),transform:({hue:a,saturation:b,lightness:c,alpha:d=1})=>"hsla("+Math.round(a)+", "+aa.transform(S(b))+", "+aa.transform(S(c))+", "+S(Q.transform(d))+")"},ag={test:a=>Y.test(a)||Z.test(a)||af.test(a),parse:a=>Y.test(a)?Y.parse(a):af.test(a)?af.parse(a):Z.parse(a),transform:a=>"string"==typeof a?a:a.hasOwnProperty("red")?Y.transform(a):af.transform(a),getAnimatableNone:a=>{let b=ag.parse(a);return b.alpha=0,ag.transform(b)}},ah=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,ai="number",aj="color",ak=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function al(a){let b=a.toString(),c=[],d={color:[],number:[],var:[]},e=[],f=0,g=b.replace(ak,a=>(ag.test(a)?(d.color.push(f),e.push(aj),c.push(ag.parse(a))):a.startsWith("var(")?(d.var.push(f),e.push("var"),c.push(a)):(d.number.push(f),e.push(ai),c.push(parseFloat(a))),++f,"${}")).split("${}");return{values:c,split:g,indexes:d,types:e}}function am(a){return al(a).values}function an(a){let{split:b,types:c}=al(a),d=b.length;return a=>{let e="";for(let f=0;f<d;f++)if(e+=b[f],void 0!==a[f]){let b=c[f];b===ai?e+=S(a[f]):b===aj?e+=ag.transform(a[f]):e+=a[f]}return e}}let ao=a=>"number"==typeof a?0:ag.test(a)?ag.getAnimatableNone(a):a,ap={test:function(a){return isNaN(a)&&"string"==typeof a&&(a.match(T)?.length||0)+(a.match(ah)?.length||0)>0},parse:am,createTransformer:an,getAnimatableNone:function(a){let b=am(a);return an(a)(b.map(ao))}},aq=new Set(["brightness","contrast","saturate","opacity"]);function ar(a){let[b,c]=a.slice(0,-1).split("(");if("drop-shadow"===b)return a;let[d]=c.match(T)||[];if(!d)return a;let e=c.replace(d,""),f=+!!aq.has(b);return d!==c&&(f*=100),b+"("+f+e+")"}let as=/\b([a-z-]*)\(.*?\)/gu,at={...ap,getAnimatableNone:a=>{let b=a.match(as);return b?b.map(ar).join(" "):a}},au={...ap,getAnimatableNone:a=>{let b=ap.parse(a);return ap.createTransformer(a)(b.map(a=>"number"==typeof a?0:"object"==typeof a?{...a,alpha:1}:a))}},av={...P,transform:Math.round},aw={borderWidth:ab,borderTopWidth:ab,borderRightWidth:ab,borderBottomWidth:ab,borderLeftWidth:ab,borderRadius:ab,borderTopLeftRadius:ab,borderTopRightRadius:ab,borderBottomRightRadius:ab,borderBottomLeftRadius:ab,width:ab,maxWidth:ab,height:ab,maxHeight:ab,top:ab,right:ab,bottom:ab,left:ab,inset:ab,insetBlock:ab,insetBlockStart:ab,insetBlockEnd:ab,insetInline:ab,insetInlineStart:ab,insetInlineEnd:ab,padding:ab,paddingTop:ab,paddingRight:ab,paddingBottom:ab,paddingLeft:ab,paddingBlock:ab,paddingBlockStart:ab,paddingBlockEnd:ab,paddingInline:ab,paddingInlineStart:ab,paddingInlineEnd:ab,margin:ab,marginTop:ab,marginRight:ab,marginBottom:ab,marginLeft:ab,marginBlock:ab,marginBlockStart:ab,marginBlockEnd:ab,marginInline:ab,marginInlineStart:ab,marginInlineEnd:ab,fontSize:ab,backgroundPositionX:ab,backgroundPositionY:ab,rotate:_,rotateX:_,rotateY:_,rotateZ:_,scale:R,scaleX:R,scaleY:R,scaleZ:R,skew:_,skewX:_,skewY:_,distance:ab,translateX:ab,translateY:ab,translateZ:ab,x:ab,y:ab,z:ab,perspective:ab,transformPerspective:ab,opacity:Q,originX:ae,originY:ae,originZ:ab,zIndex:av,fillOpacity:Q,strokeOpacity:Q,numOctaves:av},ax={...aw,color:ag,backgroundColor:ag,outlineColor:ag,fill:ag,stroke:ag,borderColor:ag,borderTopColor:ag,borderRightColor:ag,borderBottomColor:ag,borderLeftColor:ag,filter:at,WebkitFilter:at,mask:au,WebkitMask:au},ay=a=>ax[a],az=()=>({translate:0,scale:1,origin:0,originPoint:0}),aA=()=>({x:az(),y:az()}),aB=()=>({min:0,max:0}),aC=()=>({x:aB(),y:aB()}),aD=a=>!!(a&&a.getVelocity),aE=new Set(["width","height","top","left","right","bottom",...M]),aF=a=>b=>b.test(a),aG=[P,ab,aa,_,ad,ac,{test:a=>"auto"===a,parse:a=>a}],aH=a=>aG.find(aF(a)),aI=()=>{},aJ=()=>{},aK=a=>b=>"string"==typeof b&&b.startsWith(a),aL=aK("--"),aM=aK("var(--"),aN=a=>!!aM(a)&&aO.test(a.split("/*")[0].trim()),aO=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function aP(a){return"string"==typeof a&&a.split("/*")[0].includes("var(--")}let aQ=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u,aR=a=>180*a/Math.PI,aS=a=>aU(aR(Math.atan2(a[1],a[0]))),aT={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:a=>(Math.abs(a[0])+Math.abs(a[3]))/2,rotate:aS,rotateZ:aS,skewX:a=>aR(Math.atan(a[1])),skewY:a=>aR(Math.atan(a[2])),skew:a=>(Math.abs(a[1])+Math.abs(a[2]))/2},aU=a=>((a%=360)<0&&(a+=360),a),aV=a=>Math.sqrt(a[0]*a[0]+a[1]*a[1]),aW=a=>Math.sqrt(a[4]*a[4]+a[5]*a[5]),aX={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:aV,scaleY:aW,scale:a=>(aV(a)+aW(a))/2,rotateX:a=>aU(aR(Math.atan2(a[6],a[5]))),rotateY:a=>aU(aR(Math.atan2(-a[2],a[0]))),rotateZ:aS,rotate:aS,skewX:a=>aR(Math.atan(a[4])),skewY:a=>aR(Math.atan(a[1])),skew:a=>(Math.abs(a[1])+Math.abs(a[4]))/2};function aY(a){return+!!a.includes("scale")}function aZ(a,b){let c,d;if(!a||"none"===a)return aY(b);let e=a.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);if(e)c=aX,d=e;else{let b=a.match(/^matrix\(([-\d.e\s,]+)\)$/u);c=aT,d=b}if(!d)return aY(b);let f=c[b],g=d[1].split(",").map(a$);return"function"==typeof f?f(g):g[f]}function a$(a){return parseFloat(a.trim())}let a_=a=>a===P||a===ab,a0=new Set(["x","y","z"]),a1=M.filter(a=>!a0.has(a)),a2={width:({x:a},{paddingLeft:b="0",paddingRight:c="0"})=>a.max-a.min-parseFloat(b)-parseFloat(c),height:({y:a},{paddingTop:b="0",paddingBottom:c="0"})=>a.max-a.min-parseFloat(b)-parseFloat(c),top:(a,{top:b})=>parseFloat(b),left:(a,{left:b})=>parseFloat(b),bottom:({y:a},{top:b})=>parseFloat(b)+(a.max-a.min),right:({x:a},{left:b})=>parseFloat(b)+(a.max-a.min),x:(a,{transform:b})=>aZ(b,"x"),y:(a,{transform:b})=>aZ(b,"y")};a2.translateX=a2.x,a2.translateY=a2.y;let a3=a=>a,a4={},a5=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function a6(a,b){let c=!1,d=!0,e={delta:0,timestamp:0,isProcessing:!1},f=()=>c=!0,g=a5.reduce((a,c)=>(a[c]=function(a,b){let c=new Set,d=new Set,e=!1,f=!1,g=new WeakSet,h={delta:0,timestamp:0,isProcessing:!1},i=0;function j(b){g.has(b)&&(k.schedule(b),a()),i++,b(h)}let k={schedule:(a,b=!1,f=!1)=>{let h=f&&e?c:d;return b&&g.add(a),h.has(a)||h.add(a),a},cancel:a=>{d.delete(a),g.delete(a)},process:a=>{if(h=a,e){f=!0;return}e=!0,[c,d]=[d,c],c.forEach(j),b,i=0,c.clear(),e=!1,f&&(f=!1,k.process(a))}};return k}(f,b?c:void 0),a),{}),{setup:h,read:i,resolveKeyframes:j,preUpdate:k,update:l,preRender:m,render:n,postRender:o}=g,p=()=>{let f=a4.useManualTiming?e.timestamp:performance.now();c=!1,a4.useManualTiming||(e.delta=d?1e3/60:Math.max(Math.min(f-e.timestamp,40),1)),e.timestamp=f,e.isProcessing=!0,h.process(e),i.process(e),j.process(e),k.process(e),l.process(e),m.process(e),n.process(e),o.process(e),e.isProcessing=!1,c&&b&&(d=!1,a(p))};return{schedule:a5.reduce((b,f)=>{let h=g[f];return b[f]=(b,f=!1,g=!1)=>(!c&&(c=!0,d=!0,e.isProcessing||a(p)),h.schedule(b,f,g)),b},{}),cancel:a=>{for(let b=0;b<a5.length;b++)g[a5[b]].cancel(a)},state:e,steps:g}}let{schedule:a7,cancel:a8,state:a9,steps:ba}=a6("u">typeof requestAnimationFrame?requestAnimationFrame:a3,!0),bb=new Set,bc=!1,bd=!1,be=!1;function bf(){if(bd){let a=Array.from(bb).filter(a=>a.needsMeasurement),b=new Set(a.map(a=>a.element)),c=new Map;b.forEach(a=>{let b,d=(b=[],a1.forEach(c=>{let d=a.getValue(c);void 0!==d&&(b.push([c,d.get()]),d.set(+!!c.startsWith("scale")))}),b);d.length&&(c.set(a,d),a.render())}),a.forEach(a=>a.measureInitialState()),b.forEach(a=>{a.render();let b=c.get(a);b&&b.forEach(([b,c])=>{a.getValue(b)?.set(c)})}),a.forEach(a=>a.measureEndState()),a.forEach(a=>{void 0!==a.suspendedScrollY&&window.scrollTo(0,a.suspendedScrollY)})}bd=!1,bc=!1,bb.forEach(a=>a.complete(be)),bb.clear()}function bg(){bb.forEach(a=>{a.readKeyframes(),a.needsMeasurement&&(bd=!0)})}class bh{constructor(a,b,c,d,e,f=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...a],this.onComplete=b,this.name=c,this.motionValue=d,this.element=e,this.isAsync=f}scheduleResolve(){this.state="scheduled",this.isAsync?(bb.add(this),bc||(bc=!0,a7.read(bg),a7.resolveKeyframes(bf))):(this.readKeyframes(),this.complete())}readKeyframes(){let{unresolvedKeyframes:a,name:b,element:c,motionValue:d}=this;if(null===a[0]){let e=d?.get(),f=a[a.length-1];if(void 0!==e)a[0]=e;else if(c&&b){let d=c.readValue(b,f);null!=d&&(a[0]=d)}void 0===a[0]&&(a[0]=f),d&&void 0===e&&d.set(a[0])}for(let b=1;b<a.length;b++)a[b]??(a[b]=a[b-1])}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(a=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,a),bb.delete(this)}cancel(){"scheduled"===this.state&&(bb.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}let bi=new Set([at,au]);function bj(a,b){let c=ay(a);return bi.has(c)||(c=ap),c.getAnimatableNone?c.getAnimatableNone(b):void 0}let bk=new Set(["auto","none","0"]);class bl extends bh{constructor(a,b,c,d,e){super(a,b,c,d,e,!0)}readKeyframes(){let{unresolvedKeyframes:a,element:b,name:c}=this;if(!b||!b.current)return;super.readKeyframes();for(let c=0;c<a.length;c++){let d=a[c];if("string"==typeof d&&aN(d=d.trim())){let e=function a(b,c,d=1){aJ(d<=4,`Max CSS variable fallback depth detected in property "${b}". This may indicate a circular fallback dependency.`,"max-css-var-depth");let[e,f]=function(a){let b=aQ.exec(a);if(!b)return[,];let[,c,d,e]=b;return[`--${c??d}`,e]}(b);if(!e)return;let g=window.getComputedStyle(c).getPropertyValue(e);if(g){let a=g.trim();return/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(a)?parseFloat(a):a}return aN(f)?a(f,c,d+1):f}(d,b.current);void 0!==e&&(a[c]=e),c===a.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!aE.has(c)||2!==a.length)return;let[d,e]=a,f=aH(d),g=aH(e);if(aP(d)!==aP(e)&&a2[c]){this.needsMeasurement=!0;return}if(f!==g)if(a_(f)&&a_(g))for(let b=0;b<a.length;b++){let c=a[b];"string"==typeof c&&(a[b]=parseFloat(c))}else a2[c]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){let{unresolvedKeyframes:a,name:b}=this,c=[];for(let b=0;b<a.length;b++)(null===a[b]||function(a){if("number"==typeof a)return 0===a;if(null===a)return!0;return"none"===a||"0"===a||/^0[^.\s]+$/u.test(a)}(a[b]))&&c.push(b);c.length&&function(a,b,c){let d,e=0;for(;e<a.length&&!d;){let b=a[e];"string"==typeof b&&!bk.has(b)&&al(b).values.length&&(d=a[e]),e++}if(d&&c)for(let e of b)a[e]=bj(c,d)}(a,c,b)}measureInitialState(){let{element:a,unresolvedKeyframes:b,name:c}=this;if(!a||!a.current)return;"height"===c&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=a2[c](a.measureViewportBox(),window.getComputedStyle(a.current)),b[0]=this.measuredOrigin;let d=b[b.length-1];void 0!==d&&a.getValue(c,d).jump(d,!1)}measureEndState(){let{element:a,name:b,unresolvedKeyframes:c}=this;if(!a||!a.current)return;let d=a.getValue(b);d&&d.jump(this.measuredOrigin,!1);let e=c.length-1,f=c[e];c[e]=a2[b](a.measureViewportBox(),window.getComputedStyle(a.current)),null!==f&&void 0===this.finalKeyframe&&(this.finalKeyframe=f),this.removedTransforms?.length&&this.removedTransforms.forEach(([b,c])=>{a.getValue(b).set(c)}),this.resolveNoneKeyframes()}}let bm=a=>1e3*a;function bn(a,b){-1===a.indexOf(b)&&a.push(b)}function bo(a,b){let c=a.indexOf(b);c>-1&&a.splice(c,1)}class bp{constructor(){this.subscriptions=[]}add(a){return bn(this.subscriptions,a),()=>bo(this.subscriptions,a)}notify(a,b,c){let d=this.subscriptions.length;if(d)if(1===d)this.subscriptions[0](a,b,c);else for(let e=0;e<d;e++){let d=this.subscriptions[e];d&&d(a,b,c)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function bq(a){let b;return()=>(void 0===b&&(b=a()),b)}let br={};function bs(a,b){let c=bq(a);return()=>br[b]??c()}let bt=bs(()=>void 0!==window.ScrollTimeline,"scrollTimeline"),bu=a=>null!==a;function bv(a,{repeat:b,repeatType:c="loop"},d,e=1){let f=a.filter(bu),g=e<0||b&&"loop"!==c&&b%2==1?0:f.length-1;return g&&void 0!==d?d:f[g]}class bw{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(a=>{this.resolve=a})}notifyFinished(){this.resolve()}then(a,b){return this.finished.then(a,b)}}let bx={layout:0,mainThread:0,waapi:0},by=a=>Array.isArray(a)&&"number"==typeof a[0],bz=bs(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(a){return!1}return!0},"linearEasing"),bA=(a,b,c=10)=>{let d="",e=Math.max(Math.round(b/c),2);for(let b=0;b<e;b++)d+=Math.round(1e4*a(b/(e-1)))/1e4+", ";return`linear(${d.substring(0,d.length-2)})`},bB=([a,b,c,d])=>`cubic-bezier(${a}, ${b}, ${c}, ${d})`,bC={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:bB([0,.65,.55,1]),circOut:bB([.55,0,1,.45]),backIn:bB([.31,.01,.66,-.59]),backOut:bB([.33,1.53,.69,.99])};function bD(a){return"function"==typeof a&&"applyToOptions"in a}class bE extends bw{constructor(a){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!a)return;const{element:b,name:c,keyframes:d,pseudoElement:e,allowFlatten:f=!1,finalKeyframe:g,onComplete:h}=a;this.isPseudoElement=!!e,this.allowFlatten=f,this.options=a,aJ("string"!=typeof a.type,'Mini animate() doesn\'t support "type" as a string.',"mini-spring");const i=function({type:a,...b}){return bD(a)&&bz()?a.applyToOptions(b):(b.duration??(b.duration=300),b.ease??(b.ease="easeOut"),b)}(a);this.animation=function(a,b,c,{delay:d=0,duration:e=300,repeat:f=0,repeatType:g="loop",ease:h="easeOut",times:i}={},j){let k={[b]:c};i&&(k.offset=i);let l=function a(b,c){if(b)return"function"==typeof b?bz()?bA(b,c):"ease-out":by(b)?bB(b):Array.isArray(b)?b.map(b=>a(b,c)||bC.easeOut):bC[b]}(h,e);Array.isArray(l)&&(k.easing=l);let m={delay:d,duration:e,easing:Array.isArray(l)?"linear":l,fill:"both",iterations:f+1,direction:"reverse"===g?"alternate":"normal"};j&&(m.pseudoElement=j);let n=a.animate(k,m);return n}(b,c,d,i,e),!1===i.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!e){let a=bv(d,this.options,g,this.speed);this.updateMotionValue?this.updateMotionValue(a):c.startsWith("--")?b.style.setProperty(c,a):b.style[c]=a,this.animation.cancel()}h?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(a){}}stop(){if(this.isStopped)return;this.isStopped=!0;let{state:a}=this;"idle"!==a&&"finished"!==a&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){let a=this.options?.element;!this.isPseudoElement&&a?.isConnected&&this.animation.commitStyles?.()}get duration(){return Number(this.animation.effect?.getComputedTiming?.().duration||0)/1e3}get iterationDuration(){let{delay:a=0}=this.options||{};return this.duration+a/1e3}get time(){return(Number(this.animation.currentTime)||0)/1e3}set time(a){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=bm(a)}get speed(){return this.animation.playbackRate}set speed(a){a<0&&(this.finishedTime=null),this.animation.playbackRate=a}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(a){this.manualStartTime=this.animation.startTime=a}attachTimeline({timeline:a,observe:b}){return(this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,a&&bt())?(this.animation.timeline=a,a3):b(this)}}let bF=new Set(["opacity","clipPath","filter","transform"]),{schedule:bG}=a6(queueMicrotask,!1);function bH(){b=void 0}let bI={now:()=>(void 0===b&&bI.set(a9.isProcessing||a4.useManualTiming?a9.timestamp:performance.now()),b),set:a=>{b=a,queueMicrotask(bH)}};class bJ{constructor(a,b={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{let b=bI.now();if(this.updatedAt!==b&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(let a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(a),this.owner=b.owner}setCurrent(a){this.current=a,this.updatedAt=bI.now(),null===this.canTrackVelocity&&void 0!==a&&(this.canTrackVelocity=!isNaN(parseFloat(this.current)))}setPrevFrameValue(a=this.current){this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt}onChange(a){return this.on("change",a)}on(a,b){this.events[a]||(this.events[a]=new bp);let c=this.events[a].add(b);return"change"===a?()=>{c(),a7.read(()=>{this.events.change.getSize()||this.stop()})}:c}clearListeners(){for(let a in this.events)this.events[a].clear()}attach(a,b){this.passiveEffect=a,this.stopPassiveEffect=b}set(a){this.passiveEffect?this.passiveEffect(a,this.updateAndNotify):this.updateAndNotify(a)}setWithVelocity(a,b,c){this.set(b),this.prev=void 0,this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt-c}jump(a,b=!0){this.updateAndNotify(a),this.prev=a,this.prevUpdatedAt=this.prevFrameValue=void 0,b&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(a){this.dependents||(this.dependents=new Set),this.dependents.add(a)}removeDependent(a){this.dependents&&this.dependents.delete(a)}get(){return y&&y.push(this),this.current}getPrevious(){return this.prev}getVelocity(){var a;let b=bI.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||b-this.updatedAt>30)return 0;let c=Math.min(this.updatedAt-this.prevUpdatedAt,30);return a=parseFloat(this.current)-parseFloat(this.prevFrameValue),c?1e3/c*a:0}start(a){return this.stop(),new Promise(b=>{this.hasAnimated=!0,this.animation=a(b),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function bK(a,b){return new bJ(a,b)}let bL=[...aG,ag,ap],bM=new WeakMap;function bN(a){return null!==a&&"object"==typeof a&&"function"==typeof a.start}function bO(a){return"string"==typeof a||Array.isArray(a)}let bP=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],bQ=["initial",...bP];function bR(a){return bN(a.animate)||bQ.some(b=>bO(a[b]))}function bS(a){return!!(bR(a)||a.variants)}let bT={current:!1};function bU(a){let b=[{},{}];return a?.values.forEach((a,c)=>{b[0][c]=a.get(),b[1][c]=a.getVelocity()}),b}function bV(a,b,c,d){if("function"==typeof b){let[e,f]=bU(d);b=b(void 0!==c?c:a.custom,e,f)}if("string"==typeof b&&(b=a.variants&&a.variants[b]),"function"==typeof b){let[e,f]=bU(d);b=b(void 0!==c?c:a.custom,e,f)}return b}let bW=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],bX={};class bY{scrapeMotionValuesFromProps(a,b,c){return{}}constructor({parent:a,props:b,presenceContext:c,reducedMotionConfig:d,skipAnimations:e,blockInitialAnimation:f,visualState:g},h={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=bh,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{let a=bI.now();this.renderScheduledAt<a&&(this.renderScheduledAt=a,a7.render(this.render,!1,!0))};const{latestValues:i,renderState:j}=g;this.latestValues=i,this.baseTarget={...i},this.initialValues=b.initial?{...i}:{},this.renderState=j,this.parent=a,this.props=b,this.presenceContext=c,this.depth=a?a.depth+1:0,this.reducedMotionConfig=d,this.skipAnimationsConfig=e,this.options=h,this.blockInitialAnimation=!!f,this.isControllingVariants=bR(b),this.isVariantNode=bS(b),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(a&&a.current);const{willChange:k,...l}=this.scrapeMotionValuesFromProps(b,{},this);for(const a in l){const b=l[a];void 0!==i[a]&&aD(b)&&b.set(i[a])}}mount(a){if(this.hasBeenMounted)for(let a in this.initialValues)this.values.get(a)?.jump(this.initialValues[a]),this.latestValues[a]=this.initialValues[a];this.current=a,bM.set(a,this),this.projection&&!this.projection.instance&&this.projection.mount(a),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,b)=>this.bindToMotionValue(b,a)),"never"===this.reducedMotionConfig?this.shouldReduceMotion=!1:"always"===this.reducedMotionConfig?this.shouldReduceMotion=!0:(bT.current||(bT.current=!0),this.shouldReduceMotion=null),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,this.parent?.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){for(let a in this.projection&&this.projection.unmount(),a8(this.notifyUpdate),a8(this.render),this.valueSubscriptions.forEach(a=>a()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this),this.events)this.events[a].clear();for(let a in this.features){let b=this.features[a];b&&(b.unmount(),b.isMounted=!1)}this.current=null}addChild(a){this.children.add(a),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(a)}removeChild(a){this.children.delete(a),this.enteringChildren&&this.enteringChildren.delete(a)}bindToMotionValue(a,b){let c;if(this.valueSubscriptions.has(a)&&this.valueSubscriptions.get(a)(),b.accelerate&&bF.has(a)&&this.current instanceof HTMLElement){let{factory:c,keyframes:d,times:e,ease:f,duration:g}=b.accelerate,h=new bE({element:this.current,name:a,keyframes:d,times:e,ease:f,duration:bm(g)}),i=c(h);this.valueSubscriptions.set(a,()=>{i(),h.cancel()});return}let d=N.has(a);d&&this.onBindTransform&&this.onBindTransform();let e=b.on("change",b=>{this.latestValues[a]=b,this.props.onUpdate&&a7.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});this.valueSubscriptions.set(a,()=>{e(),c&&c(),b.owner&&b.stop()})}sortNodePosition(a){return this.current&&this.sortInstanceNodePosition&&this.type===a.type?this.sortInstanceNodePosition(this.current,a.current):0}updateFeatures(){let a="animation";for(a in bX){let b=bX[a];if(!b)continue;let{isEnabled:c,Feature:d}=b;if(!this.features[a]&&d&&c(this.props)&&(this.features[a]=new d(this)),this.features[a]){let b=this.features[a];b.isMounted?b.update():(b.mount(),b.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):aC()}getStaticValue(a){return this.latestValues[a]}setStaticValue(a,b){this.latestValues[a]=b}update(a,b){(a.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=a,this.prevPresenceContext=this.presenceContext,this.presenceContext=b;for(let b=0;b<bW.length;b++){let c=bW[b];this.propEventSubscriptions[c]&&(this.propEventSubscriptions[c](),delete this.propEventSubscriptions[c]);let d=a["on"+c];d&&(this.propEventSubscriptions[c]=this.on(c,d))}this.prevMotionValues=function(a,b,c){for(let d in b){let e=b[d],f=c[d];if(aD(e))a.addValue(d,e);else if(aD(f))a.addValue(d,bK(e,{owner:a}));else if(f!==e)if(a.hasValue(d)){let b=a.getValue(d);!0===b.liveStyle?b.jump(e):b.hasAnimated||b.set(e)}else{let b=a.getStaticValue(d);a.addValue(d,bK(void 0!==b?b:e,{owner:a}))}}for(let d in c)void 0===b[d]&&a.removeValue(d);return b}(this,this.scrapeMotionValuesFromProps(a,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(a){return this.props.variants?this.props.variants[a]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(a){let b=this.getClosestVariantNode();if(b)return b.variantChildren&&b.variantChildren.add(a),()=>b.variantChildren.delete(a)}addValue(a,b){let c=this.values.get(a);b!==c&&(c&&this.removeValue(a),this.bindToMotionValue(a,b),this.values.set(a,b),this.latestValues[a]=b.get())}removeValue(a){this.values.delete(a);let b=this.valueSubscriptions.get(a);b&&(b(),this.valueSubscriptions.delete(a)),delete this.latestValues[a],this.removeValueFromRenderState(a,this.renderState)}hasValue(a){return this.values.has(a)}getValue(a,b){if(this.props.values&&this.props.values[a])return this.props.values[a];let c=this.values.get(a);return void 0===c&&void 0!==b&&(c=bK(null===b?void 0:b,{owner:this}),this.addValue(a,c)),c}readValue(a,b){let c=void 0===this.latestValues[a]&&this.current?this.getBaseTargetFromProps(this.props,a)??this.readValueFromInstance(this.current,a,this.options):this.latestValues[a];if(null!=c){let d,e;if("string"==typeof c&&(d=c,/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(d)||(e=c,/^0[^.\s]+$/u.test(e))))c=parseFloat(c);else{let d;d=c,!bL.find(aF(d))&&ap.test(b)&&(c=bj(a,b))}this.setBaseTarget(a,aD(c)?c.get():c)}return aD(c)?c.get():c}setBaseTarget(a,b){this.baseTarget[a]=b}getBaseTarget(a){let b,{initial:c}=this.props;if("string"==typeof c||"object"==typeof c){let d=bV(this.props,c,this.presenceContext?.custom);d&&(b=d[a])}if(c&&void 0!==b)return b;let d=this.getBaseTargetFromProps(this.props,a);return void 0===d||aD(d)?void 0!==this.initialValues[a]&&void 0===b?void 0:this.baseTarget[a]:d}on(a,b){return this.events[a]||(this.events[a]=new bp),this.events[a].add(b)}notify(a,...b){this.events[a]&&this.events[a].notify(...b)}scheduleRenderMicrotask(){bG.render(this.render)}}class bZ extends bY{constructor(){super(...arguments),this.KeyframeResolver=bl}sortInstanceNodePosition(a,b){return 2&a.compareDocumentPosition(b)?1:-1}getBaseTargetFromProps(a,b){let c=a.style;return c?c[b]:void 0}removeValueFromRenderState(a,{vars:b,style:c}){delete b[a],delete c[a]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);let{children:a}=this.props;aD(a)&&(this.childSubscription=a.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function b$(a){return a.replace(/([A-Z])/g,a=>`-${a.toLowerCase()}`)}let b_=(a,b)=>b&&"number"==typeof a?b.transform(a):a,b0={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},b1=M.length;function b2(a,b,c){let{style:d,vars:e,transformOrigin:f}=a,g=!1,h=!1;for(let a in b){let c=b[a];if(N.has(a)){g=!0;continue}if(aL(a)){e[a]=c;continue}{let b=b_(c,aw[a]);a.startsWith("origin")?(h=!0,f[a]=b):d[a]=b}}if(!b.transform&&(g||c?d.transform=function(a,b,c){let d="",e=!0;for(let f=0;f<b1;f++){let g=M[f],h=a[g];if(void 0===h)continue;let i=!0;if("number"==typeof h)i=h===+!!g.startsWith("scale");else{let a=parseFloat(h);i=g.startsWith("scale")?1===a:0===a}if(!i||c){let a=b_(h,aw[g]);if(!i){e=!1;let b=b0[g]||g;d+=`${b}(${a}) `}c&&(b[g]=a)}}return d=d.trim(),c?d=c(b,e?"":d):e&&(d="none"),d}(b,a.transform,c):d.transform&&(d.transform="none")),h){let{originX:a="50%",originY:b="50%",originZ:c=0}=f;d.transformOrigin=`${a} ${b} ${c}`}}let b3={offset:"stroke-dashoffset",array:"stroke-dasharray"},b4={offset:"strokeDashoffset",array:"strokeDasharray"},b5=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function b6(a,{attrX:b,attrY:c,attrScale:d,pathLength:e,pathSpacing:f=1,pathOffset:g=0,...h},i,j,k){if(b2(a,h,j),i){a.style.viewBox&&(a.attrs.viewBox=a.style.viewBox);return}a.attrs=a.style,a.style={};let{attrs:l,style:m}=a;for(let a of(l.transform&&(m.transform=l.transform,delete l.transform),(m.transform||l.transformOrigin)&&(m.transformOrigin=l.transformOrigin??"50% 50%",delete l.transformOrigin),m.transform&&(m.transformBox=k?.transformBox??"fill-box",delete l.transformBox),b5))void 0!==l[a]&&(m[a]=l[a],delete l[a]);void 0!==b&&(l.x=b),void 0!==c&&(l.y=c),void 0!==d&&(l.scale=d),void 0!==e&&function(a,b,c=1,d=0,e=!0){a.pathLength=1;let f=e?b3:b4;a[f.offset]=`${-d}`,a[f.array]=`${b} ${c}`}(l,e,f,g,!1)}let b7=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),b8=a=>"string"==typeof a&&"svg"===a.toLowerCase();function b9(a,{style:b,vars:c},d,e){let f,g=a.style;for(f in b)g[f]=b[f];for(f in e?.applyProjectionStyles(g,d),c)g.setProperty(f,c[f])}function ca(a,b){return b.max===b.min?0:a/(b.max-b.min)*100}let cb={correct:(a,b)=>{if(!b.target)return a;if("string"==typeof a)if(!ab.test(a))return a;else a=parseFloat(a);let c=ca(a,b.target.x),d=ca(a,b.target.y);return`${c}% ${d}%`}},cc=(a,b,c)=>a+(b-a)*c,cd={borderRadius:{...cb,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:cb,borderTopRightRadius:cb,borderBottomLeftRadius:cb,borderBottomRightRadius:cb,boxShadow:{correct:(a,{treeScale:b,projectionDelta:c})=>{let d=ap.parse(a);if(d.length>5)return a;let e=ap.createTransformer(a),f=+("number"!=typeof d[0]),g=c.x.scale*b.x,h=c.y.scale*b.y;d[0+f]/=g,d[1+f]/=h;let i=cc(g,h,.5);return"number"==typeof d[2+f]&&(d[2+f]/=i),"number"==typeof d[3+f]&&(d[3+f]/=i),e(d)}}};function ce(a,{layout:b,layoutId:c}){return N.has(a)||a.startsWith("origin")||(b||void 0!==c)&&(!!cd[a]||"opacity"===a)}function cf(a,b,c){let d=a.style,e=b?.style,f={};if(!d)return f;for(let b in d)(aD(d[b])||e&&aD(e[b])||ce(b,a)||c?.getValue(b)?.liveStyle!==void 0)&&(f[b]=d[b]);return f}function cg(a,b,c){let d=cf(a,b,c);for(let c in a)(aD(a[c])||aD(b[c]))&&(d[-1!==M.indexOf(c)?"attr"+c.charAt(0).toUpperCase()+c.substring(1):c]=a[c]);return d}class ch extends bZ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=aC}getBaseTargetFromProps(a,b){return a[b]}readValueFromInstance(a,b){if(N.has(b)){let a=ay(b);return a&&a.default||0}return b=b7.has(b)?b:b$(b),a.getAttribute(b)}scrapeMotionValuesFromProps(a,b,c){return cg(a,b,c)}build(a,b,c){b6(a,b,this.isSVGTag,c.transformTemplate,c.style)}renderInstance(a,b,c,d){for(let c in b9(a,b,void 0,d),b.attrs)a.setAttribute(b7.has(c)?c:b$(c),b.attrs[c])}mount(a){this.isSVGTag=b8(a.tagName),super.mount(a)}}function ci({top:a,left:b,right:c,bottom:d}){return{x:{min:b,max:c},y:{min:a,max:d}}}function cj(a){return void 0===a||1===a}function ck({scale:a,scaleX:b,scaleY:c}){return!cj(a)||!cj(b)||!cj(c)}function cl(a){return ck(a)||cm(a)||a.z||a.rotate||a.rotateX||a.rotateY||a.skewX||a.skewY}function cm(a){var b,c;return(b=a.x)&&"0%"!==b||(c=a.y)&&"0%"!==c}function cn(a,b,c,d,e){return void 0!==e&&(a=d+e*(a-d)),d+c*(a-d)+b}function co(a,b=0,c=1,d,e){a.min=cn(a.min,b,c,d,e),a.max=cn(a.max,b,c,d,e)}function cp(a,{x:b,y:c}){co(a.x,b.translate,b.scale,b.originPoint),co(a.y,c.translate,c.scale,c.originPoint)}function cq(a,b){a.min=a.min+b,a.max=a.max+b}function cr(a,b,c,d,e=.5){let f=cc(a.min,a.max,e);co(a,b,c,f,d)}function cs(a,b){cr(a.x,b.x,b.scaleX,b.scale,b.originX),cr(a.y,b.y,b.scaleY,b.scale,b.originY)}function ct(a,b){return ci(function(a,b){if(!b)return a;let c=b({x:a.left,y:a.top}),d=b({x:a.right,y:a.bottom});return{top:c.y,left:c.x,bottom:d.y,right:d.x}}(a.getBoundingClientRect(),b))}class cu extends bZ{constructor(){super(...arguments),this.type="html",this.renderInstance=b9}readValueFromInstance(a,b){if(N.has(b))return this.projection?.isProjecting?aY(b):((a,b)=>{let{transform:c="none"}=getComputedStyle(a);return aZ(c,b)})(a,b);{let c=window.getComputedStyle(a),d=(aL(b)?c.getPropertyValue(b):c[b])||0;return"string"==typeof d?d.trim():d}}measureInstanceViewportBox(a,{transformPagePoint:b}){return ct(a,b)}build(a,b,c){b2(a,b,c.transformTemplate)}scrapeMotionValuesFromProps(a,b,c){return cf(a,b,c)}}let cv=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function cw(a){if("string"!=typeof a||a.includes("-"));else if(cv.indexOf(a)>-1||/[A-Z]/u.test(a))return!0;return!1}let cx=(0,L.createContext)({}),cy=((0,L.createContext)({strict:!1}),(0,L.createContext)({transformPagePoint:a=>a,isStatic:!1,reducedMotion:"never"})),cz=(0,L.createContext)({});function cA(a){return Array.isArray(a)?a.join(" "):a}let cB=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function cC(a,b,c){for(let d in b)aD(b[d])||ce(d,c)||(a[d]=b[d])}let cD=()=>({...cB(),attrs:{}}),cE=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function cF(a){return a.startsWith("while")||a.startsWith("drag")&&"draggable"!==a||a.startsWith("layout")||a.startsWith("onTap")||a.startsWith("onPan")||a.startsWith("onLayout")||cE.has(a)}let cG=a=>!cF(a);try{A=(()=>{let a=Error("Cannot find module '@emotion/is-prop-valid'");throw a.code="MODULE_NOT_FOUND",a})().default,"function"==typeof A&&(cG=a=>a.startsWith("on")?!cF(a):A(a))}catch{}function cH(a){return aD(a)?a.get():a}let cI=(0,L.createContext)(null);function cJ(a){let b=(0,L.useRef)(null);return null===b.current&&(b.current=a()),b.current}let cK=a=>(b,c)=>{let d=(0,L.useContext)(cz),e=(0,L.useContext)(cI),f=()=>(function({scrapeMotionValuesFromProps:a,createRenderState:b},c,d,e){return{latestValues:function(a,b,c,d){let e={},f=d(a,{});for(let a in f)e[a]=cH(f[a]);let{initial:g,animate:h}=a,i=bR(a),j=bS(a);b&&j&&!i&&!1!==a.inherit&&(void 0===g&&(g=b.initial),void 0===h&&(h=b.animate));let k=!!c&&!1===c.initial,l=(k=k||!1===g)?h:g;if(l&&"boolean"!=typeof l&&!bN(l)){let b=Array.isArray(l)?l:[l];for(let c=0;c<b.length;c++){let d=bV(a,b[c]);if(d){let{transitionEnd:a,transition:b,...c}=d;for(let a in c){let b=c[a];if(Array.isArray(b)){let a=k?b.length-1:0;b=b[a]}null!==b&&(e[a]=b)}for(let b in a)e[b]=a[b]}}}return e}(c,d,e,a),renderState:b()}})(a,b,d,e);return c?f():cJ(f)},cL=cK({scrapeMotionValuesFromProps:cf,createRenderState:cB}),cM=cK({scrapeMotionValuesFromProps:cg,createRenderState:cD}),cN={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},cO=!1,cP=Symbol.for("motionComponentSymbol"),cQ="data-"+b$("framerAppearId"),cR=(0,L.createContext)({});function cS(a){return a&&"object"==typeof a&&Object.prototype.hasOwnProperty.call(a,"current")}let cT=L.useEffect;function cU(a,{forwardMotionProps:b=!1,type:c}={},d,e){d&&function(a){let b=(!function(){if(cO)return;let a={};for(let b in cN)a[b]={isEnabled:a=>cN[b].some(b=>!!a[b])};bX=a,cO=!0}(),bX);for(let c in a)b[c]={...b[c],...a[c]};bX=b}(d);let f=c?"svg"===c:cw(a),g=f?cM:cL;function h(c,d){var e;let h,i,j,k={...(0,L.useContext)(cy),...c,layoutId:function({layoutId:a}){let b=(0,L.useContext)(cx).id;return b&&void 0!==a?b+"-"+a:a}(c)},{isStatic:l}=k,m=function(a){let{initial:b,animate:c}=function(a,b){if(bR(a)){let{initial:b,animate:c}=a;return{initial:!1===b||bO(b)?b:void 0,animate:bO(c)?c:void 0}}return!1!==a.inherit?b:{}}(a,(0,L.useContext)(cz));return(0,L.useMemo)(()=>({initial:b,animate:c}),[cA(b),cA(c)])}(c),n=g(c,l);return(0,K.jsxs)(cz.Provider,{value:m,children:[h&&m.visualElement?(0,K.jsx)(h,{visualElement:m.visualElement,...k}):null,function(a,b,c,{latestValues:d},e,f=!1,g){let h=(g??cw(a)?function(a,b,c,d){let e=(0,L.useMemo)(()=>{let c=cD();return b6(c,b,b8(d),a.transformTemplate,a.style),{...c.attrs,style:{...c.style}}},[b]);if(a.style){let b={};cC(b,a.style,a),e.style={...b,...e.style}}return e}:function(a,b){let c,d,e={},f=(c=a.style||{},cC(d={},c,a),Object.assign(d,function({transformTemplate:a},b){return(0,L.useMemo)(()=>{let c=cB();return b2(c,b,a),Object.assign({},c.vars,c.style)},[b])}(a,b)),d);return a.drag&&!1!==a.dragListener&&(e.draggable=!1,f.userSelect=f.WebkitUserSelect=f.WebkitTouchCallout="none",f.touchAction=!0===a.drag?"none":`pan-${"x"===a.drag?"y":"x"}`),void 0===a.tabIndex&&(a.onTap||a.onTapStart||a.whileTap)&&(e.tabIndex=0),e.style=f,e})(b,d,e,a),i=function(a,b,c){let d={};for(let e in a)("values"!==e||"object"!=typeof a.values)&&(cG(e)||!0===c&&cF(e)||!b&&!cF(e)||a.draggable&&e.startsWith("onDrag"))&&(d[e]=a[e]);return d}(b,"string"==typeof a,f),j=a!==L.Fragment?{...i,...h,ref:c}:{},{children:k}=b,l=(0,L.useMemo)(()=>aD(k)?k.get():k,[k]);return(0,L.createElement)(a,{...j,children:l})}(a,c,(e=m.visualElement,i=(0,L.useRef)(d),(0,L.useInsertionEffect)(()=>{i.current=d}),j=(0,L.useRef)(null),(0,L.useCallback)(a=>{a&&n.onMount?.(a),e&&(a?e.mount(a):e.unmount());let b=i.current;if("function"==typeof b)if(a){let c=b(a);"function"==typeof c&&(j.current=c)}else j.current?(j.current(),j.current=null):b(a);else b&&(b.current=a)},[e])),n,l,b,f)]})}h.displayName=`motion.${"string"==typeof a?a:`create(${a.displayName??a.name??""})`}`;let i=(0,L.forwardRef)(h);return i[cP]=a,i}class cV{constructor(a){this.isMounted=!1,this.node=a}update(){}}function cW(a,b,c){let d=a.getProps();return bV(d,b,void 0!==c?c:d.custom,a)}function cX(a,b){if(a?.inherit&&b){let{inherit:c,...d}=a;return{...b,...d}}return a}function cY(a,b){let c=a?.[b]??a?.default??a;return c!==a?cX(c,a):c}let cZ=a=>Array.isArray(a);function c$(a,b){let c=a.getValue("willChange");if(aD(c)&&c.add)return c.add(b);if(!c&&a4.WillChange){let c=new a4.WillChange("auto");a.addValue("willChange",c),c.add(b)}}let c_=(a,b)=>c=>b(a(c)),c0=(...a)=>a.reduce(c_);function c1(a,b,c){return(c<0&&(c+=1),c>1&&(c-=1),c<1/6)?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}function c2(a,b){return c=>c>0?b:a}let c3=(a,b,c)=>{let d=a*a,e=c*(b*b-d)+d;return e<0?0:Math.sqrt(e)},c4=[Z,Y,af];function c5(a){let b=c4.find(b=>b.test(a));if(aI(!!b,`'${a}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!b)return!1;let c=b.parse(a);return b===af&&(c=function({hue:a,saturation:b,lightness:c,alpha:d}){a/=360,c/=100;let e=0,f=0,g=0;if(b/=100){let d=c<.5?c*(1+b):c+b-c*b,h=2*c-d;e=c1(h,d,a+1/3),f=c1(h,d,a),g=c1(h,d,a-1/3)}else e=f=g=c;return{red:Math.round(255*e),green:Math.round(255*f),blue:Math.round(255*g),alpha:d}}(c)),c}let c6=(a,b)=>{let c=c5(a),d=c5(b);if(!c||!d)return c2(a,b);let e={...c};return a=>(e.red=c3(c.red,d.red,a),e.green=c3(c.green,d.green,a),e.blue=c3(c.blue,d.blue,a),e.alpha=cc(c.alpha,d.alpha,a),Y.transform(e))},c7=new Set(["none","hidden"]);function c8(a,b){return c=>cc(a,b,c)}function c9(a){return"number"==typeof a?c8:"string"==typeof a?aN(a)?c2:ag.test(a)?c6:dc:Array.isArray(a)?da:"object"==typeof a?ag.test(a)?c6:db:c2}function da(a,b){let c=[...a],d=c.length,e=a.map((a,c)=>c9(a)(a,b[c]));return a=>{for(let b=0;b<d;b++)c[b]=e[b](a);return c}}function db(a,b){let c={...a,...b},d={};for(let e in c)void 0!==a[e]&&void 0!==b[e]&&(d[e]=c9(a[e])(a[e],b[e]));return a=>{for(let b in d)c[b]=d[b](a);return c}}let dc=(a,b)=>{let c=ap.createTransformer(b),d=al(a),e=al(b);if(!(d.indexes.var.length===e.indexes.var.length&&d.indexes.color.length===e.indexes.color.length&&d.indexes.number.length>=e.indexes.number.length))return aI(!0,`Complex values '${a}' and '${b}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),c2(a,b);if(c7.has(a)&&!e.values.length||c7.has(b)&&!d.values.length)return c7.has(a)?c=>c<=0?a:b:c=>c>=1?b:a;return c0(da(function(a,b){let c=[],d={color:0,var:0,number:0};for(let e=0;e<b.values.length;e++){let f=b.types[e],g=a.indexes[f][d[f]],h=a.values[g]??0;c[e]=h,d[f]++}return c}(d,e),e.values),c)};function dd(a,b,c){return"number"==typeof a&&"number"==typeof b&&"number"==typeof c?cc(a,b,c):c9(a)(a,b)}let de=a=>{let b=({timestamp:b})=>a(b);return{start:(a=!0)=>a7.update(b,a),stop:()=>a8(b),now:()=>a9.isProcessing?a9.timestamp:bI.now()}};function df(a){let b=0,c=a.next(b);for(;!c.done&&b<2e4;)b+=50,c=a.next(b);return b>=2e4?1/0:b}function dg(a,b,c){var d,e;let f=Math.max(b-5,0);return d=c-a(f),(e=b-f)?1e3/e*d:0}let dh=.01,di=2,dj=.005,dk=.5;function dl(a,b){return a*Math.sqrt(1-b*b)}let dm=["duration","bounce"],dn=["stiffness","damping","mass"];function dp(a,b){return b.some(b=>void 0!==a[b])}function dq(a=.3,b=.3){let c,d="object"!=typeof a?{visualDuration:a,keyframes:[0,1],bounce:b}:a,{restSpeed:e,restDelta:f}=d,g=d.keyframes[0],h=d.keyframes[d.keyframes.length-1],i={done:!1,value:g},{stiffness:j,damping:k,mass:l,duration:m,velocity:n,isResolvedFromDuration:o}=function(a){let b={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...a};if(!dp(a,dn)&&dp(a,dm))if(a.visualDuration){let c=2*Math.PI/(1.2*a.visualDuration),d=c*c,e=2*O(.05,1,1-(a.bounce||0))*Math.sqrt(d);b={...b,mass:1,stiffness:d,damping:e}}else{let c=function({duration:a=800,bounce:b=.3,velocity:c=0,mass:d=1}){let e,f;aI(a<=bm(10),"Spring duration must be 10 seconds or less","spring-duration-limit");let g=1-b;g=O(.05,1,g),a=O(.01,10,a/1e3),g<1?(e=b=>{let d=b*g,e=d*a;return .001-(d-c)/dl(b,g)*Math.exp(-e)},f=b=>{let d=b*g*a,f=Math.pow(g,2)*Math.pow(b,2)*a,h=Math.exp(-d),i=dl(Math.pow(b,2),g);return(d*c+c-f)*h*(-e(b)+.001>0?-1:1)/i}):(e=b=>-.001+Math.exp(-b*a)*((b-c)*a+1),f=b=>a*a*(c-b)*Math.exp(-b*a));let h=function(a,b,c){let d=c;for(let c=1;c<12;c++)d-=a(d)/b(d);return d}(e,f,5/a);if(a=bm(a),isNaN(h))return{stiffness:100,damping:10,duration:a};{let b=Math.pow(h,2)*d;return{stiffness:b,damping:2*g*Math.sqrt(d*b),duration:a}}}(a);(b={...b,...c,mass:1}).isResolvedFromDuration=!0}return b}({...d,velocity:-((d.velocity||0)/1e3)}),p=n||0,q=k/(2*Math.sqrt(j*l)),r=h-g,s=Math.sqrt(j/l)/1e3,t=5>Math.abs(r);if(e||(e=t?dh:di),f||(f=t?dj:dk),q<1){let a=dl(s,q);c=b=>h-Math.exp(-q*s*b)*((p+q*s*r)/a*Math.sin(a*b)+r*Math.cos(a*b))}else if(1===q)c=a=>h-Math.exp(-s*a)*(r+(p+s*r)*a);else{let a=s*Math.sqrt(q*q-1);c=b=>{let c=Math.exp(-q*s*b),d=Math.min(a*b,300);return h-c*((p+q*s*r)*Math.sinh(d)+a*r*Math.cosh(d))/a}}let u={calculatedDuration:o&&m||null,next:a=>{let b=c(a);if(o)i.done=a>=m;else{let d=0===a?p:0;q<1&&(d=0===a?bm(p):dg(c,a,b));let g=Math.abs(h-b)<=f;i.done=Math.abs(d)<=e&&g}return i.value=i.done?h:b,i},toString:()=>{let a=Math.min(df(u),2e4),b=bA(b=>u.next(a*b).value,a,30);return a+"ms "+b},toTransition:()=>{}};return u}function dr({keyframes:a,velocity:b=0,power:c=.8,timeConstant:d=325,bounceDamping:e=10,bounceStiffness:f=500,modifyTarget:g,min:h,max:i,restDelta:j=.5,restSpeed:k}){let l,m,n=a[0],o={done:!1,value:n},p=c*b,q=n+p,r=void 0===g?q:g(q);r!==q&&(p=r-n);let s=a=>-p*Math.exp(-a/d),t=a=>r+s(a),u=a=>{let b=s(a),c=t(a);o.done=Math.abs(b)<=j,o.value=o.done?r:c},v=a=>{let b;if(b=o.value,void 0!==h&&b<h||void 0!==i&&b>i){var c;l=a,m=dq({keyframes:[o.value,(c=o.value,void 0===h?i:void 0===i||Math.abs(h-c)<Math.abs(i-c)?h:i)],velocity:dg(t,a,o.value),damping:e,stiffness:f,restDelta:j,restSpeed:k})}};return v(0),{calculatedDuration:null,next:a=>{let b=!1;return(m||void 0!==l||(b=!0,u(a),v(a)),void 0!==l&&a>=l)?m.next(a-l):(b||u(a),o)}}}dq.applyToOptions=a=>{let b=function(a,b=100,c){let d=c({...a,keyframes:[0,b]}),e=Math.min(df(d),2e4);return{type:"keyframes",ease:a=>d.next(e*a).value/b,duration:e/1e3}}(a,100,dq);return a.ease=b.ease,a.duration=bm(b.duration),a.type="keyframes",a};let ds=(a,b,c)=>(((1-3*c+3*b)*a+(3*c-6*b))*a+3*b)*a;function dt(a,b,c,d){return a===b&&c===d?a3:e=>0===e||1===e?e:ds(function(a,b,c,d,e){let f,g,h=0;do(f=ds(g=b+(c-b)/2,d,e)-a)>0?c=g:b=g;while(Math.abs(f)>1e-7&&++h<12)return g}(e,0,1,a,c),b,d)}let du=dt(.42,0,1,1),dv=dt(0,0,.58,1),dw=dt(.42,0,.58,1),dx=a=>b=>b<=.5?a(2*b)/2:(2-a(2*(1-b)))/2,dy=a=>b=>1-a(1-b),dz=dt(.33,1.53,.69,.99),dA=dy(dz),dB=dx(dA),dC=a=>(a*=2)<1?.5*dA(a):.5*(2-Math.pow(2,-10*(a-1))),dD=a=>1-Math.sin(Math.acos(a)),dE=dy(dD),dF=dx(dD),dG={linear:a3,easeIn:du,easeInOut:dw,easeOut:dv,circIn:dD,circInOut:dF,circOut:dE,backIn:dA,backInOut:dB,backOut:dz,anticipate:dC},dH=a=>{if(by(a)){aJ(4===a.length,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");let[b,c,d,e]=a;return dt(b,c,d,e)}return"string"==typeof a?(aJ(void 0!==dG[a],`Invalid easing type '${a}'`,"invalid-easing-type"),dG[a]):a},dI=(a,b,c)=>{let d=b-a;return 0===d?1:(c-a)/d};function dJ({duration:a=300,keyframes:b,times:c,ease:d="easeInOut"}){var e;let f,g=Array.isArray(d)&&"number"!=typeof d[0]?d.map(dH):dH(d),h={done:!1,value:b[0]},i=function(a,b,{clamp:c=!0,ease:d,mixer:e}={}){let f=a.length;if(aJ(f===b.length,"Both input and output ranges must be the same length","range-length"),1===f)return()=>b[0];if(2===f&&b[0]===b[1])return()=>b[1];let g=a[0]===a[1];a[0]>a[f-1]&&(a=[...a].reverse(),b=[...b].reverse());let h=function(a,b,c){let d=[],e=c||a4.mix||dd,f=a.length-1;for(let c=0;c<f;c++){let f=e(a[c],a[c+1]);b&&(f=c0(Array.isArray(b)?b[c]||a3:b,f)),d.push(f)}return d}(b,d,e),i=h.length,j=c=>{if(g&&c<a[0])return b[0];let d=0;if(i>1)for(;d<a.length-2&&!(c<a[d+1]);d++);let e=dI(a[d],a[d+1],c);return h[d](e)};return c?b=>j(O(a[0],a[f-1],b)):j}((e=c&&c.length===b.length?c:(!function(a,b){let c=a[a.length-1];for(let d=1;d<=b;d++){let e=dI(0,b,d);a.push(cc(c,1,e))}}(f=[0],b.length-1),f),e.map(b=>b*a)),b,{ease:Array.isArray(g)?g:b.map(()=>g||dw).splice(0,b.length-1)});return{calculatedDuration:a,next:b=>(h.value=i(b),h.done=b>=a,h)}}let dK={decay:dr,inertia:dr,tween:dJ,keyframes:dJ,spring:dq};function dL(a){"string"==typeof a.type&&(a.type=dK[a.type])}let dM=a=>a/100;class dN extends bw{constructor(a){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{let{motionValue:a}=this.options;a&&a.updatedAt!==bI.now()&&this.tick(bI.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},bx.mainThread++,this.options=a,this.initAnimation(),this.play(),!1===a.autoplay&&this.pause()}initAnimation(){let{options:a}=this;dL(a);let{type:b=dJ,repeat:c=0,repeatDelay:d=0,repeatType:e,velocity:f=0}=a,{keyframes:g}=a,h=b||dJ;h!==dJ&&"number"!=typeof g[0]&&(this.mixKeyframes=c0(dM,dd(g[0],g[1])),g=[0,100]);let i=h({...a,keyframes:g});"mirror"===e&&(this.mirroredGenerator=h({...a,keyframes:[...g].reverse(),velocity:-f})),null===i.calculatedDuration&&(i.calculatedDuration=df(i));let{calculatedDuration:j}=i;this.calculatedDuration=j,this.resolvedDuration=j+d,this.totalDuration=this.resolvedDuration*(c+1)-d,this.generator=i}updateTime(a){let b=Math.round(a-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=b}tick(a,b=!1){let{generator:c,totalDuration:d,mixKeyframes:e,mirroredGenerator:f,resolvedDuration:g,calculatedDuration:h}=this;if(null===this.startTime)return c.next(0);let{delay:i=0,keyframes:j,repeat:k,repeatType:l,repeatDelay:m,type:n,onUpdate:o,finalKeyframe:p}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,a):this.speed<0&&(this.startTime=Math.min(a-d/this.speed,this.startTime)),b?this.currentTime=a:this.updateTime(a);let q=this.currentTime-i*(this.playbackSpeed>=0?1:-1),r=this.playbackSpeed>=0?q<0:q>d;this.currentTime=Math.max(q,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=d);let s=this.currentTime,t=c;if(k){let a=Math.min(this.currentTime,d)/g,b=Math.floor(a),c=a%1;!c&&a>=1&&(c=1),1===c&&b--,(b=Math.min(b,k+1))%2&&("reverse"===l?(c=1-c,m&&(c-=m/g)):"mirror"===l&&(t=f)),s=O(0,1,c)*g}let u=r?{done:!1,value:j[0]}:t.next(s);e&&(u.value=e(u.value));let{done:v}=u;r||null===h||(v=this.playbackSpeed>=0?this.currentTime>=d:this.currentTime<=0);let w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&v);return w&&n!==dr&&(u.value=bv(j,this.options,p,this.speed)),o&&o(u.value),w&&this.finish(),u}then(a,b){return this.finished.then(a,b)}get duration(){return this.calculatedDuration/1e3}get iterationDuration(){let{delay:a=0}=this.options||{};return this.duration+a/1e3}get time(){return this.currentTime/1e3}set time(a){a=bm(a),this.currentTime=a,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=a:this.driver&&(this.startTime=this.driver.now()-a/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(a){this.updateTime(bI.now());let b=this.playbackSpeed!==a;this.playbackSpeed=a,b&&(this.time=this.currentTime/1e3)}play(){if(this.isStopped)return;let{driver:a=de,startTime:b}=this.options;this.driver||(this.driver=a(a=>this.tick(a))),this.options.onPlay?.();let c=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=c):null!==this.holdTime?this.startTime=c-this.holdTime:this.startTime||(this.startTime=b??c),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(bI.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,bx.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(a){return this.startTime=0,this.tick(a,!0)}attachTimeline(a){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),a.observe(this)}}let dO={anticipate:dC,backInOut:dB,circInOut:dF};class dP extends bE{constructor(a){!function(a){"string"==typeof a.ease&&a.ease in dO&&(a.ease=dO[a.ease])}(a),dL(a),super(a),void 0!==a.startTime&&(this.startTime=a.startTime),this.options=a}updateMotionValue(a){let{motionValue:b,onUpdate:c,onComplete:d,element:e,...f}=this.options;if(!b)return;if(void 0!==a)return void b.set(a);let g=new dN({...f,autoplay:!1}),h=Math.max(10,bI.now()-this.startTime),i=O(0,10,h-10);b.setWithVelocity(g.sample(Math.max(0,h-i)).value,g.sample(h).value,i),g.stop()}}let dQ=(a,b)=>"zIndex"!==b&&!!("number"==typeof a||Array.isArray(a)||"string"==typeof a&&(ap.test(a)||"0"===a)&&!a.startsWith("url("));function dR(a){a.duration=0,a.type="keyframes"}let dS=new Set(["opacity","clipPath","filter","transform"]),dT=bq(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class dU extends bw{constructor({autoplay:a=!0,delay:b=0,type:c="keyframes",repeat:d=0,repeatDelay:e=0,repeatType:f="loop",keyframes:g,name:h,motionValue:i,element:j,...k}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=bI.now();const l={autoplay:a,delay:b,type:c,repeat:d,repeatDelay:e,repeatType:f,name:h,motionValue:i,element:j,...k},m=j?.KeyframeResolver||bh;this.keyframeResolver=new m(g,(a,b,c)=>this.onKeyframesResolved(a,b,l,!c),h,i,j),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(a,b,c,d){this.keyframeResolver=void 0;let{name:e,type:f,velocity:g,delay:h,isHandoff:i,onUpdate:j}=c;this.resolvedAt=bI.now(),!function(a,b,c,d){let e=a[0];if(null===e)return!1;if("display"===b||"visibility"===b)return!0;let f=a[a.length-1],g=dQ(e,b),h=dQ(f,b);return aI(g===h,`You are trying to animate ${b} from "${e}" to "${f}". "${g?f:e}" is not an animatable value.`,"value-not-animatable"),!!g&&!!h&&(function(a){let b=a[0];if(1===a.length)return!0;for(let c=0;c<a.length;c++)if(a[c]!==b)return!0}(a)||("spring"===c||bD(c))&&d)}(a,e,f,g)&&((a4.instantAnimations||!h)&&j?.(bv(a,c,b)),a[0]=a[a.length-1],dR(c),c.repeat=0);let k={startTime:d?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:b,...c,keyframes:a},l=!i&&function(a){let{motionValue:b,name:c,repeatDelay:d,repeatType:e,damping:f,type:g}=a;if(!(b?.owner?.current instanceof HTMLElement))return!1;let{onUpdate:h,transformTemplate:i}=b.owner.getProps();return dT()&&c&&dS.has(c)&&("transform"!==c||!i)&&!h&&!d&&"mirror"!==e&&0!==f&&"inertia"!==g}(k),m=k.motionValue?.owner?.current,n=l?new dP({...k,element:m}):new dN(k);n.finished.then(()=>{this.notifyFinished()}).catch(a3),this.pendingTimeline&&(this.stopTimeline=n.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=n}get finished(){return this._animation?this.animation.finished:this._finished}then(a,b){return this.finished.finally(a).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),be=!0,bg(),bf(),be=!1),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(a){this.animation.time=a}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(a){this.animation.speed=a}get startTime(){return this.animation.startTime}attachTimeline(a){return this._animation?this.stopTimeline=this.animation.attachTimeline(a):this.pendingTimeline=a,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}let dV={type:"spring",stiffness:500,damping:25,restSpeed:10},dW={type:"keyframes",duration:.8},dX={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},dY=a=>null!==a,dZ=(a,b,c,d={},e,f)=>g=>{let h=cY(d,a)||{},i=h.delay||d.delay||0,{elapsed:j=0}=d;j-=bm(i);let k={keyframes:Array.isArray(c)?c:[null,c],ease:"easeOut",velocity:b.getVelocity(),...h,delay:-j,onUpdate:a=>{b.set(a),h.onUpdate&&h.onUpdate(a)},onComplete:()=>{g(),h.onComplete&&h.onComplete()},name:a,motionValue:b,element:f?void 0:e};!function({when:a,delay:b,delayChildren:c,staggerChildren:d,staggerDirection:e,repeat:f,repeatType:g,repeatDelay:h,from:i,elapsed:j,...k}){return!!Object.keys(k).length}(h)&&Object.assign(k,((a,{keyframes:b})=>b.length>2?dW:N.has(a)?a.startsWith("scale")?{type:"spring",stiffness:550,damping:0===b[1]?2*Math.sqrt(550):30,restSpeed:10}:dV:dX)(a,k)),k.duration&&(k.duration=bm(k.duration)),k.repeatDelay&&(k.repeatDelay=bm(k.repeatDelay)),void 0!==k.from&&(k.keyframes[0]=k.from);let l=!1;if(!1!==k.type&&(0!==k.duration||k.repeatDelay)||(dR(k),0===k.delay&&(l=!0)),(a4.instantAnimations||a4.skipAnimations||e?.shouldSkipAnimations)&&(l=!0,dR(k),k.delay=0),k.allowFlatten=!h.type&&!h.ease,l&&!f&&void 0!==b.get()){let a=function(a,{repeat:b,repeatType:c="loop"},d){let e=a.filter(dY),f=b&&"loop"!==c&&b%2==1?0:e.length-1;return e[f]}(k.keyframes,h);if(void 0!==a)return void a7.update(()=>{k.onUpdate(a),k.onComplete()})}return h.isSync?new dN(k):new dU(k)};function d$(a,b,{delay:c=0,transitionOverride:d,type:e}={}){let{transition:f,transitionEnd:g,...h}=b,i=a.getDefaultTransition();f=f?cX(f,i):i;let j=f?.reduceMotion;d&&(f=d);let k=[],l=e&&a.animationState&&a.animationState.getState()[e];for(let b in h){let d=a.getValue(b,a.latestValues[b]??null),e=h[b];if(void 0===e||l&&function({protectedKeys:a,needsAnimating:b},c){let d=a.hasOwnProperty(c)&&!0!==b[c];return b[c]=!1,d}(l,b))continue;let g={delay:c,...cY(f||{},b)},i=d.get();if(void 0!==i&&!d.isAnimating&&!Array.isArray(e)&&e===i&&!g.velocity)continue;let m=!1;if(window.MotionHandoffAnimation){let c=a.props[cQ];if(c){let a=window.MotionHandoffAnimation(c,b,a7);null!==a&&(g.startTime=a,m=!0)}}c$(a,b);let n=j??a.shouldReduceMotion;d.start(dZ(b,d,e,n&&aE.has(b)?{type:!1}:g,a,m));let o=d.animation;o&&k.push(o)}if(g){let b=()=>a7.update(()=>{g&&function(a,b){let{transitionEnd:c={},transition:d={},...e}=cW(a,b)||{};for(let b in e={...e,...c}){var f;let c=cZ(f=e[b])?f[f.length-1]||0:f;a.hasValue(b)?a.getValue(b).set(c):a.addValue(b,bK(c))}}(a,g)});k.length?Promise.all(k).then(b):b()}return k}function d_(a,b,c,d=0,e=1){let f=Array.from(a).sort((a,b)=>a.sortNodePosition(b)).indexOf(b),g=a.size,h=(g-1)*d;return"function"==typeof c?c(f,g):1===e?f*d:h-f*d}function d0(a,b,c={}){let d=cW(a,b,"exit"===c.type?a.presenceContext?.custom:void 0),{transition:e=a.getDefaultTransition()||{}}=d||{};c.transitionOverride&&(e=c.transitionOverride);let f=d?()=>Promise.all(d$(a,d,c)):()=>Promise.resolve(),g=a.variantChildren&&a.variantChildren.size?(d=0)=>{let{delayChildren:f=0,staggerChildren:g,staggerDirection:h}=e;return function(a,b,c=0,d=0,e=0,f=1,g){let h=[];for(let i of a.variantChildren)i.notify("AnimationStart",b),h.push(d0(i,b,{...g,delay:c+("function"==typeof d?0:d)+d_(a.variantChildren,i,d,e,f)}).then(()=>i.notify("AnimationComplete",b)));return Promise.all(h)}(a,b,d,f,g,h,c)}:()=>Promise.resolve(),{when:h}=e;if(!h)return Promise.all([f(),g(c.delay)]);{let[a,b]="beforeChildren"===h?[f,g]:[g,f];return a().then(()=>b())}}let d1=bQ.length;function d2(a,b){if(!Array.isArray(b))return!1;let c=b.length;if(c!==a.length)return!1;for(let d=0;d<c;d++)if(b[d]!==a[d])return!1;return!0}let d3=[...bP].reverse(),d4=bP.length;function d5(a=!1){return{isActive:a,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function d6(){return{animate:d5(!0),whileInView:d5(),whileHover:d5(),whileTap:d5(),whileDrag:d5(),whileFocus:d5(),exit:d5()}}let d7=0;function d8(a){return[a("x"),a("y")]}let d9=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]),ea=new Set(["INPUT","SELECT","TEXTAREA"]);function eb(a,b,c,d={passive:!0}){return a.addEventListener(b,c,d),()=>a.removeEventListener(b,c)}let ec={x:!1,y:!1};function ed(a){return a.max-a.min}function ee(a,b,c,d=.5){a.origin=d,a.originPoint=cc(b.min,b.max,a.origin),a.scale=ed(c)/ed(b),a.translate=cc(c.min,c.max,a.origin)-a.originPoint,(a.scale>=.9999&&a.scale<=1.0001||isNaN(a.scale))&&(a.scale=1),(a.translate>=-.01&&a.translate<=.01||isNaN(a.translate))&&(a.translate=0)}function ef(a,b,c,d){ee(a.x,b.x,c.x,d?d.originX:void 0),ee(a.y,b.y,c.y,d?d.originY:void 0)}function eg(a,b,c){a.min=c.min+b.min,a.max=a.min+ed(b)}function eh(a,b,c){a.min=b.min-c.min,a.max=a.min+ed(b)}function ei(a,b,c){eh(a.x,b.x,c.x),eh(a.y,b.y,c.y)}function ej(a){return"object"==typeof a&&null!==a}function ek(a){return ej(a)&&"ownerSVGElement"in a}function el(a,b,c){if(null==a)return[];if(a instanceof EventTarget)return[a];if("string"==typeof a){let d=document;b&&(d=b.current);let e=c?.[a]??d.querySelectorAll(a);return e?Array.from(e):[]}return Array.from(a).filter(a=>null!=a)}let em=new WeakMap,en=(a,b,c)=>(d,e)=>e&&e[0]?e[0][a+"Size"]:ek(d)&&"getBBox"in d?d.getBBox()[b]:d[c],eo=en("inline","width","offsetWidth"),ep=en("block","height","offsetHeight");function eq({target:a,borderBoxSize:b}){em.get(a)?.forEach(c=>{c(a,{get width(){return eo(a,b)},get height(){return ep(a,b)}})})}function er(a){a.forEach(eq)}let es=new Set;function et(a,b){let e;return"function"==typeof a?(es.add(a),d||(d=()=>{let a={get width(){return window.innerWidth},get height(){return window.innerHeight}};es.forEach(b=>b(a))},window.addEventListener("resize",d)),()=>{es.delete(a),es.size||"function"!=typeof d||(window.removeEventListener("resize",d),d=void 0)}):(!c&&"u">typeof ResizeObserver&&(c=new ResizeObserver(er)),(e=el(a)).forEach(a=>{let d=em.get(a);d||(d=new Set,em.set(a,d)),d.add(b),c?.observe(a)}),()=>{e.forEach(a=>{let d=em.get(a);d?.delete(b),d?.size||c?.unobserve(a)})})}let eu=a=>"mouse"===a.pointerType?"number"!=typeof a.button||a.button<=0:!1!==a.isPrimary;function ev(a){return{point:{x:a.pageX,y:a.pageY}}}function ew(a,b,c,d){return eb(a,b,a=>eu(a)&&c(a,ev(a)),d)}let ex=({current:a})=>a?a.ownerDocument.defaultView:null,ey=(a,b)=>Math.abs(a-b),ez=new Set(["auto","scroll"]);class eA{constructor(a,b,{transformPagePoint:c,contextWindow:d=window,dragSnapToOrigin:e=!1,distanceThreshold:f=3,element:g}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=a=>{this.handleScroll(a.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{var a,b;if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let c=eD(this.lastMoveEventInfo,this.history),d=null!==this.startEvent,e=(a=c.offset,b={x:0,y:0},Math.sqrt(ey(a.x,b.x)**2+ey(a.y,b.y)**2)>=this.distanceThreshold);if(!d&&!e)return;let{point:f}=c,{timestamp:g}=a9;this.history.push({...f,timestamp:g});let{onStart:h,onMove:i}=this.handlers;d||(h&&h(this.lastMoveEvent,c),this.startEvent=this.lastMoveEvent),i&&i(this.lastMoveEvent,c)},this.handlePointerMove=(a,b)=>{this.lastMoveEvent=a,this.lastMoveEventInfo=eB(b,this.transformPagePoint),a7.update(this.updatePoint,!0)},this.handlePointerUp=(a,b)=>{this.end();let{onEnd:c,onSessionEnd:d,resumeAnimation:e}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&e&&e(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let f=eD("pointercancel"===a.type?this.lastMoveEventInfo:eB(b,this.transformPagePoint),this.history);this.startEvent&&c&&c(a,f),d&&d(a,f)},!eu(a))return;this.dragSnapToOrigin=e,this.handlers=b,this.transformPagePoint=c,this.distanceThreshold=f,this.contextWindow=d||window;const h=eB(ev(a),this.transformPagePoint),{point:i}=h,{timestamp:j}=a9;this.history=[{...i,timestamp:j}];const{onSessionStart:k}=b;k&&k(a,eD(h,this.history)),this.removeListeners=c0(ew(this.contextWindow,"pointermove",this.handlePointerMove),ew(this.contextWindow,"pointerup",this.handlePointerUp),ew(this.contextWindow,"pointercancel",this.handlePointerUp)),g&&this.startScrollTracking(g)}startScrollTracking(a){let b=a.parentElement;for(;b;){let a=getComputedStyle(b);(ez.has(a.overflowX)||ez.has(a.overflowY))&&this.scrollPositions.set(b,{x:b.scrollLeft,y:b.scrollTop}),b=b.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(a){let b=this.scrollPositions.get(a);if(!b)return;let c=a===window,d=c?{x:window.scrollX,y:window.scrollY}:{x:a.scrollLeft,y:a.scrollTop},e={x:d.x-b.x,y:d.y-b.y};(0!==e.x||0!==e.y)&&(c?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=e.x,this.lastMoveEventInfo.point.y+=e.y):this.history.length>0&&(this.history[0].x-=e.x,this.history[0].y-=e.y),this.scrollPositions.set(a,d),a7.update(this.updatePoint,!0))}updateHandlers(a){this.handlers=a}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),a8(this.updatePoint)}}function eB(a,b){return b?{point:b(a.point)}:a}function eC(a,b){return{x:a.x-b.x,y:a.y-b.y}}function eD({point:a},b){return{point:a,delta:eC(a,eE(b)),offset:eC(a,b[0]),velocity:function(a,b){if(a.length<2)return{x:0,y:0};let c=a.length-1,d=null,e=eE(a);for(;c>=0&&(d=a[c],!(e.timestamp-d.timestamp>bm(.1)));)c--;if(!d)return{x:0,y:0};d===a[0]&&a.length>2&&e.timestamp-d.timestamp>2*bm(.1)&&(d=a[1]);let f=(e.timestamp-d.timestamp)/1e3;if(0===f)return{x:0,y:0};let g={x:(e.x-d.x)/f,y:(e.y-d.y)/f};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}(b,.1)}}function eE(a){return a[a.length-1]}function eF(a,b,c){return{min:void 0!==b?a.min+b:void 0,max:void 0!==c?a.max+c-(a.max-a.min):void 0}}function eG(a,b){let c=b.min-a.min,d=b.max-a.max;return b.max-b.min<a.max-a.min&&([c,d]=[d,c]),{min:c,max:d}}function eH(a,b,c){return{min:eI(a,b),max:eI(a,c)}}function eI(a,b){return"number"==typeof a?a:a[b]||0}let eJ=new WeakMap;class eK{constructor(a){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=aC(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=a}start(a,{snapToCursor:b=!1,distanceThreshold:c}={}){let{presenceContext:d}=this.visualElement;if(d&&!1===d.isPresent)return;let e=a=>{b&&this.snapToCursor(ev(a).point),this.stopAnimation()},f=(a,b)=>{let{drag:c,dragPropagation:d,onDragStart:e}=this.getProps();if(c&&!d&&(this.openDragLock&&this.openDragLock(),this.openDragLock=function(a){if("x"===a||"y"===a)if(ec[a])return null;else return ec[a]=!0,()=>{ec[a]=!1};return ec.x||ec.y?null:(ec.x=ec.y=!0,()=>{ec.x=ec.y=!1})}(c),!this.openDragLock))return;this.latestPointerEvent=a,this.latestPanInfo=b,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),d8(a=>{let b=this.getAxisMotionValue(a).get()||0;if(aa.test(b)){let{projection:c}=this.visualElement;if(c&&c.layout){let d=c.layout.layoutBox[a];d&&(b=ed(d)*(parseFloat(b)/100))}}this.originPoint[a]=b}),e&&a7.update(()=>e(a,b),!1,!0),c$(this.visualElement,"transform");let{animationState:f}=this.visualElement;f&&f.setActive("whileDrag",!0)},g=(a,b)=>{this.latestPointerEvent=a,this.latestPanInfo=b;let{dragPropagation:c,dragDirectionLock:d,onDirectionLock:e,onDrag:f}=this.getProps();if(!c&&!this.openDragLock)return;let{offset:g}=b;if(d&&null===this.currentDirection){this.currentDirection=function(a,b=10){let c=null;return Math.abs(a.y)>b?c="y":Math.abs(a.x)>b&&(c="x"),c}(g),null!==this.currentDirection&&e&&e(this.currentDirection);return}this.updateAxis("x",b.point,g),this.updateAxis("y",b.point,g),this.visualElement.render(),f&&a7.update(()=>f(a,b),!1,!0)},h=(a,b)=>{this.latestPointerEvent=a,this.latestPanInfo=b,this.stop(a,b),this.latestPointerEvent=null,this.latestPanInfo=null},i=()=>{let{dragSnapToOrigin:a}=this.getProps();(a||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:j}=this.getProps();this.panSession=new eA(a,{onSessionStart:e,onStart:f,onMove:g,onSessionEnd:h,resumeAnimation:i},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:j,distanceThreshold:c,contextWindow:ex(this.visualElement),element:this.visualElement.current})}stop(a,b){let c=a||this.latestPointerEvent,d=b||this.latestPanInfo,e=this.isDragging;if(this.cancel(),!e||!d||!c)return;let{velocity:f}=d;this.startAnimation(f);let{onDragEnd:g}=this.getProps();g&&a7.postRender(()=>g(c,d))}cancel(){this.isDragging=!1;let{projection:a,animationState:b}=this.visualElement;a&&(a.isAnimationBlocked=!1),this.endPanSession();let{dragPropagation:c}=this.getProps();!c&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),b&&b.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(a,b,c){let{drag:d}=this.getProps();if(!c||!eM(a,d,this.currentDirection))return;let e=this.getAxisMotionValue(a),f=this.originPoint[a]+c[a];this.constraints&&this.constraints[a]&&(f=function(a,{min:b,max:c},d){return void 0!==b&&a<b?a=d?cc(b,a,d.min):Math.max(a,b):void 0!==c&&a>c&&(a=d?cc(c,a,d.max):Math.min(a,c)),a}(f,this.constraints[a],this.elastic[a])),e.set(f)}resolveConstraints(){let{dragConstraints:a,dragElastic:b}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,d=this.constraints;a&&cS(a)?this.constraints||(this.constraints=this.resolveRefConstraints()):a&&c?this.constraints=function(a,{top:b,left:c,bottom:d,right:e}){return{x:eF(a.x,c,e),y:eF(a.y,b,d)}}(c.layoutBox,a):this.constraints=!1,this.elastic=function(a=.35){return!1===a?a=0:!0===a&&(a=.35),{x:eH(a,"left","right"),y:eH(a,"top","bottom")}}(b),d!==this.constraints&&!cS(a)&&c&&this.constraints&&!this.hasMutatedConstraints&&d8(a=>{var b,d;let e;!1!==this.constraints&&this.getAxisMotionValue(a)&&(this.constraints[a]=(b=c.layoutBox[a],d=this.constraints[a],e={},void 0!==d.min&&(e.min=d.min-b.min),void 0!==d.max&&(e.max=d.max-b.min),e))})}resolveRefConstraints(){var a;let{dragConstraints:b,onMeasureDragConstraints:c}=this.getProps();if(!b||!cS(b))return!1;let d=b.current;aJ(null!==d,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");let{projection:e}=this.visualElement;if(!e||!e.layout)return!1;let f=function(a,b,c){let d=ct(a,c),{scroll:e}=b;return e&&(cq(d.x,e.offset.x),cq(d.y,e.offset.y)),d}(d,e.root,this.visualElement.getTransformPagePoint()),g=(a=e.layout.layoutBox,{x:eG(a.x,f.x),y:eG(a.y,f.y)});if(c){let a=c(function({x:a,y:b}){return{top:b.min,right:a.max,bottom:b.max,left:a.min}}(g));this.hasMutatedConstraints=!!a,a&&(g=ci(a))}return g}startAnimation(a){let{drag:b,dragMomentum:c,dragElastic:d,dragTransition:e,dragSnapToOrigin:f,onDragTransitionEnd:g}=this.getProps(),h=this.constraints||{};return Promise.all(d8(g=>{if(!eM(g,b,this.currentDirection))return;let i=h&&h[g]||{};f&&(i={min:0,max:0});let j={type:"inertia",velocity:c?a[g]:0,bounceStiffness:d?200:1e6,bounceDamping:d?40:1e7,timeConstant:750,restDelta:1,restSpeed:10,...e,...i};return this.startAxisValueAnimation(g,j)})).then(g)}startAxisValueAnimation(a,b){let c=this.getAxisMotionValue(a);return c$(this.visualElement,a),c.start(dZ(a,c,0,b,this.visualElement,!1))}stopAnimation(){d8(a=>this.getAxisMotionValue(a).stop())}getAxisMotionValue(a){let b=`_drag${a.toUpperCase()}`,c=this.visualElement.getProps();return c[b]||this.visualElement.getValue(a,(c.initial?c.initial[a]:void 0)||0)}snapToCursor(a){d8(b=>{let{drag:c}=this.getProps();if(!eM(b,c,this.currentDirection))return;let{projection:d}=this.visualElement,e=this.getAxisMotionValue(b);if(d&&d.layout){let{min:c,max:f}=d.layout.layoutBox[b],g=e.get()||0;e.set(a[b]-cc(c,f,.5)+g)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;let{drag:a,dragConstraints:b}=this.getProps(),{projection:c}=this.visualElement;if(!cS(b)||!c||!this.constraints)return;this.stopAnimation();let d={x:0,y:0};d8(a=>{let b=this.getAxisMotionValue(a);if(b&&!1!==this.constraints){var c,e;let f,g,h,i=b.get();d[a]=(c={min:i,max:i},e=this.constraints[a],f=.5,g=ed(c),(h=ed(e))>g?f=dI(e.min,e.max-g,c.min):g>h&&(f=dI(c.min,c.max-h,e.min)),O(0,1,f))}});let{transformTemplate:e}=this.visualElement.getProps();this.visualElement.current.style.transform=e?e({},""):"none",c.root&&c.root.updateScroll(),c.updateLayout(),this.constraints=!1,this.resolveConstraints(),d8(b=>{if(!eM(b,a,null))return;let c=this.getAxisMotionValue(b),{min:e,max:f}=this.constraints[b];c.set(cc(e,f,d[b]))}),this.visualElement.render()}addListeners(){let a;if(!this.visualElement.current)return;eJ.set(this.visualElement,this);let b=this.visualElement.current,c=ew(b,"pointerdown",a=>{let{drag:c,dragListener:d=!0}=this.getProps(),e=a.target,f=e!==b&&(ea.has(e.tagName)||!0===e.isContentEditable);c&&d&&!f&&this.start(a)}),d=()=>{var c,d,e;let f,g,{dragConstraints:h}=this.getProps();cS(h)&&h.current&&(this.constraints=this.resolveRefConstraints(),a||(c=b,d=h.current,f=et(c,eL(e=()=>this.scalePositionWithinConstraints())),g=et(d,eL(e)),a=()=>{f(),g()}))},{projection:e}=this.visualElement,f=e.addEventListener("measure",d);e&&!e.layout&&(e.root&&e.root.updateScroll(),e.updateLayout()),a7.read(d);let g=eb(window,"resize",()=>this.scalePositionWithinConstraints()),h=e.addEventListener("didUpdate",({delta:a,hasLayoutChanged:b})=>{this.isDragging&&b&&(d8(b=>{let c=this.getAxisMotionValue(b);c&&(this.originPoint[b]+=a[b].translate,c.set(c.get()+a[b].translate))}),this.visualElement.render())});return()=>{g(),c(),f(),h&&h(),a&&a()}}getProps(){let a=this.visualElement.getProps(),{drag:b=!1,dragDirectionLock:c=!1,dragPropagation:d=!1,dragConstraints:e=!1,dragElastic:f=.35,dragMomentum:g=!0}=a;return{...a,drag:b,dragDirectionLock:c,dragPropagation:d,dragConstraints:e,dragElastic:f,dragMomentum:g}}}function eL(a){let b=!0;return()=>{if(b){b=!1;return}a()}}function eM(a,b,c){return(!0===b||b===a)&&(null===c||c===a)}let eN=a=>(b,c)=>{a&&a7.update(()=>a(b,c),!1,!0)},eO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};var eP=L;function eQ(a=!0){let b=(0,L.useContext)(cI);if(null===b)return[!0,null];let{isPresent:c,onExitComplete:d,register:e}=b,f=(0,L.useId)();(0,L.useEffect)(()=>{if(a)return e(f)},[a]);let g=(0,L.useCallback)(()=>a&&d&&d(f),[f,d,a]);return!c&&d?[!1,g]:[!0]}let eR=!1;class eS extends eP.Component{componentDidMount(){let{visualElement:a,layoutGroup:b,switchLayoutGroup:c,layoutId:d}=this.props,{projection:e}=a;e&&(b.group&&b.group.add(e),c&&c.register&&d&&c.register(e),eR&&e.root.didUpdate(),e.addEventListener("animationComplete",()=>{this.safeToRemove()}),e.setOptions({...e.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),eO.hasEverUpdated=!0}getSnapshotBeforeUpdate(a){let{layoutDependency:b,visualElement:c,drag:d,isPresent:e}=this.props,{projection:f}=c;return f&&(f.isPresent=e,a.layoutDependency!==b&&f.setOptions({...f.options,layoutDependency:b}),eR=!0,d||a.layoutDependency!==b||void 0===b||a.isPresent!==e?f.willUpdate():this.safeToRemove(),a.isPresent!==e&&(e?f.promote():f.relegate()||a7.postRender(()=>{let a=f.getStack();a&&a.members.length||this.safeToRemove()}))),null}componentDidUpdate(){let{projection:a}=this.props.visualElement;a&&(a.root.didUpdate(),bG.postRender(()=>{!a.currentAnimation&&a.isLead()&&this.safeToRemove()}))}componentWillUnmount(){let{visualElement:a,layoutGroup:b,switchLayoutGroup:c}=this.props,{projection:d}=a;eR=!0,d&&(d.scheduleCheckAfterUnmount(),b&&b.group&&b.group.remove(d),c&&c.deregister&&c.deregister(d))}safeToRemove(){let{safeToRemove:a}=this.props;a&&a()}render(){return null}}function eT(a){let[b,c]=eQ(),d=(0,eP.useContext)(cx);return(0,K.jsx)(eS,{...a,layoutGroup:d,switchLayoutGroup:(0,eP.useContext)(cR),isPresent:b,safeToRemove:c})}let eU=["TopLeft","TopRight","BottomLeft","BottomRight"],eV=eU.length,eW=a=>"string"==typeof a?parseFloat(a):a,eX=a=>"number"==typeof a||ab.test(a);function eY(a,b){return void 0!==a[b]?a[b]:a.borderRadius}let eZ=e_(0,.5,dE),e$=e_(.5,.95,a3);function e_(a,b,c){return d=>d<a?0:d>b?1:c(dI(a,b,d))}function e0(a,b){a.min=b.min,a.max=b.max}function e1(a,b){e0(a.x,b.x),e0(a.y,b.y)}function e2(a,b){a.translate=b.translate,a.scale=b.scale,a.originPoint=b.originPoint,a.origin=b.origin}function e3(a,b,c,d,e){return a-=b,a=d+1/c*(a-d),void 0!==e&&(a=d+1/e*(a-d)),a}function e4(a,b,[c,d,e],f,g){!function(a,b=0,c=1,d=.5,e,f=a,g=a){if(aa.test(b)&&(b=parseFloat(b),b=cc(g.min,g.max,b/100)-g.min),"number"!=typeof b)return;let h=cc(f.min,f.max,d);a===f&&(h-=b),a.min=e3(a.min,b,c,h,e),a.max=e3(a.max,b,c,h,e)}(a,b[c],b[d],b[e],b.scale,f,g)}let e5=["x","scaleX","originX"],e6=["y","scaleY","originY"];function e7(a,b,c,d){e4(a.x,b,e5,c?c.x:void 0,d?d.x:void 0),e4(a.y,b,e6,c?c.y:void 0,d?d.y:void 0)}function e8(a){return 0===a.translate&&1===a.scale}function e9(a){return e8(a.x)&&e8(a.y)}function fa(a,b){return a.min===b.min&&a.max===b.max}function fb(a,b){return Math.round(a.min)===Math.round(b.min)&&Math.round(a.max)===Math.round(b.max)}function fc(a,b){return fb(a.x,b.x)&&fb(a.y,b.y)}function fd(a){return ed(a.x)/ed(a.y)}function fe(a,b){return a.translate===b.translate&&a.scale===b.scale&&a.originPoint===b.originPoint}class ff{constructor(){this.members=[]}add(a){bn(this.members,a);for(let b=this.members.length-1;b>=0;b--){let c=this.members[b];if(c===a||c===this.lead||c===this.prevLead)continue;let d=c.instance;d&&!1===d.isConnected&&!1!==c.isPresent&&!c.snapshot&&bo(this.members,c)}a.scheduleRender()}remove(a){if(bo(this.members,a),a===this.prevLead&&(this.prevLead=void 0),a===this.lead){let a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(a){let b,c=this.members.findIndex(b=>a===b);if(0===c)return!1;for(let a=c;a>=0;a--){let c=this.members[a],d=c.instance;if(!1!==c.isPresent&&(!d||!1!==d.isConnected)){b=c;break}}return!!b&&(this.promote(b),!0)}promote(a,b){let c=this.lead;if(a!==c&&(this.prevLead=c,this.lead=a,a.show(),c)){c.instance&&c.scheduleRender(),a.scheduleRender();let d=c.options.layoutDependency,e=a.options.layoutDependency;if(void 0===d||void 0===e||d!==e){let d=c.instance;!(d&&!1===d.isConnected&&!c.snapshot)&&(a.resumeFrom=c,b&&(a.resumeFrom.preserveOpacity=!0),c.snapshot&&(a.snapshot=c.snapshot,a.snapshot.latestValues=c.animationValues||c.latestValues),a.root&&a.root.isUpdating&&(a.isLayoutDirty=!0))}let{crossfade:f}=a.options;!1===f&&c.hide()}}exitAnimationComplete(){this.members.forEach(a=>{let{options:b,resumingFrom:c}=a;b.onExitComplete&&b.onExitComplete(),c&&c.options.onExitComplete&&c.options.onExitComplete()})}scheduleRender(){this.members.forEach(a=>{a.instance&&a.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}let fg=(a,b)=>a.depth-b.depth;class fh{constructor(){this.children=[],this.isDirty=!1}add(a){bn(this.children,a),this.isDirty=!0}remove(a){bo(this.children,a),this.isDirty=!0}forEach(a){this.isDirty&&this.children.sort(fg),this.isDirty=!1,this.children.forEach(a)}}let fi=["","X","Y","Z"],fj=0;function fk(a,b,c,d){let{latestValues:e}=b;e[a]&&(c[a]=e[a],b.setStaticValue(a,0),d&&(d[a]=0))}function fl({attachResizeListener:a,defaultParent:b,measureScroll:c,checkIsScrollRoot:d,resetTransform:e}){return class{constructor(a={},c=b?.()){this.id=fj++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(fo),this.nodes.forEach(fv),this.nodes.forEach(fw),this.nodes.forEach(fp)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let a=0;a<this.path.length;a++)this.path[a].shouldResetTransform=!0;this.root===this&&(this.nodes=new fh)}addEventListener(a,b){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new bp),this.eventHandlers.get(a).add(b)}notifyListeners(a,...b){let c=this.eventHandlers.get(a);c&&c.notify(...b)}hasListeners(a){return this.eventHandlers.has(a)}mount(b){if(this.instance)return;this.isSVG=ek(b)&&!(ek(b)&&"svg"===b.tagName),this.instance=b;let{layoutId:c,layout:d,visualElement:e}=this.options;if(e&&!e.current&&e.mount(b),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(d||c)&&(this.isLayoutDirty=!0),a){let c,d=0,e=()=>this.root.updateBlockedByResize=!1;a7.read(()=>{d=window.innerWidth}),a(b,()=>{let a=window.innerWidth;if(a!==d){let b,f;d=a,this.root.updateBlockedByResize=!0,c&&c(),b=bI.now(),f=({timestamp:a})=>{let c=a-b;c>=250&&(a8(f),e(c-250))},a7.setup(f,!0),c=()=>a8(f),eO.hasAnimatedSinceResize&&(eO.hasAnimatedSinceResize=!1,this.nodes.forEach(fu))}})}c&&this.root.registerSharedNode(c,this),!1!==this.options.animate&&e&&(c||d)&&this.addEventListener("didUpdate",({delta:a,hasLayoutChanged:b,hasRelativeLayoutChanged:c,layout:d})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}let f=this.options.transition||e.getDefaultTransition()||fC,{onLayoutAnimationStart:g,onLayoutAnimationComplete:h}=e.getProps(),i=!this.targetLayout||!fc(this.targetLayout,d),j=!b&&c;if(this.options.layoutRoot||this.resumeFrom||j||b&&(i||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);let b={...cY(f,"layout"),onPlay:g,onComplete:h};(e.shouldReduceMotion||this.options.layoutRoot)&&(b.delay=0,b.type=!1),this.startAnimation(b),this.setAnimationOrigin(a,j)}else b||fu(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=d})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);let a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),a8(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){!this.isUpdateBlocked()&&(this.isUpdating=!0,this.nodes&&this.nodes.forEach(fx),this.animationId++)}getTransformTemplate(){let{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&function a(b){if(b.hasCheckedOptimisedAppear=!0,b.root===b)return;let{visualElement:c}=b.options;if(!c)return;let d=c.props[cQ];if(window.MotionHasOptimisedAnimation(d,"transform")){let{layout:a,layoutId:c}=b.options;window.MotionCancelOptimisedAnimation(d,"transform",a7,!(a||c))}let{parent:e}=b;e&&!e.hasCheckedOptimisedAppear&&a(e)}(this),this.root.isUpdating||this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let a=0;a<this.path.length;a++){let b=this.path[a];b.shouldResetTransform=!0,b.updateScroll("snapshot"),b.options.layoutRoot&&b.willUpdate(!1)}let{layoutId:b,layout:c}=this.options;if(void 0===b&&!c)return;let d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(fr);return}if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(fs);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(ft),this.nodes.forEach(fm),this.nodes.forEach(fn)):this.nodes.forEach(fs),this.clearAllSnapshots();let a=bI.now();a9.delta=O(0,1e3/60,a-a9.timestamp),a9.timestamp=a,a9.isProcessing=!0,ba.update.process(a9),ba.preRender.process(a9),ba.render.process(a9),a9.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,bG.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(fq),this.sharedNodes.forEach(fy)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,a7.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){a7.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||ed(this.snapshot.measuredBox.x)||ed(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let a=0;a<this.path.length;a++)this.path[a].updateScroll();let a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=aC(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);let{visualElement:b}=this.options;b&&b.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let b=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(b=!1),b&&this.instance){let b=d(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:b,offset:c(this.instance),wasRoot:this.scroll?this.scroll.isRoot:b}}}resetTransform(){if(!e)return;let a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,b=this.projectionDelta&&!e9(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,f=d!==this.prevTransformTemplateValue;a&&this.instance&&(b||cl(this.latestValues)||f)&&(e(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){var b;let c=this.measurePageBox(),d=this.removeElementScroll(c);return a&&(d=this.removeTransform(d)),fF((b=d).x),fF(b.y),{animationId:this.root.animationId,measuredBox:c,layoutBox:d,latestValues:{},source:this.id}}measurePageBox(){let{visualElement:a}=this.options;if(!a)return aC();let b=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(fH))){let{scroll:a}=this.root;a&&(cq(b.x,a.offset.x),cq(b.y,a.offset.y))}return b}removeElementScroll(a){let b=aC();if(e1(b,a),this.scroll?.wasRoot)return b;for(let c=0;c<this.path.length;c++){let d=this.path[c],{scroll:e,options:f}=d;d!==this.root&&e&&f.layoutScroll&&(e.wasRoot&&e1(b,a),cq(b.x,e.offset.x),cq(b.y,e.offset.y))}return b}applyTransform(a,b=!1){let c=aC();e1(c,a);for(let a=0;a<this.path.length;a++){let d=this.path[a];!b&&d.options.layoutScroll&&d.scroll&&d!==d.root&&cs(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),cl(d.latestValues)&&cs(c,d.latestValues)}return cl(this.latestValues)&&cs(c,this.latestValues),c}removeTransform(a){let b=aC();e1(b,a);for(let a=0;a<this.path.length;a++){let c=this.path[a];if(!c.instance||!cl(c.latestValues))continue;ck(c.latestValues)&&c.updateSnapshot();let d=aC();e1(d,c.measurePageBox()),e7(b,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,d)}return cl(this.latestValues)&&e7(b,this.latestValues),b}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:void 0===a.crossfade||a.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==a9.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){let b=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=b.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=b.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=b.isSharedProjectionDirty);let c=!!this.resumingFrom||this!==b;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;let{layout:d,layoutId:e}=this.options;if(!this.layout||!(d||e))return;this.resolvedRelativeTargetAt=a9.timestamp;let f=this.getClosestProjectingParent();if(f&&this.linkedParentVersion!==f.layoutVersion&&!f.options.layoutRoot&&this.removeRelativeTarget(),this.targetDelta||this.relativeTarget||(f&&f.layout?this.createRelativeTarget(f,this.layout.layoutBox,f.layout.layoutBox):this.removeRelativeTarget()),this.relativeTarget||this.targetDelta){if(this.target||(this.target=aC(),this.targetWithTransforms=aC()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target){var g,h,i;this.forceRelativeParentToResolveTarget(),g=this.target,h=this.relativeTarget,i=this.relativeParent.target,eg(g.x,h.x,i.x),eg(g.y,h.y,i.y)}else this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):e1(this.target,this.layout.layoutBox),cp(this.target,this.targetDelta)):e1(this.target,this.layout.layoutBox);this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&1!==this.animationProgress?this.createRelativeTarget(f,this.target,f.target):this.relativeParent=this.relativeTarget=void 0)}}getClosestProjectingParent(){if(!(!this.parent||ck(this.parent.latestValues)||cm(this.parent.latestValues)))if(this.parent.isProjecting())return this.parent;else return this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,b,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=aC(),this.relativeTargetOrigin=aC(),ei(this.relativeTargetOrigin,b,c),e1(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){let a=this.getLead(),b=!!this.resumingFrom||this!==a,c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),b&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===a9.timestamp&&(c=!1),c)return;let{layout:d,layoutId:e}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||e))return;e1(this.layoutCorrected,this.layout.layoutBox);let f=this.treeScale.x,g=this.treeScale.y;!function(a,b,c,d=!1){let e,f,g=c.length;if(g){b.x=b.y=1;for(let h=0;h<g;h++){f=(e=c[h]).projectionDelta;let{visualElement:g}=e.options;(!g||!g.props.style||"contents"!==g.props.style.display)&&(d&&e.options.layoutScroll&&e.scroll&&e!==e.root&&cs(a,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),f&&(b.x*=f.x.scale,b.y*=f.y.scale,cp(a,f)),d&&cl(e.latestValues)&&cs(a,e.latestValues))}b.x<1.0000000000001&&b.x>.999999999999&&(b.x=1),b.y<1.0000000000001&&b.y>.999999999999&&(b.y=1)}}(this.layoutCorrected,this.treeScale,this.path,b),a.layout&&!a.target&&(1!==this.treeScale.x||1!==this.treeScale.y)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=aC());let{target:h}=a;if(!h){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}this.projectionDelta&&this.prevProjectionDelta?(e2(this.prevProjectionDelta.x,this.projectionDelta.x),e2(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),ef(this.projectionDelta,this.layoutCorrected,h,this.latestValues),this.treeScale.x===f&&this.treeScale.y===g&&fe(this.projectionDelta.x,this.prevProjectionDelta.x)&&fe(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",h))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){let a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=aA(),this.projectionDelta=aA(),this.projectionDeltaWithTransform=aA()}setAnimationOrigin(a,b=!1){let c,d=this.snapshot,e=d?d.latestValues:{},f={...this.latestValues},g=aA();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!b;let h=aC(),i=(d?d.source:void 0)!==(this.layout?this.layout.source:void 0),j=this.getStack(),k=!j||j.members.length<=1,l=!!(i&&!k&&!0===this.options.crossfade&&!this.path.some(fB));this.animationProgress=0,this.mixTargetDelta=b=>{let d=b/1e3;if(fz(g.x,a.x,d),fz(g.y,a.y,d),this.setTargetDelta(g),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout){var j,m,n,o,p,q;ei(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),n=this.relativeTarget,o=this.relativeTargetOrigin,p=h,q=d,fA(n.x,o.x,p.x,q),fA(n.y,o.y,p.y,q),c&&(j=this.relativeTarget,m=c,fa(j.x,m.x)&&fa(j.y,m.y))&&(this.isProjectionDirty=!1),c||(c=aC()),e1(c,this.relativeTarget)}i&&(this.animationValues=f,function(a,b,c,d,e,f){e?(a.opacity=cc(0,c.opacity??1,eZ(d)),a.opacityExit=cc(b.opacity??1,0,e$(d))):f&&(a.opacity=cc(b.opacity??1,c.opacity??1,d));for(let e=0;e<eV;e++){let f=`border${eU[e]}Radius`,g=eY(b,f),h=eY(c,f);(void 0!==g||void 0!==h)&&(g||(g=0),h||(h=0),0===g||0===h||eX(g)===eX(h)?(a[f]=Math.max(cc(eW(g),eW(h),d),0),(aa.test(h)||aa.test(g))&&(a[f]+="%")):a[f]=h)}(b.rotate||c.rotate)&&(a.rotate=cc(b.rotate||0,c.rotate||0,d))}(f,e,this.latestValues,d,l,k)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=d},this.mixTargetDelta(1e3*!!this.options.layoutRoot)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(a8(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=a7.update(()=>{var b,c,d;let e;eO.hasAnimatedSinceResize=!0,bx.layout++,this.motionValue||(this.motionValue=bK(0)),this.currentAnimation=(b=this.motionValue,c=[0,1e3],d={...a,velocity:0,isSync:!0,onUpdate:b=>{this.mixTargetDelta(b),a.onUpdate&&a.onUpdate(b)},onStop:()=>{bx.layout--},onComplete:()=>{bx.layout--,a.onComplete&&a.onComplete(),this.completeAnimation()}},(e=aD(b)?b:bK(b)).start(dZ("",e,c,d)),e.animation),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);let a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){let a=this.getLead(),{targetWithTransforms:b,target:c,layout:d,latestValues:e}=a;if(b&&c&&d){if(this!==a&&this.layout&&d&&fG(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||aC();let b=ed(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+b;let d=ed(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+d}e1(b,c),cs(b,e),ef(this.projectionDeltaWithTransform,this.layoutCorrected,b,e)}}registerSharedNode(a,b){this.sharedNodes.has(a)||this.sharedNodes.set(a,new ff),this.sharedNodes.get(a).add(b);let c=b.options.initialPromotionConfig;b.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(b):void 0})}isLead(){let a=this.getStack();return!a||a.lead===this}getLead(){let{layoutId:a}=this.options;return a&&this.getStack()?.lead||this}getPrevLead(){let{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){let{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:b,preserveFollowOpacity:c}={}){let d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),b&&this.setOptions({transition:b})}relegate(){let a=this.getStack();return!!a&&a.relegate(this)}resetSkewAndRotation(){let{visualElement:a}=this.options;if(!a)return;let b=!1,{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(b=!0),!b)return;let d={};c.z&&fk("z",a,d,this.animationValues);for(let b=0;b<fi.length;b++)fk(`rotate${fi[b]}`,a,d,this.animationValues),fk(`skew${fi[b]}`,a,d,this.animationValues);for(let b in a.render(),d)a.setStaticValue(b,d[b]),this.animationValues&&(this.animationValues[b]=d[b]);a.scheduleRender()}applyProjectionStyles(a,b){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}let c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=cH(b?.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}let d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,a.pointerEvents=cH(b?.pointerEvents)||""),this.hasProjected&&!cl(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";let e=d.animationValues||d.latestValues;this.applyTransformsToTarget();let f=function(a,b,c){let d="",e=a.x.translate/b.x,f=a.y.translate/b.y,g=c?.z||0;if((e||f||g)&&(d=`translate3d(${e}px, ${f}px, ${g}px) `),(1!==b.x||1!==b.y)&&(d+=`scale(${1/b.x}, ${1/b.y}) `),c){let{transformPerspective:a,rotate:b,rotateX:e,rotateY:f,skewX:g,skewY:h}=c;a&&(d=`perspective(${a}px) ${d}`),b&&(d+=`rotate(${b}deg) `),e&&(d+=`rotateX(${e}deg) `),f&&(d+=`rotateY(${f}deg) `),g&&(d+=`skewX(${g}deg) `),h&&(d+=`skewY(${h}deg) `)}let h=a.x.scale*b.x,i=a.y.scale*b.y;return(1!==h||1!==i)&&(d+=`scale(${h}, ${i})`),d||"none"}(this.projectionDeltaWithTransform,this.treeScale,e);c&&(f=c(e,f)),a.transform=f;let{x:g,y:h}=this.projectionDelta;for(let b in a.transformOrigin=`${100*g.origin}% ${100*h.origin}% 0`,d.animationValues?a.opacity=d===this?e.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:e.opacityExit:a.opacity=d===this?void 0!==e.opacity?e.opacity:"":void 0!==e.opacityExit?e.opacityExit:0,cd){if(void 0===e[b])continue;let{correct:c,applyTo:g,isCSSVariable:h}=cd[b],i="none"===f?e[b]:c(e[b],d);if(g){let b=g.length;for(let c=0;c<b;c++)a[g[c]]=i}else h?this.options.visualElement.renderState.vars[b]=i:a[b]=i}this.options.layoutId&&(a.pointerEvents=d===this?cH(b?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(fr),this.root.sharedNodes.clear()}}}function fm(a){a.updateLayout()}function fn(a){let b=a.resumeFrom?.snapshot||a.snapshot;if(a.isLead()&&a.layout&&b&&a.hasListeners("didUpdate")){let{layoutBox:c,measuredBox:d}=a.layout,{animationType:e}=a.options,f=b.source!==a.layout.source;"size"===e?d8(a=>{let d=f?b.measuredBox[a]:b.layoutBox[a],e=ed(d);d.min=c[a].min,d.max=d.min+e}):fG(e,b.layoutBox,c)&&d8(d=>{let e=f?b.measuredBox[d]:b.layoutBox[d],g=ed(c[d]);e.max=e.min+g,a.relativeTarget&&!a.currentAnimation&&(a.isProjectionDirty=!0,a.relativeTarget[d].max=a.relativeTarget[d].min+g)});let g=aA();ef(g,c,b.layoutBox);let h=aA();f?ef(h,a.applyTransform(d,!0),b.measuredBox):ef(h,c,b.layoutBox);let i=!e9(g),j=!1;if(!a.resumeFrom){let d=a.getClosestProjectingParent();if(d&&!d.resumeFrom){let{snapshot:e,layout:f}=d;if(e&&f){let g=aC();ei(g,b.layoutBox,e.layoutBox);let h=aC();ei(h,c,f.layoutBox),fc(g,h)||(j=!0),d.options.layoutRoot&&(a.relativeTarget=h,a.relativeTargetOrigin=g,a.relativeParent=d)}}}a.notifyListeners("didUpdate",{layout:c,snapshot:b,delta:h,layoutDelta:g,hasLayoutChanged:i,hasRelativeLayoutChanged:j})}else if(a.isLead()){let{onExitComplete:b}=a.options;b&&b()}a.options.transition=void 0}function fo(a){a.parent&&(a.isProjecting()||(a.isProjectionDirty=a.parent.isProjectionDirty),a.isSharedProjectionDirty||(a.isSharedProjectionDirty=!!(a.isProjectionDirty||a.parent.isProjectionDirty||a.parent.isSharedProjectionDirty)),a.isTransformDirty||(a.isTransformDirty=a.parent.isTransformDirty))}function fp(a){a.isProjectionDirty=a.isSharedProjectionDirty=a.isTransformDirty=!1}function fq(a){a.clearSnapshot()}function fr(a){a.clearMeasurements()}function fs(a){a.isLayoutDirty=!1}function ft(a){let{visualElement:b}=a.options;b&&b.getProps().onBeforeLayoutMeasure&&b.notify("BeforeLayoutMeasure"),a.resetTransform()}function fu(a){a.finishAnimation(),a.targetDelta=a.relativeTarget=a.target=void 0,a.isProjectionDirty=!0}function fv(a){a.resolveTargetDelta()}function fw(a){a.calcProjection()}function fx(a){a.resetSkewAndRotation()}function fy(a){a.removeLeadSnapshot()}function fz(a,b,c){a.translate=cc(b.translate,0,c),a.scale=cc(b.scale,1,c),a.origin=b.origin,a.originPoint=b.originPoint}function fA(a,b,c,d){a.min=cc(b.min,c.min,d),a.max=cc(b.max,c.max,d)}function fB(a){return a.animationValues&&void 0!==a.animationValues.opacityExit}let fC={duration:.45,ease:[.4,0,.1,1]},fD=a=>"u">typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(a),fE=fD("applewebkit/")&&!fD("chrome/")?Math.round:a3;function fF(a){a.min=fE(a.min),a.max=fE(a.max)}function fG(a,b,c){return"position"===a||"preserve-aspect"===a&&!(.2>=Math.abs(fd(b)-fd(c)))}function fH(a){return a!==a.root&&a.scroll?.wasRoot}let fI=fl({attachResizeListener:(a,b)=>eb(a,"resize",b),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body?.scrollLeft||0,y:document.documentElement.scrollTop||document.body?.scrollTop||0}),checkIsScrollRoot:()=>!0}),fJ={current:void 0},fK=fl({measureScroll:a=>({x:a.scrollLeft,y:a.scrollTop}),defaultParent:()=>{if(!fJ.current){let a=new fI({});a.mount(window),a.setOptions({layoutScroll:!0}),fJ.current=a}return fJ.current},resetTransform:(a,b)=>{a.style.transform=void 0!==b?b:"none"},checkIsScrollRoot:a=>"fixed"===window.getComputedStyle(a).position});function fL(a,b){let c=el(a),d=new AbortController;return[c,{passive:!0,...b,signal:d.signal},()=>d.abort()]}function fM(a,b,c){let{props:d}=a;a.animationState&&d.whileHover&&a.animationState.setActive("whileHover","Start"===c);let e=d["onHover"+c];e&&a7.postRender(()=>e(b,ev(b)))}function fN(a){return ej(a)&&"offsetHeight"in a}let fO=(a,b)=>!!b&&(a===b||fO(a,b.parentElement)),fP=new WeakSet;function fQ(a){return b=>{"Enter"===b.key&&a(b)}}function fR(a,b){a.dispatchEvent(new PointerEvent("pointer"+b,{isPrimary:!0,bubbles:!0}))}function fS(a){return eu(a)&&!(ec.x||ec.y)}let fT=new WeakSet;function fU(a,b,c){let{props:d}=a;if(a.current instanceof HTMLButtonElement&&a.current.disabled)return;a.animationState&&d.whileTap&&a.animationState.setActive("whileTap","Start"===c);let e=d["onTap"+("End"===c?"":c)];e&&a7.postRender(()=>e(b,ev(b)))}let fV=new WeakMap,fW=new WeakMap,fX=a=>{let b=fV.get(a.target);b&&b(a)},fY=a=>{a.forEach(fX)},fZ={some:0,all:1},f$=function(a,b){if("u"<typeof Proxy)return cU;let c=new Map,d=(c,d)=>cU(c,d,a,b);return new Proxy((a,b)=>d(a,b),{get:(e,f)=>"create"===f?d:(c.has(f)||c.set(f,cU(f,void 0,a,b)),c.get(f))})}({animation:{Feature:class extends cV{constructor(a){super(a),a.animationState||(a.animationState=function(a){let b=b=>Promise.all(b.map(({animation:b,options:c})=>(function(a,b,c={}){let d;if(a.notify("AnimationStart",b),Array.isArray(b))d=Promise.all(b.map(b=>d0(a,b,c)));else if("string"==typeof b)d=d0(a,b,c);else{let e="function"==typeof b?cW(a,b,c.custom):b;d=Promise.all(d$(a,e,c))}return d.then(()=>{a.notify("AnimationComplete",b)})})(a,b,c))),c=d6(),d=!0,e=b=>(c,d)=>{let e=cW(a,d,"exit"===b?a.presenceContext?.custom:void 0);if(e){let{transition:a,transitionEnd:b,...d}=e;c={...c,...d,...b}}return c};function f(f){let{props:g}=a,h=function a(b){if(!b)return;if(!b.isControllingVariants){let c=b.parent&&a(b.parent)||{};return void 0!==b.props.initial&&(c.initial=b.props.initial),c}let c={};for(let a=0;a<d1;a++){let d=bQ[a],e=b.props[d];(bO(e)||!1===e)&&(c[d]=e)}return c}(a.parent)||{},i=[],j=new Set,k={},l=1/0;for(let b=0;b<d4;b++){var m,n;let o=d3[b],p=c[o],q=void 0!==g[o]?g[o]:h[o],r=bO(q),s=o===f?p.isActive:null;!1===s&&(l=b);let t=q===h[o]&&q!==g[o]&&r;if(t&&d&&a.manuallyAnimateOnMount&&(t=!1),p.protectedKeys={...k},!p.isActive&&null===s||!q&&!p.prevProp||bN(q)||"boolean"==typeof q)continue;if("exit"===o&&p.isActive&&!0!==s){p.prevResolvedValues&&(k={...k,...p.prevResolvedValues});continue}let u=(m=p.prevProp,"string"==typeof(n=q)?n!==m:!!Array.isArray(n)&&!d2(n,m)),v=u||o===f&&p.isActive&&!t&&r||b>l&&r,w=!1,x=Array.isArray(q)?q:[q],y=x.reduce(e(o),{});!1===s&&(y={});let{prevResolvedValues:z={}}=p,A={...z,...y},B=b=>{v=!0,j.has(b)&&(w=!0,j.delete(b)),p.needsAnimating[b]=!0;let c=a.getValue(b);c&&(c.liveStyle=!1)};for(let a in A){let b=y[a],c=z[a];if(!k.hasOwnProperty(a))(cZ(b)&&cZ(c)?d2(b,c):b===c)?void 0!==b&&j.has(a)?B(a):p.protectedKeys[a]=!0:null!=b?B(a):j.add(a)}p.prevProp=q,p.prevResolvedValues=y,p.isActive&&(k={...k,...y}),d&&a.blockInitialAnimation&&(v=!1);let C=t&&u,D=!C||w;v&&D&&i.push(...x.map(b=>{let c={type:o};if("string"==typeof b&&d&&!C&&a.manuallyAnimateOnMount&&a.parent){let{parent:d}=a,e=cW(d,b);if(d.enteringChildren&&e){let{delayChildren:b}=e.transition||{};c.delay=d_(d.enteringChildren,a,b)}}return{animation:b,options:c}}))}if(j.size){let b={};if("boolean"!=typeof g.initial){let c=cW(a,Array.isArray(g.initial)?g.initial[0]:g.initial);c&&c.transition&&(b.transition=c.transition)}j.forEach(c=>{let d=a.getBaseTarget(c),e=a.getValue(c);e&&(e.liveStyle=!0),b[c]=d??null}),i.push({animation:b})}let o=!!i.length;return d&&(!1===g.initial||g.initial===g.animate)&&!a.manuallyAnimateOnMount&&(o=!1),d=!1,o?b(i):Promise.resolve()}return{animateChanges:f,setActive:function(b,d){if(c[b].isActive===d)return Promise.resolve();a.variantChildren?.forEach(a=>a.animationState?.setActive(b,d)),c[b].isActive=d;let e=f(b);for(let a in c)c[a].protectedKeys={};return e},setAnimateFunction:function(c){b=c(a)},getState:()=>c,reset:()=>{c=d6()}}}(a))}updateAnimationControlsSubscription(){let{animate:a}=this.node.getProps();bN(a)&&(this.unmountControls=a.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){let{animate:a}=this.node.getProps(),{animate:b}=this.node.prevProps||{};a!==b&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends cV{constructor(){super(...arguments),this.id=d7++}update(){if(!this.node.presenceContext)return;let{isPresent:a,onExitComplete:b}=this.node.presenceContext,{isPresent:c}=this.node.prevPresenceContext||{};if(!this.node.animationState||a===c)return;let d=this.node.animationState.setActive("exit",!a);b&&!a&&d.then(()=>{b(this.id)})}mount(){let{register:a,onExitComplete:b}=this.node.presenceContext||{};b&&b(this.id),a&&(this.unmount=a(this.id))}unmount(){}}},inView:{Feature:class extends cV{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){var a;let b;this.unmount();let{viewport:c={}}=this.node.getProps(),{root:d,margin:e,amount:f="some",once:g}=c,h={root:d?d.current:void 0,rootMargin:e,threshold:"number"==typeof f?f:fZ[f]},i=a=>{let{isIntersecting:b}=a;if(this.isInView===b||(this.isInView=b,g&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);let{onViewportEnter:c,onViewportLeave:d}=this.node.getProps(),e=b?c:d;e&&e(a)};return a=this.node.current,b=function({root:a,...b}){let c=a||document;fW.has(c)||fW.set(c,{});let d=fW.get(c),e=JSON.stringify(b);return d[e]||(d[e]=new IntersectionObserver(fY,{root:a,...b})),d[e]}(h),fV.set(a,i),b.observe(a),()=>{fV.delete(a),b.unobserve(a)}}mount(){this.startObserver()}update(){if("u"<typeof IntersectionObserver)return;let{props:a,prevProps:b}=this.node;["amount","margin","root"].some(function({viewport:a={}},{viewport:b={}}={}){return c=>a[c]!==b[c]}(a,b))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends cV{mount(){let{current:a}=this.node;if(!a)return;let{globalTapTarget:b,propagate:c}=this.node.props;this.unmount=function(a,b,c={}){let[d,e,f]=fL(a,c),g=a=>{let d=a.currentTarget;if(!fS(a)||fT.has(a))return;fP.add(d),c.stopPropagation&&fT.add(a);let f=b(d,a),g=(a,b)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",i),fP.has(d)&&fP.delete(d),fS(a)&&"function"==typeof f&&f(a,{success:b})},h=a=>{g(a,d===window||d===document||c.useGlobalTarget||fO(d,a.target))},i=a=>{g(a,!1)};window.addEventListener("pointerup",h,e),window.addEventListener("pointercancel",i,e)};return d.forEach(a=>{((c.useGlobalTarget?window:a).addEventListener("pointerdown",g,e),fN(a))&&(a.addEventListener("focus",a=>((a,b)=>{let c=a.currentTarget;if(!c)return;let d=fQ(()=>{if(fP.has(c))return;fR(c,"down");let a=fQ(()=>{fR(c,"up")});c.addEventListener("keyup",a,b),c.addEventListener("blur",()=>fR(c,"cancel"),b)});c.addEventListener("keydown",d,b),c.addEventListener("blur",()=>c.removeEventListener("keydown",d),b)})(a,e)),d9.has(a.tagName)||!0===a.isContentEditable||a.hasAttribute("tabindex")||(a.tabIndex=0))}),f}(a,(a,b)=>(fU(this.node,b,"Start"),(a,{success:b})=>fU(this.node,a,b?"End":"Cancel")),{useGlobalTarget:b,stopPropagation:c?.tap===!1})}unmount(){}}},focus:{Feature:class extends cV{constructor(){super(...arguments),this.isActive=!1}onFocus(){let a=!1;try{a=this.node.current.matches(":focus-visible")}catch(b){a=!0}a&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=c0(eb(this.node.current,"focus",()=>this.onFocus()),eb(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends cV{mount(){let{current:a}=this.node;a&&(this.unmount=function(a,b,c={}){let[d,e,f]=fL(a,c);return d.forEach(a=>{let c,d=!1,f=!1,g=b=>{c&&(c(b),c=void 0),a.removeEventListener("pointerleave",i)},h=a=>{d=!1,window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",h),f&&(f=!1,g(a))},i=a=>{if("touch"!==a.pointerType){if(d){f=!0;return}g(a)}};a.addEventListener("pointerenter",d=>{if("touch"===d.pointerType||ec.x||ec.y)return;f=!1;let g=b(a,d);"function"==typeof g&&(c=g,a.addEventListener("pointerleave",i,e))},e),a.addEventListener("pointerdown",()=>{d=!0,window.addEventListener("pointerup",h,e),window.addEventListener("pointercancel",h,e)},e)}),f}(a,(a,b)=>(fM(this.node,b,"Start"),a=>fM(this.node,a,"End"))))}unmount(){}}},pan:{Feature:class extends cV{constructor(){super(...arguments),this.removePointerDownListener=a3}onPointerDown(a){this.session=new eA(a,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ex(this.node)})}createPanHandlers(){let{onPanSessionStart:a,onPanStart:b,onPan:c,onPanEnd:d}=this.node.getProps();return{onSessionStart:eN(a),onStart:eN(b),onMove:eN(c),onEnd:(a,b)=>{delete this.session,d&&a7.postRender(()=>d(a,b))}}}mount(){this.removePointerDownListener=ew(this.node.current,"pointerdown",a=>this.onPointerDown(a))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends cV{constructor(a){super(a),this.removeGroupControls=a3,this.removeListeners=a3,this.controls=new eK(a)}mount(){let{dragControls:a}=this.node.getProps();a&&(this.removeGroupControls=a.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||a3}update(){let{dragControls:a}=this.node.getProps(),{dragControls:b}=this.node.prevProps||{};a!==b&&(this.removeGroupControls(),a&&(this.removeGroupControls=a.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}},ProjectionNode:fK,MeasureLayout:eT},layout:{ProjectionNode:fK,MeasureLayout:eT}},(a,b)=>b.isSVG??cw(a)?new ch(b):new cu(b,{allowProjection:a!==L.Fragment})),f_=(a=new Map,b=null,c)=>({nextPart:a,validators:b,classGroupId:c}),f0=[],f1=(a,b,c)=>{if(0==a.length-b)return c.classGroupId;let d=a[b],e=c.nextPart.get(d);if(e){let c=f1(a,b+1,e);if(c)return c}let f=c.validators;if(null===f)return;let g=0===b?a.join("-"):a.slice(b).join("-"),h=f.length;for(let a=0;a<h;a++){let b=f[a];if(b.validator(g))return b.classGroupId}},f2=(a,b)=>{let c=f_();for(let d in a)f3(a[d],c,d,b);return c},f3=(a,b,c,d)=>{let e=a.length;for(let f=0;f<e;f++)f4(a[f],b,c,d)},f4=(a,b,c,d)=>{"string"==typeof a?f5(a,b,c):"function"==typeof a?f6(a,b,c,d):f7(a,b,c,d)},f5=(a,b,c)=>{(""===a?b:f8(b,a)).classGroupId=c},f6=(a,b,c,d)=>{f9(a)?f3(a(d),b,c,d):(null===b.validators&&(b.validators=[]),b.validators.push({classGroupId:c,validator:a}))},f7=(a,b,c,d)=>{let e=Object.entries(a),f=e.length;for(let a=0;a<f;a++){let[f,g]=e[a];f3(g,f8(b,f),c,d)}},f8=(a,b)=>{let c=a,d=b.split("-"),e=d.length;for(let a=0;a<e;a++){let b=d[a],e=c.nextPart.get(b);e||(e=f_(),c.nextPart.set(b,e)),c=e}return c},f9=a=>"isThemeGetter"in a&&!0===a.isThemeGetter,ga=[],gb=(a,b,c,d,e)=>({modifiers:a,hasImportantModifier:b,baseClassName:c,maybePostfixModifierPosition:d,isExternal:e}),gc=/\s+/,gd=a=>{let b;if("string"==typeof a)return a;let c="";for(let d=0;d<a.length;d++)a[d]&&(b=gd(a[d]))&&(c&&(c+=" "),c+=b);return c},ge=[],gf=a=>{let b=b=>b[a]||ge;return b.isThemeGetter=!0,b},gg=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,gh=/^\((?:(\w[\w-]*):)?(.+)\)$/i,gi=/^\d+\/\d+$/,gj=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,gk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,gl=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,gm=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,gn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,go=a=>gi.test(a),gp=a=>!!a&&!Number.isNaN(Number(a)),gq=a=>!!a&&Number.isInteger(Number(a)),gr=a=>a.endsWith("%")&&gp(a.slice(0,-1)),gs=a=>gj.test(a),gt=()=>!0,gu=a=>gk.test(a)&&!gl.test(a),gv=()=>!1,gw=a=>gm.test(a),gx=a=>gn.test(a),gy=a=>!gA(a)&&!gI(a),gz=a=>gQ(a,gU,gv),gA=a=>gg.test(a),gB=a=>gQ(a,gV,gu),gC=a=>gQ(a,gW,gp),gD=a=>gQ(a,gY,gt),gE=a=>gQ(a,gX,gv),gF=a=>gQ(a,gS,gv),gG=a=>gQ(a,gT,gx),gH=a=>gQ(a,gZ,gw),gI=a=>gh.test(a),gJ=a=>gR(a,gV),gK=a=>gR(a,gX),gL=a=>gR(a,gS),gM=a=>gR(a,gU),gN=a=>gR(a,gT),gO=a=>gR(a,gZ,!0),gP=a=>gR(a,gY,!0),gQ=(a,b,c)=>{let d=gg.exec(a);return!!d&&(d[1]?b(d[1]):c(d[2]))},gR=(a,b,c=!1)=>{let d=gh.exec(a);return!!d&&(d[1]?b(d[1]):c)},gS=a=>"position"===a||"percentage"===a,gT=a=>"image"===a||"url"===a,gU=a=>"length"===a||"size"===a||"bg-size"===a,gV=a=>"length"===a,gW=a=>"number"===a,gX=a=>"family-name"===a,gY=a=>"number"===a||"weight"===a,gZ=a=>"shadow"===a,g$=((a,...b)=>{let c,d,e,f,g=a=>{let b=d(a);if(b)return b;let f=((a,b)=>{let{parseClassName:c,getClassGroupId:d,getConflictingClassGroupIds:e,sortModifiers:f}=b,g=[],h=a.trim().split(gc),i="";for(let a=h.length-1;a>=0;a-=1){let b=h[a],{isExternal:j,modifiers:k,hasImportantModifier:l,baseClassName:m,maybePostfixModifierPosition:n}=c(b);if(j){i=b+(i.length>0?" "+i:i);continue}let o=!!n,p=d(o?m.substring(0,n):m);if(!p){if(!o||!(p=d(m))){i=b+(i.length>0?" "+i:i);continue}o=!1}let q=0===k.length?"":1===k.length?k[0]:f(k).join(":"),r=l?q+"!":q,s=r+p;if(g.indexOf(s)>-1)continue;g.push(s);let t=e(p,o);for(let a=0;a<t.length;++a){let b=t[a];g.push(r+b)}i=b+(i.length>0?" "+i:i)}return i})(a,c);return e(a,f),f};return f=h=>{var i;let j;return d=(c={cache:(a=>{if(a<1)return{get:()=>void 0,set:()=>{}};let b=0,c=Object.create(null),d=Object.create(null),e=(e,f)=>{c[e]=f,++b>a&&(b=0,d=c,c=Object.create(null))};return{get(a){let b=c[a];return void 0!==b?b:void 0!==(b=d[a])?(e(a,b),b):void 0},set(a,b){a in c?c[a]=b:e(a,b)}}})((i=b.reduce((a,b)=>b(a),a())).cacheSize),parseClassName:(a=>{let{prefix:b,experimentalParseClassName:c}=a,d=a=>{let b,c=[],d=0,e=0,f=0,g=a.length;for(let h=0;h<g;h++){let g=a[h];if(0===d&&0===e){if(":"===g){c.push(a.slice(f,h)),f=h+1;continue}if("/"===g){b=h;continue}}"["===g?d++:"]"===g?d--:"("===g?e++:")"===g&&e--}let h=0===c.length?a:a.slice(f),i=h,j=!1;return h.endsWith("!")?(i=h.slice(0,-1),j=!0):h.startsWith("!")&&(i=h.slice(1),j=!0),gb(c,j,i,b&&b>f?b-f:void 0)};if(b){let a=b+":",c=d;d=b=>b.startsWith(a)?c(b.slice(a.length)):gb(ga,!1,b,void 0,!0)}if(c){let a=d;d=b=>c({className:b,parseClassName:a})}return d})(i),sortModifiers:(j=new Map,i.orderSensitiveModifiers.forEach((a,b)=>{j.set(a,1e6+b)}),a=>{let b=[],c=[];for(let d=0;d<a.length;d++){let e=a[d],f="["===e[0],g=j.has(e);f||g?(c.length>0&&(c.sort(),b.push(...c),c=[]),b.push(e)):c.push(e)}return c.length>0&&(c.sort(),b.push(...c)),b}),...(a=>{let b=(a=>{let{theme:b,classGroups:c}=a;return f2(c,b)})(a),{conflictingClassGroups:c,conflictingClassGroupModifiers:d}=a;return{getClassGroupId:a=>{if(a.startsWith("[")&&a.endsWith("]")){var c;let b,d,e;return -1===(c=a).slice(1,-1).indexOf(":")?void 0:(d=(b=c.slice(1,-1)).indexOf(":"),(e=b.slice(0,d))?"arbitrary.."+e:void 0)}let d=a.split("-"),e=+(""===d[0]&&d.length>1);return f1(d,e,b)},getConflictingClassGroupIds:(a,b)=>{if(b){let b=d[a],e=c[a];if(b){if(e){let a=Array(e.length+b.length);for(let b=0;b<e.length;b++)a[b]=e[b];for(let c=0;c<b.length;c++)a[e.length+c]=b[c];return a}return b}return e||f0}return c[a]||f0}}})(i)}).cache.get,e=c.cache.set,f=g,g(h)},(...a)=>f(((...a)=>{let b,c,d=0,e="";for(;d<a.length;)(b=a[d++])&&(c=gd(b))&&(e&&(e+=" "),e+=c);return e})(...a))})(()=>{let a=gf("color"),b=gf("font"),c=gf("text"),d=gf("font-weight"),e=gf("tracking"),f=gf("leading"),g=gf("breakpoint"),h=gf("container"),i=gf("spacing"),j=gf("radius"),k=gf("shadow"),l=gf("inset-shadow"),m=gf("text-shadow"),n=gf("drop-shadow"),o=gf("blur"),p=gf("perspective"),q=gf("aspect"),r=gf("ease"),s=gf("animate"),t=()=>["auto","avoid","all","avoid-page","page","left","right","column"],u=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],v=()=>[...u(),gI,gA],w=()=>["auto","hidden","clip","visible","scroll"],x=()=>["auto","contain","none"],y=()=>[gI,gA,i],z=()=>[go,"full","auto",...y()],A=()=>[gq,"none","subgrid",gI,gA],B=()=>["auto",{span:["full",gq,gI,gA]},gq,gI,gA],C=()=>[gq,"auto",gI,gA],D=()=>["auto","min","max","fr",gI,gA],E=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],F=()=>["start","end","center","stretch","center-safe","end-safe"],G=()=>["auto",...y()],H=()=>[go,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...y()],I=()=>[a,gI,gA],J=()=>[...u(),gL,gF,{position:[gI,gA]}],K=()=>["no-repeat",{repeat:["","x","y","space","round"]}],L=()=>["auto","cover","contain",gM,gz,{size:[gI,gA]}],M=()=>[gr,gJ,gB],N=()=>["","none","full",j,gI,gA],O=()=>["",gp,gJ,gB],P=()=>["solid","dashed","dotted","double"],Q=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],R=()=>[gp,gr,gL,gF],S=()=>["","none",o,gI,gA],T=()=>["none",gp,gI,gA],U=()=>["none",gp,gI,gA],V=()=>[gp,gI,gA],W=()=>[go,"full",...y()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[gs],breakpoint:[gs],color:[gt],container:[gs],"drop-shadow":[gs],ease:["in","out","in-out"],font:[gy],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[gs],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[gs],shadow:[gs],spacing:["px",gp],text:[gs],"text-shadow":[gs],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",go,gA,gI,q]}],container:["container"],columns:[{columns:[gp,gA,gI,h]}],"break-after":[{"break-after":t()}],"break-before":[{"break-before":t()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:v()}],overflow:[{overflow:w()}],"overflow-x":[{"overflow-x":w()}],"overflow-y":[{"overflow-y":w()}],overscroll:[{overscroll:x()}],"overscroll-x":[{"overscroll-x":x()}],"overscroll-y":[{"overscroll-y":x()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:z()}],"inset-x":[{"inset-x":z()}],"inset-y":[{"inset-y":z()}],start:[{start:z()}],end:[{end:z()}],top:[{top:z()}],right:[{right:z()}],bottom:[{bottom:z()}],left:[{left:z()}],visibility:["visible","invisible","collapse"],z:[{z:[gq,"auto",gI,gA]}],basis:[{basis:[go,"full","auto",h,...y()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[gp,go,"auto","initial","none",gA]}],grow:[{grow:["",gp,gI,gA]}],shrink:[{shrink:["",gp,gI,gA]}],order:[{order:[gq,"first","last","none",gI,gA]}],"grid-cols":[{"grid-cols":A()}],"col-start-end":[{col:B()}],"col-start":[{"col-start":C()}],"col-end":[{"col-end":C()}],"grid-rows":[{"grid-rows":A()}],"row-start-end":[{row:B()}],"row-start":[{"row-start":C()}],"row-end":[{"row-end":C()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":D()}],"auto-rows":[{"auto-rows":D()}],gap:[{gap:y()}],"gap-x":[{"gap-x":y()}],"gap-y":[{"gap-y":y()}],"justify-content":[{justify:[...E(),"normal"]}],"justify-items":[{"justify-items":[...F(),"normal"]}],"justify-self":[{"justify-self":["auto",...F()]}],"align-content":[{content:["normal",...E()]}],"align-items":[{items:[...F(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...F(),{baseline:["","last"]}]}],"place-content":[{"place-content":E()}],"place-items":[{"place-items":[...F(),"baseline"]}],"place-self":[{"place-self":["auto",...F()]}],p:[{p:y()}],px:[{px:y()}],py:[{py:y()}],ps:[{ps:y()}],pe:[{pe:y()}],pt:[{pt:y()}],pr:[{pr:y()}],pb:[{pb:y()}],pl:[{pl:y()}],m:[{m:G()}],mx:[{mx:G()}],my:[{my:G()}],ms:[{ms:G()}],me:[{me:G()}],mt:[{mt:G()}],mr:[{mr:G()}],mb:[{mb:G()}],ml:[{ml:G()}],"space-x":[{"space-x":y()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":y()}],"space-y-reverse":["space-y-reverse"],size:[{size:H()}],w:[{w:[h,"screen",...H()]}],"min-w":[{"min-w":[h,"screen","none",...H()]}],"max-w":[{"max-w":[h,"screen","none","prose",{screen:[g]},...H()]}],h:[{h:["screen","lh",...H()]}],"min-h":[{"min-h":["screen","lh","none",...H()]}],"max-h":[{"max-h":["screen","lh",...H()]}],"font-size":[{text:["base",c,gJ,gB]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[d,gP,gD]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",gr,gA]}],"font-family":[{font:[gK,gE,b]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[e,gI,gA]}],"line-clamp":[{"line-clamp":[gp,"none",gI,gC]}],leading:[{leading:[f,...y()]}],"list-image":[{"list-image":["none",gI,gA]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",gI,gA]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:I()}],"text-color":[{text:I()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...P(),"wavy"]}],"text-decoration-thickness":[{decoration:[gp,"from-font","auto",gI,gB]}],"text-decoration-color":[{decoration:I()}],"underline-offset":[{"underline-offset":[gp,"auto",gI,gA]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:y()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",gI,gA]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",gI,gA]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:J()}],"bg-repeat":[{bg:K()}],"bg-size":[{bg:L()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},gq,gI,gA],radial:["",gI,gA],conic:[gq,gI,gA]},gN,gG]}],"bg-color":[{bg:I()}],"gradient-from-pos":[{from:M()}],"gradient-via-pos":[{via:M()}],"gradient-to-pos":[{to:M()}],"gradient-from":[{from:I()}],"gradient-via":[{via:I()}],"gradient-to":[{to:I()}],rounded:[{rounded:N()}],"rounded-s":[{"rounded-s":N()}],"rounded-e":[{"rounded-e":N()}],"rounded-t":[{"rounded-t":N()}],"rounded-r":[{"rounded-r":N()}],"rounded-b":[{"rounded-b":N()}],"rounded-l":[{"rounded-l":N()}],"rounded-ss":[{"rounded-ss":N()}],"rounded-se":[{"rounded-se":N()}],"rounded-ee":[{"rounded-ee":N()}],"rounded-es":[{"rounded-es":N()}],"rounded-tl":[{"rounded-tl":N()}],"rounded-tr":[{"rounded-tr":N()}],"rounded-br":[{"rounded-br":N()}],"rounded-bl":[{"rounded-bl":N()}],"border-w":[{border:O()}],"border-w-x":[{"border-x":O()}],"border-w-y":[{"border-y":O()}],"border-w-s":[{"border-s":O()}],"border-w-e":[{"border-e":O()}],"border-w-t":[{"border-t":O()}],"border-w-r":[{"border-r":O()}],"border-w-b":[{"border-b":O()}],"border-w-l":[{"border-l":O()}],"divide-x":[{"divide-x":O()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":O()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...P(),"hidden","none"]}],"divide-style":[{divide:[...P(),"hidden","none"]}],"border-color":[{border:I()}],"border-color-x":[{"border-x":I()}],"border-color-y":[{"border-y":I()}],"border-color-s":[{"border-s":I()}],"border-color-e":[{"border-e":I()}],"border-color-t":[{"border-t":I()}],"border-color-r":[{"border-r":I()}],"border-color-b":[{"border-b":I()}],"border-color-l":[{"border-l":I()}],"divide-color":[{divide:I()}],"outline-style":[{outline:[...P(),"none","hidden"]}],"outline-offset":[{"outline-offset":[gp,gI,gA]}],"outline-w":[{outline:["",gp,gJ,gB]}],"outline-color":[{outline:I()}],shadow:[{shadow:["","none",k,gO,gH]}],"shadow-color":[{shadow:I()}],"inset-shadow":[{"inset-shadow":["none",l,gO,gH]}],"inset-shadow-color":[{"inset-shadow":I()}],"ring-w":[{ring:O()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:I()}],"ring-offset-w":[{"ring-offset":[gp,gB]}],"ring-offset-color":[{"ring-offset":I()}],"inset-ring-w":[{"inset-ring":O()}],"inset-ring-color":[{"inset-ring":I()}],"text-shadow":[{"text-shadow":["none",m,gO,gH]}],"text-shadow-color":[{"text-shadow":I()}],opacity:[{opacity:[gp,gI,gA]}],"mix-blend":[{"mix-blend":[...Q(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Q()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[gp]}],"mask-image-linear-from-pos":[{"mask-linear-from":R()}],"mask-image-linear-to-pos":[{"mask-linear-to":R()}],"mask-image-linear-from-color":[{"mask-linear-from":I()}],"mask-image-linear-to-color":[{"mask-linear-to":I()}],"mask-image-t-from-pos":[{"mask-t-from":R()}],"mask-image-t-to-pos":[{"mask-t-to":R()}],"mask-image-t-from-color":[{"mask-t-from":I()}],"mask-image-t-to-color":[{"mask-t-to":I()}],"mask-image-r-from-pos":[{"mask-r-from":R()}],"mask-image-r-to-pos":[{"mask-r-to":R()}],"mask-image-r-from-color":[{"mask-r-from":I()}],"mask-image-r-to-color":[{"mask-r-to":I()}],"mask-image-b-from-pos":[{"mask-b-from":R()}],"mask-image-b-to-pos":[{"mask-b-to":R()}],"mask-image-b-from-color":[{"mask-b-from":I()}],"mask-image-b-to-color":[{"mask-b-to":I()}],"mask-image-l-from-pos":[{"mask-l-from":R()}],"mask-image-l-to-pos":[{"mask-l-to":R()}],"mask-image-l-from-color":[{"mask-l-from":I()}],"mask-image-l-to-color":[{"mask-l-to":I()}],"mask-image-x-from-pos":[{"mask-x-from":R()}],"mask-image-x-to-pos":[{"mask-x-to":R()}],"mask-image-x-from-color":[{"mask-x-from":I()}],"mask-image-x-to-color":[{"mask-x-to":I()}],"mask-image-y-from-pos":[{"mask-y-from":R()}],"mask-image-y-to-pos":[{"mask-y-to":R()}],"mask-image-y-from-color":[{"mask-y-from":I()}],"mask-image-y-to-color":[{"mask-y-to":I()}],"mask-image-radial":[{"mask-radial":[gI,gA]}],"mask-image-radial-from-pos":[{"mask-radial-from":R()}],"mask-image-radial-to-pos":[{"mask-radial-to":R()}],"mask-image-radial-from-color":[{"mask-radial-from":I()}],"mask-image-radial-to-color":[{"mask-radial-to":I()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":u()}],"mask-image-conic-pos":[{"mask-conic":[gp]}],"mask-image-conic-from-pos":[{"mask-conic-from":R()}],"mask-image-conic-to-pos":[{"mask-conic-to":R()}],"mask-image-conic-from-color":[{"mask-conic-from":I()}],"mask-image-conic-to-color":[{"mask-conic-to":I()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:J()}],"mask-repeat":[{mask:K()}],"mask-size":[{mask:L()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",gI,gA]}],filter:[{filter:["","none",gI,gA]}],blur:[{blur:S()}],brightness:[{brightness:[gp,gI,gA]}],contrast:[{contrast:[gp,gI,gA]}],"drop-shadow":[{"drop-shadow":["","none",n,gO,gH]}],"drop-shadow-color":[{"drop-shadow":I()}],grayscale:[{grayscale:["",gp,gI,gA]}],"hue-rotate":[{"hue-rotate":[gp,gI,gA]}],invert:[{invert:["",gp,gI,gA]}],saturate:[{saturate:[gp,gI,gA]}],sepia:[{sepia:["",gp,gI,gA]}],"backdrop-filter":[{"backdrop-filter":["","none",gI,gA]}],"backdrop-blur":[{"backdrop-blur":S()}],"backdrop-brightness":[{"backdrop-brightness":[gp,gI,gA]}],"backdrop-contrast":[{"backdrop-contrast":[gp,gI,gA]}],"backdrop-grayscale":[{"backdrop-grayscale":["",gp,gI,gA]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[gp,gI,gA]}],"backdrop-invert":[{"backdrop-invert":["",gp,gI,gA]}],"backdrop-opacity":[{"backdrop-opacity":[gp,gI,gA]}],"backdrop-saturate":[{"backdrop-saturate":[gp,gI,gA]}],"backdrop-sepia":[{"backdrop-sepia":["",gp,gI,gA]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":y()}],"border-spacing-x":[{"border-spacing-x":y()}],"border-spacing-y":[{"border-spacing-y":y()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",gI,gA]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[gp,"initial",gI,gA]}],ease:[{ease:["linear","initial",r,gI,gA]}],delay:[{delay:[gp,gI,gA]}],animate:[{animate:["none",s,gI,gA]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[p,gI,gA]}],"perspective-origin":[{"perspective-origin":v()}],rotate:[{rotate:T()}],"rotate-x":[{"rotate-x":T()}],"rotate-y":[{"rotate-y":T()}],"rotate-z":[{"rotate-z":T()}],scale:[{scale:U()}],"scale-x":[{"scale-x":U()}],"scale-y":[{"scale-y":U()}],"scale-z":[{"scale-z":U()}],"scale-3d":["scale-3d"],skew:[{skew:V()}],"skew-x":[{"skew-x":V()}],"skew-y":[{"skew-y":V()}],transform:[{transform:[gI,gA,"","none","gpu","cpu"]}],"transform-origin":[{origin:v()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:W()}],"translate-x":[{"translate-x":W()}],"translate-y":[{"translate-y":W()}],"translate-z":[{"translate-z":W()}],"translate-none":["translate-none"],accent:[{accent:I()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:I()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",gI,gA]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":y()}],"scroll-mx":[{"scroll-mx":y()}],"scroll-my":[{"scroll-my":y()}],"scroll-ms":[{"scroll-ms":y()}],"scroll-me":[{"scroll-me":y()}],"scroll-mt":[{"scroll-mt":y()}],"scroll-mr":[{"scroll-mr":y()}],"scroll-mb":[{"scroll-mb":y()}],"scroll-ml":[{"scroll-ml":y()}],"scroll-p":[{"scroll-p":y()}],"scroll-px":[{"scroll-px":y()}],"scroll-py":[{"scroll-py":y()}],"scroll-ps":[{"scroll-ps":y()}],"scroll-pe":[{"scroll-pe":y()}],"scroll-pt":[{"scroll-pt":y()}],"scroll-pr":[{"scroll-pr":y()}],"scroll-pb":[{"scroll-pb":y()}],"scroll-pl":[{"scroll-pl":y()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",gI,gA]}],fill:[{fill:["none",...I()]}],"stroke-w":[{stroke:[gp,gJ,gB,gC]}],stroke:[{stroke:["none",...I()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}});function g_(...a){return g$(function(){for(var a,b,c=0,d="",e=arguments.length;c<e;c++)(a=arguments[c])&&(b=function a(b){var c,d,e="";if("string"==typeof b||"number"==typeof b)e+=b;else if("object"==typeof b)if(Array.isArray(b)){var f=b.length;for(c=0;c<f;c++)b[c]&&(d=a(b[c]))&&(e&&(e+=" "),e+=d)}else for(d in b)b[d]&&(e&&(e+=" "),e+=d);return e}(a))&&(d&&(d+=" "),d+=b);return d}(a))}let g0=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f},g1=a=>{let b=a?g0(a):g0,c=a=>(function(a,b=a=>a){let c=L.default.useSyncExternalStore(a.subscribe,L.default.useCallback(()=>b(a.getState()),[a,b]),L.default.useCallback(()=>b(a.getInitialState()),[a,b]));return L.default.useDebugValue(c),c})(b,a);return Object.assign(c,b),c};function g2(a){let b=Array.from({length:9},()=>Array(9).fill(0));!function a(b,c=!1){for(let d=0;d<9;d++)for(let e=0;e<9;e++)if(0===b[d][e]){let f=[1,2,3,4,5,6,7,8,9];if(c)for(let a=f.length-1;a>0;a--){let b=Math.floor(Math.random()*(a+1));[f[a],f[b]]=[f[b],f[a]]}for(let g of f)if(function(a,b,c,d){for(let e=0;e<9;e++){if(a[b][e]===d&&e!==c||a[e][c]===d&&e!==b)return!1;let f=3*Math.floor(b/3)+Math.floor(e/3),g=3*Math.floor(c/3)+e%3;if(a[f][g]===d&&(f!==b||g!==c))return!1}return!0}(b,d,e,g)){if(b[d][e]=g,a(b,c))return!0;b[d][e]=0}return!1}return!0}(b,!0);let c=b.map(a=>[...a]),d="Easy"===a?30:"Medium"===a?45:"Hard"===a?55:60;for(;d>0;){let a=Math.floor(9*Math.random()),b=Math.floor(9*Math.random());for(;0===c[a][b];)a=Math.floor(9*Math.random()),b=Math.floor(9*Math.random());c[a][b]=0,d--}return{initial:c,solved:b}}function g3(a,b,c){let d=new Set([1,2,3,4,5,6,7,8,9]);for(let e=0;e<9;e++)d.delete(a[b][e]),d.delete(a[e][c]);let e=3*Math.floor(b/3),f=3*Math.floor(c/3);for(let b=0;b<3;b++)for(let c=0;c<3;c++)d.delete(a[e+b][f+c]);return d}function g4(a,b,c){for(let d=1;d<=9;d++){let e=!1;for(let{r:c,c:f}of b)if(a[c][f]===d){e=!0;break}if(e)continue;let f=null,g=0;for(let{r:c,c:e}of b)if(0===a[c][e]&&g3(a,c,e).has(d)&&(f={r:c,c:e},++g>1))break;if(1===g&&f)return{r:f.r,c:f.c,value:d,reason:`${d} can only go here in ${c}  no other empty cell in this ${c.toLowerCase().split(" ")[0]} can hold it.`,strategy:"hidden_single"}}return null}let g5={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},g6=function(a,b){if(!a)throw g7(b)},g7=function(a){return Error("Firebase Database ("+g5.SDK_VERSION+") INTERNAL ASSERT FAILED: "+a)},g8=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},g9=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=((7&e)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(f>>10)),b[d++]=String.fromCharCode(56320+(1023&f))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},ha={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(g8(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):g9(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new hb;let i=e<<2|f>>4;if(d.push(i),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class hb extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let hc=function(a){let b=g8(a);return ha.encodeByteArray(b,!0)},hd=function(a){return hc(a).replace(/\./g,"")},he=function(a){try{return ha.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null},hf=()=>{try{return("u">typeof self?self:a.g).__FIREBASE_DEFAULTS__||(()=>{if("u"<typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)})()||(()=>{let a;if("u"<typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&he(a[1]);return b&&JSON.parse(b)})()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},hg=a=>hf()?.emulatorHosts?.[a],hh=()=>hf()?.config;class hi{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),"function"==typeof a&&(this.promise.catch(()=>{}),1===a.length?a(b):a(b,c))}}}function hj(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function hk(a){return(await fetch(a,{credentials:"include"})).ok}function hl(a,b){}function hm(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function hn(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function ho(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function hp(){return!0===g5.NODE_CLIENT||!0===g5.NODE_ADMIN}class hq extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name="FirebaseError",Object.setPrototypeOf(this,hq.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hr.prototype.create)}}class hr{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){var c,d;let e=b[0]||{},f=`${this.service}/${a}`,g=this.errors[a],h=g?(c=g,d=e,c.replace(hs,(a,b)=>{let c=d[b];return null!=c?String(c):`<${b}?>`})):"Error",i=`${this.serviceName}: ${h} (${f}).`;return new hq(f,i,e)}}let hs=/\{\$([^}]+)}/g;function ht(a){return JSON.parse(a)}function hu(a){return JSON.stringify(a)}let hv=function(a){let b={},c={},d={},e="";try{let f=a.split(".");b=ht(he(f[0])||""),c=ht(he(f[1])||""),e=f[2],d=c.d||{},delete c.d}catch(a){}return{header:b,claims:c,data:d,signature:e}},hw=function(a){let b=hv(a).claims;return!!b&&"object"==typeof b&&b.hasOwnProperty("iat")},hx=function(a){let b=hv(a).claims;return"object"==typeof b&&!0===b.admin};function hy(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function hz(a,b){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:void 0}function hA(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}function hB(a,b,c){let d={};for(let e in a)Object.prototype.hasOwnProperty.call(a,e)&&(d[e]=b.call(c,a[e],e,a));return d}function hC(a,b){if(a===b)return!0;let c=Object.keys(a),d=Object.keys(b);for(let e of c){if(!d.includes(e))return!1;let c=a[e],f=b[e];if(hD(c)&&hD(f)){if(!hC(c,f))return!1}else if(c!==f)return!1}for(let a of d)if(!c.includes(a))return!1;return!0}function hD(a){return null!==a&&"object"==typeof a}function hE(a){let b=[];for(let[c,d]of Object.entries(a))Array.isArray(d)?d.forEach(a=>{b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}):b.push(encodeURIComponent(c)+"="+encodeURIComponent(d));return b.length?"&"+b.join("&"):""}function hF(a){let b={};return a.replace(/^\?/,"").split("&").forEach(a=>{if(a){let[c,d]=a.split("=");b[decodeURIComponent(c)]=decodeURIComponent(d)}}),b}function hG(a){let b=a.indexOf("?");if(!b)return"";let c=a.indexOf("#",b);return a.substring(b,c>0?c:void 0)}class hH{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let a=1;a<this.blockSize;++a)this.pad_[a]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(a,b){let c,d;b||(b=0);let e=this.W_;if("string"==typeof a)for(let c=0;c<16;c++)e[c]=a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3),b+=4;else for(let c=0;c<16;c++)e[c]=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3],b+=4;for(let a=16;a<80;a++){let b=e[a-3]^e[a-8]^e[a-14]^e[a-16];e[a]=(b<<1|b>>>31)&0xffffffff}let f=this.chain_[0],g=this.chain_[1],h=this.chain_[2],i=this.chain_[3],j=this.chain_[4];for(let a=0;a<80;a++){a<40?a<20?(c=i^g&(h^i),d=0x5a827999):(c=g^h^i,d=0x6ed9eba1):a<60?(c=g&h|i&(g|h),d=0x8f1bbcdc):(c=g^h^i,d=0xca62c1d6);let b=(f<<5|f>>>27)+c+j+d+e[a]|0;j=i,i=h,h=(g<<30|g>>>2)&0xffffffff,g=f,f=b}this.chain_[0]=this.chain_[0]+f|0,this.chain_[1]=this.chain_[1]+g|0,this.chain_[2]=this.chain_[2]+h|0,this.chain_[3]=this.chain_[3]+i|0,this.chain_[4]=this.chain_[4]+j|0}update(a,b){if(null==a)return;void 0===b&&(b=a.length);let c=b-this.blockSize,d=0,e=this.buf_,f=this.inbuf_;for(;d<b;){if(0===f)for(;d<=c;)this.compress_(a,d),d+=this.blockSize;if("string"==typeof a){for(;d<b;)if(e[f]=a.charCodeAt(d),++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}this.inbuf_=f,this.total_+=b}digest(){let a=[],b=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=255&b,b/=256;this.compress_(this.buf_);let c=0;for(let b=0;b<5;b++)for(let d=24;d>=0;d-=8)a[c]=this.chain_[b]>>d&255,++c;return a}}class hI{constructor(a,b){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=b,this.task.then(()=>{a(this)}).catch(a=>{this.error(a)})}next(a){this.forEachObserver(b=>{b.next(a)})}error(a){this.forEachObserver(b=>{b.error(a)}),this.close(a)}complete(){this.forEachObserver(a=>{a.complete()}),this.close()}subscribe(a,b,c){let d;if(void 0===a&&void 0===b&&void 0===c)throw Error("Missing Observer.");void 0===(d=!function(a,b){if("object"!=typeof a||null===a)return!1;for(let c of b)if(c in a&&"function"==typeof a[c])return!0;return!1}(a,["next","error","complete"])?{next:a,error:b,complete:c}:a).next&&(d.next=hJ),void 0===d.error&&(d.error=hJ),void 0===d.complete&&(d.complete=hJ);let e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch(a){}}),this.observers.push(d),e}unsubscribeOne(a){void 0!==this.observers&&void 0!==this.observers[a]&&(delete this.observers[a],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(a){if(!this.finalized)for(let b=0;b<this.observers.length;b++)this.sendOne(b,a)}sendOne(a,b){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[a])try{b(this.observers[a])}catch(a){"u">typeof console&&console.error&&console.error(a)}})}close(a){this.finalized||(this.finalized=!0,void 0!==a&&(this.finalError=a),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function hJ(){}function hK(a,b){return`${a} failed: ${b} argument `}let hL=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);if(e>=55296&&e<=56319){let b=e-55296;g6(++d<a.length,"Surrogate pair missing trail surrogate."),e=65536+(b<<10)+(a.charCodeAt(d)-56320)}e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:(e<65536?b[c++]=e>>12|224:(b[c++]=e>>18|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},hM=function(a){let b=0;for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);d<128?b++:d<2048?b+=2:d>=55296&&d<=56319?(b+=4,c++):b+=3}return b};function hN(a){return a&&a._delegate?a._delegate:a}g5.NODE_CLIENT=!0;class hO{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let hP="[DEFAULT]";class hQ{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){let b=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(b)){let a=new hi;if(this.instancesDeferred.set(b,a),this.isInitialized(b)||this.shouldAutoInitialize())try{let c=this.getOrInitializeService({instanceIdentifier:b});c&&a.resolve(c)}catch(a){}}return this.instancesDeferred.get(b).promise}getImmediate(a){let b=this.normalizeInstanceIdentifier(a?.identifier),c=a?.optional??!1;if(this.isInitialized(b)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:b})}catch(a){if(c)return null;throw a}if(c)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,this.shouldAutoInitialize()){if("EAGER"===a.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:hP})}catch(a){}for(let[a,b]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(a);try{let a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}}clearInstance(a=hP){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){let a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return null!=this.component}isInitialized(a=hP){return this.instances.has(a)}getOptions(a=hP){return this.instancesOptions.get(a)||{}}initialize(a={}){let{options:b={}}=a,c=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let d=this.getOrInitializeService({instanceIdentifier:c,options:b});for(let[a,b]of this.instancesDeferred.entries())c===this.normalizeInstanceIdentifier(a)&&b.resolve(d);return d}onInit(a,b){let c=this.normalizeInstanceIdentifier(b),d=this.onInitCallbacks.get(c)??new Set;d.add(a),this.onInitCallbacks.set(c,d);let e=this.instances.get(c);return e&&a(e,c),()=>{d.delete(a)}}invokeOnInitCallbacks(a,b){let c=this.onInitCallbacks.get(b);if(c)for(let d of c)try{d(a,b)}catch{}}getOrInitializeService({instanceIdentifier:a,options:b={}}){var c;let d=this.instances.get(a);if(!d&&this.component&&(d=this.component.instanceFactory(this.container,{instanceIdentifier:(c=a)===hP?void 0:c,options:b}),this.instances.set(a,d),this.instancesOptions.set(a,b),this.invokeOnInitCallbacks(d,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,d)}catch{}return d||null}normalizeInstanceIdentifier(a=hP){return this.component?this.component.multipleInstances?a:hP:a}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class hR{constructor(a){this.name=a,this.providers=new Map}addComponent(a){let b=this.getProvider(a.name);if(b.isComponentSet())throw Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);let b=new hQ(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}}let hS=[];(B=I||(I={}))[B.DEBUG=0]="DEBUG",B[B.VERBOSE=1]="VERBOSE",B[B.INFO=2]="INFO",B[B.WARN=3]="WARN",B[B.ERROR=4]="ERROR",B[B.SILENT=5]="SILENT";let hT={debug:I.DEBUG,verbose:I.VERBOSE,info:I.INFO,warn:I.WARN,error:I.ERROR,silent:I.SILENT},hU=I.INFO,hV={[I.DEBUG]:"log",[I.VERBOSE]:"log",[I.INFO]:"info",[I.WARN]:"warn",[I.ERROR]:"error"},hW=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=hV[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class hX{constructor(a){this.name=a,this._logLevel=hU,this._logHandler=hW,this._userLogHandler=null,hS.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in I))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?hT[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,I.DEBUG,...a),this._logHandler(this,I.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,I.VERBOSE,...a),this._logHandler(this,I.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,I.INFO,...a),this._logHandler(this,I.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,I.WARN,...a),this._logHandler(this,I.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,I.ERROR,...a),this._logHandler(this,I.ERROR,...a)}}let hY=new WeakMap,hZ=new WeakMap,h$=new WeakMap,h_=new WeakMap,h0=new WeakMap,h1={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return hZ.get(a);if("objectStoreNames"===b)return a.objectStoreNames||h$.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return h2(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function h2(a){if(a instanceof IDBRequest){let b;return(b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(h2(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)})).then(b=>{b instanceof IDBCursor&&hY.set(b,a)}).catch(()=>{}),h0.set(b,a),b}if(h_.has(a))return h_.get(a);let b=function(a){if("function"==typeof a)return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(h3(this),b),h2(hY.get(this))}:function(...b){return h2(a.apply(h3(this),b))}:function(b,...c){let d=a.call(h3(this),b,...c);return h$.set(d,b.sort?b.sort():[b]),h2(d)};return a instanceof IDBTransaction&&function(a){if(hZ.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});hZ.set(a,b)}(a),(e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(b=>a instanceof b)?new Proxy(a,h1):a}(a);return b!==a&&(h_.set(a,b),h0.set(b,a)),b}let h3=a=>h0.get(a),h4=["get","getKey","getAll","getAllKeys","count"],h5=["put","add","delete","clear"],h6=new Map;function h7(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(h6.get(b))return h6.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=h5.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||h4.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return h6.set(b,f),f}h1={...z=h1,get:(a,b,c)=>h7(a,b)||z.get(a,b,c),has:(a,b)=>!!h7(a,b)||z.has(a,b)};class h8{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{let b;if(b=a.getComponent(),b?.type!=="VERSION")return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}let h9="@firebase/app",ia="0.14.8",ib=new hX("@firebase/app"),ic="[DEFAULT]",id={[h9]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ie=new Map,ig=new Map,ih=new Map;function ii(a,b){try{a.container.addComponent(b)}catch(c){ib.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function ij(a,b){a.container.addOrOverwriteComponent(b)}function ik(a){let b=a.name;if(ih.has(b))return ib.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(ih.set(b,a),ie.values()))ii(c,a);for(let b of ig.values())ii(b,a);return!0}function il(a,b){let c=a.container.getProvider("heartbeat").getImmediate({optional:!0});return c&&c.triggerHeartbeat(),a.container.getProvider(b)}function im(a,b,c=ic){il(a,b).clearInstance(c)}function io(a){return void 0!==a.options}function ip(a){return!io(a)&&("authIdToken"in a||"appCheckToken"in a||"releaseOnDeref"in a||"automaticDataCollectionEnabled"in a)}function iq(a){return null!=a&&void 0!==a.settings}function ir(){ih.clear()}let is=new hr("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class it{constructor(a,b,c){this._isDeleted=!1,this._options={...a},this._config={...b},this._name=b.name,this._automaticDataCollectionEnabled=b.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new hO("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw is.create("app-deleted",{appName:this._name})}}function iu(a,b){let c=he(a.split(".")[1]);null===c?console.error(`FirebaseServerApp ${b} is invalid: second part could not be parsed.`):void 0===JSON.parse(c).exp?console.error(`FirebaseServerApp ${b} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(c).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${b} is invalid: the token has expired.`)}class iv extends it{constructor(a,b,c,d){const e=void 0===b.automaticDataCollectionEnabled||b.automaticDataCollectionEnabled,f={name:c,automaticDataCollectionEnabled:e};void 0!==a.apiKey?super(a,f,d):super(a.options,f,d),this._serverConfig={automaticDataCollectionEnabled:e,...b},this._serverConfig.authIdToken&&iu(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&iu(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,b.releaseOnDeref=void 0,iC(h9,ia,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(a){this.isDeleted||(this._refCount++,void 0!==a&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(a,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){iB(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw is.create("server-app-deleted")}}let iw="12.9.0";function ix(a,b={}){let c=a;"object"!=typeof b&&(b={name:b});let d={name:ic,automaticDataCollectionEnabled:!0,...b},e=d.name;if("string"!=typeof e||!e)throw is.create("bad-app-name",{appName:String(e)});if(c||(c=hh()),!c)throw is.create("no-options");let f=ie.get(e);if(f)if(hC(c,f.options)&&hC(d,f.config))return f;else throw is.create("duplicate-app",{appName:e});let g=new hR(e);for(let a of ih.values())g.addComponent(a);let h=new it(c,d,g);return ie.set(e,h),h}function iy(a,b={}){let c;if(hn()&&!hn())throw is.create("invalid-server-app-environment");let d=b||{};if(a&&(io(a)?c=a.options:ip(a)?d=a:c=a),void 0===d.automaticDataCollectionEnabled&&(d.automaticDataCollectionEnabled=!0),c||(c=hh()),!c)throw is.create("no-options");let e={...d,...c};if(void 0!==e.releaseOnDeref&&delete e.releaseOnDeref,void 0!==d.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw is.create("finalization-registry-not-supported",{});let f=""+[...JSON.stringify(e)].reduce((a,b)=>Math.imul(31,a)+b.charCodeAt(0)|0,0),g=ig.get(f);if(g)return g.incRefCount(d.releaseOnDeref),g;let h=new hR(f);for(let a of ih.values())h.addComponent(a);let i=new iv(c,d,f,h);return ig.set(f,i),i}function iz(a=ic){let b=ie.get(a);if(!b&&a===ic&&hh())return ix();if(!b)throw is.create("no-app",{appName:a});return b}function iA(){return Array.from(ie.values())}async function iB(a){let b=!1,c=a.name;ie.has(c)?(b=!0,ie.delete(c)):ig.has(c)&&0>=a.decRefCount()&&(ig.delete(c),b=!0),b&&(await Promise.all(a.container.getProviders().map(a=>a.delete())),a.isDeleted=!0)}function iC(a,b,c){let d=id[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),ib.warn(a.join(" "));return}ik(new hO(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}function iD(a,b){if(null!==a&&"function"!=typeof a)throw is.create("invalid-log-argument");for(let c of hS){let d=null;b&&b.level&&(d=hT[b.level]),null===a?c.userLogHandler=null:c.userLogHandler=(b,c,...e)=>{let f=e.map(a=>{if(null==a)return null;if("string"==typeof a)return a;if("number"==typeof a||"boolean"==typeof a)return a.toString();if(a instanceof Error)return a.message;try{return JSON.stringify(a)}catch(a){return null}}).filter(a=>a).join(" ");c>=(d??b.logLevel)&&a({level:I[c].toLowerCase(),message:f,args:e,type:b.name})}}}function iE(a){hS.forEach(b=>{b.setLogLevel(a)})}let iF="firebase-heartbeat-store",iG=null;function iH(){return iG||(iG=(function(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,1),h=h2(g);return d&&g.addEventListener("upgradeneeded",a=>{d(h2(g.result),a.oldVersion,a.newVersion,h2(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h})("firebase-heartbeat-database",0,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(iF)}catch(a){console.warn(a)}}}).catch(a=>{throw is.create("idb-open",{originalErrorMessage:a.message})})),iG}async function iI(a){try{let b=(await iH()).transaction(iF),c=await b.objectStore(iF).get(iK(a));return await b.done,c}catch(a){if(a instanceof hq)ib.warn(a.message);else{let b=is.create("idb-get",{originalErrorMessage:a?.message});ib.warn(b.message)}}}async function iJ(a,b){try{let c=(await iH()).transaction(iF,"readwrite"),d=c.objectStore(iF);await d.put(b,iK(a)),await c.done}catch(a){if(a instanceof hq)ib.warn(a.message);else{let b=is.create("idb-set",{originalErrorMessage:a?.message});ib.warn(b.message)}}}function iK(a){return`${a.name}!${a.options.appId}`}class iL{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new iN(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=iM();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>30){let a=function(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){ib.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=iM(),{heartbeatsToSend:b,unsentEntries:c}=function(a,b=1024){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),iO(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),iO(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}(this._heartbeatsCache.heartbeats),d=hd(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return ib.warn(a),""}}}function iM(){return new Date().toISOString().substring(0,10)}class iN{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(a){return!1}}()&&new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await iI(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return iJ(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return iJ(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function iO(a){return hd(JSON.stringify({version:2,heartbeats:a})).length}ik(new hO("platform-logger",a=>new h8(a),"PRIVATE")),ik(new hO("heartbeat",a=>new iL(a),"PRIVATE")),iC(h9,ia,""),iC(h9,ia,"esm2020"),iC("fire-js",""),a.s(["SDK_VERSION",()=>iw,"_DEFAULT_ENTRY_NAME",()=>ic,"_addComponent",()=>ii,"_addOrOverwriteComponent",()=>ij,"_apps",()=>ie,"_clearComponents",()=>ir,"_components",()=>ih,"_getProvider",()=>il,"_isFirebaseApp",()=>io,"_isFirebaseServerApp",()=>iq,"_isFirebaseServerAppSettings",()=>ip,"_registerComponent",()=>ik,"_removeServiceInstance",()=>im,"_serverApps",()=>ig,"deleteApp",()=>iB,"getApp",()=>iz,"getApps",()=>iA,"initializeApp",()=>ix,"initializeServerApp",()=>iy,"onLog",()=>iD,"registerVersion",()=>iC,"setLogLevel",()=>iE],88156),iC("firebase","12.9.0","app"),a.i(88156);var iP=a.i(47760);let iQ=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,iR="websocket",iS="long_polling";class iT{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(a,b){null==b?delete this.cache_[a]:this.cache_[a]=b}get(a){return hy(this.cache_,a)?this.cache_[a]:null}remove(a){delete this.cache_[a]}}let iU=function(a){return new iT},iV=iU("localStorage"),iW=iU("sessionStorage"),iX=new hX("@firebase/database"),iY=(t=1,function(){return t++}),iZ=function(a){let b=hL(a),c=new hH;c.update(b);let d=c.digest();return ha.encodeByteArray(d)},i$=function(...a){let b="";for(let c=0;c<a.length;c++){let d=a[c];Array.isArray(d)||d&&"object"==typeof d&&"number"==typeof d.length?b+=i$.apply(null,d):"object"==typeof d?b+=hu(d):b+=d,b+=" "}return b},i_=null,i0=!0,i1=function(a,b){g6(!b||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?(iX.logLevel=I.VERBOSE,i_=iX.log.bind(iX),b&&iW.set("logging_enabled",!0)):"function"==typeof a?i_=a:(i_=null,iW.remove("logging_enabled"))},i2=function(...a){if(!0===i0&&(i0=!1,null===i_&&!0===iW.get("logging_enabled")&&i1(!0)),i_){let b=i$.apply(null,a);i_(b)}},i3=function(a){return function(...b){i2(a,...b)}},i4=function(...a){let b="FIREBASE INTERNAL ERROR: "+i$(...a);iX.error(b)},i5=function(...a){let b=`FIREBASE FATAL ERROR: ${i$(...a)}`;throw iX.error(b),Error(b)},i6=function(...a){let b="FIREBASE WARNING: "+i$(...a);iX.warn(b)},i7=function(){},i8=function(a){return"number"==typeof a&&(a!=a||a===1/0||a===-1/0)},i9=function(a){if(hp()||"complete"===document.readyState)a();else{let b=!1,c=function(){document.body?b||(b=!0,a()):setTimeout(c,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}},ja="[MIN_NAME]",jb="[MAX_NAME]",jc=function(a,b){if(a===b)return 0;{if(a===ja||b===jb)return -1;if(b===ja||a===jb)return 1;let c=jk(a),d=jk(b);if(null!==c)if(null!==d)return c-d==0?a.length-b.length:c-d;else return -1;return null!==d?1:a<b?-1:1}},jd=function(a,b){return a===b?0:a<b?-1:1},je=function(a,b){if(b&&a in b)return b[a];throw Error("Missing required key ("+a+") in object: "+hu(b))},jf=function(a){if("object"!=typeof a||null===a)return hu(a);let b=[];for(let c in a)b.push(c);b.sort();let c="{";for(let d=0;d<b.length;d++)0!==d&&(c+=","),c+=hu(b[d]),c+=":",c+=jf(a[b[d]]);return c+"}"},jg=function(a,b){let c=a.length;if(c<=b)return[a];let d=[];for(let e=0;e<c;e+=b)e+b>c?d.push(a.substring(e,c)):d.push(a.substring(e,e+b));return d};function jh(a,b){for(let c in a)a.hasOwnProperty(c)&&b(c,a[c])}let ji=function(a){let b,c,d,e,f;g6(!i8(a),"Invalid JSON number");0===a?(c=0,d=0,b=+(1/a==-1/0)):(b=a<0,(a=Math.abs(a))>=22250738585072014e-324?(c=(e=Math.min(Math.floor(Math.log(a)/Math.LN2),1023))+1023,d=Math.round(a*Math.pow(2,52-e)-0x10000000000000)):(c=0,d=Math.round(a/5e-324)));let g=[];for(f=52;f;f-=1)g.push(d%2?1:0),d=Math.floor(d/2);for(f=11;f;f-=1)g.push(c%2?1:0),c=Math.floor(c/2);g.push(+!!b),g.reverse();let h=g.join(""),i="";for(f=0;f<64;f+=8){let a=parseInt(h.substr(f,8),2).toString(16);1===a.length&&(a="0"+a),i+=a}return i.toLowerCase()},jj=RegExp("^-?(0*)\\d{1,10}$"),jk=function(a){if(jj.test(a)){let b=Number(a);if(b>=-0x80000000&&b<=0x7fffffff)return b}return null},jl=function(a){try{a()}catch(a){setTimeout(()=>{throw i6("Exception was thrown by user callback.",a.stack||""),a},Math.floor(0))}},jm=function(a,b){let c=setTimeout(a,b);return"number"==typeof c&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(c):"object"==typeof c&&c.unref&&c.unref(),c};class jn{constructor(a,b,c,d,e=!1,f="",g=!1,h=!1,i=null){this.secure=b,this.namespace=c,this.webSocketOnly=d,this.nodeAdmin=e,this.persistenceKey=f,this.includeNamespaceInQueryParams=g,this.isUsingEmulator=h,this.emulatorOptions=i,this._host=a.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=iV.get("host:"+a)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&iV.set("host:"+this._host,this.internalHost))}toString(){let a=this.toURLString();return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a}toURLString(){let a=this.secure?"https://":"http://",b=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${a}${this.host}/${b}`}}function jo(a,b,c){let d;if(g6("string"==typeof b,"typeof type must == string"),g6("object"==typeof c,"typeof params must == object"),b===iR)d=(a.secure?"wss://":"ws://")+a.internalHost+"/.ws?";else if(b===iS)d=(a.secure?"https://":"http://")+a.internalHost+"/.lp?";else throw Error("Unknown connection type: "+b);(a.host!==a.internalHost||a.isCustomHost()||a.includeNamespaceInQueryParams)&&(c.ns=a.namespace);let e=[];return jh(c,(a,b)=>{e.push(a+"="+b)}),d+e.join("&")}class jp{constructor(){this.counters_={}}incrementCounter(a,b=1){hy(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=b}get(){return function a(b,c){if(!(c instanceof Object))return c;switch(c.constructor){case Date:return new Date(c.getTime());case Object:void 0===b&&(b={});break;case Array:b=[];break;default:return c}for(let d in c)c.hasOwnProperty(d)&&"__proto__"!==d&&(b[d]=a(b[d],c[d]));return b}(void 0,this.counters_)}}let jq={},jr={};function js(a){let b=a.toString();return jq[b]||(jq[b]=new jp),jq[b]}let jt="",ju=null;"u">typeof MozWebSocket?ju=MozWebSocket:"u">typeof WebSocket&&(ju=WebSocket);class jv{constructor(a,b,c,d,e,f,g){this.connId=a,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=i3(this.connId),this.stats_=js(b),this.connURL=jv.connectionURL_(b,f,g,d,c),this.nodeAdmin=b.nodeAdmin}static connectionURL_(a,b,c,d,e){let f={};return f.v="5",!hp()&&"u">typeof location&&location.hostname&&iQ.test(location.hostname)&&(f.r="f"),b&&(f.s=b),c&&(f.ls=c),d&&(f.ac=d),e&&(f.p=e),jo(a,iR,f)}open(a,b){this.onDisconnect=b,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,iV.set("previous_websocket_failure",!0);try{let a;if(hp()){let b=this.nodeAdmin?"AdminNode":"Node";a={headers:{"User-Agent":`Firebase/5/${jt}/${process.platform}/${b}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(a.headers["X-Firebase-AppCheck"]=this.appCheckToken);let c=process.env,d=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;d&&(a.proxy={origin:d})}this.mySock=new ju(this.connURL,[],a)}catch(b){this.log_("Error instantiating WebSocket.");let a=b.message||b.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");let b=a.message||a.data;b&&this.log_(b),this.onClosed_()}}start(){}static forceDisallow(){jv.forceDisallow_=!0}static isAvailable(){let a=!1;if("u">typeof navigator&&navigator.userAgent){let b=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);b&&b.length>1&&4.4>parseFloat(b[1])&&(a=!0)}return!a&&null!==ju&&!jv.forceDisallow_}static previouslyFailed(){return iV.isInMemoryStorage||!0===iV.get("previous_websocket_failure")}markConnectionHealthy(){iV.remove("previous_websocket_failure")}appendFrame_(a){if(this.frames.push(a),this.frames.length===this.totalFrames){let a=this.frames.join("");this.frames=null;let b=ht(a);this.onMessage(b)}}handleNewFrameCount_(a){this.totalFrames=a,this.frames=[]}extractFrameCount_(a){if(g6(null===this.frames,"We already have a frame buffer"),a.length<=6){let b=Number(a);if(!isNaN(b))return this.handleNewFrameCount_(b),null}return this.handleNewFrameCount_(1),a}handleIncomingFrame(a){if(null===this.mySock)return;let b=a.data;if(this.bytesReceived+=b.length,this.stats_.incrementCounter("bytes_received",b.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(b);else{let a=this.extractFrameCount_(b);null!==a&&this.appendFrame_(a)}}send(a){this.resetKeepAlive();let b=hu(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=jg(b,16384);c.length>1&&this.sendString_(String(c.length));for(let a=0;a<c.length;a++)this.sendString_(c[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(a){try{this.mySock.send(a)}catch(a){this.log_("Exception thrown from WebSocket.send():",a.message||a.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}jv.responsesRequiredToBeHealthy=2,jv.healthyTimeout=3e4;let jw="@firebase/database",jx="1.1.0";class jy{constructor(a,b){this.appCheckProvider=b,this.appName=a.name,iq(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken),this.appCheck=b?.getImmediate({optional:!0}),this.appCheck||b?.get().then(a=>this.appCheck=a)}getToken(a){if(this.serverAppAppCheckToken){if(a)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(a):new Promise((b,c)=>{setTimeout(()=>{this.appCheck?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.appCheckProvider?.get().then(b=>b.addTokenListener(a))}notifyForInvalidToken(){i6(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class jz{constructor(a,b,c){this.appName_=a,this.firebaseOptions_=b,this.authProvider_=c,this.auth_=null,this.auth_=c.getImmediate({optional:!0}),this.auth_||c.onInit(a=>this.auth_=a)}getToken(a){return this.auth_?this.auth_.getToken(a).catch(a=>a&&"auth/token-not-initialized"===a.code?(i2("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(a)):new Promise((b,c)=>{setTimeout(()=>{this.auth_?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.auth_?this.auth_.addAuthTokenListener(a):this.authProvider_.get().then(b=>b.addAuthTokenListener(a))}removeTokenChangeListener(a){this.authProvider_.get().then(b=>b.removeAuthTokenListener(a))}notifyForInvalidToken(){let a='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?a+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?a+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':a+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',i6(a)}}class jA{constructor(a){this.accessToken=a}getToken(a){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(a){a(this.accessToken)}removeTokenChangeListener(a){}notifyForInvalidToken(){}}jA.OWNER="owner";class jB{constructor(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(a,b){this.closeAfterResponse=a,this.onClose=b,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(a,b){for(this.pendingResponses[a]=b;this.pendingResponses[this.currentResponseNum];){let a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let b=0;b<a.length;++b)a[b]&&jl(()=>{this.onMessage_(a[b])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let jC="start";class jD{constructor(a,b,c,d,e,f,g){this.connId=a,this.repoInfo=b,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.transportSessionId=f,this.lastSessionId=g,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=i3(a),this.stats_=js(b),this.urlFn=a=>(this.appCheckToken&&(a.ac=this.appCheckToken),jo(b,iS,a))}open(a,b){this.curSegmentNum=0,this.onDisconnect_=b,this.myPacketOrderer=new jB(a),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),i9(()=>{if(this.isClosed_)return;this.scriptTagHolder=new jE((...a)=>{let[b,c,d,e,f]=a;if(this.incrementIncomingBytes_(a),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,b===jC)this.id=c,this.password=d;else if("close"===b)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+b)},(...a)=>{let[b,c]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(b,c)},()=>{this.onClosed_()},this.urlFn);let a={};a[jC]="t",a.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(a.cb=this.scriptTagHolder.uniqueCallbackIdentifier),a.v="5",this.transportSessionId&&(a.s=this.transportSessionId),this.lastSessionId&&(a.ls=this.lastSessionId),this.applicationId&&(a.p=this.applicationId),this.appCheckToken&&(a.ac=this.appCheckToken),"u">typeof location&&location.hostname&&iQ.test(location.hostname)&&(a.r="f");let b=this.urlFn(a);this.log_("Connecting via long-poll to "+b),this.scriptTagHolder.addTag(b,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){jD.forceAllow_=!0}static forceDisallow(){jD.forceDisallow_=!0}static isAvailable(){return!hp()&&(!!jD.forceAllow_||!jD.forceDisallow_&&"u">typeof document&&null!=document.createElement&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(a){let b=hu(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=jg(hc(b),1840);for(let a=0;a<c.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[a]),this.curSegmentNum++}addDisconnectPingFrame(a,b){if(hp())return;this.myDisconnFrame=document.createElement("iframe");let c={};c.dframe="t",c.id=a,c.pw=b,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(a){let b=hu(a).length;this.bytesReceived+=b,this.stats_.incrementCounter("bytes_received",b)}}class jE{constructor(a,b,c,d){if(this.onDisconnect=c,this.urlFn=d,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,hp())this.commandCB=a,this.onMessageCB=b;else{this.uniqueCallbackIdentifier=iY(),window["pLPCommand"+this.uniqueCallbackIdentifier]=a,window["pRTLPCB"+this.uniqueCallbackIdentifier]=b,this.myIFrame=jE.createIFrame_();let c="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(c='<script>document.domain="'+document.domain+'";</script>');const d="<html><body>"+c+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(a){i2("frame writing exception"),a.stack&&i2(a.stack),i2(a)}}}static createIFrame_(){let a=document.createElement("iframe");if(a.style.display="none",document.body){document.body.appendChild(a);try{a.contentWindow.document||i2("No IE domain setting required")}catch(b){a.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let a=this.onDisconnect;a&&(this.onDisconnect=null,a())}startLongPoll(a,b){for(this.myID=a,this.myPW=b,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let a={};a.id=this.myID,a.pw=this.myPW,a.ser=this.currentSerial;let b=this.urlFn(a),c="",d=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+c.length<=1870){let a=this.pendingSegs.shift();c=c+"&seg"+d+"="+a.seg+"&ts"+d+"="+a.ts+"&d"+d+"="+a.d,d++}else break;return b+=c,this.addLongPollTag_(b,this.currentSerial),!0}}enqueueSegment(a,b,c){this.pendingSegs.push({seg:a,ts:b,d:c}),this.alive&&this.newRequest_()}addLongPollTag_(a,b){this.outstandingRequests.add(b);let c=()=>{this.outstandingRequests.delete(b),this.newRequest_()},d=setTimeout(c,Math.floor(25e3));this.addTag(a,()=>{clearTimeout(d),c()})}addTag(a,b){hp()?this.doNodeLongPoll(a,b):setTimeout(()=>{try{if(!this.sendNewPolls)return;let c=this.myIFrame.doc.createElement("script");c.type="text/javascript",c.async=!0,c.src=a,c.onload=c.onreadystatechange=function(){let a=c.readyState;a&&"loaded"!==a&&"complete"!==a||(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),b())},c.onerror=()=>{i2("Long-poll script failed to load: "+a),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(c)}catch(a){}},Math.floor(1))}}class jF{static get ALL_TRANSPORTS(){return[jD,jv]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(a){this.initTransports_(a)}initTransports_(a){let b=jv&&jv.isAvailable(),c=b&&!jv.previouslyFailed();if(a.webSocketOnly&&(b||i6("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[jv];else{let a=this.transports_=[];for(let b of jF.ALL_TRANSPORTS)b&&b.isAvailable()&&a.push(b);jF.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}jF.globalTransportInitialized_=!1;class jG{constructor(a,b,c,d,e,f,g,h,i,j){this.id=a,this.repoInfo_=b,this.applicationId_=c,this.appCheckToken_=d,this.authToken_=e,this.onMessage_=f,this.onReady_=g,this.onDisconnect_=h,this.onKill_=i,this.lastSessionId=j,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=i3("c:"+this.id+":"),this.transportManager_=new jF(b),this.log_("Connection created"),this.start_()}start_(){let a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(b,c)},Math.floor(0));let d=a.healthyTimeout||0;d>0&&(this.healthyTimeout_=jm(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(d)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(a){return b=>{a===this.conn_?this.onConnectionLost_(b):a===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(a){return b=>{2!==this.state_&&(a===this.rx_?this.onPrimaryMessageReceived_(b):a===this.secondaryConn_?this.onSecondaryMessageReceived_(b):this.log_("message on old connection"))}}sendRequest(a){this.sendData_({t:"d",d:a})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(a){if("t"in a){let b=a.t;"a"===b?this.upgradeIfSecondaryHealthy_():"r"===b?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===b&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(a){let b=je("t",a),c=je("d",a);if("c"===b)this.onSecondaryControl_(c);else if("d"===b)this.pendingDataMessages.push(c);else throw Error("Unknown protocol layer: "+b)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(a){let b=je("t",a),c=je("d",a);"c"===b?this.onControl_(c):"d"===b&&this.onDataMessage_(c)}onDataMessage_(a){this.onPrimaryResponse_(),this.onMessage_(a)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(a){let b=je("t",a);if("d"in a){let c=a.d;if("h"===b){let a={...c};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if("n"===b){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===b?this.onConnectionShutdown_(c):"r"===b?this.onReset_(c):"e"===b?i4("Server Error: "+c):"o"===b?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):i4("Unknown control packet command: "+b)}}onHandshake_(a){let b=a.ts,c=a.v,d=a.h;this.sessionId=a.s,this.repoInfo_.host=d,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,b),"5"!==c&&i6("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)}startUpgrade_(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(b,c),jm(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.host=a,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(a,b){this.log_("Realtime connection established."),this.conn_=a,this.state_=1,this.onReady_&&(this.onReady_(b,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):jm(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()}onConnectionLost_(a){this.conn_=null,a||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(iV.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(a){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(a)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class jH{put(a,b,c,d){}merge(a,b,c,d){}refreshAuthToken(a){}refreshAppCheckToken(a){}onDisconnectPut(a,b,c){}onDisconnectMerge(a,b,c){}onDisconnectCancel(a,b){}reportStats(a){}}class jI{constructor(a){this.allowedEvents_=a,this.listeners_={},g6(Array.isArray(a)&&a.length>0,"Requires a non-empty array")}trigger(a,...b){if(Array.isArray(this.listeners_[a])){let c=[...this.listeners_[a]];for(let a=0;a<c.length;a++)c[a].callback.apply(c[a].context,b)}}on(a,b,c){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:b,context:c});let d=this.getInitialEvent(a);d&&b.apply(c,d)}off(a,b,c){this.validateEventType_(a);let d=this.listeners_[a]||[];for(let a=0;a<d.length;a++)if(d[a].callback===b&&(!c||c===d[a].context))return void d.splice(a,1)}validateEventType_(a){g6(this.allowedEvents_.find(b=>b===a),"Unknown event: "+a)}}class jJ extends jI{static getInstance(){return new jJ}constructor(){super(["online"]),this.online_=!0}getInitialEvent(a){return g6("online"===a,"Unknown event type: "+a),[this.online_]}currentlyOnline(){return this.online_}}class jK{constructor(a,b){if(void 0===b){this.pieces_=a.split("/");let b=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[b]=this.pieces_[a],b++);this.pieces_.length=b,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=b}toString(){let a="";for(let b=this.pieceNum_;b<this.pieces_.length;b++)""!==this.pieces_[b]&&(a+="/"+this.pieces_[b]);return a||"/"}}function jL(){return new jK("")}function jM(a){return a.pieceNum_>=a.pieces_.length?null:a.pieces_[a.pieceNum_]}function jN(a){return a.pieces_.length-a.pieceNum_}function jO(a){let b=a.pieceNum_;return b<a.pieces_.length&&b++,new jK(a.pieces_,b)}function jP(a){return a.pieceNum_<a.pieces_.length?a.pieces_[a.pieces_.length-1]:null}function jQ(a,b=0){return a.pieces_.slice(a.pieceNum_+b)}function jR(a){if(a.pieceNum_>=a.pieces_.length)return null;let b=[];for(let c=a.pieceNum_;c<a.pieces_.length-1;c++)b.push(a.pieces_[c]);return new jK(b,0)}function jS(a,b){let c=[];for(let b=a.pieceNum_;b<a.pieces_.length;b++)c.push(a.pieces_[b]);if(b instanceof jK)for(let a=b.pieceNum_;a<b.pieces_.length;a++)c.push(b.pieces_[a]);else{let a=b.split("/");for(let b=0;b<a.length;b++)a[b].length>0&&c.push(a[b])}return new jK(c,0)}function jT(a){return a.pieceNum_>=a.pieces_.length}function jU(a,b){let c=jM(a),d=jM(b);if(null===c)return b;if(c===d)return jU(jO(a),jO(b));throw Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")}function jV(a,b){let c=jQ(a,0),d=jQ(b,0);for(let a=0;a<c.length&&a<d.length;a++){let b=jc(c[a],d[a]);if(0!==b)return b}return c.length===d.length?0:c.length<d.length?-1:1}function jW(a,b){if(jN(a)!==jN(b))return!1;for(let c=a.pieceNum_,d=b.pieceNum_;c<=a.pieces_.length;c++,d++)if(a.pieces_[c]!==b.pieces_[d])return!1;return!0}function jX(a,b){let c=a.pieceNum_,d=b.pieceNum_;if(jN(a)>jN(b))return!1;for(;c<a.pieces_.length;){if(a.pieces_[c]!==b.pieces_[d])return!1;++c,++d}return!0}class jY{constructor(a,b){this.errorPrefix_=b,this.parts_=jQ(a,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=hM(this.parts_[a]);jZ(this)}}function jZ(a){if(a.byteLength_>768)throw Error(a.errorPrefix_+"has a key path longer than 768 bytes ("+a.byteLength_+").");if(a.parts_.length>32)throw Error(a.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+j$(a))}function j$(a){return 0===a.parts_.length?"":"in property '"+a.parts_.join(".")+"'"}class j_ extends jI{static getInstance(){return new j_}constructor(){let a,b;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(b="visibilitychange",a="hidden"):void 0!==document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):void 0!==document.msHidden?(b="msvisibilitychange",a="msHidden"):void 0!==document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,b&&document.addEventListener(b,()=>{let b=!document[a];b!==this.visible_&&(this.visible_=b,this.trigger("visible",b))},!1)}getInitialEvent(a){return g6("visible"===a,"Unknown event type: "+a),[this.visible_]}}class j0 extends jH{constructor(a,b,c,d,e,f,g,h){if(super(),this.repoInfo_=a,this.applicationId_=b,this.onDataUpdate_=c,this.onConnectStatus_=d,this.onServerInfoUpdate_=e,this.authTokenProvider_=f,this.appCheckTokenProvider_=g,this.authOverride_=h,this.id=j0.nextPersistentConnectionId_++,this.log_=i3("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!hp())throw Error("Auth override specified in options, but not supported on non Node.js platforms");j_.getInstance().on("visible",this.onVisible_,this),-1===a.host.indexOf("fblocal")&&jJ.getInstance().on("online",this.onOnline_,this)}sendRequest(a,b,c){let d=++this.requestNumber_,e={r:d,a:a,b:b};this.log_(hu(e)),g6(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),c&&(this.requestCBHash_[d]=c)}get(a){this.initConnection_();let b=new hi,c={p:a._path.toString(),q:a._queryObject};this.outstandingGets_.push({action:"g",request:c,onComplete:a=>{let c=a.d;"ok"===a.s?b.resolve(c):b.reject(c)}}),this.outstandingGetCount_++;let d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),b.promise}listen(a,b,c,d){this.initConnection_();let e=a._queryIdentifier,f=a._path.toString();this.log_("Listen called for "+f+" "+e),this.listens.has(f)||this.listens.set(f,new Map),g6(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"listen() called for non-default but complete query"),g6(!this.listens.get(f).has(e),"listen() called twice for same path/queryId.");let g={onComplete:d,hashFn:b,query:a,tag:c};this.listens.get(f).set(e,g),this.connected_&&this.sendListen_(g)}sendGet_(a){let b=this.outstandingGets_[a];this.sendRequest("g",b.request,c=>{delete this.outstandingGets_[a],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),b.onComplete&&b.onComplete(c)})}sendListen_(a){let b=a.query,c=b._path.toString(),d=b._queryIdentifier;this.log_("Listen on "+c+" for "+d);let e={p:c};a.tag&&(e.q=b._queryObject,e.t=a.tag),e.h=a.hashFn(),this.sendRequest("q",e,e=>{let f=e.d,g=e.s;j0.warnOnListenWarnings_(f,b),(this.listens.get(c)&&this.listens.get(c).get(d))===a&&(this.log_("listen response",e),"ok"!==g&&this.removeListen_(c,d),a.onComplete&&a.onComplete(g,f))})}static warnOnListenWarnings_(a,b){if(a&&"object"==typeof a&&hy(a,"w")){let c=hz(a,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){let a='".indexOn": "'+b._queryParams.getIndex().toString()+'"',c=b._path.toString();i6(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(a){this.authToken_=a,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(a)}reduceReconnectDelayIfAdminCredential_(a){(a&&40===a.length||hx(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(a){this.appCheckToken_=a,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let a=this.authToken_,b=hw(a)?"auth":"gauth",c={cred:a};null===this.authOverride_?c.noauth=!0:"object"==typeof this.authOverride_&&(c.authvar=this.authOverride_),this.sendRequest(b,c,b=>{let c=b.s,d=b.d||"error";this.authToken_===a&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},a=>{let b=a.s,c=a.d||"error";"ok"===b?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(b,c)})}unlisten(a,b){let c=a._path.toString(),d=a._queryIdentifier;this.log_("Unlisten called for "+c+" "+d),g6(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,d)&&this.connected_&&this.sendUnlisten_(c,d,a._queryObject,b)}sendUnlisten_(a,b,c,d){this.log_("Unlisten on "+a+" for "+b);let e={p:a};d&&(e.q=c,e.t=d),this.sendRequest("n",e)}onDisconnectPut(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:b,onComplete:c})}onDisconnectMerge(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:b,onComplete:c})}onDisconnectCancel(a,b){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",a,null,b):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:b})}sendOnDisconnect_(a,b,c,d){let e={p:b,d:c};this.log_("onDisconnect "+a,e),this.sendRequest(a,e,a=>{d&&setTimeout(()=>{d(a.s,a.d)},Math.floor(0))})}put(a,b,c,d){this.putInternal("p",a,b,c,d)}merge(a,b,c,d){this.putInternal("m",a,b,c,d)}putInternal(a,b,c,d,e){this.initConnection_();let f={p:b,d:c};void 0!==e&&(f.h=e),this.outstandingPuts_.push({action:a,request:f,onComplete:d}),this.outstandingPutCount_++;let g=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(g):this.log_("Buffering put: "+b)}sendPut_(a){let b=this.outstandingPuts_[a].action,c=this.outstandingPuts_[a].request,d=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(b,c,c=>{this.log_(b+" response",c),delete this.outstandingPuts_[a],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),d&&d(c.s,c.d)})}reportStats(a){if(this.connected_){let b={c:a};this.log_("reportStats",b),this.sendRequest("s",b,a=>{if("ok"!==a.s){let b=a.d;this.log_("reportStats","Error sending stats: "+b)}})}}onDataMessage_(a){if("r"in a){this.log_("from server: "+hu(a));let b=a.r,c=this.requestCBHash_[b];c&&(delete this.requestCBHash_[b],c(a.b))}else if("error"in a)throw"A server-side error has occurred: "+a.error;else"a"in a&&this.onDataPush_(a.a,a.b)}onDataPush_(a,b){this.log_("handleServerMessage",a,b),"d"===a?this.onDataUpdate_(b.p,b.d,!1,b.t):"m"===a?this.onDataUpdate_(b.p,b.d,!0,b.t):"c"===a?this.onListenRevoked_(b.p,b.q):"ac"===a?this.onAuthRevoked_(b.s,b.d):"apc"===a?this.onAppCheckRevoked_(b.s,b.d):"sd"===a?this.onSecurityDebugPacket_(b):i4("Unrecognized action received from server: "+hu(a)+"\nAre you using the latest client?")}onReady_(a,b){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(a),this.lastSessionId=b,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(a){g6(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(a))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=a}onOnline_(a){a?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let a=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),b=Math.max(0,this.reconnectDelay_-a);b=Math.random()*b,this.log_("Trying to reconnect in "+b+"ms"),this.scheduleConnect_(b),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let a=this.onDataMessage_.bind(this),b=this.onReady_.bind(this),c=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+j0.nextConnectionId_++,e=this.lastSessionId,f=!1,g=null,h=function(){g?g.close():(f=!0,c())};this.realtime_={close:h,sendRequest:function(a){g6(g,"sendRequest call when we're not connected not allowed."),g.sendRequest(a)}};let i=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,j]=await Promise.all([this.authTokenProvider_.getToken(i),this.appCheckTokenProvider_.getToken(i)]);f?i2("getToken() completed but was canceled"):(i2("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=j&&j.token,g=new jG(d,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,a,b,c,a=>{i6(a+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},e))}catch(a){this.log_("Failed to get token: "+a),f||(this.repoInfo_.nodeAdmin&&i6(a),h())}}}interrupt(a){i2("Interrupting connection for reason: "+a),this.interruptReasons_[a]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(a){i2("Resuming connection for reason: "+a),delete this.interruptReasons_[a],hA(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(a){let b=a-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:b})}cancelSentTransactions_(){for(let a=0;a<this.outstandingPuts_.length;a++){let b=this.outstandingPuts_[a];b&&"h"in b.request&&b.queued&&(b.onComplete&&b.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(a,b){let c;c=b?b.map(a=>jf(a)).join("$"):"default";let d=this.removeListen_(a,c);d&&d.onComplete&&d.onComplete("permission_denied")}removeListen_(a,b){let c,d=new jK(a).toString();if(this.listens.has(d)){let a=this.listens.get(d);c=a.get(b),a.delete(b),0===a.size&&this.listens.delete(d)}else c=void 0;return c}onAuthRevoked_(a,b){i2("Auth token revoked: "+a+"/"+b),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===a||"permission_denied"===a)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(a,b){i2("App check token revoked: "+a+"/"+b),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===a||"permission_denied"===a)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&console.log("FIREBASE: "+a.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let a of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let b of a.values())this.sendListen_(b);for(let a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){let a=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(a.action,a.pathString,a.data,a.onComplete)}for(let a=0;a<this.outstandingGets_.length;a++)this.outstandingGets_[a]&&this.sendGet_(a)}sendConnectStats_(){let a={},b="js";hp()&&(b=this.repoInfo_.nodeAdmin?"admin_node":"node"),a["sdk."+b+"."+jt.replace(/\./g,"-")]=1,ho()&&(a["framework.reactnative"]=1),this.reportStats(a)}shouldReconnect_(){let a=jJ.getInstance().currentlyOnline();return hA(this.interruptReasons_)&&a}}j0.nextPersistentConnectionId_=0,j0.nextConnectionId_=0;class j1{constructor(a,b){this.name=a,this.node=b}static Wrap(a,b){return new j1(a,b)}}class j2{getCompare(){return this.compare.bind(this)}indexedValueChanged(a,b){let c=new j1(ja,a),d=new j1(ja,b);return 0!==this.compare(c,d)}minPost(){return j1.MIN}}class j3 extends j2{static get __EMPTY_NODE(){return g}static set __EMPTY_NODE(a){g=a}compare(a,b){return jc(a.name,b.name)}isDefinedOn(a){throw g7("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(a,b){return!1}minPost(){return j1.MIN}maxPost(){return new j1(jb,g)}makePost(a,b){return g6("string"==typeof a,"KeyIndex indexValue must always be a string."),new j1(a,g)}toString(){return".key"}}let j4=new j3;class j5{constructor(a,b,c,d,e=null){this.isReverse_=d,this.resultGenerator_=e,this.nodeStack_=[];let f=1;for(;!a.isEmpty();)if(f=b?c(a.key,b):1,d&&(f*=-1),f<0)a=this.isReverse_?a.left:a.right;else if(0===f){this.nodeStack_.push(a);break}else this.nodeStack_.push(a),a=this.isReverse_?a.right:a.left}getNext(){let a;if(0===this.nodeStack_.length)return null;let b=this.nodeStack_.pop();if(a=this.resultGenerator_?this.resultGenerator_(b.key,b.value):{key:b.key,value:b.value},this.isReverse_)for(b=b.left;!b.isEmpty();)this.nodeStack_.push(b),b=b.right;else for(b=b.right;!b.isEmpty();)this.nodeStack_.push(b),b=b.left;return a}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let a=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}}}class j6{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:j6.RED,this.left=null!=d?d:j7.EMPTY_NODE,this.right=null!=e?e:j7.EMPTY_NODE}copy(a,b,c,d,e){return new j6(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||!!a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp_()}removeMin_(){if(this.left.isEmpty())return j7.EMPTY_NODE;let a=this;return a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),(a=a.copy(null,null,null,a.left.removeMin_(),null)).fixUp_()}remove(a,b){let c,d;if(c=this,0>b(a,c.key))c.left.isEmpty()||c.left.isRed_()||c.left.left.isRed_()||(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(a,b),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),c.right.isEmpty()||c.right.isRed_()||c.right.left.isRed_()||(c=c.moveRedRight_()),0===b(a,c.key))if(c.right.isEmpty())return j7.EMPTY_NODE;else d=c.right.min_(),c=c.copy(d.key,d.value,null,null,c.right.removeMin_());c=c.copy(null,null,null,null,c.right.remove(a,b))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a}moveRedLeft_(){let a=this.colorFlip_();return a.right.left.isRed_()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight_())).rotateLeft_()).colorFlip_()),a}moveRedRight_(){let a=this.colorFlip_();return a.left.left.isRed_()&&(a=(a=a.rotateRight_()).colorFlip_()),a}rotateLeft_(){let a=this.copy(null,null,j6.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight_(){let a=this.copy(null,null,j6.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip_(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let a=this.left.check_();if(a===this.right.check_())return a+ +!this.isRed_();throw Error("Black depths differ")}}j6.RED=!0,j6.BLACK=!1;class j7{constructor(a,b=j7.EMPTY_NODE){this.comparator_=a,this.root_=b}insert(a,b){return new j7(this.comparator_,this.root_.insert(a,b,this.comparator_).copy(null,null,j6.BLACK,null,null))}remove(a){return new j7(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,j6.BLACK,null,null))}get(a){let b,c=this.root_;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))return c.value;b<0?c=c.left:b>0&&(c=c.right)}return null}getPredecessorKey(a){let b,c=this.root_,d=null;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))if(c.left.isEmpty())if(d)return d.key;else return null;else{for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}b<0?c=c.left:b>0&&(d=c,c=c.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(a){return this.root_.inorderTraversal(a)}reverseTraversal(a){return this.root_.reverseTraversal(a)}getIterator(a){return new j5(this.root_,null,this.comparator_,!1,a)}getIteratorFrom(a,b){return new j5(this.root_,a,this.comparator_,!1,b)}getReverseIteratorFrom(a,b){return new j5(this.root_,a,this.comparator_,!0,b)}getReverseIterator(a){return new j5(this.root_,null,this.comparator_,!0,a)}}function j8(a,b){return jc(a.name,b.name)}function j9(a,b){return jc(a,b)}j7.EMPTY_NODE=new class{copy(a,b,c,d,e){return this}insert(a,b,c){return new j6(a,b,null)}remove(a,b){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let ka=function(a){return"number"==typeof a?"number:"+ji(a):"string:"+a},kb=function(a){if(a.isLeafNode()){let b=a.val();g6("string"==typeof b||"number"==typeof b||"object"==typeof b&&hy(b,".sv"),"Priority must be a string or number.")}else g6(a===h||a.isEmpty(),"priority of unexpected type.");g6(a===h||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class kc{static set __childrenNodeConstructor(a){i=a}static get __childrenNodeConstructor(){return i}constructor(a,b=kc.__childrenNodeConstructor.EMPTY_NODE){this.value_=a,this.priorityNode_=b,this.lazyHash_=null,g6(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),kb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(a){return new kc(this.value_,a)}getImmediateChild(a){return".priority"===a?this.priorityNode_:kc.__childrenNodeConstructor.EMPTY_NODE}getChild(a){return jT(a)?this:".priority"===jM(a)?this.priorityNode_:kc.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(a,b){return null}updateImmediateChild(a,b){return".priority"===a?this.updatePriority(b):b.isEmpty()&&".priority"!==a?this:kc.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(a,b).updatePriority(this.priorityNode_)}updateChild(a,b){let c=jM(a);return null===c?b:b.isEmpty()&&".priority"!==c?this:(g6(".priority"!==c||1===jN(a),".priority must be the last token in a path"),this.updateImmediateChild(c,kc.__childrenNodeConstructor.EMPTY_NODE.updateChild(jO(a),b)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(a,b){return!1}val(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let a="";this.priorityNode_.isEmpty()||(a+="priority:"+ka(this.priorityNode_.val())+":");let b=typeof this.value_;a+=b+":","number"===b?a+=ji(this.value_):a+=this.value_,this.lazyHash_=iZ(a)}return this.lazyHash_}getValue(){return this.value_}compareTo(a){return a===kc.__childrenNodeConstructor.EMPTY_NODE?1:a instanceof kc.__childrenNodeConstructor?-1:(g6(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))}compareToLeafNode_(a){let b=typeof a.value_,c=typeof this.value_,d=kc.VALUE_TYPE_ORDER.indexOf(b),e=kc.VALUE_TYPE_ORDER.indexOf(c);return(g6(d>=0,"Unknown leaf type: "+b),g6(e>=0,"Unknown leaf type: "+c),d!==e)?e-d:"object"===c?0:this.value_<a.value_?-1:1*(this.value_!==a.value_)}withIndex(){return this}isIndexed(){return!0}equals(a){return a===this||!!a.isLeafNode()&&this.value_===a.value_&&this.priorityNode_.equals(a.priorityNode_)}}kc.VALUE_TYPE_ORDER=["object","boolean","number","string"];let kd=new class extends j2{compare(a,b){let c=a.node.getPriority(),d=b.node.getPriority(),e=c.compareTo(d);return 0===e?jc(a.name,b.name):e}isDefinedOn(a){return!a.getPriority().isEmpty()}indexedValueChanged(a,b){return!a.getPriority().equals(b.getPriority())}minPost(){return j1.MIN}maxPost(){return new j1(jb,new kc("[PRIORITY-POST]",k))}makePost(a,b){return new j1(b,new kc("[PRIORITY-POST]",j(a)))}toString(){return".priority"}},ke=Math.log(2);class kf{constructor(a){this.count=(a=>parseInt(Math.log(a)/ke,10))(a+1),this.current_=this.count-1;const b=(a=>parseInt(Array(a+1).join("1"),2))(this.count);this.bits_=a+1&b}nextBitIsOne(){let a=!(this.bits_&1<<this.current_);return this.current_--,a}}let kg=function(a,b,c,d){a.sort(b);let e=function(b,d){let f,g=d-b;if(0===g)return null;if(1===g)return f=a[b],new j6(c?c(f):f,f.node,j6.BLACK,null,null);{let h=parseInt(g/2,10)+b,i=e(b,h),j=e(h+1,d);return f=a[h],new j6(c?c(f):f,f.node,j6.BLACK,i,j)}};return new j7(d||b,function(b){let d=null,f=null,g=a.length,h=function(b,d){let f=g-b,h=g;g-=b;let j=e(f+1,h),k=a[f];i(new j6(c?c(k):k,k.node,d,null,j))},i=function(a){d?d.left=a:f=a,d=a};for(let a=0;a<b.count;++a){let c=b.nextBitIsOne(),d=Math.pow(2,b.count-(a+1));c?h(d,j6.BLACK):(h(d,j6.BLACK),h(d,j6.RED))}return f}(new kf(a.length)))},kh={};class ki{static get Default(){return g6(kh&&kd,"ChildrenNode.ts has not been loaded"),l=l||new ki({".priority":kh},{".priority":kd})}constructor(a,b){this.indexes_=a,this.indexSet_=b}get(a){let b=hz(this.indexes_,a);if(!b)throw Error("No index defined for "+a);return b instanceof j7?b:null}hasIndex(a){return hy(this.indexSet_,a.toString())}addIndex(a,b){let c;g6(a!==j4,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let d=[],e=!1,f=b.getIterator(j1.Wrap),g=f.getNext();for(;g;)e=e||a.isDefinedOn(g.node),d.push(g),g=f.getNext();c=e?kg(d,a.getCompare()):kh;let h=a.toString(),i={...this.indexSet_};i[h]=a;let j={...this.indexes_};return j[h]=c,new ki(j,i)}addToIndexes(a,b){return new ki(hB(this.indexes_,(c,d)=>{let e=hz(this.indexSet_,d);if(g6(e,"Missing index implementation for "+d),c===kh)if(!e.isDefinedOn(a.node))return kh;else{let c=[],d=b.getIterator(j1.Wrap),f=d.getNext();for(;f;)f.name!==a.name&&c.push(f),f=d.getNext();return c.push(a),kg(c,e.getCompare())}{let d=b.get(a.name),e=c;return d&&(e=e.remove(new j1(a.name,d))),e.insert(a,a.node)}}),this.indexSet_)}removeFromIndexes(a,b){return new ki(hB(this.indexes_,c=>{if(c===kh)return c;{let d=b.get(a.name);return d?c.remove(new j1(a.name,d)):c}}),this.indexSet_)}}class kj{static get EMPTY_NODE(){return m||(m=new kj(new j7(j9),null,ki.Default))}constructor(a,b,c){this.children_=a,this.priorityNode_=b,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&kb(this.priorityNode_),this.children_.isEmpty()&&g6(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||m}updatePriority(a){return this.children_.isEmpty()?this:new kj(this.children_,a,this.indexMap_)}getImmediateChild(a){if(".priority"===a)return this.getPriority();{let b=this.children_.get(a);return null===b?m:b}}getChild(a){let b=jM(a);return null===b?this:this.getImmediateChild(b).getChild(jO(a))}hasChild(a){return null!==this.children_.get(a)}updateImmediateChild(a,b){if(g6(b,"We should always be passing snapshot nodes"),".priority"===a)return this.updatePriority(b);{let c,d,e=new j1(a,b);b.isEmpty()?(c=this.children_.remove(a),d=this.indexMap_.removeFromIndexes(e,this.children_)):(c=this.children_.insert(a,b),d=this.indexMap_.addToIndexes(e,this.children_));let f=c.isEmpty()?m:this.priorityNode_;return new kj(c,f,d)}}updateChild(a,b){let c=jM(a);if(null===c)return b;{g6(".priority"!==jM(a)||1===jN(a),".priority must be the last token in a path");let d=this.getImmediateChild(c).updateChild(jO(a),b);return this.updateImmediateChild(c,d)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(a){if(this.isEmpty())return null;let b={},c=0,d=0,e=!0;if(this.forEachChild(kd,(f,g)=>{b[f]=g.val(a),c++,e&&kj.INTEGER_REGEXP_.test(f)?d=Math.max(d,Number(f)):e=!1}),a||!e||!(d<2*c))return a&&!this.getPriority().isEmpty()&&(b[".priority"]=this.getPriority().val()),b;{let a=[];for(let c in b)a[c]=b[c];return a}}hash(){if(null===this.lazyHash_){let a="";this.getPriority().isEmpty()||(a+="priority:"+ka(this.getPriority().val())+":"),this.forEachChild(kd,(b,c)=>{let d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.lazyHash_=""===a?"":iZ(a)}return this.lazyHash_}getPredecessorChildName(a,b,c){let d=this.resolveIndex_(c);if(!d)return this.children_.getPredecessorKey(a);{let c=d.getPredecessorKey(new j1(a,b));return c?c.name:null}}getFirstChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.minKey();{let a=b.minKey();return a&&a.name}}getFirstChild(a){let b=this.getFirstChildName(a);return b?new j1(b,this.children_.get(b)):null}getLastChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.maxKey();{let a=b.maxKey();return a&&a.name}}getLastChild(a){let b=this.getLastChildName(a);return b?new j1(b,this.children_.get(b)):null}forEachChild(a,b){let c=this.resolveIndex_(a);return c?c.inorderTraversal(a=>b(a.name,a.node)):this.children_.inorderTraversal(b)}getIterator(a){return this.getIteratorFrom(a.minPost(),a)}getIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getIteratorFrom(a,a=>a);{let c=this.children_.getIteratorFrom(a.name,j1.Wrap),d=c.peek();for(;null!=d&&0>b.compare(d,a);)c.getNext(),d=c.peek();return c}}getReverseIterator(a){return this.getReverseIteratorFrom(a.maxPost(),a)}getReverseIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getReverseIteratorFrom(a,a=>a);{let c=this.children_.getReverseIteratorFrom(a.name,j1.Wrap),d=c.peek();for(;null!=d&&b.compare(d,a)>0;)c.getNext(),d=c.peek();return c}}compareTo(a){if(this.isEmpty())if(a.isEmpty())return 0;else return -1;return a.isLeafNode()||a.isEmpty()?1:a===kk?-1:0}withIndex(a){if(a===j4||this.indexMap_.hasIndex(a))return this;{let b=this.indexMap_.addIndex(a,this.children_);return new kj(this.children_,this.priorityNode_,b)}}isIndexed(a){return a===j4||this.indexMap_.hasIndex(a)}equals(a){if(a===this)return!0;if(a.isLeafNode()||!this.getPriority().equals(a.getPriority()))return!1;if(this.children_.count()!==a.children_.count())return!1;{let b=this.getIterator(kd),c=a.getIterator(kd),d=b.getNext(),e=c.getNext();for(;d&&e;){if(d.name!==e.name||!d.node.equals(e.node))return!1;d=b.getNext(),e=c.getNext()}return null===d&&null===e}}resolveIndex_(a){return a===j4?null:this.indexMap_.get(a.toString())}}kj.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let kk=new class extends kj{constructor(){super(new j7(j9),kj.EMPTY_NODE,ki.Default)}compareTo(a){return+(a!==this)}equals(a){return a===this}getPriority(){return this}getImmediateChild(a){return kj.EMPTY_NODE}isEmpty(){return!1}};function kl(a,b=null){if(null===a)return kj.EMPTY_NODE;if("object"==typeof a&&".priority"in a&&(b=a[".priority"]),g6(null===b||"string"==typeof b||"number"==typeof b||"object"==typeof b&&".sv"in b,"Invalid priority type found: "+typeof b),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new kc(a,kl(b));if(a instanceof Array){let c=kj.EMPTY_NODE;return jh(a,(b,d)=>{if(hy(a,b)&&"."!==b.substring(0,1)){let a=kl(d);(a.isLeafNode()||!a.isEmpty())&&(c=c.updateImmediateChild(b,a))}}),c.updatePriority(kl(b))}{let c=[],d=!1;if(jh(a,(a,b)=>{if("."!==a.substring(0,1)){let e=kl(b);e.isEmpty()||(d=d||!e.getPriority().isEmpty(),c.push(new j1(a,e)))}}),0===c.length)return kj.EMPTY_NODE;let e=kg(c,j8,a=>a.name,j9);if(!d)return new kj(e,kl(b),ki.Default);{let a=kg(c,kd.getCompare());return new kj(e,kl(b),new ki({".priority":a},{".priority":kd}))}}}Object.defineProperties(j1,{MIN:{value:new j1(ja,kj.EMPTY_NODE)},MAX:{value:new j1(jb,kk)}}),j3.__EMPTY_NODE=kj.EMPTY_NODE,kc.__childrenNodeConstructor=kj,h=kk,k=kk,j=kl;class km extends j2{constructor(a){super(),this.indexPath_=a,g6(!jT(a)&&".priority"!==jM(a),"Can't create PathIndex with empty path or .priority key")}extractChild(a){return a.getChild(this.indexPath_)}isDefinedOn(a){return!a.getChild(this.indexPath_).isEmpty()}compare(a,b){let c=this.extractChild(a.node),d=this.extractChild(b.node),e=c.compareTo(d);return 0===e?jc(a.name,b.name):e}makePost(a,b){let c=kl(a);return new j1(b,kj.EMPTY_NODE.updateChild(this.indexPath_,c))}maxPost(){return new j1(jb,kj.EMPTY_NODE.updateChild(this.indexPath_,kk))}toString(){return jQ(this.indexPath_,0).join("/")}}let kn=new class extends j2{compare(a,b){let c=a.node.compareTo(b.node);return 0===c?jc(a.name,b.name):c}isDefinedOn(a){return!0}indexedValueChanged(a,b){return!a.equals(b)}minPost(){return j1.MIN}maxPost(){return j1.MAX}makePost(a,b){return new j1(b,kl(a))}toString(){return".value"}};function ko(a){return{type:"value",snapshotNode:a}}function kp(a,b){return{type:"child_added",snapshotNode:b,childName:a}}function kq(a,b){return{type:"child_removed",snapshotNode:b,childName:a}}function kr(a,b,c){return{type:"child_changed",snapshotNode:b,childName:a,oldSnap:c}}class ks{constructor(a){this.index_=a}updateChild(a,b,c,d,e,f){g6(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");let g=a.getImmediateChild(b);return g.getChild(d).equals(c.getChild(d))&&g.isEmpty()===c.isEmpty()||(null!=f&&(c.isEmpty()?a.hasChild(b)?f.trackChildChange(kq(b,g)):g6(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):g.isEmpty()?f.trackChildChange(kp(b,c)):f.trackChildChange(kr(b,c,g))),a.isLeafNode()&&c.isEmpty())?a:a.updateImmediateChild(b,c).withIndex(this.index_)}updateFullNode(a,b,c){return null!=c&&(a.isLeafNode()||a.forEachChild(kd,(a,d)=>{b.hasChild(a)||c.trackChildChange(kq(a,d))}),b.isLeafNode()||b.forEachChild(kd,(b,d)=>{if(a.hasChild(b)){let e=a.getImmediateChild(b);e.equals(d)||c.trackChildChange(kr(b,d,e))}else c.trackChildChange(kp(b,d))})),b.withIndex(this.index_)}updatePriority(a,b){return a.isEmpty()?kj.EMPTY_NODE:a.updatePriority(b)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class kt{constructor(a){this.indexedFilter_=new ks(a.getIndex()),this.index_=a.getIndex(),this.startPost_=kt.getStartPost_(a),this.endPost_=kt.getEndPost_(a),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(a){let b=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),a):0>this.index_.compare(this.getStartPost(),a),c=this.endIsInclusive_?0>=this.index_.compare(a,this.getEndPost()):0>this.index_.compare(a,this.getEndPost());return b&&c}updateChild(a,b,c,d,e,f){return this.matches(new j1(b,c))||(c=kj.EMPTY_NODE),this.indexedFilter_.updateChild(a,b,c,d,e,f)}updateFullNode(a,b,c){b.isLeafNode()&&(b=kj.EMPTY_NODE);let d=b.withIndex(this.index_);d=d.updatePriority(kj.EMPTY_NODE);let e=this;return b.forEachChild(kd,(a,b)=>{e.matches(new j1(a,b))||(d=d.updateImmediateChild(a,kj.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(a){if(!a.hasStart())return a.getIndex().minPost();{let b=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),b)}}static getEndPost_(a){if(!a.hasEnd())return a.getIndex().maxPost();{let b=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),b)}}}class ku{constructor(a){this.withinDirectionalStart=a=>this.reverse_?this.withinEndPost(a):this.withinStartPost(a),this.withinDirectionalEnd=a=>this.reverse_?this.withinStartPost(a):this.withinEndPost(a),this.withinStartPost=a=>{let b=this.index_.compare(this.rangedFilter_.getStartPost(),a);return this.startIsInclusive_?b<=0:b<0},this.withinEndPost=a=>{let b=this.index_.compare(a,this.rangedFilter_.getEndPost());return this.endIsInclusive_?b<=0:b<0},this.rangedFilter_=new kt(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft(),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}updateChild(a,b,c,d,e,f){return(this.rangedFilter_.matches(new j1(b,c))||(c=kj.EMPTY_NODE),a.getImmediateChild(b).equals(c))?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,b,c,d,e,f):this.fullLimitUpdateChild_(a,b,c,e,f)}updateFullNode(a,b,c){let d;if(b.isLeafNode()||b.isEmpty())d=kj.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<b.numChildren()&&b.isIndexed(this.index_)){let a;d=kj.EMPTY_NODE.withIndex(this.index_),a=this.reverse_?b.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):b.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;a.hasNext()&&c<this.limit_;){let b=a.getNext();if(this.withinDirectionalStart(b))if(this.withinDirectionalEnd(b))d=d.updateImmediateChild(b.name,b.node),c++;else break}}else{let a;d=(d=b.withIndex(this.index_)).updatePriority(kj.EMPTY_NODE),a=this.reverse_?d.getReverseIterator(this.index_):d.getIterator(this.index_);let c=0;for(;a.hasNext();){let b=a.getNext();c<this.limit_&&this.withinDirectionalStart(b)&&this.withinDirectionalEnd(b)?c++:d=d.updateImmediateChild(b.name,kj.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(a,b,c,d,e){let f;if(this.reverse_){let a=this.index_.getCompare();f=(b,c)=>a(c,b)}else f=this.index_.getCompare();g6(a.numChildren()===this.limit_,"");let g=new j1(b,c),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),i=this.rangedFilter_.matches(g);if(a.hasChild(b)){let j=a.getImmediateChild(b),k=d.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=k&&(k.name===b||a.hasChild(k.name));)k=d.getChildAfterChild(this.index_,k,this.reverse_);let l=null==k?1:f(k,g);if(i&&!c.isEmpty()&&l>=0)return null!=e&&e.trackChildChange(kr(b,c,j)),a.updateImmediateChild(b,c);{null!=e&&e.trackChildChange(kq(b,j));let c=a.updateImmediateChild(b,kj.EMPTY_NODE);return null!=k&&this.rangedFilter_.matches(k)?(null!=e&&e.trackChildChange(kp(k.name,k.node)),c.updateImmediateChild(k.name,k.node)):c}}return c.isEmpty()?a:i?f(h,g)>=0?(null!=e&&(e.trackChildChange(kq(h.name,h.node)),e.trackChildChange(kp(b,c))),a.updateImmediateChild(b,c).updateImmediateChild(h.name,kj.EMPTY_NODE)):a:a}}class kv{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=kd}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return g6(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(g6(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:ja}hasEnd(){return this.endSet_}getIndexEndValue(){return g6(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(g6(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:jb}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return g6(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===kd}copy(){let a=new kv;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.startAfterSet_=this.startAfterSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.endBeforeSet_=this.endBeforeSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a.viewFrom_=this.viewFrom_,a}}function kw(a){let b,c={};if(a.isDefault())return c;if(a.index_===kd?b="$priority":a.index_===kn?b="$value":a.index_===j4?b="$key":(g6(a.index_ instanceof km,"Unrecognized index type!"),b=a.index_.toString()),c.orderBy=hu(b),a.startSet_){let b=a.startAfterSet_?"startAfter":"startAt";c[b]=hu(a.indexStartValue_),a.startNameSet_&&(c[b]+=","+hu(a.indexStartName_))}if(a.endSet_){let b=a.endBeforeSet_?"endBefore":"endAt";c[b]=hu(a.indexEndValue_),a.endNameSet_&&(c[b]+=","+hu(a.indexEndName_))}return a.limitSet_&&(a.isViewFromLeft()?c.limitToFirst=a.limit_:c.limitToLast=a.limit_),c}function kx(a){let b={};if(a.startSet_&&(b.sp=a.indexStartValue_,a.startNameSet_&&(b.sn=a.indexStartName_),b.sin=!a.startAfterSet_),a.endSet_&&(b.ep=a.indexEndValue_,a.endNameSet_&&(b.en=a.indexEndName_),b.ein=!a.endBeforeSet_),a.limitSet_){b.l=a.limit_;let c=a.viewFrom_;""===c&&(c=a.isViewFromLeft()?"l":"r"),b.vf=c}return a.index_!==kd&&(b.i=a.index_.toString()),b}class ky extends jH{reportStats(a){throw Error("Method not implemented.")}static getListenId_(a,b){return void 0!==b?"tag$"+b:(g6(a._queryParams.isDefault(),"should have a tag if it's not a default query."),a._path.toString())}constructor(a,b,c,d){super(),this.repoInfo_=a,this.onDataUpdate_=b,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.log_=i3("p:rest:"),this.listens_={}}listen(a,b,c,d){let e=a._path.toString();this.log_("Listen called for "+e+" "+a._queryIdentifier);let f=ky.getListenId_(a,c),g={};this.listens_[f]=g;let h=kw(a._queryParams);this.restRequest_(e+".json",h,(a,b)=>{let h=b;(404===a&&(h=null,a=null),null===a&&this.onDataUpdate_(e,h,!1,c),hz(this.listens_,f)===g)&&d(a?401===a?"permission_denied":"rest_error:"+a:"ok",null)})}unlisten(a,b){let c=ky.getListenId_(a,b);delete this.listens_[c]}get(a){let b=kw(a._queryParams),c=a._path.toString(),d=new hi;return this.restRequest_(c+".json",b,(a,b)=>{let e=b;404===a&&(e=null,a=null),null===a?(this.onDataUpdate_(c,e,!1,null),d.resolve(e)):d.reject(Error(e))}),d.promise}refreshAuthToken(a){}restRequest_(a,b={},c){return b.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([d,e])=>{d&&d.accessToken&&(b.auth=d.accessToken),e&&e.token&&(b.ac=e.token);let f=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+a+"?ns="+this.repoInfo_.namespace+hE(b);this.log_("Sending REST request for "+f);let g=new XMLHttpRequest;g.onreadystatechange=()=>{if(c&&4===g.readyState){this.log_("REST Response for "+f+" received. status:",g.status,"response:",g.responseText);let a=null;if(g.status>=200&&g.status<300){try{a=ht(g.responseText)}catch(a){i6("Failed to parse JSON response for "+f+": "+g.responseText)}c(null,a)}else 401!==g.status&&404!==g.status&&i6("Got unsuccessful REST response for "+f+" Status: "+g.status),c(g.status);c=null}},g.open("GET",f,!0),g.send()})}}class kz{constructor(){this.rootNode_=kj.EMPTY_NODE}getNode(a){return this.rootNode_.getChild(a)}updateSnapshot(a,b){this.rootNode_=this.rootNode_.updateChild(a,b)}}function kA(){return{value:null,children:new Map}}function kB(a,b,c){var d,e;null!==a.value?c(b,a.value):(d=a,e=(a,d)=>{kB(d,new jK(b.toString()+"/"+a),c)},d.children.forEach((a,b)=>{e(b,a)}))}class kC{constructor(a){this.collection_=a,this.last_=null}get(){let a=this.collection_.get(),b={...a};return this.last_&&jh(this.last_,(a,c)=>{b[a]=b[a]-c}),this.last_=a,b}}class kD{constructor(a,b){this.server_=b,this.statsToReport_={},this.statsListener_=new kC(a);const c=1e4+2e4*Math.random();jm(this.reportStats_.bind(this),Math.floor(c))}reportStats_(){let a=this.statsListener_.get(),b={},c=!1;jh(a,(a,d)=>{d>0&&hy(this.statsToReport_,a)&&(b[a]=d,c=!0)}),c&&this.server_.reportStats(b),jm(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function kE(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function kF(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function kG(a){return{fromUser:!1,fromServer:!0,queryId:a,tagged:!0}}(C=J||(J={}))[C.OVERWRITE=0]="OVERWRITE",C[C.MERGE=1]="MERGE",C[C.ACK_USER_WRITE=2]="ACK_USER_WRITE",C[C.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class kH{constructor(a,b,c){this.path=a,this.affectedTree=b,this.revert=c,this.type=J.ACK_USER_WRITE,this.source=kE()}operationForChild(a){if(!jT(this.path))return g6(jM(this.path)===a,"operationForChild called for unrelated child."),new kH(jO(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return g6(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let b=this.affectedTree.subtree(new jK(a));return new kH(jL(),b,this.revert)}}}class kI{constructor(a,b){this.source=a,this.path=b,this.type=J.LISTEN_COMPLETE}operationForChild(a){return jT(this.path)?new kI(this.source,jL()):new kI(this.source,jO(this.path))}}class kJ{constructor(a,b,c){this.source=a,this.path=b,this.snap=c,this.type=J.OVERWRITE}operationForChild(a){return jT(this.path)?new kJ(this.source,jL(),this.snap.getImmediateChild(a)):new kJ(this.source,jO(this.path),this.snap)}}class kK{constructor(a,b,c){this.source=a,this.path=b,this.children=c,this.type=J.MERGE}operationForChild(a){if(!jT(this.path))return g6(jM(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new kK(this.source,jO(this.path),this.children);{let b=this.children.subtree(new jK(a));return b.isEmpty()?null:b.value?new kJ(this.source,jL(),b.value):new kK(this.source,jL(),b)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class kL{constructor(a,b,c){this.node_=a,this.fullyInitialized_=b,this.filtered_=c}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(a){if(jT(a))return this.isFullyInitialized()&&!this.filtered_;let b=jM(a);return this.isCompleteForChild(b)}isCompleteForChild(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)}getNode(){return this.node_}}class kM{constructor(a){this.query_=a,this.index_=this.query_._queryParams.getIndex()}}function kN(a,b,c,d,e,f){let g=d.filter(a=>a.type===c);g.sort((b,c)=>(function(a,b,c){if(null==b.childName||null==c.childName)throw g7("Should only compare child_ events.");let d=new j1(b.childName,b.snapshotNode),e=new j1(c.childName,c.snapshotNode);return a.index_.compare(d,e)})(a,b,c)),g.forEach(c=>{var d,g,h;let i=(d=a,g=c,h=f,"value"===g.type||"child_removed"===g.type||(g.prevName=h.getPredecessorChildName(g.childName,g.snapshotNode,d.index_)),g);e.forEach(d=>{d.respondsTo(c.type)&&b.push(d.createEvent(i,a.query_))})})}function kO(a,b){return{eventCache:a,serverCache:b}}function kP(a,b,c,d){return kO(new kL(b,c,d),a.serverCache)}function kQ(a,b,c,d){return kO(a.eventCache,new kL(b,c,d))}function kR(a){return a.eventCache.isFullyInitialized()?a.eventCache.getNode():null}function kS(a){return a.serverCache.isFullyInitialized()?a.serverCache.getNode():null}class kT{static fromObject(a){let b=new kT(null);return jh(a,(a,c)=>{b=b.set(new jK(a),c)}),b}constructor(a,b=(!n&&(n=new j7(jd)),n)){this.value=a,this.children=b}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(a,b){if(null!=this.value&&b(this.value))return{path:jL(),value:this.value};{if(jT(a))return null;let c=jM(a),d=this.children.get(c);if(null===d)return null;{let e=d.findRootMostMatchingPathAndValue(jO(a),b);return null!=e?{path:jS(new jK(c),e.path),value:e.value}:null}}}findRootMostValueAndPath(a){return this.findRootMostMatchingPathAndValue(a,()=>!0)}subtree(a){if(jT(a))return this;{let b=jM(a),c=this.children.get(b);return null!==c?c.subtree(jO(a)):new kT(null)}}set(a,b){if(jT(a))return new kT(b,this.children);{let c=jM(a),d=(this.children.get(c)||new kT(null)).set(jO(a),b),e=this.children.insert(c,d);return new kT(this.value,e)}}remove(a){if(jT(a))if(this.children.isEmpty())return new kT(null);else return new kT(null,this.children);{let b=jM(a),c=this.children.get(b);if(!c)return this;{let d,e=c.remove(jO(a));return(d=e.isEmpty()?this.children.remove(b):this.children.insert(b,e),null===this.value&&d.isEmpty())?new kT(null):new kT(this.value,d)}}}get(a){if(jT(a))return this.value;{let b=jM(a),c=this.children.get(b);return c?c.get(jO(a)):null}}setTree(a,b){if(jT(a))return b;{let c,d=jM(a),e=(this.children.get(d)||new kT(null)).setTree(jO(a),b);return c=e.isEmpty()?this.children.remove(d):this.children.insert(d,e),new kT(this.value,c)}}fold(a){return this.fold_(jL(),a)}fold_(a,b){let c={};return this.children.inorderTraversal((d,e)=>{c[d]=e.fold_(jS(a,d),b)}),b(a,this.value,c)}findOnPath(a,b){return this.findOnPath_(a,jL(),b)}findOnPath_(a,b,c){let d=!!this.value&&c(b,this.value);if(d)return d;{if(jT(a))return null;let d=jM(a),e=this.children.get(d);return e?e.findOnPath_(jO(a),jS(b,d),c):null}}foreachOnPath(a,b){return this.foreachOnPath_(a,jL(),b)}foreachOnPath_(a,b,c){if(jT(a))return this;{this.value&&c(b,this.value);let d=jM(a),e=this.children.get(d);return e?e.foreachOnPath_(jO(a),jS(b,d),c):new kT(null)}}foreach(a){this.foreach_(jL(),a)}foreach_(a,b){this.children.inorderTraversal((c,d)=>{d.foreach_(jS(a,c),b)}),this.value&&b(a,this.value)}foreachChild(a){this.children.inorderTraversal((b,c)=>{c.value&&a(b,c.value)})}}class kU{constructor(a){this.writeTree_=a}static empty(){return new kU(new kT(null))}}function kV(a,b,c){if(jT(b))return new kU(new kT(c));{let d=a.writeTree_.findRootMostValueAndPath(b);if(null!=d){let e=d.path,f=d.value,g=jU(e,b);return f=f.updateChild(g,c),new kU(a.writeTree_.set(e,f))}{let d=new kT(c);return new kU(a.writeTree_.setTree(b,d))}}}function kW(a,b,c){let d=a;return jh(c,(a,c)=>{d=kV(d,jS(b,a),c)}),d}function kX(a,b){return jT(b)?kU.empty():new kU(a.writeTree_.setTree(b,new kT(null)))}function kY(a,b){return null!=kZ(a,b)}function kZ(a,b){let c=a.writeTree_.findRootMostValueAndPath(b);return null!=c?a.writeTree_.get(c.path).getChild(jU(c.path,b)):null}function k$(a){let b=[],c=a.writeTree_.value;return null!=c?c.isLeafNode()||c.forEachChild(kd,(a,c)=>{b.push(new j1(a,c))}):a.writeTree_.children.inorderTraversal((a,c)=>{null!=c.value&&b.push(new j1(a,c.value))}),b}function k_(a,b){if(jT(b))return a;{let c=kZ(a,b);return new kU(null!=c?new kT(c):a.writeTree_.subtree(b))}}function k0(a){return a.writeTree_.isEmpty()}function k1(a,b){return function a(b,c,d){if(null!=c.value)return d.updateChild(b,c.value);{let e=null;return c.children.inorderTraversal((c,f)=>{".priority"===c?(g6(null!==f.value,"Priority writes must always be leaf nodes"),e=f.value):d=a(jS(b,c),f,d)}),d.getChild(b).isEmpty()||null===e||(d=d.updateChild(jS(b,".priority"),e)),d}}(jL(),a.writeTree_,b)}function k2(a){return a.visible}function k3(a,b,c){let d=kU.empty();for(let e=0;e<a.length;++e){let f=a[e];if(b(f)){let a,b=f.path;if(f.snap)jX(c,b)?d=kV(d,a=jU(c,b),f.snap):jX(b,c)&&(a=jU(b,c),d=kV(d,jL(),f.snap.getChild(a)));else if(f.children){if(jX(c,b))d=kW(d,a=jU(c,b),f.children);else if(jX(b,c))if(jT(a=jU(b,c)))d=kW(d,jL(),f.children);else{let b=hz(f.children,jM(a));if(b){let c=b.getChild(jO(a));d=kV(d,jL(),c)}}}else throw g7("WriteRecord should have .snap or .children")}}return d}function k4(a,b,c,d,e){if(d||e){let f=k_(a.visibleWrites,b);return!e&&k0(f)?c:e||null!=c||kY(f,jL())?k1(k3(a.allWrites,function(a){return(a.visible||e)&&(!d||!~d.indexOf(a.writeId))&&(jX(a.path,b)||jX(b,a.path))},b),c||kj.EMPTY_NODE):null}{let d=kZ(a.visibleWrites,b);if(null!=d)return d;{let d=k_(a.visibleWrites,b);return k0(d)?c:null!=c||kY(d,jL())?k1(d,c||kj.EMPTY_NODE):null}}}function k5(a,b,c,d){return k4(a.writeTree,a.treePath,b,c,d)}function k6(a,b){return function(a,b,c){let d=kj.EMPTY_NODE,e=kZ(a.visibleWrites,b);if(e)return e.isLeafNode()||e.forEachChild(kd,(a,b)=>{d=d.updateImmediateChild(a,b)}),d;if(!c)return k$(k_(a.visibleWrites,b)).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d;{let e=k_(a.visibleWrites,b);return c.forEachChild(kd,(a,b)=>{let c=k1(k_(e,new jK(a)),b);d=d.updateImmediateChild(a,c)}),k$(e).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d}}(a.writeTree,a.treePath,b)}function k7(a,b,c,d){return function(a,b,c,d,e){g6(d||e,"Either existingEventSnap or existingServerSnap must exist");let f=jS(b,c);if(kY(a.visibleWrites,f))return null;{let b=k_(a.visibleWrites,f);return k0(b)?e.getChild(c):k1(b,e.getChild(c))}}(a.writeTree,a.treePath,b,c,d)}function k8(a,b){var c,d;return c=a.writeTree,d=jS(a.treePath,b),kZ(c.visibleWrites,d)}function k9(a,b,c){var d,e;let f,g;return d=a.writeTree,e=a.treePath,f=jS(e,b),null!=(g=kZ(d.visibleWrites,f))?g:c.isCompleteForChild(b)?k1(k_(d.visibleWrites,f),c.getNode().getImmediateChild(b)):null}function la(a,b){return lb(jS(a.treePath,b),a.writeTree)}function lb(a,b){return{treePath:a,writeTree:b}}class lc{constructor(){this.changeMap=new Map}trackChildChange(a){let b=a.type,c=a.childName;g6("child_added"===b||"child_changed"===b||"child_removed"===b,"Only child changes supported for tracking"),g6(".priority"!==c,"Only non-priority child changes can be tracked.");let d=this.changeMap.get(c);if(d){let e=d.type;if("child_added"===b&&"child_removed"===e)this.changeMap.set(c,kr(c,a.snapshotNode,d.snapshotNode));else if("child_removed"===b&&"child_added"===e)this.changeMap.delete(c);else if("child_removed"===b&&"child_changed"===e)this.changeMap.set(c,kq(c,d.oldSnap));else if("child_changed"===b&&"child_added"===e)this.changeMap.set(c,kp(c,a.snapshotNode));else if("child_changed"===b&&"child_changed"===e)this.changeMap.set(c,kr(c,a.snapshotNode,d.oldSnap));else throw g7("Illegal combination of changes: "+a+" occurred after "+d)}else this.changeMap.set(c,a)}getChanges(){return Array.from(this.changeMap.values())}}let ld=new class{getCompleteChild(a){return null}getChildAfterChild(a,b,c){return null}};class le{constructor(a,b,c=null){this.writes_=a,this.viewCache_=b,this.optCompleteServerCache_=c}getCompleteChild(a){let b=this.viewCache_.eventCache;if(b.isCompleteForChild(a))return b.getNode().getImmediateChild(a);{let b=null!=this.optCompleteServerCache_?new kL(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return k9(this.writes_,a,b)}}getChildAfterChild(a,b,c){var d;let e=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:kS(this.viewCache_),f=(d=this.writes_,function(a,b,c,d,e,f,g){let h,i=k_(a.visibleWrites,b),j=kZ(i,jL());if(null!=j)h=j;else{if(null==c)return[];h=k1(i,c)}if((h=h.withIndex(g)).isEmpty()||h.isLeafNode())return[];{let a=[],b=g.getCompare(),c=f?h.getReverseIteratorFrom(d,g):h.getIteratorFrom(d,g),e=c.getNext();for(;e&&a.length<1;)0!==b(e,d)&&a.push(e),e=c.getNext();return a}}(d.writeTree,d.treePath,e,b,1,c,a));return 0===f.length?null:f[0]}}function lf(a,b,c,d,e,f){let g=b.eventCache;if(null!=k8(d,c))return b;{let h,i;if(jT(c))if(g6(b.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),b.serverCache.isFiltered()){let c=kS(b),e=k6(d,c instanceof kj?c:kj.EMPTY_NODE);h=a.filter.updateFullNode(b.eventCache.getNode(),e,f)}else{let c=k5(d,kS(b));h=a.filter.updateFullNode(b.eventCache.getNode(),c,f)}else{let j=jM(c);if(".priority"===j){g6(1===jN(c),"Can't have a priority with additional path components");let e=g.getNode(),f=k7(d,c,e,i=b.serverCache.getNode());h=null!=f?a.filter.updatePriority(e,f):g.getNode()}else{let k,l=jO(c);if(g.isCompleteForChild(j)){i=b.serverCache.getNode();let a=k7(d,c,g.getNode(),i);k=null!=a?g.getNode().getImmediateChild(j).updateChild(l,a):g.getNode().getImmediateChild(j)}else k=k9(d,j,b.serverCache);h=null!=k?a.filter.updateChild(g.getNode(),j,k,l,e,f):g.getNode()}}return kP(b,h,g.isFullyInitialized()||jT(c),a.filter.filtersNodes())}}function lg(a,b,c,d,e,f,g,h){let i,j=b.serverCache,k=g?a.filter:a.filter.getIndexedFilter();if(jT(c))i=k.updateFullNode(j.getNode(),d,null);else if(k.filtersNodes()&&!j.isFiltered()){let a=j.getNode().updateChild(c,d);i=k.updateFullNode(j.getNode(),a,null)}else{let a=jM(c);if(!j.isCompleteForPath(c)&&jN(c)>1)return b;let e=jO(c),f=j.getNode().getImmediateChild(a).updateChild(e,d);i=".priority"===a?k.updatePriority(j.getNode(),f):k.updateChild(j.getNode(),a,f,e,ld,null)}let l=kQ(b,i,j.isFullyInitialized()||jT(c),k.filtersNodes()),m=new le(e,l,f);return lf(a,l,c,e,m,h)}function lh(a,b,c,d,e,f,g){let h,i,j=b.eventCache,k=new le(e,b,f);if(jT(c))i=a.filter.updateFullNode(b.eventCache.getNode(),d,g),h=kP(b,i,!0,a.filter.filtersNodes());else{let e=jM(c);if(".priority"===e)i=a.filter.updatePriority(b.eventCache.getNode(),d),h=kP(b,i,j.isFullyInitialized(),j.isFiltered());else{let f,i=jO(c),l=j.getNode().getImmediateChild(e);if(jT(i))f=d;else{let a=k.getCompleteChild(e);f=null!=a?".priority"===jP(i)&&a.getChild(jR(i)).isEmpty()?a:a.updateChild(i,d):kj.EMPTY_NODE}h=l.equals(f)?b:kP(b,a.filter.updateChild(j.getNode(),e,f,i,k,g),j.isFullyInitialized(),a.filter.filtersNodes())}}return h}function li(a,b){return a.eventCache.isCompleteForChild(b)}function lj(a,b,c){return c.foreach((a,c)=>{b=b.updateChild(a,c)}),b}function lk(a,b,c,d,e,f,g,h){let i;if(b.serverCache.getNode().isEmpty()&&!b.serverCache.isFullyInitialized())return b;let j=b;i=jT(c)?d:new kT(null).setTree(c,d);let k=b.serverCache.getNode();return i.children.inorderTraversal((c,d)=>{if(k.hasChild(c)){let i=lj(a,b.serverCache.getNode().getImmediateChild(c),d);j=lg(a,j,new jK(c),i,e,f,g,h)}}),i.children.inorderTraversal((c,d)=>{let i=!b.serverCache.isCompleteForChild(c)&&null===d.value;if(!k.hasChild(c)&&!i){let i=lj(a,b.serverCache.getNode().getImmediateChild(c),d);j=lg(a,j,new jK(c),i,e,f,g,h)}}),j}class ll{constructor(a,b){this.query_=a,this.eventRegistrations_=[];const c=this.query_._queryParams,d=new ks(c.getIndex()),e=function(a){return a.loadsAllData()?new ks(a.getIndex()):a.hasLimit()?new ku(a):new kt(a)}(c);this.processor_=function(a){return{filter:a}}(e);const f=b.serverCache,g=b.eventCache,h=d.updateFullNode(kj.EMPTY_NODE,f.getNode(),null),i=e.updateFullNode(kj.EMPTY_NODE,g.getNode(),null),j=new kL(h,f.isFullyInitialized(),d.filtersNodes()),k=new kL(i,g.isFullyInitialized(),e.filtersNodes());this.viewCache_=kO(k,j),this.eventGenerator_=new kM(this.query_)}get query(){return this.query_}}function lm(a){return 0===a.eventRegistrations_.length}function ln(a,b,c){let d=[];if(c){g6(null==b,"A cancel should cancel all event registrations.");let e=a.query._path;a.eventRegistrations_.forEach(a=>{let b=a.createCancelEvent(c,e);b&&d.push(b)})}if(b){let c=[];for(let d=0;d<a.eventRegistrations_.length;++d){let e=a.eventRegistrations_[d];if(e.matches(b)){if(b.hasAnyCallback()){c=c.concat(a.eventRegistrations_.slice(d+1));break}}else c.push(e)}a.eventRegistrations_=c}else a.eventRegistrations_=[];return d}function lo(a,b,c,d){var e,f;b.type===J.MERGE&&null!==b.source.queryId&&(g6(kS(a.viewCache_),"We should always have a full cache before handling merges"),g6(kR(a.viewCache_),"Missing event cache, even though we have a server cache"));let g=a.viewCache_,h=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;let r,s,t=new lc;if(c.type===J.OVERWRITE)c.source.fromUser?r=lh(a,b,c.path,c.snap,d,e,t):(g6(c.source.fromServer,"Unknown source."),s=c.source.tagged||b.serverCache.isFiltered()&&!jT(c.path),r=lg(a,b,c.path,c.snap,d,e,s,t));else if(c.type===J.MERGE){let m;c.source.fromUser?(f=a,g=b,h=c.path,i=c.children,j=d,k=e,l=t,m=g,i.foreach((a,b)=>{let c=jS(h,a);li(g,jM(c))&&(m=lh(f,m,c,b,j,k,l))}),i.foreach((a,b)=>{let c=jS(h,a);li(g,jM(c))||(m=lh(f,m,c,b,j,k,l))}),r=m):(g6(c.source.fromServer,"Unknown source."),s=c.source.tagged||b.serverCache.isFiltered(),r=lk(a,b,c.path,c.children,d,e,s,t))}else if(c.type===J.ACK_USER_WRITE)r=c.revert?function(a,b,c,d,e,f){let g;if(null!=k8(d,c))return b;{let h,i=new le(d,b,e),j=b.eventCache.getNode();if(jT(c)||".priority"===jM(c)){let c;if(b.serverCache.isFullyInitialized())c=k5(d,kS(b));else{let a=b.serverCache.getNode();g6(a instanceof kj,"serverChildren would be complete if leaf node"),c=k6(d,a)}h=a.filter.updateFullNode(j,c,f)}else{let e=jM(c),k=k9(d,e,b.serverCache);null==k&&b.serverCache.isCompleteForChild(e)&&(k=j.getImmediateChild(e)),(h=null!=k?a.filter.updateChild(j,e,k,jO(c),i,f):b.eventCache.getNode().hasChild(e)?a.filter.updateChild(j,e,kj.EMPTY_NODE,jO(c),i,f):j).isEmpty()&&b.serverCache.isFullyInitialized()&&(g=k5(d,kS(b))).isLeafNode()&&(h=a.filter.updateFullNode(h,g,f))}return g=b.serverCache.isFullyInitialized()||null!=k8(d,jL()),kP(b,h,g,a.filter.filtersNodes())}}(a,b,c.path,d,e,t):function(a,b,c,d,e,f,g){if(null!=k8(e,c))return b;let h=b.serverCache.isFiltered(),i=b.serverCache;if(null!=d.value)if(jT(c)&&i.isFullyInitialized()||i.isCompleteForPath(c))return lg(a,b,c,i.getNode().getChild(c),e,f,h,g);else{if(!jT(c))return b;let d=new kT(null);return i.getNode().forEachChild(j4,(a,b)=>{d=d.set(new jK(a),b)}),lk(a,b,c,d,e,f,h,g)}{let j=new kT(null);return d.foreach((a,b)=>{let d=jS(c,a);i.isCompleteForPath(d)&&(j=j.set(a,i.getNode().getChild(d)))}),lk(a,b,c,j,e,f,h,g)}}(a,b,c.path,c.affectedTree,d,e,t);else if(c.type===J.LISTEN_COMPLETE){let e;m=a,n=b,o=c.path,p=d,q=t,e=n.serverCache,r=lf(m,kQ(n,e.getNode(),e.isFullyInitialized()||jT(o),e.isFiltered()),o,p,ld,q)}else throw g7("Unknown operation type: "+c.type);let u=t.getChanges();return function(a,b,c){let d=b.eventCache;if(d.isFullyInitialized()){let e=d.getNode().isLeafNode()||d.getNode().isEmpty(),f=kR(a);!(c.length>0)&&a.eventCache.isFullyInitialized()&&(!e||d.getNode().equals(f))&&d.getNode().getPriority().equals(f.getPriority())||c.push(ko(kR(b)))}}(b,r,u),{viewCache:r,changes:u}}(a.processor_,g,b,c,d);return e=a.processor_,g6((f=h.viewCache).eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),g6(f.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed"),g6(h.viewCache.serverCache.isFullyInitialized()||!g.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),a.viewCache_=h.viewCache,lp(a,h.changes,h.viewCache.eventCache.getNode(),null)}function lp(a,b,c,d){var e;let f,g,h=d?[d]:a.eventRegistrations_;return e=a.eventGenerator_,f=[],g=[],b.forEach(a=>{var b;"child_changed"===a.type&&e.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&g.push((b=a.childName,{type:"child_moved",snapshotNode:a.snapshotNode,childName:b}))}),kN(e,f,"child_removed",b,h,c),kN(e,f,"child_added",b,h,c),kN(e,f,"child_moved",g,h,c),kN(e,f,"child_changed",b,h,c),kN(e,f,"value",b,h,c),f}class lq{constructor(){this.views=new Map}}function lr(a,b,c,d){let e=b.source.queryId;if(null!==e){let f=a.views.get(e);return g6(null!=f,"SyncTree gave us an op for an invalid query."),lo(f,b,c,d)}{let e=[];for(let f of a.views.values())e=e.concat(lo(f,b,c,d));return e}}function ls(a,b,c,d,e){let f=b._queryIdentifier,g=a.views.get(f);if(!g){let a=k5(c,e?d:null),f=!1;return a?f=!0:(a=d instanceof kj?k6(c,d):kj.EMPTY_NODE,f=!1),new ll(b,kO(new kL(a,f,!1),new kL(d,e,!1)))}return g}function lt(a){let b=[];for(let c of a.views.values())c.query._queryParams.loadsAllData()||b.push(c);return b}function lu(a,b){let c=null;for(let d of a.views.values())c=c||function(a,b){let c=kS(a.viewCache_);return c&&(a.query._queryParams.loadsAllData()||!jT(b)&&!c.getImmediateChild(jM(b)).isEmpty())?c.getChild(b):null}(d,b);return c}function lv(a,b){if(b._queryParams.loadsAllData())return lx(a);{let c=b._queryIdentifier;return a.views.get(c)}}function lw(a){return null!=lx(a)}function lx(a){for(let b of a.views.values())if(b.query._queryParams.loadsAllData())return b;return null}let ly=1;class lz{constructor(a){this.listenProvider_=a,this.syncPointTree_=new kT(null),this.pendingWriteTree_={visibleWrites:kU.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function lA(a,b,c,d,e){var f,g;return(f=a.pendingWriteTree_,g=e,g6(d>f.lastWriteId,"Stacking an older write on top of newer ones"),void 0===g&&(g=!0),f.allWrites.push({path:b,snap:c,writeId:d,visible:g}),g&&(f.visibleWrites=kV(f.visibleWrites,b,c)),f.lastWriteId=d,e)?lG(a,new kJ(kE(),b,c)):[]}function lB(a,b,c=!1){let d=function(a,b){for(let c=0;c<a.allWrites.length;c++){let d=a.allWrites[c];if(d.writeId===b)return d}return null}(a.pendingWriteTree_,b);if(!function(a,b){var c;let d=a.allWrites.findIndex(a=>a.writeId===b);g6(d>=0,"removeWrite called with nonexistent writeId.");let e=a.allWrites[d];a.allWrites.splice(d,1);let f=e.visible,g=!1,h=a.allWrites.length-1;for(;f&&h>=0;){let b=a.allWrites[h];b.visible&&(h>=d&&function(a,b){if(a.snap)return jX(a.path,b);for(let c in a.children)if(a.children.hasOwnProperty(c)&&jX(jS(a.path,c),b))return!0;return!1}(b,e.path)?f=!1:jX(e.path,b.path)&&(g=!0)),h--}return!!f&&(g?((c=a).visibleWrites=k3(c.allWrites,k2,jL()),c.allWrites.length>0?c.lastWriteId=c.allWrites[c.allWrites.length-1].writeId:c.lastWriteId=-1):e.snap?a.visibleWrites=kX(a.visibleWrites,e.path):jh(e.children,b=>{a.visibleWrites=kX(a.visibleWrites,jS(e.path,b))}),!0)}(a.pendingWriteTree_,b))return[];{let b=new kT(null);return null!=d.snap?b=b.set(jL(),!0):jh(d.children,a=>{b=b.set(new jK(a),!0)}),lG(a,new kH(d.path,b,c))}}function lC(a,b,c){return lG(a,new kJ(kF(),b,c))}function lD(a,b,c,d,e=!1){let f=b._path,g=a.syncPointTree_.get(f),h=[];if(g&&("default"===b._queryIdentifier||null!=lv(g,b))){let k=function(a,b,c,d){let e=b._queryIdentifier,f=[],g=[],h=lw(a);if("default"===e)for(let[b,e]of a.views.entries())g=g.concat(ln(e,c,d)),lm(e)&&(a.views.delete(b),e.query._queryParams.loadsAllData()||f.push(e.query));else{let b=a.views.get(e);b&&(g=g.concat(ln(b,c,d)),lm(b)&&(a.views.delete(e),b.query._queryParams.loadsAllData()||f.push(b.query)))}return h&&!lw(a)&&f.push(new(g6(o,"Reference.ts has not been loaded"),o)(b._repo,b._path)),{removed:f,events:g}}(g,b,c,d);0===g.views.size&&(a.syncPointTree_=a.syncPointTree_.remove(f));let l=k.removed;if(h=k.events,!e){let c=-1!==l.findIndex(a=>a._queryParams.loadsAllData()),e=a.syncPointTree_.findOnPath(f,(a,b)=>lw(b));if(c&&!e){let b=a.syncPointTree_.subtree(f);if(!b.isEmpty()){let c=b.fold((a,b,c)=>{if(b&&lw(b))return[lx(b)];{let a=[];return b&&(a=lt(b)),jh(c,(b,c)=>{a=a.concat(c)}),a}});for(let b=0;b<c.length;++b){let d=c[b],e=d.query,f=lH(a,d);a.listenProvider_.startListening(lN(e),lI(a,e),f.hashFn,f.onComplete)}}}e||!(l.length>0)||d||(c?a.listenProvider_.stopListening(lN(b),null):l.forEach(b=>{let c=a.queryToTagMap.get(lJ(b));a.listenProvider_.stopListening(lN(b),c)}))}var i=a,j=l;for(let a=0;a<j.length;++a){let b=j[a];if(!b._queryParams.loadsAllData()){let a=lJ(b),c=i.queryToTagMap.get(a);i.queryToTagMap.delete(a),i.tagToQueryMap.delete(c)}}}return h}function lE(a,b,c,d){let e=lK(a,d);if(null==e)return[];{let d=lL(e),f=d.path,g=d.queryId,h=jU(f,b);return lM(a,f,new kJ(kG(g),h,c))}}function lF(a,b,c){let d=a.pendingWriteTree_,e=a.syncPointTree_.findOnPath(b,(a,c)=>{let d=lu(c,jU(a,b));if(d)return d});return k4(d,b,e,c,!0)}function lG(a,b){var c;return function a(b,c,d,e){if(jT(b.path))return function a(b,c,d,e){let f=c.get(jL());null==d&&null!=f&&(d=lu(f,jL()));let g=[];return c.children.inorderTraversal((c,f)=>{let h=d?d.getImmediateChild(c):null,i=la(e,c),j=b.operationForChild(c);j&&(g=g.concat(a(j,f,h,i)))}),f&&(g=g.concat(lr(f,b,e,d))),g}(b,c,d,e);{let f=c.get(jL());null==d&&null!=f&&(d=lu(f,jL()));let g=[],h=jM(b.path),i=b.operationForChild(h),j=c.children.get(h);if(j&&i){let b=d?d.getImmediateChild(h):null,c=la(e,h);g=g.concat(a(i,j,b,c))}return f&&(g=g.concat(lr(f,b,e,d))),g}}(b,a.syncPointTree_,null,(c=a.pendingWriteTree_,lb(jL(),c)))}function lH(a,b){let c=b.query,d=lI(a,c);return{hashFn:()=>(b.viewCache_.serverCache.getNode()||kj.EMPTY_NODE).hash(),onComplete:b=>{var e;if("ok"===b)if(d)return function(a,b,c){let d=lK(a,c);if(!d)return[];{let c=lL(d),e=c.path,f=c.queryId,g=jU(e,b);return lM(a,e,new kI(kG(f),g))}}(a,c._path,d);else return e=c._path,lG(a,new kI(kF(),e));{let d,e,f=(d="Unknown Error","too_big"===b?d="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===b?d="Client doesn't have permission to access the desired data.":"unavailable"===b&&(d="The service is unavailable"),(e=Error(b+" at "+c._path.toString()+": "+d)).code=b.toUpperCase(),e);return lD(a,c,null,f)}}}}function lI(a,b){let c=lJ(b);return a.queryToTagMap.get(c)}function lJ(a){return a._path.toString()+"$"+a._queryIdentifier}function lK(a,b){return a.tagToQueryMap.get(b)}function lL(a){let b=a.indexOf("$");return g6(-1!==b&&b<a.length-1,"Bad queryKey."),{queryId:a.substr(b+1),path:new jK(a.substr(0,b))}}function lM(a,b,c){let d=a.syncPointTree_.get(b);return g6(d,"Missing sync point for query tag that we're tracking"),lr(d,c,lb(b,a.pendingWriteTree_),null)}function lN(a){return a._queryParams.loadsAllData()&&!a._queryParams.isDefault()?new(g6(p,"Reference.ts has not been loaded"),p)(a._repo,a._path):a}class lO{constructor(a){this.node_=a}getImmediateChild(a){return new lO(this.node_.getImmediateChild(a))}node(){return this.node_}}class lP{constructor(a,b){this.syncTree_=a,this.path_=b}getImmediateChild(a){let b=jS(this.path_,a);return new lP(this.syncTree_,b)}node(){return lF(this.syncTree_,this.path_)}}let lQ=function(a,b,c){return a&&"object"==typeof a?(g6(".sv"in a,"Unexpected leaf node or priority contents"),"string"==typeof a[".sv"])?lR(a[".sv"],b,c):"object"==typeof a[".sv"]?lS(a[".sv"],b):void g6(!1,"Unexpected server value: "+JSON.stringify(a,null,2)):a},lR=function(a,b,c){if("timestamp"===a)return c.timestamp;g6(!1,"Unexpected server value: "+a)},lS=function(a,b,c){a.hasOwnProperty("increment")||g6(!1,"Unexpected server value: "+JSON.stringify(a,null,2));let d=a.increment;"number"!=typeof d&&g6(!1,"Unexpected increment value: "+d);let e=b.node();if(g6(null!=e,"Expected ChildrenNode.EMPTY_NODE for nulls"),!e.isLeafNode())return d;let f=e.getValue();return"number"!=typeof f?d:f+d},lT=function(a,b,c,d){return lV(b,new lP(c,a),d)},lU=function(a,b,c){return lV(a,new lO(b),c)};function lV(a,b,c){let d,e=lQ(a.getPriority().val(),b.getImmediateChild(".priority"),c);if(!a.isLeafNode())return d=a,e!==a.getPriority().val()&&(d=d.updatePriority(new kc(e))),a.forEachChild(kd,(a,e)=>{let f=lV(e,b.getImmediateChild(a),c);f!==e&&(d=d.updateImmediateChild(a,f))}),d;{let d=lQ(a.getValue(),b,c);return d!==a.getValue()||e!==a.getPriority().val()?new kc(d,kl(e)):a}}class lW{constructor(a="",b=null,c={children:{},childCount:0}){this.name=a,this.parent=b,this.node=c}}function lX(a,b){let c=b instanceof jK?b:new jK(b),d=a,e=jM(c);for(;null!==e;){let a=hz(d.node.children,e)||{children:{},childCount:0};d=new lW(e,d,a),e=jM(c=jO(c))}return d}function lY(a){return a.node.value}function lZ(a,b){a.node.value=b,function a(b){null!==b.parent&&function(b,c,d){let e=void 0===lY(d)&&!l$(d),f=hy(b.node.children,c);e&&f?(delete b.node.children[c],b.node.childCount--,a(b)):e||f||(b.node.children[c]=d.node,b.node.childCount++,a(b))}(b.parent,b.name,b)}(a)}function l$(a){return a.node.childCount>0}function l_(a,b){jh(a.node.children,(c,d)=>{b(new lW(c,a,d))})}function l0(a){return new jK(null===a.parent?a.name:l0(a.parent)+"/"+a.name)}let l1=/[\[\].#$\/\u0000-\u001F\u007F]/,l2=/[\[\].#$\u0000-\u001F\u007F]/,l3=function(a){return"string"==typeof a&&0!==a.length&&!l1.test(a)},l4=function(a){return"string"==typeof a&&0!==a.length&&!l2.test(a)},l5=function(a,b,c,d){d&&void 0===b||l6(hK(a,"value"),b,c)},l6=function(a,b,c){let d=c instanceof jK?new jY(c,a):c;if(void 0===b)throw Error(a+"contains undefined "+j$(d));if("function"==typeof b)throw Error(a+"contains a function "+j$(d)+" with contents = "+b.toString());if(i8(b))throw Error(a+"contains "+b.toString()+" "+j$(d));if("string"==typeof b&&b.length>3495253.3333333335&&hM(b)>0xa00000)throw Error(a+"contains a string greater than 10485760 utf8 bytes "+j$(d)+" ('"+b.substring(0,50)+"...')");if(b&&"object"==typeof b){let c=!1,e=!1;if(jh(b,(b,f)=>{let g;if(".value"===b)c=!0;else if(".priority"!==b&&".sv"!==b&&(e=!0,!l3(b)))throw Error(a+" contains an invalid key ("+b+") "+j$(d)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');d.parts_.length>0&&(d.byteLength_+=1),d.parts_.push(b),d.byteLength_+=hM(b),jZ(d),l6(a,f,d),g=d.parts_.pop(),d.byteLength_-=hM(g),d.parts_.length>0&&(d.byteLength_-=1)}),c&&e)throw Error(a+' contains ".value" child '+j$(d)+" in addition to actual children.")}},l7=function(a,b){let c,d;for(c=0;c<b.length;c++){let e=jQ(d=b[c]);for(let b=0;b<e.length;b++)if(".priority"===e[b]&&b===e.length-1);else if(!l3(e[b]))throw Error(a+"contains an invalid key ("+e[b]+") in path "+d.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}b.sort(jV);let e=null;for(c=0;c<b.length;c++){if(d=b[c],null!==e&&jX(e,d))throw Error(a+"contains a path "+e.toString()+" that is ancestor of another path "+d.toString());e=d}},l8=function(a,b,c,d){if(d&&void 0===b)return;let e=hK(a,"values");if(!(b&&"object"==typeof b)||Array.isArray(b))throw Error(e+" must be an object containing the children to replace.");let f=[];jh(b,(a,b)=>{let d=new jK(a);if(l6(e,b,jS(c,d)),".priority"===jP(d)&&!(null===b||"string"==typeof b||"number"==typeof b&&!i8(b)||b&&"object"==typeof b&&hy(b,".sv")))throw Error(e+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");f.push(d)}),l7(e,f)},l9=function(a,b,c,d){if((!d||void 0!==c)&&!l4(c))throw Error(hK(a,b)+'was an invalid path = "'+c+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ma=function(a,b,c,d){c&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),l9(a,b,c,d)},mb=function(a,b){if(".info"===jM(b))throw Error(a+" failed = Can't modify data under /.info/")},mc=function(a,b){var c;let d=b.path.toString();if("string"!=typeof b.repoInfo.host||0===b.repoInfo.host.length||!l3(b.repoInfo.namespace)&&"localhost"!==b.repoInfo.host.split(":")[0]||0!==d.length&&((c=d)&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),!l4(c)))throw Error(hK(a,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class md{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function me(a,b){let c=null;for(let d=0;d<b.length;d++){let e=b[d],f=e.getPath();null===c||jW(f,c.path)||(a.eventLists_.push(c),c=null),null===c&&(c={events:[],path:f}),c.events.push(e)}c&&a.eventLists_.push(c)}function mf(a,b,c){me(a,c),function(a,b){a.recursionDepth_++;let c=!0;for(let d=0;d<a.eventLists_.length;d++){let e=a.eventLists_[d];e&&(b(e.path)?(function(a){for(let b=0;b<a.events.length;b++){let c=a.events[b];if(null!==c){a.events[b]=null;let d=c.getEventRunner();i_&&i2("event: "+c.toString()),jl(d)}}}(a.eventLists_[d]),a.eventLists_[d]=null):c=!1)}c&&(a.eventLists_=[]),a.recursionDepth_--}(a,a=>jX(a,b)||jX(b,a))}class mg{constructor(a,b,c,d){this.repoInfo_=a,this.forceRestClient_=b,this.authTokenProvider_=c,this.appCheckProvider_=d,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new md,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=kA(),this.transactionQueueTree_=new lW,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function mh(a){var b;let c;return(b=b={timestamp:(c=a.infoData_.getNode(new jK(".info/serverTimeOffset")).val()||0,new Date().getTime()+c)}).timestamp=b.timestamp||new Date().getTime(),b}function mi(a,b,c,d,e){a.dataUpdateCount++;let f=new jK(b);c=a.interceptServerDataCallback_?a.interceptServerDataCallback_(b,c):c;let g=[];if(e)if(d){let b=hB(c,a=>kl(a));g=function(a,b,c,d){let e=lK(a,d);if(!e)return[];{let d=lL(e),f=d.path,g=d.queryId,h=jU(f,b),i=kT.fromObject(c);return lM(a,f,new kK(kG(g),h,i))}}(a.serverSyncTree_,f,b,e)}else{let b=kl(c);g=lE(a.serverSyncTree_,f,b,e)}else if(d){var h;let b,d=hB(c,a=>kl(a));h=a.serverSyncTree_,b=kT.fromObject(d),g=lG(h,new kK(kF(),f,b))}else{let b=kl(c);g=lC(a.serverSyncTree_,f,b)}let i=f;g.length>0&&(i=mp(a,f)),mf(a.eventQueue_,i,g)}function mj(a,b){var c;let d,e,f;mk(a,"connected",b),!1===b&&(mm(c=a,"onDisconnectEvents"),d=mh(c),e=kA(),kB(c.onDisconnect_,jL(),(a,b)=>{let f=lT(a,b,c.serverSyncTree_,d);!function a(b,c,d){if(jT(c))b.value=d,b.children.clear();else if(null!==b.value)b.value=b.value.updateChild(c,d);else{let e=jM(c);b.children.has(e)||b.children.set(e,kA()),a(b.children.get(e),c=jO(c),d)}}(e,a,f)}),f=[],kB(e,jL(),(a,b)=>{f=f.concat(lC(c.serverSyncTree_,a,b));let d=mt(c,a);mp(c,d)}),c.onDisconnect_=kA(),mf(c.eventQueue_,jL(),f))}function mk(a,b,c){let d=new jK("/.info/"+b),e=kl(c);a.infoData_.updateSnapshot(d,e);let f=lC(a.infoSyncTree_,d,e);mf(a.eventQueue_,d,f)}function ml(a){return a.nextWriteId_++}function mm(a,...b){let c="";a.persistentConnection_&&(c=a.persistentConnection_.id+":"),i2(c,...b)}function mn(a,b,c,d){b&&jl(()=>{if("ok"===c)b(null);else{let a=(c||"error").toUpperCase(),e=a;d&&(e+=": "+d);let f=Error(e);f.code=a,b(f)}})}function mo(a,b,c){return lF(a.serverSyncTree_,b,c)||kj.EMPTY_NODE}function mp(a,b){let c=mq(a,b),d=l0(c),e=mr(a,c);return function(a,b,c){if(0===b.length)return;let d=[],e=[],f=b.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let g=0;g<b.length;g++){let h=b[g],i=jU(c,h.path),j=!1,k;if(g6(null!==i,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)j=!0,k=h.abortReason,e=e.concat(lB(a.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=25)j=!0,k="maxretry",e=e.concat(lB(a.serverSyncTree_,h.currentWriteId,!0));else{let c=mo(a,h.path,f);h.currentInputSnapshot=c;let d=b[g].update(c.val());if(void 0!==d){l6("transaction failed: Data returned ",d,h.path);let b=kl(d);"object"==typeof d&&null!=d&&hy(d,".priority")||(b=b.updatePriority(c.getPriority()));let g=h.currentWriteId,i=lU(b,c,mh(a));h.currentOutputSnapshotRaw=b,h.currentOutputSnapshotResolved=i,h.currentWriteId=ml(a),f.splice(f.indexOf(g),1),e=(e=e.concat(lA(a.serverSyncTree_,h.path,i,h.currentWriteId,h.applyLocally))).concat(lB(a.serverSyncTree_,g,!0))}else j=!0,k="nodata",e=e.concat(lB(a.serverSyncTree_,h.currentWriteId,!0))}mf(a.eventQueue_,c,e),e=[],j&&(b[g].status=2,setTimeout(b[g].unwatcher,Math.floor(0)),b[g].onComplete&&("nodata"===k?d.push(()=>b[g].onComplete(null,!1,b[g].currentInputSnapshot)):d.push(()=>b[g].onComplete(Error(k),!1,null))))}ms(a,a.transactionQueueTree_);for(let a=0;a<d.length;a++)jl(d[a]);!function a(b,c=b.transactionQueueTree_){if(c||ms(b,c),lY(c)){let d=mr(b,c);g6(d.length>0,"Sending zero length transaction queue"),d.every(a=>0===a.status)&&function(b,c,d){let e=mo(b,c,d.map(a=>a.currentWriteId)),f=e,g=e.hash();for(let a=0;a<d.length;a++){let b=d[a];g6(0===b.status,"tryToSendTransactionQueue_: items in queue should all be run."),b.status=1,b.retryCount++;let e=jU(c,b.path);f=f.updateChild(e,b.currentOutputSnapshotRaw)}let h=f.val(!0);b.server_.put(c.toString(),h,e=>{mm(b,"transaction put response",{path:c.toString(),status:e});let f=[];if("ok"===e){let e=[];for(let a=0;a<d.length;a++)d[a].status=2,f=f.concat(lB(b.serverSyncTree_,d[a].currentWriteId)),d[a].onComplete&&e.push(()=>d[a].onComplete(null,!0,d[a].currentOutputSnapshotResolved)),d[a].unwatcher();ms(b,lX(b.transactionQueueTree_,c)),a(b,b.transactionQueueTree_),mf(b.eventQueue_,c,f);for(let a=0;a<e.length;a++)jl(e[a])}else{if("datastale"===e)for(let a=0;a<d.length;a++)3===d[a].status?d[a].status=4:d[a].status=0;else{i6("transaction at "+c.toString()+" failed: "+e);for(let a=0;a<d.length;a++)d[a].status=4,d[a].abortReason=e}mp(b,c)}},g)}(b,l0(c),d)}else l$(c)&&l_(c,c=>{a(b,c)})}(a,a.transactionQueueTree_)}(a,e,d),d}function mq(a,b){let c,d=a.transactionQueueTree_;for(c=jM(b);null!==c&&void 0===lY(d);)d=lX(d,c),c=jM(b=jO(b));return d}function mr(a,b){let c=[];return function a(b,c,d){let e=lY(c);if(e)for(let a=0;a<e.length;a++)d.push(e[a]);l_(c,c=>{a(b,c,d)})}(a,b,c),c.sort((a,b)=>a.order-b.order),c}function ms(a,b){let c=lY(b);if(c){let a=0;for(let b=0;b<c.length;b++)2!==c[b].status&&(c[a]=c[b],a++);c.length=a,lZ(b,c.length>0?c:void 0)}l_(b,b=>{ms(a,b)})}function mt(a,b){let c=l0(mq(a,b)),d=lX(a.transactionQueueTree_,b);return!function(a,b,c){let d=a.parent;for(;null!==d;){if(b(d))return!0;d=d.parent}}(d,b=>{mu(a,b)}),mu(a,d),!function a(b,c,d,e){d&&!e&&c(b),l_(b,b=>{a(b,c,!0,e)}),d&&e&&c(b)}(d,b=>{mu(a,b)}),c}function mu(a,b){let c=lY(b);if(c){let d=[],e=[],f=-1;for(let b=0;b<c.length;b++)3===c[b].status||(1===c[b].status?(g6(f===b-1,"All SENT items should be at beginning of queue."),f=b,c[b].status=3,c[b].abortReason="set"):(g6(0===c[b].status,"Unexpected transaction status in abort"),c[b].unwatcher(),e=e.concat(lB(a.serverSyncTree_,c[b].currentWriteId,!0)),c[b].onComplete&&d.push(c[b].onComplete.bind(null,Error("set"),!1,null))));-1===f?lZ(b,void 0):c.length=f+1,mf(a.eventQueue_,l0(b),e);for(let a=0;a<d.length;a++)jl(d[a])}}let mv=function(a,b){let c=mw(a),d=c.namespace;"firebase.com"===c.domain&&i5(c.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),d&&"undefined"!==d||"localhost"===c.domain||i5("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),c.secure||i7();let e="ws"===c.scheme||"wss"===c.scheme;return{repoInfo:new jn(c.host,c.secure,d,e,b,"",d!==c.subdomain),path:new jK(c.pathString)}},mw=function(a){let b="",c="",d="",e="",f="",g=!0,h="https",i=443;if("string"==typeof a){let j=a.indexOf("//");j>=0&&(h=a.substring(0,j-1),a=a.substring(j+2));let k=a.indexOf("/");-1===k&&(k=a.length);let l=a.indexOf("?");-1===l&&(l=a.length),b=a.substring(0,Math.min(k,l)),k<l&&(e=function(a){let b="",c=a.split("/");for(let a=0;a<c.length;a++)if(c[a].length>0){let d=c[a];try{d=decodeURIComponent(d.replace(/\+/g," "))}catch(a){}b+="/"+d}return b}(a.substring(k,l)));let m=function(a){let b={};for(let c of("?"===a.charAt(0)&&(a=a.substring(1)),a.split("&"))){if(0===c.length)continue;let d=c.split("=");2===d.length?b[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):i6(`Invalid query segment '${c}' in query '${a}'`)}return b}(a.substring(Math.min(a.length,l)));(j=b.indexOf(":"))>=0?(g="https"===h||"wss"===h,i=parseInt(b.substring(j+1),10)):j=b.length;let n=b.slice(0,j);if("localhost"===n.toLowerCase())c="localhost";else if(n.split(".").length<=2)c=n;else{let a=b.indexOf(".");d=b.substring(0,a).toLowerCase(),c=b.substring(a+1),f=d}"ns"in m&&(f=m.ns)}return{host:b,port:i,domain:c,subdomain:d,secure:g,scheme:h,pathString:e,namespace:f}};class mx{constructor(a,b,c,d){this.eventType=a,this.eventRegistration=b,this.snapshot=c,this.prevName=d}getPath(){let a=this.snapshot.ref;return"value"===this.eventType?a._path:a.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+hu(this.snapshot.exportVal())}}class my{constructor(a,b,c){this.eventRegistration=a,this.error=b,this.path=c}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class mz{constructor(a,b){this.snapshotCallback=a,this.cancelCallback=b}onValue(a,b){this.snapshotCallback.call(null,a,b)}onCancel(a){return g6(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,a)}get hasCancelCallback(){return!!this.cancelCallback}matches(a){return this.snapshotCallback===a.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===a.snapshotCallback.userCallback&&this.snapshotCallback.context===a.snapshotCallback.context}}class mA{constructor(a,b,c,d){this._repo=a,this._path=b,this._queryParams=c,this._orderByCalled=d}get key(){return jT(this._path)?null:jP(this._path)}get ref(){return new mB(this._repo,this._path)}get _queryIdentifier(){let a=jf(kx(this._queryParams));return"{}"===a?"default":a}get _queryObject(){return kx(this._queryParams)}isEqual(a){if(!((a=hN(a))instanceof mA))return!1;let b=this._repo===a._repo,c=jW(this._path,a._path),d=this._queryIdentifier===a._queryIdentifier;return b&&c&&d}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(a){let b="";for(let c=a.pieceNum_;c<a.pieces_.length;c++)""!==a.pieces_[c]&&(b+="/"+encodeURIComponent(String(a.pieces_[c])));return b||"/"}(this._path)}}class mB extends mA{constructor(a,b){super(a,b,new kv,!1)}get parent(){let a=jR(this._path);return null===a?null:new mB(this._repo,a)}get root(){let a=this;for(;null!==a.parent;)a=a.parent;return a}}class mC{constructor(a,b,c){this._node=a,this.ref=b,this._index=c}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(a){let b=new jK(a),c=mE(this.ref,a);return new mC(this._node.getChild(b),c,kd)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(a){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(b,c)=>a(new mC(c,mE(this.ref,b),kd)))}hasChild(a){let b=new jK(a);return!this._node.getChild(b).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function mD(a,b){return(a=hN(a))._checkNotDeleted("ref"),void 0!==b?mE(a._root,b):a._root}function mE(a,b){return null===jM((a=hN(a))._path)?ma("child","path",b,!1):l9("child","path",b,!1),new mB(a._repo,jS(a._path,b))}function mF(a){var b,c,d,e,f;let g,h,i,j,k,l,m;a=hN(a);let n=new mG(new mz(()=>{}));return(b=a._repo,c=a,d=b.serverSyncTree_,h=(e=c)._path,i=null,d.syncPointTree_.foreachOnPath(h,(a,b)=>{let c=jU(a,h);i=i||lu(b,c)}),(j=d.syncPointTree_.get(h))?i=i||lu(j,jL()):(j=new lq,d.syncPointTree_=d.syncPointTree_.set(h,j)),l=(k=null!=i)?new kL(i,!0,!1):null,m=(f=d.pendingWriteTree_,lb(e._path,f)),null!=(g=kR(ls(j,e,m,k?l.getNode():kj.EMPTY_NODE,k).viewCache_))?Promise.resolve(g):b.server_.get(c).then(a=>{let d,e=kl(a).withIndex(c._queryParams.getIndex());if(!function(a,b,c,d=!1){var e;let f,g,h,i,j=b._path,k=null,l=!1;a.syncPointTree_.foreachOnPath(j,(a,b)=>{let c=jU(a,j);k=k||lu(b,c),l=l||lw(b)});let m=a.syncPointTree_.get(j);m?(l=l||lw(m),k=k||lu(m,jL())):(m=new lq,a.syncPointTree_=a.syncPointTree_.set(j,m)),null!=k?f=!0:(f=!1,k=kj.EMPTY_NODE,a.syncPointTree_.subtree(j).foreachChild((a,b)=>{let c=lu(b,jL());c&&(k=k.updateImmediateChild(a,c))}));let n=null!=lv(m,b);if(!n&&!b._queryParams.loadsAllData()){let c=lJ(b);g6(!a.queryToTagMap.has(c),"View does not exist, but we have a tag");let d=ly++;a.queryToTagMap.set(c,d),a.tagToQueryMap.set(d,c)}let o=lb(j,a.pendingWriteTree_),p=(g=ls(e=m,b,o,k,f),e.views.has(b._queryIdentifier)||e.views.set(b._queryIdentifier,g),g.eventRegistrations_.push(c),h=g.viewCache_.eventCache,i=[],h.getNode().isLeafNode()||h.getNode().forEachChild(kd,(a,b)=>{i.push(kp(a,b))}),h.isFullyInitialized()&&i.push(ko(h.getNode())),lp(g,i,h.getNode(),c));if(!n&&!l&&!d){let c=lv(m,b);p=p.concat(function(a,b,c){let d=b._path,e=lI(a,b),f=lH(a,c),g=a.listenProvider_.startListening(lN(b),e,f.hashFn,f.onComplete),h=a.syncPointTree_.subtree(d);if(e)g6(!lw(h.value),"If we're adding a query, it shouldn't be shadowed");else{let b=h.fold((a,b,c)=>{if(!jT(a)&&b&&lw(b))return[lx(b).query];{let a=[];return b&&(a=a.concat(lt(b).map(a=>a.query))),jh(c,(b,c)=>{a=a.concat(c)}),a}});for(let c=0;c<b.length;++c){let d=b[c];a.listenProvider_.stopListening(lN(d),lI(a,d))}}return g}(a,b,c))}}(b.serverSyncTree_,c,n,!0),c._queryParams.loadsAllData())d=lC(b.serverSyncTree_,c._path,e);else{let a=lI(b.serverSyncTree_,c);d=lE(b.serverSyncTree_,c._path,e,a)}return mf(b.eventQueue_,c._path,d),lD(b.serverSyncTree_,c,n,null,!0),e},a=>(mm(b,"get for query "+hu(c)+" failed: "+a),Promise.reject(Error(a))))).then(b=>new mC(b,new mB(a._repo,a._path),a._queryParams.getIndex()))}class mG{constructor(a){this.callbackContext=a}respondsTo(a){return"value"===a}createEvent(a,b){let c=b._queryParams.getIndex();return new mx("value",this,new mC(a.snapshotNode,new mB(b._repo,b._path),c))}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,null)}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new my(this,a,b):null}matches(a){return a instanceof mG&&(!a.callbackContext||!this.callbackContext||a.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}g6(!o,"__referenceConstructor has already been defined"),o=mB,g6(!p,"__referenceConstructor has already been defined"),p=mB;let mH={};class mI{constructor(a,b){this._repoInternal=a,this.app=b,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(a,b,c){var d;let e;if(a.stats_=js(a.repoInfo_),a.forceRestClient_||"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)a.server_=new ky(a.repoInfo_,(b,c,d,e)=>{mi(a,b,c,d,e)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>mj(a,!0),0);else{if(null!=c){if("object"!=typeof c)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{hu(c)}catch(a){throw Error("Invalid authOverride provided: "+a)}}a.persistentConnection_=new j0(a.repoInfo_,b,(b,c,d,e)=>{mi(a,b,c,d,e)},b=>{mj(a,b)},b=>{var c;c=a,jh(b,(a,b)=>{mk(c,a,b)})},a.authTokenProvider_,a.appCheckProvider_,c),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(b=>{a.server_.refreshAuthToken(b)}),a.appCheckProvider_.addTokenChangeListener(b=>{a.server_.refreshAppCheckToken(b.token)}),d=a.repoInfo_,jr[e=d.toString()]||(jr[e]=(()=>new kD(a.stats_,a.server_))()),a.statsReporter_=jr[e],a.infoData_=new kz,a.infoSyncTree_=new lz({startListening:(b,c,d,e)=>{let f=[],g=a.infoData_.getNode(b._path);return g.isEmpty()||(f=lC(a.infoSyncTree_,b._path,g),setTimeout(()=>{e("ok")},0)),f},stopListening:()=>{}}),mk(a,"connected",!1),a.serverSyncTree_=new lz({startListening:(b,c,d,e)=>(a.server_.listen(b,d,c,(c,d)=>{let f=e(c,d);mf(a.eventQueue_,b._path,f)}),[]),stopListening:(b,c)=>{a.server_.unlisten(b,c)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new mB(this._repo,jL())),this._rootInternal}_delete(){if(null!==this._rootInternal){var a,b;let c;a=this._repo,(c=mH[b=this.app.name])&&c[a.key]===a||i5(`Database ${b}(${a.repoInfo_}) has already been deleted.`),a.persistentConnection_&&a.persistentConnection_.interrupt("repo_interrupt"),delete c[a.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(a){null===this._rootInternal&&i5("Cannot call "+a+" on a deleted database.")}}j0.prototype.simpleListen=function(a,b){this.sendRequest("q",{p:a},b)},j0.prototype.echo=function(a,b){this.sendRequest("echo",{d:a},b)},ju=iP.default.Client;function mJ(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}jt=iw,ik(new hO("database",(a,{instanceIdentifier:b})=>{var c,d,e,f;let g,h,i,j,k,l,m,n=a.getProvider("app").getImmediate(),o=a.getProvider("auth-internal"),p=a.getProvider("app-check-internal");return void 0===(i=b||n.options.databaseURL)&&(n.options.projectId||i5("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),i2("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`),k=(j=mv(i,void 0)).repoInfo,"u">typeof process&&process.env&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?k=(j=mv(i=`http://${l}?ns=${k.namespace}`,void 0)).repoInfo:!j.repoInfo.secure,m=new jz(n.name,n.options,o),mc("Invalid Firebase Database URL",j),jT(j.path)||i5("Database URL must point to the root of a Firebase Database (not including a child path)."),new mI((c=k,d=n,e=m,f=new jy(n,p),(g=mH[d.name])||(g={},mH[d.name]=g),(h=g[c.toURLString()])&&i5("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),h=new mg(c,!1,e,f),g[c.toURLString()]=h,h),n)},"PUBLIC").setMultipleInstances(!0)),iC(jw,jx,"node"),iC(jw,jx,"esm2020");let mK=new hr("auth","Firebase",mJ()),mL=new hX("@firebase/auth");function mM(a,...b){mL.logLevel<=I.ERROR&&mL.error(`Auth (${iw}): ${a}`,...b)}function mN(a,...b){throw mR(a,...b)}function mO(a,...b){return mR(a,...b)}function mP(a,b,c){return new hr("auth","Firebase",{...mJ(),[b]:c}).create(b,{appName:a.name})}function mQ(a){return mP(a,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mR(a,...b){if("string"!=typeof a){let c=b[0],d=[...b.slice(1)];return d[0]&&(d[0].appName=a.name),a._errorFactory.create(c,...d)}return mK.create(a,...b)}function mS(a,b,...c){if(!a)throw mR(b,...c)}function mT(a){let b="INTERNAL ASSERTION FAILED: "+a;throw mM(b),Error(b)}function mU(){return"u">typeof self&&self.location?.protocol||null}class mV{static initialize(a,b,c){this.fetchImpl=a,b&&(this.headersImpl=b),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void mT("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void mT("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void mT("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let mW={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},mX=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],mY=new class{constructor(a,b){this.shortDelay=a,this.longDelay=b,function(a,b){a||mT(b)}(b>a,"Short delay should be less than long delay!"),this.isMobile=ho()}get(){let a;return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===mU()||"https:"===mU()||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}(3e4,6e4);function mZ(a,b){return a.tenantId&&!b.tenantId?{...b,tenantId:a.tenantId}:b}async function m$(a,b,c,d,e={}){return m_(a,e,async()=>{let e={},f={};d&&("GET"===b?f=d:e={body:JSON.stringify(d)});let g=hE({key:a.config.apiKey,...f}).slice(1),h=await a._getAdditionalHeaders();h["Content-Type"]="application/json",a.languageCode&&(h["X-Firebase-Locale"]=a.languageCode);let i={method:b,headers:h,...e};return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(i.referrerPolicy="no-referrer"),a.emulatorConfig&&hj(a.emulatorConfig.host)&&(i.credentials="include"),mV.fetch()(await m1(a,a.config.apiHost,c,g),i)})}async function m_(a,b,c){a._canInitEmulator=!1;let d={...mW,...b};try{let b=new m2(a),e=await Promise.race([c(),b.promise]);b.clearNetworkTimeout();let f=await e.json();if("needConfirmation"in f)throw m3(a,"account-exists-with-different-credential",f);if(e.ok&&!("errorMessage"in f))return f;{let[b,c]=(e.ok?f.errorMessage:f.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===b)throw m3(a,"credential-already-in-use",f);if("EMAIL_EXISTS"===b)throw m3(a,"email-already-in-use",f);if("USER_DISABLED"===b)throw m3(a,"user-disabled",f);let g=d[b]||b.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw mP(a,g,c);mN(a,g)}}catch(b){if(b instanceof hq)throw b;mN(a,"network-request-failed",{message:String(b)})}}async function m0(a,b,c,d,e={}){let f=await m$(a,b,c,d,e);return"mfaPendingCredential"in f&&mN(a,"multi-factor-auth-required",{_serverResponse:f}),f}async function m1(a,b,c,d){let e=`${b}${c}?${d}`,f=a.config.emulator?function(a,b){var c;c=a.emulator,c||mT("Emulator should always be set here");let{url:d}=a.emulator;return b?`${d}${b.startsWith("/")?b.slice(1):b}`:d}(a.config,e):`${a.config.apiScheme}://${e}`;return mX.includes(c)&&(await a._persistenceManagerAvailable,"COOKIE"===a._getPersistenceType())?a._getPersistence()._getFinalTarget(f).toString():f}class m2{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((a,b)=>{this.timer=setTimeout(()=>b(mO(this.auth,"network-request-failed")),mY.get())})}}function m3(a,b,c){let d={appName:a.name};c.email&&(d.email=c.email),c.phoneNumber&&(d.phoneNumber=c.phoneNumber);let e=mO(a,b,d);return e.customData._tokenResponse=c,e}function m4(a){return void 0!==a&&void 0!==a.enterprise}class m5{constructor(a){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===a.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=a.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=a.recaptchaEnforcementState}getProviderEnforcementState(a){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let b of this.recaptchaEnforcementState)if(b.provider&&b.provider===a)switch(b.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(a){return"ENFORCE"===this.getProviderEnforcementState(a)||"AUDIT"===this.getProviderEnforcementState(a)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function m6(a,b){return m$(a,"GET","/v2/recaptchaConfig",mZ(a,b))}async function m7(a,b){return m$(a,"POST","/v1/accounts:delete",b)}async function m8(a,b){return m$(a,"POST","/v1/accounts:lookup",b)}function m9(a){if(a)try{let b=new Date(Number(a));if(!isNaN(b.getTime()))return b.toUTCString()}catch(a){}}async function na(a,b=!1){let c=hN(a),d=await c.getIdToken(b),e=nc(d);mS(e&&e.exp&&e.auth_time&&e.iat,c.auth,"internal-error");let f="object"==typeof e.firebase?e.firebase:void 0,g=f?.sign_in_provider;return{claims:e,token:d,authTime:m9(nb(e.auth_time)),issuedAtTime:m9(nb(e.iat)),expirationTime:m9(nb(e.exp)),signInProvider:g||null,signInSecondFactor:f?.sign_in_second_factor||null}}function nb(a){return 1e3*Number(a)}function nc(a){let[b,c,d]=a.split(".");if(void 0===b||void 0===c||void 0===d)return mM("JWT malformed, contained fewer than 3 sections"),null;try{let a=he(c);if(!a)return mM("Failed to decode base64 JWT payload"),null;return JSON.parse(a)}catch(a){return mM("Caught error parsing JWT payload as JSON",a?.toString()),null}}function nd(a){let b=nc(a);return mS(b,"internal-error"),mS(void 0!==b.exp,"internal-error"),mS(void 0!==b.iat,"internal-error"),Number(b.exp)-Number(b.iat)}async function ne(a,b,c=!1){if(c)return b;try{return await b}catch(b){throw b instanceof hq&&function({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}(b)&&a.auth.currentUser===a&&await a.auth.signOut(),b}}class nf{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(a){if(!a)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let a=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),a}}schedule(a=!1){if(!this.isRunning)return;let b=this.getInterval(a);this.timerId=setTimeout(async()=>{await this.iteration()},b)}async iteration(){try{await this.user.getIdToken(!0)}catch(a){a?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ng{constructor(a,b){this.createdAt=a,this.lastLoginAt=b,this._initializeTime()}_initializeTime(){this.lastSignInTime=m9(this.lastLoginAt),this.creationTime=m9(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function nh(a){var b,c;let d=a.auth,e=await a.getIdToken(),f=await ne(a,m8(d,{idToken:e}));mS(f?.users.length,d,"internal-error");let g=f.users[0];a._notifyReloadListener(g);let h=g.providerUserInfo?.length?nj(g.providerUserInfo):[],i=(b=a.providerData,c=h,[...b.filter(a=>!c.some(b=>b.providerId===a.providerId)),...c]),j=a.isAnonymous,k=!(a.email&&g.passwordHash)&&!i?.length;Object.assign(a,{uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:i,metadata:new ng(g.createdAt,g.lastLoginAt),isAnonymous:!!j&&k})}async function ni(a){let b=hN(a);await nh(b),await b.auth._persistUserIfCurrent(b),b.auth._notifyListenersIfCurrent(b)}function nj(a){return a.map(({providerId:a,...b})=>({providerId:a,uid:b.rawId||"",displayName:b.displayName||null,email:b.email||null,phoneNumber:b.phoneNumber||null,photoURL:b.photoUrl||null}))}async function nk(a,b){let c=await m_(a,{},async()=>{let c=hE({grant_type:"refresh_token",refresh_token:b}).slice(1),{tokenApiHost:d,apiKey:e}=a.config,f=await m1(a,d,"/v1/token",`key=${e}`),g=await a._getAdditionalHeaders();g["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:g,body:c};return a.emulatorConfig&&hj(a.emulatorConfig.host)&&(h.credentials="include"),mV.fetch()(f,h)});return{accessToken:c.access_token,expiresIn:c.expires_in,refreshToken:c.refresh_token}}async function nl(a,b){return m$(a,"POST","/v2/accounts:revokeToken",mZ(a,b))}class nm{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){mS(a.idToken,"internal-error"),mS(void 0!==a.idToken,"internal-error"),mS(void 0!==a.refreshToken,"internal-error");let b="expiresIn"in a&&void 0!==a.expiresIn?Number(a.expiresIn):nd(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,b)}updateFromIdToken(a){mS(0!==a.length,"internal-error");let b=nd(a);this.updateTokensAndExpiration(a,null,b)}async getToken(a,b=!1){return b||!this.accessToken||this.isExpired?(mS(this.refreshToken,a,"user-token-expired"),this.refreshToken)?(await this.refresh(a,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(a,b){let{accessToken:c,refreshToken:d,expiresIn:e}=await nk(a,b);this.updateTokensAndExpiration(c,d,Number(e))}updateTokensAndExpiration(a,b,c){this.refreshToken=b||null,this.accessToken=a||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(a,b){let{refreshToken:c,accessToken:d,expirationTime:e}=b,f=new nm;return c&&(mS("string"==typeof c,"internal-error",{appName:a}),f.refreshToken=c),d&&(mS("string"==typeof d,"internal-error",{appName:a}),f.accessToken=d),e&&(mS("number"==typeof e,"internal-error",{appName:a}),f.expirationTime=e),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new nm,this.toJSON())}_performRefresh(){return mT("not implemented")}}function nn(a,b){mS("string"==typeof a||void 0===a,"internal-error",{appName:b})}class no{constructor({uid:a,auth:b,stsTokenManager:c,...d}){this.providerId="firebase",this.proactiveRefresh=new nf(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=b,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new ng(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(a){let b=await ne(this,this.stsTokenManager.getToken(this.auth,a));return mS(b,this.auth,"internal-error"),this.accessToken!==b&&(this.accessToken=b,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),b}getIdTokenResult(a){return na(this,a)}reload(){return ni(this)}_assign(a){this!==a&&(mS(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(a=>({...a})),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){let b=new no({...this,auth:a,stsTokenManager:this.stsTokenManager._clone()});return b.metadata._copy(this.metadata),b}_onReload(a){mS(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(a,b=!1){let c=!1;a.idToken&&a.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(a),c=!0),b&&await nh(this),await this.auth._persistUserIfCurrent(this),c&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(iq(this.auth.app))return Promise.reject(mQ(this.auth));let a=await this.getIdToken();return await ne(this,m7(this.auth,{idToken:a})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>({...a})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,b){let c=b.displayName??void 0,d=b.email??void 0,e=b.phoneNumber??void 0,f=b.photoURL??void 0,g=b.tenantId??void 0,h=b._redirectEventId??void 0,i=b.createdAt??void 0,j=b.lastLoginAt??void 0,{uid:k,emailVerified:l,isAnonymous:m,providerData:n,stsTokenManager:o}=b;mS(k&&o,a,"internal-error");let p=nm.fromJSON(this.name,o);mS("string"==typeof k,a,"internal-error"),nn(c,a.name),nn(d,a.name),mS("boolean"==typeof l,a,"internal-error"),mS("boolean"==typeof m,a,"internal-error"),nn(e,a.name),nn(f,a.name),nn(g,a.name),nn(h,a.name),nn(i,a.name),nn(j,a.name);let q=new no({uid:k,auth:a,email:d,emailVerified:l,displayName:c,isAnonymous:m,photoURL:f,phoneNumber:e,tenantId:g,stsTokenManager:p,createdAt:i,lastLoginAt:j});return n&&Array.isArray(n)&&(q.providerData=n.map(a=>({...a}))),h&&(q._redirectEventId=h),q}static async _fromIdTokenResponse(a,b,c=!1){let d=new nm;d.updateFromServerResponse(b);let e=new no({uid:b.localId,auth:a,stsTokenManager:d,isAnonymous:c});return await nh(e),e}static async _fromGetAccountInfoResponse(a,b,c){let d=b.users[0];mS(void 0!==d.localId,"internal-error");let e=void 0!==d.providerUserInfo?nj(d.providerUserInfo):[],f=!(d.email&&d.passwordHash)&&!e?.length,g=new nm;g.updateFromIdToken(c);let h=new no({uid:d.localId,auth:a,stsTokenManager:g,isAnonymous:f});return Object.assign(h,{uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:e,metadata:new ng(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!e?.length}),h}}let np=new Map;function nq(a){a instanceof Function||mT("Expected a class definition");let b=np.get(a);return b?(b instanceof a||mT("Instance stored in cache mismatched with class"),b):(b=new a,np.set(a,b),b)}class nr{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(a,b){this.storage[a]=b}async _get(a){let b=this.storage[a];return void 0===b?null:b}async _remove(a){delete this.storage[a]}_addListener(a,b){}_removeListener(a,b){}}function ns(a,b,c){return`firebase:${a}:${b}:${c}`}nr.type="NONE";class nt{constructor(a,b,c){this.persistence=a,this.auth=b,this.userKey=c;const{config:d,name:e}=this.auth;this.fullUserKey=ns(this.userKey,d.apiKey,e),this.fullPersistenceKey=ns("persistence",d.apiKey,e),this.boundEventHandler=b._onStorageEvent.bind(b),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}async getCurrentUser(){let a=await this.persistence._get(this.fullUserKey);if(!a)return null;if("string"==typeof a){let b=await m8(this.auth,{idToken:a}).catch(()=>void 0);return b?no._fromGetAccountInfoResponse(this.auth,b,a):null}return no._fromJSON(this.auth,a)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(a){if(this.persistence===a)return;let b=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=a,b)return this.setCurrentUser(b)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(a,b,c="authUser"){if(!b.length)return new nt(nq(nr),a,c);let d=(await Promise.all(b.map(async a=>{if(await a._isAvailable())return a}))).filter(a=>a),e=d[0]||nq(nr),f=ns(c,a.config.apiKey,a.name),g=null;for(let c of b)try{let b=await c._get(f);if(b){let d;if("string"==typeof b){let c=await m8(a,{idToken:b}).catch(()=>void 0);if(!c)break;d=await no._fromGetAccountInfoResponse(a,c,b)}else d=no._fromJSON(a,b);c!==e&&(g=d),e=c;break}}catch{}let h=d.filter(a=>a._shouldAllowMigration);return e._shouldAllowMigration&&h.length&&(e=h[0],g&&await e._set(f,g.toJSON()),await Promise.all(b.map(async a=>{if(a!==e)try{await a._remove(f)}catch{}}))),new nt(e,a,c)}}function nu(a){let b=a.toLowerCase();if(b.includes("opera/")||b.includes("opr/")||b.includes("opios/"))return"Opera";{if(function(a=hm()){return/iemobile/i.test(a)}(b))return"IEMobile";if(b.includes("msie")||b.includes("trident/"))return"IE";if(b.includes("edge/"))return"Edge";if(function(a=hm()){return/firefox\//i.test(a)}(b))return"Firefox";if(b.includes("silk/"))return"Silk";if(function(a=hm()){return/blackberry/i.test(a)}(b))return"Blackberry";if(function(a=hm()){return/webos/i.test(a)}(b))return"Webos";if(function(a=hm()){let b=a.toLowerCase();return b.includes("safari/")&&!b.includes("chrome/")&&!b.includes("crios/")&&!b.includes("android")}(b))return"Safari";if((b.includes("chrome/")||function(a=hm()){return/crios\//i.test(a)}(b))&&!b.includes("edge/"))return"Chrome";if(function(a=hm()){return/android/i.test(a)}(b))return"Android";let c=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(c?.length===2)return c[1]}return"Other"}function nv(a,b=[]){let c;switch(a){case"Browser":c=nu(hm());break;case"Worker":c=`${nu(hm())}-${a}`;break;default:c=a}let d=b.length?b.join(","):"FirebaseCore-web";return`${c}/JsCore/${iw}/${d}`}class nw{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,b){let c=b=>new Promise((c,d)=>{try{let d=a(b);c(d)}catch(a){d(a)}});c.onAbort=b,this.queue.push(c);let d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(a){if(this.auth.currentUser===a)return;let b=[];try{for(let c of this.queue)await c(a),c.onAbort&&b.push(c.onAbort)}catch(a){for(let a of(b.reverse(),b))try{a()}catch(a){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a?.message})}}}async function nx(a,b={}){return m$(a,"GET","/v2/passwordPolicy",mZ(a,b))}class ny{constructor(a){const b=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=b.minPasswordLength??6,b.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=b.maxPasswordLength),void 0!==b.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=b.containsLowercaseCharacter),void 0!==b.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=b.containsUppercaseCharacter),void 0!==b.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=b.containsNumericCharacter),void 0!==b.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=b.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=a.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=a.forceUpgradeOnSignin??!1,this.schemaVersion=a.schemaVersion}validatePassword(a){let b={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,b),this.validatePasswordCharacterOptions(a,b),b.isValid&&(b.isValid=b.meetsMinPasswordLength??!0),b.isValid&&(b.isValid=b.meetsMaxPasswordLength??!0),b.isValid&&(b.isValid=b.containsLowercaseLetter??!0),b.isValid&&(b.isValid=b.containsUppercaseLetter??!0),b.isValid&&(b.isValid=b.containsNumericCharacter??!0),b.isValid&&(b.isValid=b.containsNonAlphanumericCharacter??!0),b}validatePasswordLengthOptions(a,b){let c=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;c&&(b.meetsMinPasswordLength=a.length>=c),d&&(b.meetsMaxPasswordLength=a.length<=d)}validatePasswordCharacterOptions(a,b){let c;this.updatePasswordCharacterOptionsStatuses(b,!1,!1,!1,!1);for(let d=0;d<a.length;d++)c=a.charAt(d),this.updatePasswordCharacterOptionsStatuses(b,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(a,b,c,d,e){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=b)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=e))}}class nz{constructor(a,b,c,d){this.app=a,this.heartbeatServiceProvider=b,this.appCheckServiceProvider=c,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nA(this),this.idTokenSubscription=new nA(this),this.beforeStateQueue=new nw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mK,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=d.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(a,b){return b&&(this._popupRedirectResolver=nq(b)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await nt.create(this,a),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(a){}await this.initializeCurrentUser(b),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let a=await this.assertedPersistence.getCurrentUser();if(this.currentUser||a){if(this.currentUser&&a&&this.currentUser.uid===a.uid){this._currentUser._assign(a),await this.currentUser.getIdToken();return}await this._updateCurrentUser(a,!0)}}async initializeCurrentUserFromIdToken(a){try{let b=await m8(this,{idToken:a}),c=await no._fromGetAccountInfoResponse(this,b,a);await this.directlySetCurrentUser(c)}catch(a){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",a),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(a){if(iq(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(b=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(b,b))}):this.directlySetCurrentUser(null)}let b=await this.assertedPersistence.getCurrentUser(),c=b,d=!1;if(a&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let b=this.redirectUser?._redirectEventId,e=c?._redirectEventId,f=await this.tryRedirectSignIn(a);(!b||b===e)&&f?.user&&(c=f.user,d=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(c)}catch(a){c=b,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return(mS(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId)?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(a){let b=null;try{b=await this._popupRedirectResolver._completeRedirectFn(this,a,!0)}catch(a){await this._setRedirectUser(null)}return b}async reloadAndSetCurrentUserOrClear(a){try{await nh(a)}catch(a){if(a?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(a)}useDeviceLanguage(){this.languageCode=function(){if("u"<typeof navigator)return null;let a=navigator;return a.languages&&a.languages[0]||a.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(a){if(iq(this.app))return Promise.reject(mQ(this));let b=a?hN(a):null;return b&&mS(b.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(b&&b._clone(this))}async _updateCurrentUser(a,b=!1){if(!this._deleted)return a&&mS(this.tenantId===a.tenantId,this,"tenant-id-mismatch"),b||await this.beforeStateQueue.runMiddleware(a),this.queue(async()=>{await this.directlySetCurrentUser(a),this.notifyAuthListeners()})}async signOut(){return iq(this.app)?Promise.reject(mQ(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(a){return iq(this.app)?Promise.reject(mQ(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(nq(a))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(a){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let b=this._getPasswordPolicyInternal();return b.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):b.validatePassword(a)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let a=new ny(await nx(this));null===this.tenantId?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(a){this._errorFactory=new hr("auth","Firebase",a())}onAuthStateChanged(a,b,c){return this.registerStateListener(this.authStateSubscription,a,b,c)}beforeAuthStateChanged(a,b){return this.beforeStateQueue.pushCallback(a,b)}onIdTokenChanged(a,b,c){return this.registerStateListener(this.idTokenSubscription,a,b,c)}authStateReady(){return new Promise((a,b)=>{if(this.currentUser)a();else{let c=this.onAuthStateChanged(()=>{c(),a()},b)}})}async revokeAccessToken(a){if(this.currentUser){let b={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(b.tenantId=this.tenantId),await nl(this,b)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(a,b){let c=await this.getOrInitRedirectPersistenceManager(b);return null===a?c.removeCurrentUser():c.setCurrentUser(a)}async getOrInitRedirectPersistenceManager(a){if(!this.redirectPersistenceManager){let b=a&&nq(a)||this._popupRedirectResolver;mS(b,this,"argument-error"),this.redirectPersistenceManager=await nt.create(this,[nq(b._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(a){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===a)?this._currentUser:this.redirectUser?._redirectEventId===a?this.redirectUser:null}async _persistUserIfCurrent(a){if(a===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(a))}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let a=this.currentUser?.uid??null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,b,c,d){if(this._deleted)return()=>{};let e="function"==typeof b?b:b.next.bind(b),f=!1,g=this._isInitialized?Promise.resolve():this._initializationPromise;if(mS(g,this,"internal-error"),g.then(()=>{f||e(this.currentUser)}),"function"==typeof b){let e=a.addObserver(b,c,d);return()=>{f=!0,e()}}{let c=a.addObserver(b);return()=>{f=!0,c()}}}async directlySetCurrentUser(a){this.currentUser&&this.currentUser!==a&&this._currentUser._stopProactiveRefresh(),a&&this.isProactiveRefreshEnabled&&a._startProactiveRefresh(),this.currentUser=a,a?await this.assertedPersistence.setCurrentUser(a):await this.assertedPersistence.removeCurrentUser()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return mS(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=nv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let a={"X-Client-Version":this.clientVersion};this.app.options.appId&&(a["X-Firebase-gmpid"]=this.app.options.appId);let b=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();b&&(a["X-Firebase-Client"]=b);let c=await this._getAppCheckToken();return c&&(a["X-Firebase-AppCheck"]=c),a}async _getAppCheckToken(){if(iq(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let a=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return a?.error&&function(a,...b){mL.logLevel<=I.WARN&&mL.warn(`Auth (${iw}): ${a}`,...b)}(`Error while retrieving App Check token: ${a.error}`),a?.token}}class nA{constructor(a){this.auth=a,this.observer=null,this.addObserver=function(a,b){let c=new hI(a,void 0);return c.subscribe.bind(c)}(a=>this.observer=a)}get next(){return mS(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class nB{constructor(){this.enterprise=new nC}ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}class nC{ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}let nD="NO_RECAPTCHA";class nE{constructor(a){this.type="recaptcha-enterprise",this.auth=function(a){return hN(a)}(a)}async verify(a="verify",b=!1){async function c(a){if(!b){if(null==a.tenantId&&null!=a._agentRecaptchaConfig)return a._agentRecaptchaConfig.siteKey;if(null!=a.tenantId&&void 0!==a._tenantRecaptchaConfigs[a.tenantId])return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(b,c)=>{m6(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(void 0===d.recaptchaKey)c(Error("recaptcha Enterprise site key undefined"));else{let c=new m5(d);return null==a.tenantId?a._agentRecaptchaConfig=c:a._tenantRecaptchaConfigs[a.tenantId]=c,b(c.siteKey)}}).catch(a=>{c(a)})})}return this.auth.settings.appVerificationDisabledForTesting?new nB().execute("siteKey",{action:"verify"}):new Promise((d,e)=>{c(this.auth).then(c=>{let f;if(!(!b&&m4(window.grecaptcha)))return void e(Error("RecaptchaVerifier is only supported in browser"));m4(f=window.grecaptcha)?f.enterprise.ready(()=>{f.enterprise.execute(c,{action:a}).then(a=>{d(a)}).catch(()=>{d(nD)})}):e(Error("No reCAPTCHA enterprise script loaded."))}).catch(a=>{e(a)})})}}async function nF(a,b,c,d=!1,e=!1){let f,g=new nE(a);if(e)f=nD;else try{f=await g.verify(c)}catch(a){f=await g.verify(c,!0)}let h={...b};if("mfaSmsEnrollment"===c||"mfaSmsSignIn"===c){if("phoneEnrollmentInfo"in h){let a=h.phoneEnrollmentInfo.phoneNumber,b=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){let a=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:a,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return d?Object.assign(h,{captchaResp:f}):Object.assign(h,{captchaResponse:f}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function nG(a,b,c,d,e){if("EMAIL_PASSWORD_PROVIDER"===e)if(!a._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return d(a,b).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log(`${c} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let e=await nF(a,b,c,"getOobCode"===c);return d(a,e)}});else{let e=await nF(a,b,c,"getOobCode"===c);return d(a,e)}if("PHONE_PROVIDER"!==e)return Promise.reject(e+" provider is not supported.");if(a._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let e=await nF(a,b,c);return d(a,e).catch(async e=>{if(a._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===e.code||"auth/invalid-app-credential"===e.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${c} flow.`);let e=await nF(a,b,c,!1,!0);return d(a,e)}return Promise.reject(e)})}{let e=await nF(a,b,c,!1,!0);return d(a,e)}}function nH(a){let b=a.indexOf(":");return b<0?"":a.substr(0,b+1)}function nI(a){if(!a)return null;let b=Number(a);return isNaN(b)?null:b}class nJ{constructor(a,b){this.providerId=a,this.signInMethod=b}toJSON(){return mT("not implemented")}_getIdTokenResponse(a){return mT("not implemented")}_linkToIdToken(a,b){return mT("not implemented")}_getReauthenticationResolver(a){return mT("not implemented")}}async function nK(a,b){return m$(a,"POST","/v1/accounts:signUp",b)}async function nL(a,b){return m0(a,"POST","/v1/accounts:signInWithPassword",mZ(a,b))}async function nM(a,b){return m0(a,"POST","/v1/accounts:signInWithEmailLink",mZ(a,b))}async function nN(a,b){return m0(a,"POST","/v1/accounts:signInWithEmailLink",mZ(a,b))}class nO extends nJ{constructor(a,b,c,d=null){super("password",c),this._email=a,this._password=b,this._tenantId=d}static _fromEmailAndPassword(a,b){return new nO(a,b,"password")}static _fromEmailAndCode(a,b,c=null){return new nO(a,b,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(a){let b="string"==typeof a?JSON.parse(a):a;if(b?.email&&b?.password){if("password"===b.signInMethod)return this._fromEmailAndPassword(b.email,b.password);else if("emailLink"===b.signInMethod)return this._fromEmailAndCode(b.email,b.password,b.tenantId)}return null}async _getIdTokenResponse(a){switch(this.signInMethod){case"password":return nG(a,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nL,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nM(a,{email:this._email,oobCode:this._password});default:mN(a,"internal-error")}}async _linkToIdToken(a,b){switch(this.signInMethod){case"password":return nG(a,{idToken:b,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nK,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nN(a,{idToken:b,email:this._email,oobCode:this._password});default:mN(a,"internal-error")}}_getReauthenticationResolver(a){return this._getIdTokenResponse(a)}}async function nP(a,b){return m0(a,"POST","/v1/accounts:signInWithIdp",mZ(a,b))}class nQ extends nJ{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){let b=new nQ(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(b.idToken=a.idToken),a.accessToken&&(b.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(b.nonce=a.nonce),a.pendingToken&&(b.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(b.accessToken=a.oauthToken,b.secret=a.oauthTokenSecret):mN("argument-error"),b}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){let{providerId:b,signInMethod:c,...d}="string"==typeof a?JSON.parse(a):a;if(!b||!c)return null;let e=new nQ(b,c);return e.idToken=d.idToken||void 0,e.accessToken=d.accessToken||void 0,e.secret=d.secret,e.nonce=d.nonce,e.pendingToken=d.pendingToken||null,e}_getIdTokenResponse(a){return nP(a,this.buildRequest())}_linkToIdToken(a,b){let c=this.buildRequest();return c.idToken=b,nP(a,c)}_getReauthenticationResolver(a){let b=this.buildRequest();return b.autoCreate=!1,nP(a,b)}buildRequest(){let a={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{let b={};this.idToken&&(b.id_token=this.idToken),this.accessToken&&(b.access_token=this.accessToken),this.secret&&(b.oauth_token_secret=this.secret),b.providerId=this.providerId,this.nonce&&!this.pendingToken&&(b.nonce=this.nonce),a.postBody=hE(b)}return a}}class nR{constructor(a){const b=hF(hG(a)),c=b.apiKey??null,d=b.oobCode??null,e=function(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(b.mode??null);mS(c&&d&&e,"argument-error"),this.apiKey=c,this.operation=e,this.code=d,this.continueUrl=b.continueUrl??null,this.languageCode=b.lang??null,this.tenantId=b.tenantId??null}static parseLink(a){let b,c,d,e=(c=(b=hF(hG(a)).link)?hF(hG(b)).deep_link_id:null,((d=hF(hG(a)).deep_link_id)?hF(hG(d)).link:null)||d||c||b||a);try{return new nR(e)}catch{return null}}}class nS{constructor(){this.providerId=nS.PROVIDER_ID}static credential(a,b){return nO._fromEmailAndPassword(a,b)}static credentialWithLink(a,b){let c=nR.parseLink(b);return mS(c,"argument-error"),nO._fromEmailAndCode(a,c.code,c.tenantId)}}nS.PROVIDER_ID="password",nS.EMAIL_PASSWORD_SIGN_IN_METHOD="password",nS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class nT{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}class nU extends nT{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}class nV extends nU{constructor(){super("facebook.com")}static credential(a){return nQ._fromParams({providerId:nV.PROVIDER_ID,signInMethod:nV.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return nV.credentialFromTaggedObject(a)}static credentialFromError(a){return nV.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return nV.credential(a.oauthAccessToken)}catch{return null}}}nV.FACEBOOK_SIGN_IN_METHOD="facebook.com",nV.PROVIDER_ID="facebook.com";class nW extends nU{constructor(){super("google.com"),this.addScope("profile")}static credential(a,b){return nQ._fromParams({providerId:nW.PROVIDER_ID,signInMethod:nW.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:b})}static credentialFromResult(a){return nW.credentialFromTaggedObject(a)}static credentialFromError(a){return nW.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthIdToken:b,oauthAccessToken:c}=a;if(!b&&!c)return null;try{return nW.credential(b,c)}catch{return null}}}nW.GOOGLE_SIGN_IN_METHOD="google.com",nW.PROVIDER_ID="google.com";class nX extends nU{constructor(){super("github.com")}static credential(a){return nQ._fromParams({providerId:nX.PROVIDER_ID,signInMethod:nX.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return nX.credentialFromTaggedObject(a)}static credentialFromError(a){return nX.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return nX.credential(a.oauthAccessToken)}catch{return null}}}nX.GITHUB_SIGN_IN_METHOD="github.com",nX.PROVIDER_ID="github.com";class nY extends nU{constructor(){super("twitter.com")}static credential(a,b){return nQ._fromParams({providerId:nY.PROVIDER_ID,signInMethod:nY.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:b})}static credentialFromResult(a){return nY.credentialFromTaggedObject(a)}static credentialFromError(a){return nY.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthAccessToken:b,oauthTokenSecret:c}=a;if(!b||!c)return null;try{return nY.credential(b,c)}catch{return null}}}async function nZ(a,b){return m0(a,"POST","/v1/accounts:signUp",mZ(a,b))}nY.TWITTER_SIGN_IN_METHOD="twitter.com",nY.PROVIDER_ID="twitter.com";class n${constructor(a){this.user=a.user,this.providerId=a.providerId,this._tokenResponse=a._tokenResponse,this.operationType=a.operationType}static async _fromIdTokenResponse(a,b,c,d=!1){return new n$({user:await no._fromIdTokenResponse(a,c,d),providerId:n_(c),_tokenResponse:c,operationType:b})}static async _forOperation(a,b,c){return await a._updateTokensIfNecessary(c,!0),new n$({user:a,providerId:n_(c),_tokenResponse:c,operationType:b})}}function n_(a){return a.providerId?a.providerId:"phoneNumber"in a?"phone":null}async function n0(a){if(iq(a.app))return Promise.reject(mQ(a));let b=hN(a);if(await b._initializationPromise,b.currentUser?.isAnonymous)return new n$({user:b.currentUser,providerId:null,operationType:"signIn"});let c=await nZ(b,{returnSecureToken:!0}),d=await n$._fromIdTokenResponse(b,"signIn",c,!0);return await b._updateCurrentUser(d.user),d}class n1{constructor(a,b){this.factorId=a,this.uid=b.mfaEnrollmentId,this.enrollmentTime=new Date(b.enrolledAt).toUTCString(),this.displayName=b.displayName}static _fromServerResponse(a,b){return"phoneInfo"in b?n2._fromServerResponse(a,b):"totpInfo"in b?n3._fromServerResponse(a,b):mN(a,"internal-error")}}class n2 extends n1{constructor(a){super("phone",a),this.phoneNumber=a.phoneInfo}static _fromServerResponse(a,b){return new n2(b)}}class n3 extends n1{constructor(a){super("totp",a)}static _fromServerResponse(a,b){return new n3(b)}}async function n4(a,b){return m$(a,"POST","/v1/accounts:update",b)}async function n5(a,{displayName:b,photoURL:c}){if(void 0===b&&void 0===c)return;let d=hN(a),e=await d.getIdToken(),f=await ne(d,n4(d.auth,{idToken:e,displayName:b,photoUrl:c,returnSecureToken:!0}));d.displayName=f.displayName||null,d.photoURL=f.photoUrl||null;let g=d.providerData.find(({providerId:a})=>"password"===a);g&&(g.displayName=d.displayName,g.photoURL=d.photoURL),await d._updateTokensIfNecessary(f)}new WeakMap;var n6="@firebase/auth",n7="1.12.0";class n8{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(a){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(a)}:null}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;let b=this.auth.onIdTokenChanged(b=>{a(b?.stsTokenManager.accessToken||null)});this.internalListeners.set(a,b),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();let b=this.internalListeners.get(a);b&&(this.internalListeners.delete(a),b(),this.updateProactiveRefresh())}assertAuthConfigured(){mS(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}mV.initialize(fetch,Headers,Response),D="Node",ik(new hO("auth",(a,{options:b})=>{let c,d,e=a.getProvider("app").getImmediate(),f=a.getProvider("heartbeat"),g=a.getProvider("app-check-internal"),{apiKey:h,authDomain:i}=e.options;mS(h&&!h.includes(":"),"invalid-api-key",{appName:e.name});let j=new nz(e,f,g,{apiKey:h,authDomain:i,clientPlatform:D,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nv(D)});return d=(Array.isArray(c=b?.persistence||[])?c:[c]).map(nq),b?.errorMap&&j._updateErrorMap(b.errorMap),j._initializeWithPersistence(d,b?.popupRedirectResolver),j},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,b,c)=>{a.getProvider("auth-internal").initialize()})),ik(new hO("auth-internal",a=>new n8(hN(a.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),iC(n6,n7,function(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(D)),iC(n6,n7,"esm2020"),mO("operation-not-supported-in-this-environment"),nz.prototype.setPersistence=async()=>{};a.s([],48641),a.i(48641);let n9={apiKey:"AIzaSyCZoA63Ujp-AYb9jMx4XTeCfY4tB8Qc2Qc",authDomain:"sudoku-fb1a9.firebaseapp.com",databaseURL:"https://sudoku-fb1a9-default-rtdb.firebaseio.com",projectId:"sudoku-fb1a9",storageBucket:"sudoku-fb1a9.firebasestorage.app",messagingSenderId:"876606712356",appId:"1:876606712356:web:cdb27894402e24c74586b1"};try{n9.apiKey?(q=iA().length?iz():ix(n9),r=function(a=iz(),b){let c=il(a,"database").getImmediate({identifier:void 0});if(!c._instanceStarted){let a=(a=>{let b=hg(a);if(!b)return;let c=b.lastIndexOf(":");if(c<=0||c+1===b.length)throw Error(`Invalid host ${b} with no separate hostname and port!`);let d=parseInt(b.substring(c+1),10);return"["===b[0]?[b.substring(1,c-1),d]:[b.substring(0,c),d]})("database");a&&function(a,b,c,d={}){var e;let f,g,h;(a=hN(a))._checkNotDeleted("useEmulator");let i=`${b}:${c}`,j=a._repoInternal;if(a._instanceStarted){if(i===a._repoInternal.repoInfo_.host&&hC(d,j.repoInfo_.emulatorOptions))return;i5("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}j.repoInfo_.nodeAdmin?(d.mockUserToken&&i5('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),f=new jA(jA.OWNER)):d.mockUserToken&&(f=new jA("string"==typeof d.mockUserToken?d.mockUserToken:function(a,b){if(a.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let c=b||"demo-project",d=a.iat||0,e=a.sub||a.user_id;if(!e)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let f={iss:`https://securetoken.google.com/${c}`,aud:c,iat:d,exp:d+3600,auth_time:d,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}},...a};return[hd(JSON.stringify({alg:"none",type:"JWT"})),hd(JSON.stringify(f)),""].join(".")}(d.mockUserToken,a.app.options.projectId))),hj(b)&&(hk(b),hl("Database",!0)),e=f,g=i.lastIndexOf(":"),h=hj(i.substring(0,g)),j.repoInfo_=new jn(i,h,j.repoInfo_.namespace,j.repoInfo_.webSocketOnly,j.repoInfo_.nodeAdmin,j.repoInfo_.persistenceKey,j.repoInfo_.includeNamespaceInQueryParams,!0,d),e&&(j.authTokenProvider_=e)}(c,...a)}return c}(q),s=function(a=iz()){let b=il(a,"auth");if(b.isInitialized())return b.getImmediate();let c=function(a,b){let c=il(a,"auth");if(c.isInitialized()){let a=c.getImmediate();if(hC(c.getOptions(),(void 0)??{}))return a;mN(a,"already-initialized")}return c.initialize({options:void 0})}(a),d=hg("auth");return d&&function(a,b,c){let d=hN(a);mS(/^https?:\/\//.test(b),d,"invalid-emulator-scheme");let e=nH(b),{host:f,port:g}=function(a){let b=nH(a),c=/(\/\/)?([^?#/]+)/.exec(a.substr(b.length));if(!c)return{host:"",port:null};let d=c[2].split("@").pop()||"",e=/^(\[[^\]]+\])(:|$)/.exec(d);if(e){let a=e[1];return{host:a,port:nI(d.substr(a.length+1))}}{let[a,b]=d.split(":");return{host:a,port:nI(b)}}}(b),h=null===g?"":`:${g}`,i={url:`${e}//${f}${h}/`},j=Object.freeze({host:f,port:g,protocol:e.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!d._canInitEmulator){mS(d.config.emulator&&d.emulatorConfig,d,"emulator-config-failed"),mS(hC(i,d.config.emulator)&&hC(j,d.emulatorConfig),d,"emulator-config-failed");return}d.config.emulator=i,d.emulatorConfig=j,d.settings.appVerificationDisabledForTesting=!0,hj(f)?(hk(`${e}//${f}${h}`),hl("Auth",!0)):"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.")}(c,`http://${d}`),c}(q)):console.warn("Firebase config missing. Firebase features will not work.")}catch(a){console.warn("Firebase initialization failed:",a)}let oa={gamesPlayed:0,gamesWon:0,bestTime:{easy:null,medium:null,hard:null,expert:null},totalMistakes:0},ob=async(a,b="Player")=>{if(!r)throw Error("DB not initialized");let c=mD(r,`users/${a}`),d=await mF(c);if(d.exists())return d.val();{var e,f,g,h;let d,i,j,k,l,m,n,o={uid:a,displayName:b,stats:oa,lastActive:Date.now()};return await (mb("set",(e=hN(e=c))._path),l5("set",o,e._path,!1),d=new hi,f=e._repo,g=e._path,h=d.wrapCallback(()=>{}),mm(f,"set",{path:g.toString(),value:o,priority:null}),i=mh(f),k=lU(j=kl(o,null),lF(f.serverSyncTree_,g),i),l=ml(f),m=lA(f.serverSyncTree_,g,k,l,!0),me(f.eventQueue_,m),f.server_.put(g.toString(),j.val(!0),(a,b)=>{let c="ok"===a;c||i6("set at "+g+" failed: "+a);let d=lB(f.serverSyncTree_,l,!c);mf(f.eventQueue_,g,d),mn(f,h,a,b)}),n=mt(f,g),mp(f,n),mf(f.eventQueue_,n,[]),d.promise),o}},oc=async(a,b,c,d,e)=>{var f;let g;if(!r)return;let h=mD(r,`users/${a}`),i=await mF(h);if(!i.exists())return;let j=i.val().stats||{...oa};if(j.gamesPlayed+=1,b&&(j.gamesWon+=1),j.totalMistakes+=e,b&&null!==c){let a=j.bestTime[d];(null===a||c<a)&&(j.bestTime[d]=c)}await (l8("update",f={stats:j,lastActive:Date.now()},h._path,!1),g=new hi,!function(a,b,c,d){mm(a,"update",{path:b.toString(),value:c});let e=!0,f=mh(a),g={};if(jh(c,(c,d)=>{e=!1,g[c]=lT(jS(b,c),kl(d),a.serverSyncTree_,f)}),e)i2("update() called with empty data.  Don't do anything."),mn(a,d,"ok",void 0);else{var h,i;let e,f=ml(a),j=(h=a.serverSyncTree_,i=h.pendingWriteTree_,g6(f>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:b,children:g,writeId:f,visible:!0}),i.visibleWrites=kW(i.visibleWrites,b,g),i.lastWriteId=f,e=kT.fromObject(g),lG(h,new kK(kE(),b,e)));me(a.eventQueue_,j),a.server_.merge(b.toString(),c,(c,e)=>{let g="ok"===c;g||i6("update at "+b+" failed: "+c);let h=lB(a.serverSyncTree_,f,!g),i=h.length>0?mp(a,b):b;mf(a.eventQueue_,i,h),mn(a,d,c,e)}),jh(c,c=>{let d=mt(a,jS(b,c));mp(a,d)}),mf(a.eventQueue_,b,[])}}(h._repo,h._path,f,g.wrapCallback(()=>{})),g.promise)},od=(u=(a,b)=>({board:[],initialBoard:[],solvedBoard:[],notes:new Set,difficulty:"Medium",status:"idle",timer:0,mistakes:0,maxMistakes:3,history:[],isNotesMode:!1,selectedCell:null,hintsRemaining:3,lastHint:null,hoveredCell:null,highlightedNumber:null,opponentHoveredCells:[],cellOwners:{},currentTurn:null,mode:"single",roomId:null,playerId:null,uid:null,playerName:null,opponentProgress:0,opponentName:null,opponentStatus:null,isFirebaseConnected:!0,lastSyncError:null,syncAction:null,setSyncAction:b=>a({syncAction:b}),setRemoteBoard:b=>a({board:b}),setCellOwners:b=>a({cellOwners:b}),setCurrentTurn:b=>a({currentTurn:b}),startGame:(c,d="single")=>{let{initial:e,solved:f}=g2(c);a({board:e.map(a=>[...a]),initialBoard:e.map(a=>[...a]),solvedBoard:f,difficulty:c,status:"playing",timer:0,mistakes:0,history:[],notes:new Set,selectedCell:null,hintsRemaining:3,lastHint:null,cellOwners:{},mode:d,opponentName:"bot"===d?"AI Bot":null,uid:"bot"===d?"local-player":b().uid,currentTurn:"bot"===d?"local-player":null})},setMultiplayerState:b=>a(b),selectCell:(b,c)=>a({selectedCell:{r:b,c}}),toggleNotesMode:()=>a(a=>({isNotesMode:!a.isNotesMode})),setCellValue:c=>{let{board:d,selectedCell:e,initialBoard:f,solvedBoard:g,isNotesMode:h,notes:i,mistakes:j,maxMistakes:k,history:l,status:m,mode:n,uid:o,currentTurn:p}=b();if(!e||"won"===m||"lost"===m||("pvp"===n||"bot"===n)&&p&&o!==p)return;let{r:q,c:r}=e;if(0!==f[q][r])return;if(h){let b=`${q},${r},${c}`,d=new Set(i);d.has(b)?d.delete(b):d.add(b),a({notes:d});return}if(d[q][r]===c)return;let s=c===g[q][r],t=d.map(a=>[...a]);t[q][r]=c;let u=[...l,d.map(a=>[...a])];if(s){a({board:t,history:u});let d=0,e=!0;for(let a=0;a<9;a++)for(let b=0;b<9;b++)0!==t[a][b]&&d++,0!==t[a][b]&&t[a][b]!==g[a][b]&&(e=!1);let f=81===d&&e;if(f){a({status:"won"});let{uid:c,timer:d,difficulty:e}=b();c&&oc(c,!0,d,e.toLowerCase(),j).catch(a=>console.error("Stats Sync Failed:",a))}if("pvp"===n){let a=Math.floor(d/81*100),e=b().syncAction;e&&e({type:"CELL",r:q,c:r,val:c,progress:a,mistakes:j,status:f?"won":"playing",switchTurn:!0})}else"bot"===n&&(a({currentTurn:"bot"}),setTimeout(()=>{od.getState().playBotMove()},1e3+2e3*Math.random()))}else{let d=j+1;a({mistakes:d,board:t,history:u});let e=d>=k;if(e){a({status:"lost"});let{uid:c,timer:e,difficulty:f}=b();c&&oc(c,!1,e,f.toLowerCase(),d).catch(a=>console.error("Stats Sync Failed:",a))}if("pvp"===n){let a=0;for(let b=0;b<9;b++)for(let c=0;c<9;c++)0!==t[b][c]&&a++;let f=Math.floor(a/81*100),g=b().syncAction;g&&g({type:"CELL",r:q,c:r,val:c,progress:f,mistakes:d,status:e?"lost":"playing",switchTurn:!0})}else"bot"===n&&(a({currentTurn:"bot"}),setTimeout(()=>{od.getState().playBotMove()},1e3+2e3*Math.random()))}},undo:()=>{let{history:c}=b();0===c.length||a({board:c[c.length-1],history:c.slice(0,-1)})},resetGame:()=>{let{initialBoard:c}=b();a({board:c.map(a=>[...a]),timer:0,mistakes:0,notes:new Set,history:[],hintsRemaining:3,lastHint:null,cellOwners:{},status:"playing"})},tickTimer:()=>{"playing"===b().status&&a(a=>({timer:a.timer+1}))},getHint:()=>{let{board:c,solvedBoard:d,status:e,hintsRemaining:f}=b();if("playing"!==e||f<=0)return;let g=function(a,b){let c=function(a){for(let b=0;b<9;b++)for(let c=0;c<9;c++){if(0!==a[b][c])continue;let d=g3(a,b,c);if(1===d.size){let a=d.values().next().value;return{r:b,c,value:a,reason:`Only ${a} can go in R${b+1}C${c+1}  all other numbers are already in this row, column, or box.`,strategy:"naked_single"}}}return null}(a);if(c)return c;let d=function(a){for(let b=0;b<9;b++){let c=g4(a,function(a){let b=[];for(let c=0;c<9;c++)b.push({r:a,c});return b}(b),`Row ${b+1}`);if(c)return c}for(let b=0;b<9;b++){let c=g4(a,function(a){let b=[];for(let c=0;c<9;c++)b.push({r:c,c:a});return b}(b),`Column ${b+1}`);if(c)return c}for(let b=0;b<3;b++)for(let c=0;c<3;c++){let d=g4(a,function(a,b){let c=[],d=3*a,e=3*b;for(let a=0;a<3;a++)for(let b=0;b<3;b++)c.push({r:d+a,c:e+b});return c}(b,c),`Box ${3*b+c+1}`);if(d)return d}return null}(a);if(d)return d;let e=[];for(let b=0;b<9;b++)for(let c=0;c<9;c++)0===a[b][c]&&e.push({r:b,c});if(0===e.length)return null;let f=e[Math.floor(Math.random()*e.length)],g=b[f.r][f.c];return{r:f.r,c:f.c,value:g,reason:`The answer for R${f.r+1}C${f.c+1} is ${g}.`,strategy:"fallback"}}(c,d);if(!g)return;let h=c.map(a=>[...a]);h[g.r][g.c]=g.value;let i=!0;for(let a=0;a<9;a++){for(let b=0;b<9;b++)if(h[a][b]!==d[a][b]){i=!1;break}if(!i)break}a({board:h,selectedCell:{r:g.r,c:g.c},hintsRemaining:f-1,lastHint:g,status:i?"won":e}),setTimeout(()=>{b().lastHint===g&&a({lastHint:null})},3e3)},playBotMove:()=>{let{board:c,solvedBoard:d,status:e,cellOwners:f}=b();if("playing"!==e)return;let g=[];for(let a=0;a<9;a++)for(let b=0;b<9;b++)0===c[a][b]&&g.push({r:a,c:b});if(g.length>0){let{r:b,c:e}=g[Math.floor(Math.random()*g.length)],h=d[b][e],i=c.map(a=>[...a]);i[b][e]=h;let j={...f,[`${b},${e}`]:"bot"},k=0,l=!0;for(let a=0;a<9;a++)for(let b=0;b<9;b++)0!==i[a][b]&&k++,0!==i[a][b]&&i[a][b]!==d[a][b]&&(l=!1);let m=81===k&&l;a({board:i,cellOwners:j,opponentProgress:Math.floor(k/81*100),currentTurn:"local-player"}),m&&a({status:"lost",opponentStatus:"won"})}},setHoveredCell:b=>a({hoveredCell:b}),setHighlightedNumber:b=>a({highlightedNumber:b})}))?g1(u):g1,oe=(a,b)=>{let c=a instanceof Map?a:new Map(a.entries()),d=b instanceof Map?b:new Map(b.entries());if(c.size!==d.size)return!1;for(let[a,b]of c)if(!d.has(a)||!Object.is(b,d.get(a)))return!1;return!0};function of(a){let b=L.default.useRef(void 0);return c=>{let d=a(c);return!function(a,b){if(Object.is(a,b))return!0;if("object"!=typeof a||null===a||"object"!=typeof b||null===b||Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return!1;if(Symbol.iterator in a&&Symbol.iterator in b){if("entries"in a&&"entries"in b)return oe(a,b);let c=a[Symbol.iterator](),d=b[Symbol.iterator](),e=c.next(),f=d.next();for(;!e.done&&!f.done;){if(!Object.is(e.value,f.value))return!1;e=c.next(),f=d.next()}return!!e.done&&!!f.done}return oe({entries:()=>Object.entries(a)},{entries:()=>Object.entries(b)})}(b.current,d)?b.current=d:b.current}}let og=()=>({playSound:(0,L.useCallback)(a=>{try{let b=new(window.AudioContext||window.webkitAudioContext),c=b.createOscillator(),d=b.createGain();c.connect(d),d.connect(b.destination);let e=b.currentTime;"correct"===a?(c.type="sine",c.frequency.setValueAtTime(880,e),c.frequency.exponentialRampToValueAtTime(1320,e+.1),d.gain.setValueAtTime(.1,e),d.gain.exponentialRampToValueAtTime(.01,e+.1),c.start(e),c.stop(e+.1)):"wrong"===a?(c.type="sawtooth",c.frequency.setValueAtTime(220,e),c.frequency.exponentialRampToValueAtTime(110,e+.2),d.gain.setValueAtTime(.1,e),d.gain.linearRampToValueAtTime(0,e+.2),c.start(e),c.stop(e+.2)):"click"===a?(c.type="triangle",c.frequency.setValueAtTime(440,e),d.gain.setValueAtTime(.05,e),d.gain.linearRampToValueAtTime(0,e+.05),c.start(e),c.stop(e+.05)):"win"===a&&(c.type="sine",c.frequency.setValueAtTime(523.25,e),c.frequency.exponentialRampToValueAtTime(1046.5,e+.5),d.gain.setValueAtTime(.1,e),d.gain.linearRampToValueAtTime(0,e+.5),c.start(e),c.stop(e+.5))}catch(a){}},[]),triggerHaptic:(0,L.useCallback)(a=>{},[])}),oh=(0,L.memo)(({r:a,c:b,val:c,initial:d})=>{let e=od(of(c=>c.selectedCell?.r===a&&c.selectedCell?.c===b)),f=od(of(c=>{let d=c.selectedCell;return!!d&&(d.r===a||d.c===b||Math.floor(d.r/3)===Math.floor(a/3)&&Math.floor(d.c/3)===Math.floor(b/3))})),g=od(of(a=>{let b=a.selectedCell;if(!b)return!1;let d=a.board[b.r][b.c];return 0!==d&&d===c})),h=od(e=>!d&&0!==c&&c!==e.solvedBoard[a][b]),i=od(c=>c.lastHint?.r===a&&c.lastHint?.c===b),j=od(of(c=>c.hoveredCell?.r===a&&c.hoveredCell?.c===b)),k=od(of(c=>c.opponentHoveredCells.some(c=>c.r===a&&c.c===b))),l=od(of(c=>c.cellOwners[`${a},${b}`])),m=od(of(a=>a.uid)),n=od(of(d=>{if(0!==c)return[];let e=[];for(let c=1;c<=9;c++)d.notes.has(`${a},${b},${c}`)&&e.push(c);return e})),o=od(a=>a.selectCell),{playSound:p}=og();return(0,L.useEffect)(()=>{0===c||d||(c===od.getState().solvedBoard[a][b]?p("correct"):p("wrong"))},[c,a,b,d,p]),(0,K.jsx)("div",{onClick:()=>{p("click"),o(a,b)},"data-cell-row":a,"data-cell-col":b,className:g_("relative flex items-center justify-center w-full h-full cursor-pointer transition-colors duration-200","text-lg sm:text-xl md:text-2xl lg:text-3xl font-light select-none","border-[0.5px] border-slate-300",(2===b||5===b)&&"!border-r-2 !border-r-slate-800",(2===a||5===a)&&"!border-b-2 !border-b-slate-800",8===b&&"border-r-0",8===a&&"border-b-0",h?e?"bg-red-600 text-white":"bg-red-100 text-red-600":e?"bg-indigo-600 text-white":g?"bg-indigo-100 text-indigo-900":f?"bg-slate-100":"bg-white hover:bg-slate-50",i&&!e&&!h&&"ring-2 ring-amber-400 bg-amber-50 z-20",k&&!e&&!h&&"ring-2 ring-rose-400 bg-rose-50/50 z-20",j&&!e&&!h&&"bg-indigo-200 ring-2 ring-inset ring-indigo-500 z-30",e&&!h&&"!border-indigo-600 z-10",e&&h&&"!border-red-600 z-10",!e&&h&&"!border-red-200",d&&!e&&"text-slate-900 font-medium"),children:0!==c?(0,K.jsx)(f$.span,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:300,damping:20},className:g_("z-10",h&&"animate-shake",!d&&!h&&(l&&m&&l!==m?"text-rose-500":"text-indigo-600"),d&&"text-slate-900 font-medium"),children:c},c):(0,K.jsx)("div",{className:"grid grid-cols-3 w-full h-full p-0.5 pointer-events-none",children:[1,2,3,4,5,6,7,8,9].map(a=>(0,K.jsx)("div",{className:"flex items-center justify-center",children:n.includes(a)&&(0,K.jsx)("span",{className:"text-[9px] text-slate-500 font-medium leading-none",children:a})},a))})})});oh.displayName="Cell";let oi=()=>{let a=od(a=>a.board),b=od(a=>a.initialBoard),c=od(a=>a.startGame);return((0,L.useEffect)(()=>{0===a.length&&c("Medium")},[a.length,c]),0===a.length)?null:(0,K.jsx)(f$.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"w-full max-w-xl aspect-square bg-slate-800 p-1 rounded-sm shadow-2xl overflow-hidden",children:(0,K.jsx)("div",{className:"grid grid-cols-9 grid-rows-9 h-full w-full bg-white touch-manipulation",children:a.map((a,c)=>a.map((a,d)=>(0,K.jsx)(oh,{r:c,c:d,val:a,initial:0!==b[c][d]},`${c}-${d}`)))})})},oj=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim(),ok=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)};var ol={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let om=(0,L.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:e="",children:f,iconNode:g,...h},i)=>(0,L.createElement)("svg",{ref:i,...ol,width:b,height:b,stroke:a,strokeWidth:d?24*Number(c)/Number(b):c,className:oj("lucide",e),...!f&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0;return!1})(h)&&{"aria-hidden":"true"},...h},[...g.map(([a,b])=>(0,L.createElement)(a,b)),...Array.isArray(f)?f:[f]])),on=(a,b)=>{let c=(0,L.forwardRef)(({className:c,...d},e)=>(0,L.createElement)(om,{ref:e,iconNode:b,className:oj(`lucide-${ok(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,c),...d}));return c.displayName=ok(a),c},oo=on("eraser",[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]]),op=on("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),oq=on("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),or=on("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),os=()=>{let a=od(a=>a.undo),b=od(a=>a.toggleNotesMode),c=od(a=>a.isNotesMode),d=od(a=>a.setCellValue),e=od(a=>a.getHint),f=od(a=>a.hintsRemaining);return(0,K.jsxs)("div",{className:"flex justify-between w-full px-2",children:[(0,K.jsx)(ot,{icon:(0,K.jsx)(oq,{size:22}),label:"Undo",onClick:a}),(0,K.jsx)(ot,{icon:(0,K.jsx)(oo,{size:22}),label:"Erase",onClick:()=>d(0)}),(0,K.jsx)(ot,{icon:(0,K.jsx)(op,{size:22}),label:"Notes",isActive:c,onClick:b,badge:c?"ON":"OFF"}),(0,K.jsx)(ot,{icon:(0,K.jsx)(or,{size:22}),label:"Hint",onClick:e,badge:`${f}`,disabled:f<=0})]})},ot=({icon:a,label:b,onClick:c,isActive:d,badge:e,disabled:f})=>{let{playSound:g}=og();return(0,K.jsxs)(f$.button,{whileTap:f?{}:{scale:.9},whileHover:f?{}:{scale:1.05},onClick:f?void 0:()=>{g("click"),c?.()},suppressHydrationWarning:!0,draggable:!1,className:g_("flex flex-col items-center gap-2 group relative transition-all outline-none",f?"text-slate-300 cursor-not-allowed opacity-50":d?"text-indigo-600":"text-slate-400 hover:text-indigo-600"),children:[(0,K.jsx)("div",{className:g_("w-14 h-14 rounded-2xl flex items-center justify-center transition-all border-2 shadow-sm",f?"bg-slate-50 border-slate-100 text-slate-300":d?"bg-indigo-600 text-white border-indigo-600 shadow-indigo-200 shadow-lg ring-2 ring-indigo-100 ring-offset-2":"bg-white border-slate-100 text-slate-600 group-hover:border-indigo-100 group-hover:bg-indigo-50 group-hover:text-indigo-600"),children:a}),(0,K.jsx)("span",{className:"text-[10px] font-bold tracking-widest uppercase",children:b}),e&&(0,K.jsx)(f$.div,{initial:{scale:0},animate:{scale:1},className:g_("absolute top-0 right-0 -mr-1 -mt-1 text-[9px] font-bold px-1.5 py-0.5 rounded-full shadow-sm z-10 border border-white",f?"bg-slate-300 text-white":d?"bg-white text-indigo-600":"bg-slate-800 text-white"),children:e})]})},ou=()=>{let{setCellValue:a,mode:b,uid:c,currentTurn:d}=od(),e="pvp"===b&&null!==d&&c!==d,{playSound:f}=og(),g=a=>{e?a.preventDefault():od.getState().setHoveredCell(null)},h=a=>{let b=0,c=0;if("changedTouches"in a&&a.changedTouches.length>0)b=a.changedTouches[0].clientX,c=a.changedTouches[0].clientY;else if("touches"in a&&a.touches.length>0)b=a.touches[0].clientX,c=a.touches[0].clientY;else{if(!("clientX"in a))return null;b=a.clientX,c=a.clientY}for(let a of document.elementsFromPoint(b,c)){let b=a.closest("[data-cell-row]");if(b){let a=parseInt(b.getAttribute("data-cell-row")||"-1"),c=parseInt(b.getAttribute("data-cell-col")||"-1");if(-1!==a&&-1!==c)return{r:a,c}}}return null},i=(a,b)=>{if(e)return;let c=h(a),d=od.getState().hoveredCell;if(!c){null!==d&&od.getState().setHoveredCell(null);return}(c.r!==d?.r||c.c!==d?.c)&&od.getState().setHoveredCell(c)};return(0,K.jsx)("div",{className:"grid grid-cols-9 lg:grid-cols-3 gap-1 lg:gap-2 w-full touch-none",children:[1,2,3,4,5,6,7,8,9].map(b=>(0,K.jsx)(f$.div,{drag:!0,dragSnapToOrigin:!0,dragElastic:.1,dragMomentum:!1,whileDrag:{scale:1.2,zIndex:100,cursor:"grabbing",opacity:.8},onDragStart:g,onDrag:i,onDragEnd:(a,c)=>((a,b,c)=>{if(e)return;let d=h(a),f=od.getState();if(f.setHoveredCell(null),d){let{r:a,c:b}=d;f.initialBoard[a][b]||(f.selectCell(a,b),f.setCellValue(c))}})(a,0,b),onPointerDown:a=>{},whileHover:{scale:e?1:1.05},whileTap:{scale:e?1:.9},onClick:()=>{e||(f("click"),a(b))},draggable:!1,className:`aspect-square lg:aspect-[4/3] flex items-center justify-center text-2xl lg:text-4xl font-light text-indigo-600 bg-white shadow-sm border border-slate-200 hover:bg-slate-50 hover:border-indigo-200 hover:text-indigo-700 active:bg-indigo-100 rounded-lg lg:rounded-xl transition-all duration-300 select-none touch-none ${e?"opacity-50 grayscale cursor-not-allowed":"cursor-grab active:cursor-grabbing"}`,style:{touchAction:"none",WebkitUserDrag:"none"},children:b},b))})},ov=()=>{let a,b=od(a=>a.timer),c=od(a=>a.status);return(0,K.jsx)(f$.div,{animate:"playing"===c?{scale:[1,1.02,1],opacity:[.8,1,.8]}:{},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"font-mono text-xl font-bold text-slate-700 bg-white/50 backdrop-blur-sm px-3 py-1 rounded-lg border border-slate-100 shadow-inner",children:(a=Math.floor(b/60),`${a.toString().padStart(2,"0")}:${(b%60).toString().padStart(2,"0")}`)})};var ow=L;function ox(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}class oy extends ow.Component{getSnapshotBeforeUpdate(a){let b=this.props.childRef.current;if(b&&a.isPresent&&!this.props.isPresent&&!1!==this.props.pop){let a=b.offsetParent,c=fN(a)&&a.offsetWidth||0,d=fN(a)&&a.offsetHeight||0,e=this.props.sizeRef.current;e.height=b.offsetHeight||0,e.width=b.offsetWidth||0,e.top=b.offsetTop,e.left=b.offsetLeft,e.right=c-e.width-e.left,e.bottom=d-e.height-e.top}return null}componentDidUpdate(){}render(){return this.props.children}}function oz({children:a,isPresent:b,anchorX:c,anchorY:d,root:e,pop:f}){let g=(0,ow.useId)(),h=(0,ow.useRef)(null),i=(0,ow.useRef)({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:j}=(0,ow.useContext)(cy),k=function(...a){return L.useCallback(function(...a){return b=>{let c=!1,d=a.map(a=>{let d=ox(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():ox(a[b],null)}}}}(...a),a)}(h,a.props?.ref??a?.ref);return(0,ow.useInsertionEffect)(()=>{let{width:a,height:k,top:l,left:m,right:n,bottom:o}=i.current;if(b||!1===f||!h.current||!a||!k)return;let p="left"===c?`left: ${m}`:`right: ${n}`,q="bottom"===d?`bottom: ${o}`:`top: ${l}`;h.current.dataset.motionPopId=g;let r=document.createElement("style");j&&(r.nonce=j);let s=e??document.head;return s.appendChild(r),r.sheet&&r.sheet.insertRule(`
          [data-motion-pop-id="${g}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${k}px !important;
            ${p}px !important;
            ${q}px !important;
          }
        `),()=>{s.contains(r)&&s.removeChild(r)}},[b]),(0,K.jsx)(oy,{isPresent:b,childRef:h,sizeRef:i,pop:f,children:!1===f?a:ow.cloneElement(a,{ref:k})})}let oA=({children:a,initial:b,isPresent:c,onExitComplete:d,custom:e,presenceAffectsLayout:f,mode:g,anchorX:h,anchorY:i,root:j})=>{let k=cJ(oB),l=(0,L.useId)(),m=!0,n=(0,L.useMemo)(()=>(m=!1,{id:l,initial:b,isPresent:c,custom:e,onExitComplete:a=>{for(let b of(k.set(a,!0),k.values()))if(!b)return;d&&d()},register:a=>(k.set(a,!1),()=>k.delete(a))}),[c,k,d]);return f&&m&&(n={...n}),(0,L.useMemo)(()=>{k.forEach((a,b)=>k.set(b,!1))},[c]),L.useEffect(()=>{c||k.size||!d||d()},[c]),a=(0,K.jsx)(oz,{pop:"popLayout"===g,isPresent:c,anchorX:h,anchorY:i,root:j,children:a}),(0,K.jsx)(cI.Provider,{value:n,children:a})};function oB(){return new Map}let oC=a=>a.key||"";function oD(a){let b=[];return L.Children.forEach(a,a=>{(0,L.isValidElement)(a)&&b.push(a)}),b}let oE=({children:a,custom:b,initial:c=!0,onExitComplete:d,presenceAffectsLayout:e=!0,mode:f="sync",propagate:g=!1,anchorX:h="left",anchorY:i="top",root:j})=>{let[k,l]=eQ(g),m=(0,L.useMemo)(()=>oD(a),[a]),n=g&&!k?[]:m.map(oC),o=(0,L.useRef)(!0),p=(0,L.useRef)(m),q=cJ(()=>new Map),r=(0,L.useRef)(new Set),[s,t]=(0,L.useState)(m),[u,v]=(0,L.useState)(m);cT(()=>{o.current=!1,p.current=m;for(let a=0;a<u.length;a++){let b=oC(u[a]);n.includes(b)?(q.delete(b),r.current.delete(b)):!0!==q.get(b)&&q.set(b,!1)}},[u,n.length,n.join("-")]);let w=[];if(m!==s){let a=[...m];for(let b=0;b<u.length;b++){let c=u[b],d=oC(c);n.includes(d)||(a.splice(b,0,c),w.push(c))}return"wait"===f&&w.length&&(a=w),v(oD(a)),t(m),null}let{forceRender:x}=(0,L.useContext)(cx);return(0,K.jsx)(K.Fragment,{children:u.map(a=>{let s=oC(a),t=(!g||!!k)&&(m===u||n.includes(s));return(0,K.jsx)(oA,{isPresent:t,initial:(!o.current||!!c)&&void 0,custom:b,presenceAffectsLayout:e,mode:f,root:j,onExitComplete:t?void 0:()=>{if(r.current.has(s)||(r.current.add(s),!q.has(s)))return;q.set(s,!0);let a=!0;q.forEach(b=>{b||(a=!1)}),a&&(x?.(),v(p.current),g&&l?.(),d&&d())},anchorX:h,anchorY:i,children:a},s)})})},oF=on("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),oG=()=>{let a=od(a=>a.lastHint);return(0,K.jsx)(oE,{children:a&&(0,K.jsx)(f$.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",stiffness:400,damping:25},className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 max-w-sm w-[90vw]",children:(0,K.jsxs)("div",{className:"bg-white border border-amber-200 rounded-2xl shadow-lg shadow-amber-100/50 px-5 py-3.5 flex items-start gap-3",children:[(0,K.jsx)("div",{className:"w-8 h-8 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center flex-shrink-0 shadow-sm",children:(0,K.jsx)(oF,{size:16,className:"text-white"})}),(0,K.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,K.jsx)("p",{className:"text-[11px] font-bold uppercase tracking-widest text-amber-600 mb-0.5",children:"naked_single"===a.strategy?"Naked Single":"hidden_single"===a.strategy?"Hidden Single":"Hint"}),(0,K.jsx)("p",{className:"text-sm text-slate-700 leading-snug",children:a.reason})]})]})})})},oH=async a=>{if(!s)throw Error("Firebase Auth not initialized");try{let b=(await n0(s)).user;return a&&b&&await n5(b,{displayName:a}),b}catch(a){throw console.error("Auth error:",a),a}},oI=on("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),oJ=on("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),oK=on("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),oL=on("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),oM=on("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),oN=on("swords",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]]),oO=()=>{let{setMultiplayerState:a}=od(),[b,c]=(0,L.useState)(""),[d,e]=(0,L.useState)(""),[f,g]=(0,L.useState)(null),[h,i]=(0,L.useState)(""),[j,k]=(0,L.useState)(!1),[l,m]=(0,L.useState)(!1),n=async()=>{if(!b.trim())return void i("Enter your name to continue");i(""),k(!0);try{let c=await oH(b.trim());await ob(c.uid,b.trim());let d="ABCDEFGHJKMNPQRSTUVWXYZ23456789",e="";for(let a=0;a<6;a++)e+=d[Math.floor(Math.random()*d.length)];g(e),a({roomId:e,playerId:b.trim(),uid:c.uid,mode:"pvp",status:"waiting"})}catch(a){console.error("Lobby Create Error:",a),i(a instanceof Error?a.message:"Failed to create room")}finally{k(!1)}},o=async()=>{if(!b.trim()||!d.trim())return void i("Enter your name and room code");i(""),k(!0);try{let c=d.trim().toUpperCase(),e=await oH(b.trim());await ob(e.uid,b.trim()),a({roomId:c,playerId:b.trim(),uid:e.uid,mode:"pvp",status:"waiting"})}catch(a){i(a instanceof Error?a.message:"Failed to join room")}finally{k(!1)}};return f?(0,K.jsx)(f$.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex flex-col items-center justify-center w-full max-w-md mx-auto p-8",children:(0,K.jsxs)("div",{className:"bg-white rounded-3xl shadow-xl shadow-slate-200/60 border border-slate-100 p-8 w-full text-center",children:[(0,K.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center mx-auto mb-5 shadow-lg shadow-indigo-200",children:(0,K.jsx)(oN,{size:28,className:"text-white"})}),(0,K.jsx)("h2",{className:"text-2xl font-bold text-slate-800 mb-1",children:"Room Created!"}),(0,K.jsx)("p",{className:"text-sm text-slate-400 mb-6",children:"Share this code with your opponent"}),(0,K.jsxs)("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-6 mb-6",children:[(0,K.jsx)("p",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-2",children:"Room Code"}),(0,K.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,K.jsx)("p",{className:"text-4xl font-mono font-black tracking-[0.3em] text-slate-800 select-all",children:f}),(0,K.jsx)("button",{onClick:()=>{f&&(navigator.clipboard.writeText(f),m(!0),setTimeout(()=>m(!1),2e3))},className:"w-10 h-10 rounded-xl bg-white border border-slate-200 flex items-center justify-center text-slate-500 hover:text-indigo-600 hover:border-indigo-200 transition-all shadow-sm",children:l?(0,K.jsx)(oJ,{size:18,className:"text-emerald-500"}):(0,K.jsx)(oI,{size:18})})]})]}),(0,K.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,K.jsxs)("div",{className:"flex items-center justify-center gap-3 text-indigo-500",children:[(0,K.jsx)(oM,{size:18,className:"animate-spin"}),(0,K.jsx)("span",{className:"text-sm font-medium",children:"Waiting for opponent to connect..."})]}),(0,K.jsx)("button",{onClick:()=>{od.getState().setMultiplayerState({status:"playing"})},className:"mt-2 text-indigo-600 text-sm font-bold underline decoration-indigo-200 underline-offset-4",children:"Or join the room now"})]}),(0,K.jsxs)("button",{onClick:()=>g(null),className:"mt-6 flex items-center gap-2 mx-auto text-sm text-slate-400 hover:text-slate-600 transition-colors",children:[(0,K.jsx)(oL,{size:14}),(0,K.jsx)("span",{children:"Back"})]})]})}):(0,K.jsx)(f$.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:300,damping:25},className:"flex flex-col items-center justify-center w-full max-w-sm mx-auto p-4",children:(0,K.jsxs)("div",{className:"bg-white rounded-3xl shadow-xl shadow-slate-200/60 border border-slate-100 p-8 w-full",children:[(0,K.jsxs)("div",{className:"text-center mb-8",children:[(0,K.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center mx-auto mb-4 shadow-lg shadow-indigo-200",children:(0,K.jsx)(oK,{size:24,className:"text-white"})}),(0,K.jsx)("h2",{className:"text-2xl font-bold text-slate-800",children:"PvP Arena"}),(0,K.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Challenge a friend in real-time"})]}),(0,K.jsxs)("div",{className:"mb-6",children:[(0,K.jsx)("label",{className:"text-[10px] font-bold uppercase tracking-[0.15em] text-slate-400 mb-2 block",children:"Your Name"}),(0,K.jsx)("input",{type:"text",placeholder:"Enter your name",value:b,onChange:a=>{c(a.target.value),i("")},maxLength:16,className:"w-full px-4 py-3.5 rounded-xl border-2 border-slate-100 bg-slate-50 text-slate-800 placeholder-slate-300 font-medium focus:border-indigo-400 focus:bg-white focus:ring-4 focus:ring-indigo-50 outline-none transition-all"})]}),(0,K.jsx)(f$.button,{whileTap:{scale:.97},onClick:n,disabled:j,className:"w-full py-3.5 bg-slate-900 text-white rounded-xl font-bold text-sm tracking-wide hover:bg-slate-800 disabled:opacity-40 disabled:cursor-not-allowed transition-all shadow-lg shadow-slate-300/30",children:j?(0,K.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,K.jsx)(oM,{size:16,className:"animate-spin"}),"Creating..."]}):"Create Room"}),(0,K.jsxs)("div",{className:"flex items-center gap-4 my-6",children:[(0,K.jsx)("div",{className:"h-[1px] bg-slate-100 flex-1"}),(0,K.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-slate-300",children:"or join"}),(0,K.jsx)("div",{className:"h-[1px] bg-slate-100 flex-1"})]}),(0,K.jsxs)("div",{className:"flex gap-2",children:[(0,K.jsx)("input",{type:"text",placeholder:"ROOM CODE",value:d,onChange:a=>{e(a.target.value.toUpperCase()),i("")},maxLength:6,className:"flex-1 px-4 py-3.5 rounded-xl border-2 border-slate-100 bg-slate-50 text-slate-800 placeholder-slate-300 font-mono font-bold text-center tracking-[0.2em] uppercase focus:border-indigo-400 focus:bg-white focus:ring-4 focus:ring-indigo-50 outline-none transition-all"}),(0,K.jsx)(f$.button,{whileTap:{scale:.95},onClick:o,disabled:j,className:"px-6 py-3.5 bg-indigo-600 text-white rounded-xl font-bold text-sm hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed transition-all shadow-md shadow-indigo-200/50",children:j?(0,K.jsx)(oM,{size:16,className:"animate-spin"}):"Join"})]}),(0,K.jsxs)("div",{className:"mt-8",children:[(0,K.jsx)("p",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-slate-300 text-center mb-3",children:"No one online?"}),(0,K.jsxs)(f$.button,{whileTap:{scale:.97},onClick:()=>{let{startGame:a,difficulty:b}=od.getState();a(b,"bot")},className:"w-full py-3 bg-white text-indigo-600 border-2 border-indigo-100 rounded-xl font-bold text-sm hover:bg-indigo-50 hover:border-indigo-200 transition-all flex items-center justify-center gap-2",children:[(0,K.jsx)(oN,{size:16}),"Practice vs AI Bot"]})]}),(0,K.jsx)(oE,{children:h&&(0,K.jsx)(f$.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0},className:"mt-4 text-sm text-center text-rose-500 font-medium bg-rose-50 py-2.5 rounded-xl border border-rose-100",children:h})})]})})},oP=on("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),oQ=on("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var oR=Object.defineProperty,oS="@liveblocks/core",oT="3.14.0",oU="u">typeof globalThis?globalThis:a.g;function oV(a){console.error(a)}function oW(){let a=new Set;function b(b){return a.add(b),()=>a.delete(b)}function c(a){let c=b(b=>(c(),a(b)));return c}async function d(a){let c;return new Promise(d=>{c=b(b=>{(void 0===a||a(b))&&d(b)})}).finally(()=>c?.())}return{notify:function(b){let c=!1;for(let d of a)d(b),c=!0;return c},subscribe:b,subscribeOnce:c,count:function(){return a.size},waitUntil:d,dispose(){a.clear()},observable:{subscribe:b,subscribeOnce:c,waitUntil:d}}}function oX(a){throw Error(a)}function oY(a){return Object.entries(a)}function oZ(a){try{return JSON.parse(a)}catch(a){return}}function o$(a){return JSON.parse(JSON.stringify(a))}function o_(a){return a.filter(a=>null!=a)}function o0(a){let b={...a};return Object.keys(a).forEach(a=>{void 0===b[a]&&delete b[a]}),b}async function o1(a,b,c){let d;return Promise.race([a,new Promise((a,e)=>{d=setTimeout(()=>{e(Error(c))},b)})]).finally(()=>clearTimeout(d))}function o2(a){let b=null;return()=>(null===b&&(b=a().catch(a=>{throw setTimeout(()=>{b=null},5e3),a})),b)}var o3=Symbol("kSinks"),o4=Symbol("kTrigger"),o5=null,o6=null;function o7(a){if(null!==o5)return void a();o5=new Set;try{a()}finally{for(let a of o5)a[o4]();o5=null}}function o8(a){o5||oX("Expected to be in an active batch"),o5.add(a)}function o9(a,b){let c=!1,d={...a};return Object.keys(b).forEach(a=>{let e=b[a];d[a]!==e&&(void 0===e?delete d[a]:d[a]=e,c=!0)}),c?d:a}var pa=class{equals;#a;[o3];constructor(a){this.equals=a??Object.is,this.#a=oW(),this[o3]=new Set,this.get=this.get.bind(this),this.subscribe=this.subscribe.bind(this),this.subscribeOnce=this.subscribeOnce.bind(this)}dispose(){this.#a.dispose(),this.#a="(disposed)",this.equals="(disposed)"}get hasWatchers(){if(this.#a.count()>0)return!0;for(let a of this[o3])if(a.hasWatchers)return!0;return!1}[o4](){for(let a of(this.#a.notify(),this[o3]))o8(a)}subscribe(a){return 0===this.#a.count()&&this.get(),this.#a.subscribe(a)}subscribeOnce(a){let b=this.subscribe(()=>(b(),a()));return b}waitUntil(){throw Error("waitUntil not supported on Signals")}markSinksDirty(){for(let a of this[o3])a.markDirty()}addSink(a){this[o3].add(a)}removeSink(a){this[o3].delete(a)}asReadonly(){return this}},pb=class extends pa{#b;constructor(a,b){super(b),this.#b=(a=>a)(a)}dispose(){super.dispose(),this.#b="(disposed)"}get(){return o6?.add(this),this.#b}set(a){o7(()=>{"function"==typeof a&&(a=a(this.#b)),this.equals(this.#b,a)||(this.#b=a,this.markSinksDirty(),o8(this))})}},pc=class extends pb{constructor(a){super((a=>a)(o0(a)))}set(){throw Error("Don't call .set() directly, use .patch()")}patch(a){super.set(b=>o9(b,a))}},pd=Symbol(),pe=class a extends pa{#c;#d;#e;#f;#g;static from(...b){let c=b.pop();if("function"!=typeof c&&oX("Invalid .from() call, last argument expected to be a function"),"function"!=typeof b[b.length-1])return new a(b,c);{let d=b.pop();return new a(b,d,c)}}constructor(a,b,c){super(c),this.#d=!0,this.#c=pd,this.#f=a,this.#e=new Set,this.#g=b}dispose(){for(let a of this.#e)a.removeSink(this);this.#c="(disposed)",this.#e="(disposed)",this.#f="(disposed)",this.#g="(disposed)"}get isDirty(){return this.#d}#h(){let a,b=o6;o6=new Set;try{a=this.#g(...this.#f.map(a=>a.get()))}finally{let a=this.#e;for(let b of(this.#e=new Set,o6))this.#e.add(b),a.delete(b);for(let b of a)b.removeSink(this);for(let a of this.#e)a.addSink(this);o6=b}return this.#d=!1,!this.equals(this.#c,a)&&(this.#c=a,!0)}markDirty(){this.#d||(this.#d=!0,this.markSinksDirty())}get(){return this.#d&&this.#h(),o6?.add(this),this.#c}[o4](){!this.hasWatchers||this.#h()&&super[o4]()}},pf=class extends pa{#i;constructor(a){super(),this.#i=a}dispose(){super.dispose(),this.#i="(disposed)"}get(){return o6?.add(this),this.#i}mutate(a){o7(()=>{let b=!a||a(this.#i);null!==b&&"object"==typeof b&&"then"in b&&oX("MutableSignal.mutate() does not support async callbacks"),!1!==b&&(this.markSinksDirty(),o8(this))})}},pg=class a{#j;#k;constructor(a,b){this.#k=b,this.#j=a}static with(b){return a.fromAlreadySorted([],b)}static from(b,c){let d=new a([],c);for(let a of b)d.add(a);return d}static fromAlreadySorted(b,c){return new a(b,c)}clone(){return new a(this.#j.slice(),this.#k)}add(a){let b=function(a,b,c){let d=0,e=a.length;for(;d<e;){let f=d+(e-d>>1);c(b,a[f])?e=f:d=f+1}return d}(this.#j,a,this.#k);return this.#j.splice(b,0,a),b}clear(){let a=this.#j.length>0;return this.#j.length=0,a}removeBy(a,b=1/0){let c=0;for(let d=0;d<this.#j.length;d++)if(a(this.#j[d])){if(this.#j.splice(d,1),++c>=b)break;d--}return c>0}remove(a){let b=this.#j.indexOf(a);return b>=0&&(this.#j.splice(b,1),!0)}removeAt(a){if(a<0||a>=this.#j.length)return;let[b]=this.#j.splice(a,1);return b}reposition(a){let b=this.#j.indexOf(a);if(b<0)throw Error("Cannot reposition item that is not in the list");let c=this.#j[b-1],d=this.#j[b+1],e=void 0===c||this.#k(c,a),f=void 0===d||this.#k(a,d);if(e&&f)return b;let g=b;for(;g>0&&this.#k(a,this.#j[g-1]);)this.#j[g]=this.#j[g-1],g--;if(g<b)return this.#j[g]=a,g;for(;g<this.#j.length-1&&!this.#k(a,this.#j[g+1]);)this.#j[g]=this.#j[g+1],g++;return g!==b&&(this.#j[g]=a),g}at(a){return this.#j[a]}get length(){return this.#j.length}*filter(a){for(let b of this.#j)a(b)&&(yield b)}*findAllRight(a){for(let b=this.#j.length-1;b>=0;b--){let c=this.#j[b];a(c,b)&&(yield c)}}[Symbol.iterator](){return this.#j[Symbol.iterator]()}*iterReversed(){for(let a=this.#j.length-1;a>=0;a--)yield this.#j[a]}find(a,b){let c=this.findIndex(a,b);return c>-1?this.#j.at(c):void 0}findIndex(a,b=0){for(let c=Math.max(0,b);c<this.#j.length;c++)if(a(this.#j[c],c))return c;return -1}findRight(a,b){let c=this.findIndexRight(a,b);return c>-1?this.#j.at(c):void 0}findIndexRight(a,b=this.#j.length-1){for(let c=Math.min(b,this.#j.length-1);c>=0;c--)if(a(this.#j[c],c))return c;return -1}get rawArray(){return this.#j}},ph=class{#l;#m;signal;constructor(){this.#l=new Map,this.#m=pg.from([],(a,b)=>{let c=b.lastMessageAt??b.createdAt,d=a.lastMessageAt??a.createdAt;return c<d||c===d&&b.id<a.id}),this.signal=new pf(this)}getEvenIfDeleted(a){return this.signal.get(),this.#l.get(a)}markDeleted(a){let b=this.#l.get(a);void 0!==b&&void 0===b.deletedAt&&this.upsert({...b,deletedAt:new Date().toISOString()})}upsert(a){this.signal.mutate(()=>{let b=this.#l.get(a.id);if(void 0!==b){if(void 0!==b.deletedAt)return!1;this.#m.remove(b),this.#l.delete(b.id)}return void 0===a.deletedAt&&this.#m.add(a),this.#l.set(a.id,a),!0})}findMany(a){return Array.from(this.#m.filter(b=>{if(void 0===a.metadata)return!0;for(let[c,d]of Object.entries(a.metadata))if(null===d){if(c in b.metadata)return!1}else if("string"==typeof d){if(b.metadata[c]!==d)return!1}else{let a=b.metadata[c];if(!Array.isArray(a)||!d.every(b=>a.includes(b)))return!1}return!0}))}};function pi(a){let b=a.editedAt?new Date(a.editedAt):void 0,c=new Date(a.createdAt),d=a.reactions.map(a=>({...a,createdAt:new Date(a.createdAt)}));if(a.body)return{...a,reactions:d,createdAt:c,editedAt:b};{let e=new Date(a.deletedAt);return{...a,reactions:d,createdAt:c,editedAt:b,deletedAt:e}}}function pj(a){let b=new Date(a.createdAt),c=new Date(a.updatedAt),d=a.comments.map(a=>pi(a));return{...a,createdAt:b,updatedAt:c,comments:d}}function pk(a){let b=new Date(a.notifiedAt),c=a.readAt?new Date(a.readAt):null;if("activities"in a){let d=a.activities.map(a=>({...a,createdAt:new Date(a.createdAt)}));return{...a,notifiedAt:b,readAt:c,activities:d}}return{...a,notifiedAt:b,readAt:c}}function pl(a){let b=new Date(a.createdAt);return{...a,createdAt:b}}function pm(a){let b=new Date(a.deletedAt);return{...a,deletedAt:b}}function pn(a){let b=new Date(a.deletedAt);return{...a,deletedAt:b}}function po(a){let b=new Date(a.deletedAt);return{...a,deletedAt:b}}function pp(a){let b=new Date(a.createdAt),c=new Date(a.updatedAt),d=a.members.map(a=>({...a,addedAt:new Date(a.addedAt)}));return{...a,createdAt:b,updatedAt:c,members:d}}function pq(a,b){throw Error(b)}function pr(a,b){}function ps(a,b="Expected value to be non-nullable"){return pr(null!=a,b),a}var pt={},pu={error:()=>px,errorWithTitle:()=>pz,warn:()=>pw,warnWithTitle:()=>py};for(var pv in pu)oR(pt,pv,{get:pu[pv],enumerable:!0});var pw=console.warn,px=console.error,py=console.warn,pz=console.error;function pA(a){return null!=a}function pB(a){return null!==a&&"object"==typeof a&&"[object Object]"===Object.prototype.toString.call(a)}function pC(a){return pB(a)&&"string"==typeof a.startsWith}function pD(a){return pB(a)&&("number"==typeof a.lt||"number"==typeof a.gt||"number"==typeof a.lte||"number"==typeof a.gte)}var pE=class a extends Error{response;details;constructor(a,b,c){super(a),this.name="HttpError",this.response=b,this.details=c}static async fromResponse(b){let c,d,e;try{c=await b.text()}catch{}let f=c?oZ(c):void 0;pB(f)&&(d=f);let g="";g||="string"==typeof d?.message?d.message:"",g||="string"==typeof d?.error?d.error:"",void 0===f&&(g||=c||""),g||=b.statusText;try{e=new URL(b.url).pathname}catch{}return new a(g+=void 0!==e?` (got status ${b.status} from ${e})`:` (got status ${b.status})`,b,d)}get status(){return this.response.status}},pF=a=>a instanceof pE&&a.status>=400&&a.status<500;async function pG(a,b,c,d=pF){let e=c.length>0?c[c.length-1]:0,f=0;for(;;){f++;try{return await a()}catch(a){if(d(a))throw a;if(f>=b)throw Error(`Failed after ${b} attempts: ${String(a)}`)}let g=c[f-1]??e;pw(`Attempt ${f} was unsuccessful. Retrying in ${g} milliseconds.`),await function(a){return new Promise(b=>setTimeout(b,a))}(g)}}function pH(){let a,b;return[new Promise((c,d)=>{a=c,b=d}),a,b]}function pI(){let[a,b,c]=pH();return{promise:a,resolve:b,reject:c}}function pJ(a,b){return null===b||"object"!=typeof b||Array.isArray(b)?b:Object.keys(b).sort().reduce((a,c)=>(a[c]=b[c],a),{})}function pK(a){return JSON.stringify(a,pJ)}function pL(a){try{return JSON.stringify(a)}catch(b){throw console.error(`Could not stringify: ${b.message}`),console.error(a),b}}var pM=class{input;resolve;reject;promise;constructor(a){this.input=a;const{promise:b,resolve:c,reject:d}=pI();this.promise=b,this.resolve=c,this.reject=d}},pN=class{#n=[];#o;#p;#q;#r;error=!1;constructor(a,b){this.#o=a,this.#p=b.size??50,this.#q=b.delay}#s(){void 0!==this.#r&&(clearTimeout(this.#r),this.#r=void 0)}#t(){this.#n.length===this.#p?this.#u():1===this.#n.length&&(this.#s(),this.#r=setTimeout(()=>void this.#u(),this.#q))}async #u(){if(0===this.#n.length)return;let a=this.#n.splice(0),b=a.map(a=>a.input);try{let c=await this.#o(b);this.error=!1,a.forEach((b,d)=>{let e=c?.[d];Array.isArray(c)?a.length!==c.length?b.reject(Error(`Callback must return an array of the same length as the number of provided items. Expected ${a.length}, but got ${c.length}.`)):e instanceof Error?b.reject(e):b.resolve(e):b.reject(Error("Callback must return an array."))})}catch(b){this.error=!0,a.forEach(a=>{a.reject(b)})}}get(a){let b=this.#n.find(b=>pK(b.input)===pK(a));if(b)return b.promise;let c=new pM(a);return this.#n.push(c),this.#t(),c.promise}clear(){this.#n=[],this.error=!1,this.#s()}};function pO(a){let b=new pf(new Map);function c(a){b.mutate(b=>{if(Array.isArray(a))for(let c of a)b.set(c.key,c.state);else b.set(a.key,a.state)})}async function d(d){let e=pK(d);if(!b.get().has(e))try{c({key:e,state:{isLoading:!0}});let b=await a.get(d);c({key:e,state:{isLoading:!1,data:b}})}catch(a){c({key:e,state:{isLoading:!1,error:a}})}}return{subscribe:b.subscribe,enqueue:d,setData:function(a){c(a.map(a=>({key:pK(a[0]),state:{isLoading:!1,data:a[1]}})))},getItemState:function(a){let c=pK(a);return b.get().get(c)},getData:function(a){let c=pK(a),d=b.get();return d.get(c)?.data},invalidate:function(a){b.mutate(b=>{if(Array.isArray(a))for(let c of a)b.delete(pK(c));else b.clear()})},batch:a,_cacheKeys:function(){return[...b.get().keys()]}}}var pP=(a=21)=>crypto.getRandomValues(new Uint8Array(a)).reduce((a,b)=>a+=(b&=63)<36?b.toString(36):b<62?(b-26).toString(36).toUpperCase():b<63?"_":"-","");function pQ(a){return`${a}_${pP()}`}function pR(){return pQ("cm")}var pS=class extends Map{#v;constructor(a,b){super(b),this.#v=a}getOrCreate(a,b){if(super.has(a))return super.get(a);{let c=(b??this.#v??oX("DefaultMap used without a factory function"))(a);return this.set(a,c),c}}},pT=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function pU(a){let b=[],c=Object.entries(a),d=[],e=[],f=[];return c.forEach(([a,b])=>{if(!pT.test(a))throw Error("Key must only contain letters, numbers, _");pX(b)?d.push([a,b]):pB(b)&&(pC(b)||pD(b)?e.push([a,b]):f.push([a,b]))}),b=[...pV(d),...pW(e)],f.forEach(([a,c])=>{let d=Object.entries(c),e=[],f=[];d.forEach(([b,c])=>{if(pZ(b))throw Error("Key cannot be empty");pX(c)?e.push([pY(a,b),c]):(pC(c)||pD(c))&&f.push([pY(a,b),c])}),b=[...b,...pV(e),...pW(f)]}),b.map(({key:a,operator:b,value:c})=>`${a}${b}${p$(c)}`).join(" ")}var pV=a=>{let b=[];return a.forEach(([a,c])=>{b.push({key:a,operator:":",value:c})}),b},pW=a=>{let b=[];return a.forEach(([a,c])=>{"startsWith"in c&&"string"==typeof c.startsWith&&b.push({key:a,operator:"^",value:c.startsWith}),"lt"in c&&"number"==typeof c.lt&&b.push({key:a,operator:"<",value:c.lt}),"gt"in c&&"number"==typeof c.gt&&b.push({key:a,operator:">",value:c.gt}),"gte"in c&&"number"==typeof c.gte&&b.push({key:a,operator:">=",value:c.gte}),"lte"in c&&"number"==typeof c.lte&&b.push({key:a,operator:"<=",value:c.lte})}),b},pX=a=>"string"==typeof a||"number"==typeof a||"boolean"==typeof a||null===a,pY=(a,b)=>b?`${a}[${p$(b)}]`:a,pZ=a=>!a||""===a.toString().trim();function p$(a){let b=JSON.stringify(a);return"string"!=typeof a||b.includes("'")?b:`'${b.slice(1,-1).replace(/\\"/g,'"')}'`}function p_(a,...b){return a.reduce((a,c,d)=>a+encodeURIComponent(b[d-1]??"")+c)}function p0(a){return"public"===a.type?a.publicApiKey:a.token.raw}var p1=class{#w;#x;constructor(a,b){this.#w=a,this.#x=b}async #y(a,b,c,d){var e;let f;a.startsWith("/v2/c/")||oX("This client can only be used to make /v2/c/* requests");let g=(e=this.#w,f=new URL(a,e),void 0!==d&&(f.search=(d instanceof URLSearchParams?d:function(a){let b=new URLSearchParams;for(let[c,d]of Object.entries(a))null!=d&&b.set(c,d.toString());return b}(d)).toString()),f.toString()),h=await this.#x(g,{...c,headers:{"Content-Type":"application/json; charset=utf-8",...c?.headers,Authorization:`Bearer ${p0(b)}`,"X-LB-Client":oT||"dev"}}),i=h.headers.get("X-LB-Warn");if(i){let b=c?.method?.toUpperCase()??"GET",d=`${i} (${b} ${a})`;h.ok?pw(d):px(d)}return h}async #z(a,b,c,d){let e,f=await this.#y(a,b,c,d);if(!f.ok)throw await pE.fromResponse(f);try{e=await f.json()}catch{e={}}return e}async rawGet(a,b,c,d){return await this.#y(a,b,d,c)}async rawPost(a,b,c){return await this.#y(a,b,{method:"POST",body:pL(c)})}async rawDelete(a,b){return await this.#y(a,b,{method:"DELETE"})}async get(a,b,c,d){return await this.#z(a,b,d,c)}async post(a,b,c,d,e){return await this.#z(a,b,{...d,method:"POST",body:pL(c)},e)}async delete(a,b){return await this.#z(a,b,{method:"DELETE"})}async putBlob(a,b,c,d,e){return await this.#z(a,b,{...e,method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:c},d)}},p2=class{#A;constructor(a){this.#A=a}get current(){return this.#A}allowPatching(a){let b=this,c=!0;a({...this.#A,patch(a){if(c)for(let c of(b.#A=Object.assign({},b.#A,a),Object.entries(a))){let[a,b]=c;"patch"!==a&&(this[a]=b)}else throw Error("Can no longer patch stale context")}}),c=!1}},p3=1,p4=class{id;#B;#C;#D;#E;#F;#G;events;#H;#I;#J;#K;get #L(){let a=this.#D.values()[Symbol.iterator]().next();if(!a.done)return a.value;throw Error("No states defined yet")}get currentState(){if(null===this.#E)if(0===this.#B)throw Error("Not started yet");else throw Error("Already stopped");return this.#E}start(){if(0!==this.#B)throw Error("State machine has already started");return this.#B=1,this.#E=this.#L,this.#M(null),this}stop(){if(1!==this.#B)throw Error("Cannot stop a state machine that hasn't started yet");this.#N(null),this.#B=2,this.#E=null}constructor(a){this.id=p3++,this.#B=0,this.#E=null,this.#D=new Set,this.#J=new Map,this.#H=[],this.#I=[],this.#K=new Set,this.#F=new Map,this.#C=new p2(a),this.#G={didReceiveEvent:oW(),willTransition:oW(),didIgnoreEvent:oW(),willExitState:oW(),didEnterState:oW(),didExitState:oW()},this.events={didReceiveEvent:this.#G.didReceiveEvent.observable,willTransition:this.#G.willTransition.observable,didIgnoreEvent:this.#G.didIgnoreEvent.observable,willExitState:this.#G.willExitState.observable,didEnterState:this.#G.didEnterState.observable,didExitState:this.#G.didExitState.observable}}get context(){return this.#C.current}addState(a){if(0!==this.#B)throw Error("Already started");return this.#D.add(a),this}onEnter(a,b){if(0!==this.#B)throw Error("Already started");if(this.#J.has(a))throw Error(`enter/exit function for ${a} already exists`);return this.#J.set(a,b),this}onEnterAsync(a,b,c,d,e){return this.onEnter(a,()=>{let a=new AbortController,f=a.signal,g=e?setTimeout(()=>{let a=Error("Timed out");this.#O({type:"ASYNC_ERROR",reason:a},d)},e):void 0,h=!1;return b(this.#C.current,f).then(a=>{f.aborted||(h=!0,this.#O({type:"ASYNC_OK",data:a},c))},a=>{f.aborted||(h=!0,this.#O({type:"ASYNC_ERROR",reason:a},d))}),()=>{clearTimeout(g),h||a.abort()}})}#P(a){let b=[];if("*"===a)for(let a of this.#D)b.push(a);else if(a.endsWith(".*")){let c=a.slice(0,-1);for(let a of this.#D)a.startsWith(c)&&b.push(a)}else this.#D.has(a)&&b.push(a);if(0===b.length)throw Error(`No states match ${JSON.stringify(a)}`);return b}addTransitions(a,b){if(0!==this.#B)throw Error("Already started");for(let c of this.#P(a)){let d=this.#F.get(c);for(let[e,f]of(void 0===d&&(d=new Map,this.#F.set(c,d)),Object.entries(b))){if(d.has(e))throw Error(`Trying to set transition "${e}" on "${c}" (via "${a}"), but a transition already exists there.`);let b=f;if(this.#K.add(e),void 0!==b){let a="function"==typeof b?b:()=>b;d.set(e,a)}}}return this}addTimedTransition(a,b,c){return this.onEnter(a,()=>{let a=setTimeout(()=>{this.#O({type:"TIMER"},c)},"function"==typeof b?b(this.#C.current):b);return()=>{clearTimeout(a)}})}#Q(a){return this.#F.get(this.currentState)?.get(a)}#N(a){this.#G.willExitState.notify(this.currentState);let b=performance.now(),c=this.currentState.split(".");this.#C.allowPatching(d=>{a=a??this.#H.length;for(let e=0;e<a;e++){this.#H.pop()?.(d);let a=this.#I.pop();if(void 0!==a&&this.#G.didExitState.count()>0){let d=this.#I.length;if(0===d)continue;let e=d===c.length?this.currentState:`${c.slice(0,d).join(".")}.*`;this.#G.didExitState.notify({state:e,durationMs:b-a})}}})}#M(a){let b=function(a,b){let c=a.split(".");if(b<1||b>c.length+1)throw Error("Invalid number of levels");let d=[];b>c.length&&d.push("*");for(let a=c.length-b+1;a<c.length;a++){let b=c.slice(0,a);b.length>0&&d.push(b.join(".")+".*")}return d.push(a),d}(this.currentState,a??this.currentState.split(".").length+1),c=performance.now();this.#C.allowPatching(a=>{for(let d of b){let b=this.#J.get(d),e=b?.(a);"function"==typeof e?this.#H.push(e):this.#H.push(null),this.#I.push(c)}}),this.#G.didEnterState.notify(this.currentState)}send(a){if(!this.#K.has(a.type))throw Error(`Invalid event ${JSON.stringify(a.type)}`);if(2===this.#B)return;let b=this.#Q(a.type);if(void 0!==b)return this.#O(a,b);this.#G.didIgnoreEvent.notify(a)}#O(a,b){let c,d;this.#G.didReceiveEvent.notify(a);let e=this.currentState,f=("function"==typeof b?b:()=>b)(a,this.#C.current);if(null===f)return void this.#G.didIgnoreEvent.notify(a);if("string"==typeof f?c=f:(c=f.target,d=Array.isArray(f.effect)?f.effect:[f.effect]),!this.#D.has(c))throw Error(`Invalid next state name: ${JSON.stringify(c)}`);this.#G.willTransition.notify({from:e,to:c});let[g,h]=function(a,b){if(a===b)return[0,0];let c=a.split("."),d=b.split("."),e=Math.min(c.length,d.length),f=0;for(;f<e&&c[f]===d[f];f++);return[c.length-f,d.length-f]}(this.currentState,c);if(g>0&&this.#N(g),this.#E=c,void 0!==d){let b=d;this.#C.allowPatching(c=>{for(let d of b)"function"==typeof d?d(c,a):c.patch(d)})}h>0&&this.#M(h)}},p5=Object.freeze({UPDATE_PRESENCE:100,USER_JOINED:101,USER_LEFT:102,BROADCASTED_EVENT:103,ROOM_STATE:104,STORAGE_STATE_V7:200,STORAGE_CHUNK:210,STORAGE_STREAM_END:211,UPDATE_STORAGE:201,UPDATE_YDOC:300,THREAD_CREATED:400,THREAD_DELETED:407,THREAD_METADATA_UPDATED:401,THREAD_UPDATED:408,COMMENT_CREATED:402,COMMENT_EDITED:403,COMMENT_DELETED:404,COMMENT_REACTION_ADDED:405,COMMENT_REACTION_REMOVED:406,COMMENT_METADATA_UPDATED:409,REJECT_STORAGE_OP:299}),p6=((E=p6||{})[E.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",E[E.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",E[E.UNEXPECTED_CONDITION=1011]="UNEXPECTED_CONDITION",E[E.TRY_AGAIN_LATER=1013]="TRY_AGAIN_LATER",E[E.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",E[E.NOT_ALLOWED=4001]="NOT_ALLOWED",E[E.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",E[E.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",E[E.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",E[E.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",E[E.ROOM_ID_UPDATED=4006]="ROOM_ID_UPDATED",E[E.KICKED=4100]="KICKED",E[E.TOKEN_EXPIRED=4109]="TOKEN_EXPIRED",E[E.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",E);function p7(a){return 4999===a||a>=4e3&&a<4100}function p8(a){return 1013===a||a>=4200&&a<4300}function p9(a){let b=a.currentState;switch(b){case"@ok.connected":case"@ok.awaiting-pong":return"connected";case"@idle.initial":return"initial";case"@auth.busy":case"@auth.backoff":case"@connecting.busy":case"@connecting.backoff":case"@idle.zombie":return a.context.successCount>0?"reconnecting":"connecting";case"@idle.failed":return"disconnected";default:return pq(b,"Unknown state")}}var qa=[250,500,1e3,2e3,4e3,8e3,1e4],qb=qa[0]-1,qc=[2e3,3e4,6e4,3e5],qd=class extends Error{constructor(a){super(a)}};function qe(a,b){return b.find(b=>b>a)??b[b.length-1]}function qf(a){a.patch({backoffDelay:qe(a.backoffDelay,qa)})}function qg(a){a.patch({backoffDelay:qe(a.backoffDelay,qc)})}function qh(a){a.patch({successCount:0})}function qi(a,b){let c=2===a?px:1===a?pw:()=>{};return()=>{c(b)}}function qj(a){let b="Connection to Liveblocks websocket server";return c=>{qm(a)?pw(`${b} closed prematurely (code: ${a.code}). Retrying in ${c.backoffDelay}ms.`):pw(`${b} could not be established.`,a)}}function qk(a){let b=[`code: ${a.code}`];return a.reason&&b.push(`reason: ${a.reason}`),a=>{pw(`Connection to Liveblocks websocket server closed (${b.join(", ")}). Retrying in ${a.backoffDelay}ms.`)}}var ql=qi(1,"Connection to WebSocket closed permanently. Won't retry.");function qm(a){return!(a instanceof Error)&&"close"===a.type}var qn=a=>b=>b.patch(a),qo=class{#R;#S;events;constructor(a,b=!1,c=!0){const{machine:d,events:e,cleanups:f}=function(a,b){let c,d,e,f,g,h,i,j=(c=oW(),d=null,{...c,notify:function(a){return null!==d?(d.push(a),!1):c.notify(a)},pause:function(){d=[]},unpause:function(){if(null!==d){for(let a of d)c.notify(a);d=null}},dispose(){c.dispose(),null!==d&&(d.length=0)}});j.pause();let k=oW();function l(a,b){return()=>{k.notify({message:a,code:b})}}let m=new p4({successCount:0,authValue:null,socket:null,backoffDelay:qb}).addState("@idle.initial").addState("@idle.failed").addState("@idle.zombie").addState("@auth.busy").addState("@auth.backoff").addState("@connecting.busy").addState("@connecting.backoff").addState("@ok.connected").addState("@ok.awaiting-pong");m.addTransitions("*",{RECONNECT:{target:"@auth.backoff",effect:[qf,qh]},DISCONNECT:"@idle.initial"}),m.onEnter("@idle.*",qh).addTransitions("@idle.*",{CONNECT:(a,b)=>null!==b.authValue?"@connecting.busy":"@auth.busy"}),m.addTransitions("@auth.backoff",{NAVIGATOR_ONLINE:{target:"@auth.busy",effect:qn({backoffDelay:qb})}}).addTimedTransition("@auth.backoff",a=>a.backoffDelay,"@auth.busy").onEnterAsync("@auth.busy",()=>o1(a.authenticate(),1e4,"Timed out during auth"),a=>({target:"@connecting.busy",effect:qn({authValue:a.data})}),a=>a.reason instanceof qd?{target:"@idle.failed",effect:[qi(2,a.reason.message),l(a.reason.message,-1)]}:{target:"@auth.backoff",effect:[qf,qi(2,`Authentication failed: ${a.reason instanceof Error?a.reason.message:String(a.reason)}`)]});let n=a=>m.send({type:"EXPLICIT_SOCKET_ERROR",event:a}),o=a=>m.send({type:"EXPLICIT_SOCKET_CLOSE",event:a}),p=a=>"pong"===a.data?m.send({type:"PONG"}):j.notify(a);function q(a){a&&(a.removeEventListener("error",n),a.removeEventListener("close",o),a.removeEventListener("message",p),a.close())}m.addTransitions("@connecting.backoff",{NAVIGATOR_ONLINE:{target:"@connecting.busy",effect:qn({backoffDelay:qb})}}).addTimedTransition("@connecting.backoff",a=>a.backoffDelay,"@connecting.busy").onEnterAsync("@connecting.busy",async(c,d)=>{let e=performance.now(),f=null,g=null,h=null;return o1(new Promise((d,i)=>{if(null===c.authValue)throw Error("No auth authValue");let j=a.createSocket(c.authValue);function k(a){g=a,j.removeEventListener("message",p),i(a)}h=j;let[l,q]=pH();function r(a){let c=oZ(a.data);if(c?.type===p5.ROOM_STATE){if(b.enableDebugLogging&&null!==f){let a=performance.now()-f;pw(`[FSM #${m.id}] Socket open \u2192 ROOM_STATE: ${a.toFixed(0)}ms`)}q()}}b.waitForActorId||q(),j.addEventListener("message",p),b.waitForActorId&&j.addEventListener("message",r),j.addEventListener("error",k),j.addEventListener("close",k),j.addEventListener("open",()=>{if(f=performance.now(),b.enableDebugLogging){let a=f-e;pw(`[FSM #${m.id}] Socket epoch \u2192 open: ${a.toFixed(0)}ms`)}j.addEventListener("error",n),j.addEventListener("close",o);let a=()=>{j.removeEventListener("error",k),j.removeEventListener("close",k),j.removeEventListener("message",r)};l.then(()=>{d([j,a])})})}),2e4,"Timed out during websocket connection").then(([a,b])=>{if(b(),d.aborted)throw Error("Aborted");if(g)throw g;return a}).catch(a=>{throw q(h),a})},a=>({target:"@ok.connected",effect:qn({socket:a.data,backoffDelay:qb})}),a=>{let b=a.reason;if(b instanceof qd)return{target:"@idle.failed",effect:[qi(2,b.message),l(b.message,-1)]};if(qm(b)){if(4109===b.code)return"@auth.busy";if(p8(b.code))return{target:"@connecting.backoff",effect:[qg,qj(b)]};if(p7(b.code))return{target:"@idle.failed",effect:[qi(2,b.reason),l(b.reason,b.code)]}}return{target:"@auth.backoff",effect:[qf,qj(b)]}});let r={target:"@ok.awaiting-pong",effect:a=>{a.socket?.send("ping")}},s=()=>{let b="u">typeof document?document:void 0;return b?.visibilityState==="hidden"&&a.canZombie()?"@idle.zombie":r};if(m.addTimedTransition("@ok.connected",3e4,s).addTransitions("@ok.connected",{NAVIGATOR_OFFLINE:s,WINDOW_GOT_FOCUS:r}),m.addTransitions("@idle.zombie",{WINDOW_GOT_FOCUS:"@connecting.backoff"}),m.onEnter("@ok.*",a=>{a.patch({successCount:a.successCount+1});let b=setTimeout(j.unpause,0);return a=>{q(a.socket),a.patch({socket:null}),clearTimeout(b),j.pause()}}).addTransitions("@ok.awaiting-pong",{PONG:"@ok.connected"}).addTimedTransition("@ok.awaiting-pong",2e3,{target:"@connecting.busy",effect:qi(1,"Received no pong from server, assume implicit connection loss.")}).addTransitions("@ok.*",{EXPLICIT_SOCKET_ERROR:(a,b)=>b.socket?.readyState===1?null:{target:"@connecting.backoff",effect:qf},EXPLICIT_SOCKET_CLOSE:a=>{var b;if(p7(a.event.code))return{target:"@idle.failed",effect:[ql,l(a.event.reason,a.event.code)]};if((b=a.event.code)>=4100&&b<4200)if(4109===a.event.code)return"@auth.busy";else return{target:"@auth.backoff",effect:[qf,qk(a.event)]};return p8(a.event.code)?{target:"@connecting.backoff",effect:[qg,qk(a.event)]}:{target:"@connecting.backoff",effect:[qf,qk(a.event)]}}}),"u">typeof document){let a="u">typeof document?document:void 0,b,c=b??a;m.onEnter("*",d=>{function e(){m.send({type:"NAVIGATOR_OFFLINE"})}function f(){m.send({type:"NAVIGATOR_ONLINE"})}function g(){a?.visibilityState==="visible"&&m.send({type:"WINDOW_GOT_FOCUS"})}return b?.addEventListener("online",f),b?.addEventListener("offline",e),c?.addEventListener("visibilitychange",g),()=>{c?.removeEventListener("visibilitychange",g),b?.removeEventListener("online",f),b?.removeEventListener("offline",e),q(d.socket)}})}let t=[],{statusDidChange:u,didConnect:v,didDisconnect:w,unsubscribe:x}=(e=oW(),f=oW(),g=oW(),h=null,i=m.events.didEnterState.subscribe(()=>{let a=p9(m);a!==h&&e.notify(a),"connected"===h&&"connected"!==a?g.notify():"connected"!==h&&"connected"===a&&f.notify(),h=a}),{statusDidChange:e.observable,didConnect:f.observable,didDisconnect:g.observable,unsubscribe:i});return t.push(x),b.enableDebugLogging&&t.push(function(a){function b(...c){pw(`[FSM #${a.id}]`,...c)}let c=[a.events.didReceiveEvent.subscribe(a=>b(`Event ${a.type}`)),a.events.willTransition.subscribe(({from:a,to:c})=>b("Transitioning",a,"",c)),a.events.didExitState.subscribe(({state:a,durationMs:c})=>b(`Exited ${a} after ${c.toFixed(0)}ms`)),a.events.didIgnoreEvent.subscribe(a=>b("Ignored event",a.type,a,"(current state won't handle it)"))];return()=>{for(let a of c)a()}}(m)),m.start(),{machine:m,cleanups:t,events:{statusDidChange:u,didConnect:v,didDisconnect:w,onMessage:j.observable,onConnectionError:k.observable}}}(a,{waitForActorId:c,enableDebugLogging:b});this.#R=d,this.events=e,this.#S=f}getStatus(){try{return p9(this.#R)}catch{return"initial"}}get authValue(){return this.#R.context.authValue}connect(){this.#R.send({type:"CONNECT"})}reconnect(){this.#R.send({type:"RECONNECT"})}disconnect(){this.#R.send({type:"DISCONNECT"})}destroy(){let a;for(this.#R.stop();a=this.#S.pop();)a()}send(a){let b=this.#R.context?.socket;null===b?pw("Cannot send: not connected yet",a):1!==b.readyState?pw("Cannot send: WebSocket no longer open",a):b.send(a)}_privateSendMachineEvent(a){this.#R.send(a)}},qp=Symbol(),qq=Object.freeze({}),qr=Array.from(new Set("null")),qs=Array.from(new Set("true")),qt=Array.from(new Set("false")),qu=Array.from(new Set("nulltruefalse"));function qv(a,b){let c=a[a.length-1];return b.includes(c)?a.slice(0,-1):a}var qw=class{#T="";#U;#V=0;#W=!1;#X=-1;#Y=-1;#Z=[];constructor(a=""){this.append(a)}get source(){return this.#T}get json(){return void 0===this.#U&&(this.#U=this.#$()),this.#U}get #_(){return this.#X>=0}append(a){a&&(""===this.#T&&(a=a.trimStart()),this.#T+=a,this.#U=void 0)}#aa(a){if(this.#_)return"";let b=a.charAt(a.length-1);if(""===b)return"";if("-"===b)return"0";if(!qu.includes(b))return"";if(qr.includes(b)){if(a.endsWith("nul"))return"l";if(a.endsWith("nu"))return"ll";if(a.endsWith("n"))return"ull"}if(qs.includes(b)){if(a.endsWith("tru"))return"e";if(a.endsWith("tr"))return"ue";if(a.endsWith("t"))return"rue"}if(qt.includes(b)){if(a.endsWith("fals"))return"e";if(a.endsWith("fal"))return"se";if(a.endsWith("fa"))return"lse";if(a.endsWith("f"))return"alse"}return""}#ab(){let a=this.#T.slice(this.#V);for(let b=0;b<a.length;b++){let c=a[b],d=this.#V+b;this.#_?this.#W?this.#W=!1:"\\"===c?this.#W=!0:'"'===c&&(this.#Y=this.#X,this.#X=-1):'"'===c?this.#X=d:"{"===c?this.#Z.push("}"):"["===c?this.#Z.push("]"):"}"===c&&this.#Z.length>0&&"}"===this.#Z[this.#Z.length-1]?this.#Z.pop():"]"===c&&this.#Z.length>0&&"]"===this.#Z[this.#Z.length-1]&&this.#Z.pop()}this.#V=this.#T.length}#$(){this.#ab();let a=this.#T;if("{"!==a.charAt(0))return qq;if(a.endsWith("}")){let b=oZ(a);if(b)return b}this.#_&&(this.#W&&(a=a.slice(0,-1)),a+='"'),a=qv(a=a.trimEnd(),",."),a+=this.#aa(a);let b=this.#Z.reduceRight((a,b)=>a+b,"");{let c=oZ(a+b);if(c)return c}return this.#_?a=a.slice(0,this.#X):(a=qv(a,":")).endsWith('"')&&(a=a.slice(0,this.#Y)),oZ(a=qv(a,",")+b)??qq}};function qx(a,b){if(Object.is(a,b))return!0;let c=Array.isArray(a),d=Array.isArray(b);if(c||d){if(!c||!d)return!1;if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(!Object.is(a[c],b[c]))return!1;return!0}if(!pB(a)||!pB(b))return!1;let e=Object.keys(a);return e.length===Object.keys(b).length&&e.every(c=>Object.prototype.hasOwnProperty.call(b,c)&&Object.is(a[c],b[c]))}function qy(a,b){if(!pB(a)||!pB(b))return qx(a,b);let c=Object.keys(a);return c.length===Object.keys(b).length&&c.every(c=>Object.prototype.hasOwnProperty.call(b,c)&&qx(a[c],b[c]))}var qz=class{#ac;#ad;#ae;#af;#ag;#ah;constructor(a,b,c){this.#af=a,this.#ag=b,this.#ah=c,this.#ac=new Map,this.#ad=new pS(()=>new Set),this.#ae=pg.with(c)}get(a){return this.#ac.get(a)}getOrThrow(a){return this.get(a)??oX(`Item with id ${a} not found`)}get sorted(){return this.#ae}getParentId(a){let b=this.getOrThrow(a);return this.#ag(b)}getParent(a){let b=this.getParentId(a);return b?this.getOrThrow(b):null}getChildren(a){let b=this.#ad.get(a);return b?Array.from(b).map(a=>this.#ac.get(a)):[]}*walkUp(a,b){let c=a;do{let a=this.getOrThrow(c);(!b||b(a))&&(yield a),c=this.#ag(a)}while(null!==c)}*walkLeft(a,b){let c=this.getOrThrow(a);for(let d of pg.from(this.getSiblings(a),this.#ah).iterReversed())!this.#ah(c,d)&&(!b||b(d))&&(yield d)}*walkRight(a,b){let c=this.getOrThrow(a);for(let d of pg.from(this.getSiblings(a),this.#ah))!this.#ah(d,c)&&(!b||b(d))&&(yield d)}*walkDown(a,b){let c=pg.from(this.getChildren(a),this.#ah).rawArray;for(let a=c.length-1;a>=0;a--){let d=c[a];yield*this.walkDown(this.#af(d),b),(!b||b(d))&&(yield d)}}getSiblings(a){let b=this.getOrThrow(a),c=this.getParentId(a);return this.getChildren(c).filter(a=>a!==b)}[Symbol.iterator](){return this.#ae[Symbol.iterator]()}upsert(a){let b=this.#af(a),c=this.#ac.get(b);if(c){if(this.#ag(c)!==this.#ag(a))throw Error("Cannot upsert parent ID changes that change the tree structure. Remove the entry first, and recreate it");this.#ae.remove(c)}this.#ac.set(b,a),this.#ae.add(a);let d=this.#ag(a);this.#ad.getOrCreate(d).add(b)}remove(a){let b=this.#ac.get(a);if(!b)return!1;if(this.#ad.get(a))throw Error(`Cannot remove item '${a}' while it still has children. Remove children first.`);let c=this.#ag(b),d=this.#ad.get(c);return d&&(d.delete(a),0===d.size&&this.#ad.delete(c)),this.#ae.remove(b),this.#ad.delete(a),this.#ac.delete(a),!0}clear(){return 0!==this.#ac.size&&(this.#ad.clear(),this.#ac.clear(),this.#ae.clear(),!0)}},qA=class{#ai;#Z;#aj;constructor(){this.#ai=new Set,this.#Z=new pS(()=>new Map),this.#aj=void 0}registerLayer(a){return this.#ai.has(a)&&oX(`Layer '${a}' already exists, provide a unique layer id`),this.#ai.add(a),a}deregisterLayer(a){this.#ai.delete(a);let b=!1;for(let[c,d]of this.#Z)d.delete(a)&&(b=!0),0===d.size&&this.#Z.delete(c);b&&this.invalidate()}get(){return this.#aj??=this.#h()}invalidate(){this.#aj=void 0}#h(){return Array.from(this.#Z.values()).flatMap(a=>Array.from(a.values()).slice(-1).filter(pA))}updateKnowledge(a,b,c){this.#ai.has(a)||oX(`Unknown layer key: ${a}`),this.#Z.getOrCreate(b).set(a,c),this.invalidate()}};function qB(){return new Date().toISOString()}var qC=Symbol("*");function qD(a,b,c,d){let e=function(a,b){for(let c=a.length-1;c>=0;c--)if(b(a[c],c,a))return c;return -1}(a,a=>a.type===b.type&&c(a)===c(b));e>-1?a[e]=b:(qE(a[a.length-1],d),a.push(b))}function qE(a,b){a?.type==="reasoning"&&(a.endedAt??=b)}var qF=((F=qF||{}).Read="room:read",F.Write="room:write",F.PresenceWrite="room:presence:write",F.CommentsWrite="comments:write",F.CommentsRead="comments:read",F);function qG(a){return a.includes("room:write")}function qH(a){return a.includes("comments:write")||a.includes("room:write")}function qI(a){var b;let c=a.split(".");if(3!==c.length)throw Error("Authentication error: invalid JWT token");let d=oZ(function(a){try{let b=a.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(b).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(b){return atob(a)}}(c[1]));if(!(d&&pB(b=d)&&("acc"===b.k||"id"===b.k)))throw Error("Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback");return{raw:a,parsed:d}}var qJ=[400,401,403,404,405,410,412,414,422,431,451];async function qK(a,b,c){let d,e=await a(b,{method:"POST",headers:{"Content-Type":"application/json"},body:pL(c)});if(!e.ok){let a=`${(await e.text()).trim()||"reason not provided in auth response"} (${e.status} returned by POST ${b})`;if(qJ.includes(e.status))throw new qd(`Unauthorized: ${a}`);throw Error(`Failed to authenticate: ${a}`)}try{d=await e.json()}catch(a){throw Error(`Expected a JSON response when doing a POST request on "${b}". ${String(a)}`)}if(!pB(d)||"string"!=typeof d.token)throw Error(`Expected a JSON response of the form \`{ token: "..." }\` when doing a POST request on "${b}", but got ${pL(d)}`);let{token:f}=d;return{token:f}}function qL(a,b,c=b){("function"==typeof a?a():a)&&function(a,b=a){}(b,c)}oW().observable,Date.now();var qM=Symbol("notification-settings-plain");function qN(a){let b={[qM]:{value:a,enumerable:!1}};for(let a of["email","slack","teams","webPush"])b[a]={enumerable:!0,get(){let b=this[qM][a];return void 0===b?(px(`In order to use the '${a}' channel, please set up your project first. For more information: https://liveblocks.io/docs/errors/enable-a-notification-channel`),null):b}};return void 0!==b?Object.create(null,b):Object.create(null)}var qO="12px",qP=qS(0),qQ=qS(1),qR=qP+qS(-1);function qS(a){let b=32+(a<0?95+a:a);if(b<32||b>126)throw Error(`Invalid n value: ${a}`);return String.fromCharCode(b)}function qT(a,b){if(void 0!==a&&void 0!==b){var c=a,d=b;if(c<d)return qV(c,d);if(c>d)return qV(d,c);throw Error("Cannot compute value between two equal positions")}if(void 0!==a)return function(a){for(let b=0;b<a.length;b++){let c=a.charCodeAt(b);if(c<32||c>126)return a+qQ}for(;a.length>1&&32===a.charCodeAt(a.length-1);)a=a.slice(0,-1);if(0===a.length||a===qP)return qQ;let b=2;a.length>2&&(b=2+3*Math.ceil((a.length-2)/3));let c=qU(a,b);if(null!==c)return c;let d=qU(a,b+=3);return null!==d?d:a+qQ}(a);if(void 0===b)return qQ;{var e=b;let a=e.length-1;for(let b=0;b<=a;b++){let c=e.charCodeAt(b);if(!(c<=32))if(b!==a)return e.substring(0,b+1);else if(33===c)return e.substring(0,b)+qR;else return e.substring(0,b)+String.fromCharCode(c-1)}return qQ}}function qU(a,b){let c=[];for(let d=0;d<b;d++)d<a.length?c.push(a.charCodeAt(d)-32):c.push(0);let d=1;for(let a=b-1;a>=0&&d;a--){let b=c[a]+d;b>=95?(c[a]=0,d=1):(c[a]=b,d=0)}if(d)return null;let e="";for(let a of c)e+=String.fromCharCode(a+32);for(;e.length>1&&32===e.charCodeAt(e.length-1);)e=e.slice(0,-1);return e}function qV(a,b){let c=0,d=a.length,e=b.length;for(;;){let h=c<d?a.charCodeAt(c):32,i=c<e?b.charCodeAt(c):126;if(h===i){c++;continue}if(i-h!=1){var f,g;return f=a,((g=c)<f.length?f.substring(0,g):f+qP.repeat(g-f.length))+String.fromCharCode(i+h>>1)}{let b=c+1,d=a.substring(0,b);return d.length<b&&(d+=qP.repeat(b-d.length)),d+qV(a.substring(b),"")}}}function qW(a){return!function(a){if(""===a)return!1;let b=a.length-1,c=a.charCodeAt(b);if(c<33||c>126)return!1;for(let c=0;c<b;c++){let b=a.charCodeAt(c);if(b<32||b>126)return!1}return!0}(a)?function(a){let b=[];for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);b.push(d<32?32:d>126?126:d)}for(;b.length>0&&32===b[b.length-1];)b.length--;return b.length>0?String.fromCharCode(...b):qQ}(a):a}var qX=Object.freeze({INIT:0,SET_PARENT_KEY:1,CREATE_LIST:2,UPDATE_OBJECT:3,CREATE_OBJECT:4,DELETE_CRDT:5,DELETE_OBJECT_KEY:6,CREATE_MAP:7,CREATE_REGISTER:8});function qY(a,b,c=qW(b)){return Object.freeze({type:"HasParent",node:a,key:b,pos:c})}var qZ=Object.freeze({type:"NoParent"}),q$=class{#ak;#al;#am=qZ;_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return pq(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return pq(this.parent,"Unknown state")}}get _pool(){return this.#ak}get roomId(){return this.#ak?this.#ak.roomId:null}get _id(){return this.#al}get parent(){return this.#am}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return pq(this.parent,"Unknown state")}}_apply(a,b){if(a.type===qX.DELETE_CRDT&&"HasParent"===this.parent.type)return this.parent.node._detachChild(this);return{modified:!1}}_setParentLink(a,b){switch(this.parent.type){case"HasParent":if(this.parent.node!==a)throw Error("Cannot set parent: node already has a parent");this.#am=qY(a,b);return;case"Orphaned":case"NoParent":this.#am=qY(a,b);return;default:return pq(this.parent,"Unknown state")}}_attach(a,b){if(this.#al||this.#ak)throw Error("Cannot attach node: already attached");b.addNode(a,this),this.#al=a,this.#ak=b}_detach(){switch(this.#ak&&this.#al&&this.#ak.deleteNode(this.#al),this.parent.type){case"HasParent":this.#am=function(a,b=qW(a)){return Object.freeze({type:"Orphaned",oldKey:a,oldPos:b})}(this.parent.key,this.parent.pos);break;case"NoParent":this.#am=qZ;break;case"Orphaned":break;default:pq(this.parent,"Unknown state")}this.#ak=void 0}_toOpsWithOpId(a,b,c){return this._toOps(a,b).map(a=>({opId:c.generateOpId(),...a}))}#an;#ao;#ap;invalidate(){(void 0!==this.#an||void 0!==this.#ap)&&(this.#an=void 0,this.#ap=void 0,"HasParent"===this.parent.type&&this.parent.node.invalidate())}toTreeNode(a){return(void 0===this.#ap||this.#ao!==a)&&(this.#ao=a,this.#ap=this._toTreeNode(a)),this.#ap}toImmutable(){return void 0===this.#an&&(this.#an=this._toImmutable()),this.#an}},q_=Object.freeze({OBJECT:0,LIST:1,MAP:2,REGISTER:3});function q0(a){return a[1].type===q_.OBJECT}function q1(a){return a[1].type===q_.LIST}function q2(a){return a[1].type===q_.MAP}function q3(a){return a[1].type===q_.REGISTER}var q4=class a extends q${#j;constructor(a){super(),this.#j=a}get data(){return this.#j}static _deserialize([b,c],d,e){let f=new a(c.data);return f._attach(b,e),f}_toOps(a,b){if(void 0===this._id)throw Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:qX.CREATE_REGISTER,id:this._id,parentId:a,parentKey:b,data:this.data}]}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveRegister if parent is missing");return{type:q_.REGISTER,parentId:ps(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(a){throw Error("Method not implemented.")}_detachChild(a){throw Error("Method not implemented.")}_apply(a,b){return super._apply(a,b)}_toTreeNode(a){return{type:"Json",id:this._id??pP(),key:a,payload:this.#j}}_toImmutable(){return this.#j}clone(){return o$(this.data)}};function q5(a,b){return a._parentPos<b._parentPos}var q6=class a extends q${#aq;#ar;#as;constructor(a){let b;super(),this.#ar=new WeakSet,this.#as=new Map;const c=[];for(const d of a){const a=qT(b),e=rn(d);e._setParentLink(this,a),c.push(e),b=a}this.#aq=pg.fromAlreadySorted(c,q5)}static _deserialize([b,c],d,e){let f=new a([]);f._attach(b,e);let g=d.get(b);if(void 0===g)return f;for(let a of g){let b=a[1],c=ri(a,d,e);c._setParentLink(f,b.parentKey),f.#at(c)}return f}_toOps(a,b){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let c=[],d={id:this._id,type:qX.CREATE_LIST,parentId:a,parentKey:b};for(let a of(c.push(d),this.#aq)){let b=a._getParentKeyOrThrow();for(let d of rd(a._toOps(this._id,b),void 0))c.push(d)}return c}#at(a){let b=this.#aq.add(a);return this.invalidate(),b}#au(a,b){a._setParentLink(this,b),this.#aq.reposition(a),this.invalidate()}#av(a,b){let c=ps(this.#aq.at(a));this.#au(c,b)}_indexOfPosition(a){return this.#aq.findIndex(b=>b._getParentKeyOrThrow()===a)}_attach(a,b){for(let c of(super._attach(a,b),this.#aq))c._attach(b.generateId(),b)}_detach(){for(let a of(super._detach(),this.#aq))a._detach()}#aw(a){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:b,parentKey:c}=a,d=rg(a);d._attach(b,this._pool),d._setParentLink(this,c);let e=a.deletedId,f=this._indexOfPosition(c);if(-1!==f){let b=ps(this.#aq.removeAt(f));if(b._id===e)return b._detach(),this.#aq.add(d),{modified:q8(this,[q9(f,d)]),reverse:[]};{this.#ar.add(b),this.#aq.remove(b),this.#aq.add(d);let c=[q9(f,d)],e=this.#ax(a.deletedId);return e&&c.push(e),{modified:q8(this,c),reverse:[]}}}{let b=[],e=this.#ax(a.deletedId);return e&&b.push(e),this.#at(d),b.push(rb(this._indexOfPosition(c),d)),{reverse:[],modified:q8(this,b)}}}#ay(a){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let b=[],c=this.#ax(a.deletedId);c&&b.push(c);let d=this.#as.get(a.parentKey);if(void 0!==d)if(d!==a.opId)return 0===b.length?{modified:!1}:{modified:q8(this,b),reverse:[]};else this.#as.delete(a.parentKey);let e=this._indexOfPosition(a.parentKey),f=this.#aq.find(b=>b._id===a.id);if(void 0!==f){if(f._parentKey===a.parentKey)return{modified:b.length>0&&q8(this,b),reverse:[]};if(-1!==e){let a=ps(this.#aq.removeAt(e));this.#ar.add(a),b.push(ra(e,a))}let c=this.#aq.findIndex(a=>a===f);this.#au(f,a.parentKey);let d=this.#aq.findIndex(a=>a===f);return d!==c&&b.push(rc(c,d,f)),{modified:b.length>0&&q8(this,b),reverse:[]}}{let c=this._pool.getNode(a.id);if(c&&this.#ar.has(c)){c._setParentLink(this,a.parentKey),this.#ar.delete(c);let d=this.#at(c);return{modified:q8(this,[-1===e?rb(d,c):q9(d,c),...b]),reverse:[]}}{-1!==e&&ps(this.#aq.removeAt(e));let{newItem:c,newIndex:d}=this.#az(a,a.parentKey);return{modified:q8(this,[-1===e?rb(d,c):q9(d,c),...b]),reverse:[]}}}}#ax(a){if(void 0===a||void 0===this._pool)return null;let b=this._pool.getNode(a);if(void 0===b)return null;let c=this._detachChild(b);return!1===c.modified?null:c.modified.updates[0]}#aA(a){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let b=qW(a.parentKey),c=this._indexOfPosition(b);-1!==c&&this.#aB(c,b);let{newItem:d,newIndex:e}=this.#az(a,b);return{modified:q8(this,[rb(e,d)]),reverse:[]}}#aC(a){let b=this.#aq.find(b=>b._id===a.id),c=qW(a.parentKey),d=this._indexOfPosition(c);if(b)if(b._parentKey===c)return{modified:!1};else{let a=this.#aq.findIndex(a=>a===b);-1!==d&&this.#aB(d,c),this.#au(b,c);let e=this._indexOfPosition(c);return e===a?{modified:!1}:{modified:q8(this,[rc(a,e,b)]),reverse:[]}}{let b=ps(this._pool).getNode(a.id);if(b&&this.#ar.has(b))return b._setParentLink(this,c),this.#ar.delete(b),this.#at(b),{modified:q8(this,[rb(this._indexOfPosition(c),b)]),reverse:[]};{-1!==d&&this.#aB(d,c);let{newItem:b,newIndex:e}=this.#az(a,c);return{modified:q8(this,[rb(e,b)]),reverse:[]}}}}#aD(a){let{id:b,parentKey:c}=a,d=rg(a);if(this._pool?.getNode(b)!==void 0)return{modified:!1};d._attach(b,ps(this._pool)),d._setParentLink(this,c);let e=this._indexOfPosition(c),f=c;return -1!==e&&(f=qT(this.#aq.at(e)?._parentPos,this.#aq.at(e+1)?._parentPos),d._setParentLink(this,f)),this.#at(d),{modified:q8(this,[rb(this._indexOfPosition(f),d)]),reverse:[{type:qX.DELETE_CRDT,id:b}]}}#aE(a){let{id:b,parentKey:c}=a,d=rg(a);if(this._pool?.getNode(b)!==void 0)return{modified:!1};this.#as.set(c,ps(a.opId));let e=this._indexOfPosition(c);if(d._attach(b,ps(this._pool)),d._setParentLink(this,c),-1!==e){let b=this.#aq.at(e);b._detach(),this.#aq.remove(b),this.#aq.add(d);let f=rd(b._toOps(ps(this._id),c),a.id),g=[q9(e,d)],h=this.#ax(a.deletedId);return h&&g.push(h),{modified:q8(this,g),reverse:f}}{this.#at(d),this.#ax(a.deletedId);let e=this._indexOfPosition(c);return{reverse:[{type:qX.DELETE_CRDT,id:b}],modified:q8(this,[rb(e,d)])}}}_attachChild(a,b){let c;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");return!1!==(c="set"===a.intent?1===b?this.#aw(a):2===b?this.#ay(a):this.#aE(a):1===b?this.#aA(a):2===b?this.#aC(a):this.#aD(a)).modified&&this.invalidate(),c}_detachChild(a){if(a){let b=ps(a._parentKey),c=a._toOps(ps(this._id),b),d=this.#aq.findIndex(b=>b===a);if(-1===d)return{modified:!1};let e=this.#aq.at(d);return this.#aq.remove(a),this.invalidate(),a._detach(),{modified:q8(this,[ra(d,e)]),reverse:c}}return{modified:!1}}#aF(a,b){if(this.#ar.has(b))return this.#ar.delete(b),b._setParentLink(this,a),{modified:q8(this,[rb(this.#at(b),b)]),reverse:[]};if(a===b._parentKey)return{modified:!1};let c=this._indexOfPosition(a);if(-1===c){let c=this.#aq.findIndex(a=>a===b);this.#au(b,a);let d=this.#aq.findIndex(a=>a===b);return d===c?{modified:!1}:{modified:q8(this,[rc(c,d,b)]),reverse:[]}}{this.#av(c,qT(a,this.#aq.at(c+1)?._parentPos));let d=this.#aq.findIndex(a=>a===b);this.#au(b,a);let e=this.#aq.findIndex(a=>a===b);return e===d?{modified:!1}:{modified:q8(this,[rc(d,e,b)]),reverse:[]}}}#aG(a,b){let c=ps(b._parentKey);if(this.#ar.has(b)){let c=this._indexOfPosition(a);if(this.#ar.delete(b),-1!==c){let b=this.#aq.at(c);b._setParentLink(this,qT(a,this.#aq.at(c+1)?._parentPos)),this.#aq.reposition(b)}return b._setParentLink(this,a),{modified:q8(this,[rb(this.#at(b),b)]),reverse:[]}}{if(a===c)return{modified:!1};let d=this.#aq.findIndex(a=>a===b),e=this._indexOfPosition(a);-1!==e&&this.#av(e,qT(a,this.#aq.at(e+1)?._parentPos)),this.#au(b,a);let f=this.#aq.findIndex(a=>a===b);return d===f?{modified:!1}:{modified:q8(this,[rc(d,f,b)]),reverse:[]}}}#aH(a,b){let c=ps(b._parentKey),d=this.#aq.findIndex(a=>a===b),e=this._indexOfPosition(a),f=a;-1!==e&&(f=qT(a,this.#aq.at(e+1)?._parentPos)),this.#au(b,f);let g=this.#aq.findIndex(a=>a===b);return d===g?{modified:!1}:{modified:q8(this,[rc(d,g,b)]),reverse:[{type:qX.SET_PARENT_KEY,id:ps(b._id),parentKey:c}]}}_setChildKey(a,b,c){return 1===c?this.#aF(a,b):2===c?this.#aG(a,b):this.#aH(a,b)}_apply(a,b){return super._apply(a,b)}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveList if parent is missing");return{type:q_.LIST,parentId:ps(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this.#aq.length}push(a){return this._pool?.assertStorageIsWritable(),this.insert(a,this.length)}insert(a,b){if(this._pool?.assertStorageIsWritable(),b<0||b>this.#aq.length)throw Error(`Cannot insert list item at index "${b}". index should be between 0 and ${this.#aq.length}`);let c=qT(this.#aq.at(b-1)?._parentPos,this.#aq.at(b)?._parentPos),d=rn(a);if(d._setParentLink(this,c),this.#at(d),this._pool&&this._id){let a=this._pool.generateId();d._attach(a,this._pool),this._pool.dispatch(d._toOpsWithOpId(this._id,c,this._pool),[{type:qX.DELETE_CRDT,id:a}],new Map([[this._id,q8(this,[rb(b,d)])]]))}}move(a,b){if(this._pool?.assertStorageIsWritable(),b<0)throw Error("targetIndex cannot be less than 0");if(b>=this.#aq.length)throw Error("targetIndex cannot be greater or equal than the list length");if(a<0)throw Error("index cannot be less than 0");if(a>=this.#aq.length)throw Error("index cannot be greater or equal than the list length");let c=null,d=null;a<b?(d=b===this.#aq.length-1?void 0:this.#aq.at(b+1)?._parentPos,c=this.#aq.at(b)._parentPos):(d=this.#aq.at(b)._parentPos,c=0===b?void 0:this.#aq.at(b-1)?._parentPos);let e=qT(c,d),f=this.#aq.at(a),g=f._getParentKeyOrThrow();if(this.#av(a,e),this._pool&&this._id){let c=new Map([[this._id,q8(this,[rc(a,b,f)])]]);this._pool.dispatch([{type:qX.SET_PARENT_KEY,id:ps(f._id),opId:this._pool.generateOpId(),parentKey:e}],[{type:qX.SET_PARENT_KEY,id:ps(f._id),parentKey:g}],c)}}delete(a){if(this._pool?.assertStorageIsWritable(),a<0||a>=this.#aq.length)throw Error(`Cannot delete list item at index "${a}". index should be between 0 and ${this.#aq.length-1}`);let b=this.#aq.at(a);if(b._detach(),this.#aq.remove(b),this.invalidate(),this._pool){let c=b._id;if(c){let d=new Map;d.set(ps(this._id),q8(this,[ra(a,b)])),this._pool.dispatch([{id:c,opId:this._pool.generateOpId(),type:qX.DELETE_CRDT}],b._toOps(ps(this._id),b._getParentKeyOrThrow()),d)}}}clear(){if(this._pool?.assertStorageIsWritable(),this._pool){let a=[],b=[],c=[];for(let d of this.#aq){d._detach();let e=d._id;e&&(a.push({type:qX.DELETE_CRDT,id:e,opId:this._pool.generateOpId()}),b.push(...d._toOps(ps(this._id),d._getParentKeyOrThrow())),c.push(ra(0,d)))}this.#aq.clear(),this.invalidate();let d=new Map;d.set(ps(this._id),q8(this,c)),this._pool.dispatch(a,b,d)}else{for(let a of this.#aq)a._detach();this.#aq.clear(),this.invalidate()}}set(a,b){if(this._pool?.assertStorageIsWritable(),a<0||a>=this.#aq.length)throw Error(`Cannot set list item at index "${a}". index should be between 0 and ${this.#aq.length-1}`);let c=this.#aq.at(a),d=c._getParentKeyOrThrow(),e=c._id;c._detach();let f=rn(b);if(f._setParentLink(this,d),this.#aq.remove(c),this.#aq.add(f),this.invalidate(),this._pool&&this._id){let b=this._pool.generateId();f._attach(b,this._pool);let g=new Map;g.set(this._id,q8(this,[q9(a,f)]));let h=rd(f._toOpsWithOpId(this._id,d,this._pool),e);this.#as.set(d,ps(h[0].opId));let i=rd(c._toOps(this._id,d),b);this._pool.dispatch(h,i,g)}}toArray(){return Array.from(this.#aq,a=>rm(a))}every(a){return this.toArray().every(a)}filter(a){return this.toArray().filter(a)}find(a){return this.toArray().find(a)}findIndex(a){return this.toArray().findIndex(a)}forEach(a){return this.toArray().forEach(a)}get(a){if(a<0||a>=this.#aq.length)return;let b=this.#aq.at(a);return b?rm(b):void 0}indexOf(a,b){return this.toArray().indexOf(a,b)}lastIndexOf(a,b){return this.toArray().lastIndexOf(a,b)}map(a){let b=[],c=0;for(let d of this.#aq)b.push(a(rm(d),c)),c++;return b}some(a){return this.toArray().some(a)}[Symbol.iterator](){return new q7(this.#aq)}#az(a,b){let c=rg(a);return c._attach(a.id,ps(this._pool)),c._setParentLink(this,b),this.#at(c),{newItem:c,newIndex:this._indexOfPosition(b)}}#aB(a,b){let c=qT(b,this.#aq.length>a+1?this.#aq.at(a+1)?._parentPos:void 0);this.#av(a,c)}_toTreeNode(a){let b=[],c=0;for(let a of this.#aq)b.push(a.toTreeNode(c.toString())),c++;return{type:"LiveList",id:this._id??pP(),key:a,payload:b}}toImmutable(){return super.toImmutable()}_toImmutable(){return Array.from(this.#aq,a=>a.toImmutable())}clone(){return new a(Array.from(this.#aq,a=>a.clone()))}},q7=class{#aI;constructor(a){this.#aI=a[Symbol.iterator]()}[Symbol.iterator](){return this}next(){let a=this.#aI.next();return a.done?{done:!0,value:void 0}:{value:rm(a.value)}}};function q8(a,b){return{node:a,type:"LiveList",updates:b}}function q9(a,b){return{index:a,type:"set",item:b instanceof q4?b.data:b}}function ra(a,b){return{type:"delete",index:a,deletedItem:b instanceof q4?b.data:b}}function rb(a,b){return{index:a,type:"insert",item:b instanceof q4?b.data:b}}function rc(a,b,c){return{type:"move",index:b,item:c instanceof q4?c.data:c,previousIndex:a}}function rd(a,b){return a.map((a,c)=>0===c?{...a,intent:"set",deletedId:b}:a)}var re=class a extends q${#aJ;#aK;constructor(a){if(super(),this.#aK=new Map,a){const b=[];for(const[c,d]of a){const a=rn(d);a._setParentLink(this,c),b.push([c,a])}this.#aJ=new Map(b)}else this.#aJ=new Map}_toOps(a,b){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let c=[],d={id:this._id,type:qX.CREATE_MAP,parentId:a,parentKey:b};for(let[a,b]of(c.push(d),this.#aJ))for(let d of b._toOps(this._id,a))c.push(d);return c}static _deserialize([b,c],d,e){let f=new a;f._attach(b,e);let g=d.get(b);if(void 0===g)return f;for(let a of g){let b=a[1],c=ri(a,d,e);c._setParentLink(f,b.parentKey),f.#aJ.set(b.parentKey,c),f.invalidate()}return f}_attach(a,b){for(let[c,d]of(super._attach(a,b),this.#aJ))rk(d)&&d._attach(b.generateId(),b)}_attachChild(a,b){let c;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:d,parentKey:e,opId:f}=a,g=rg(a);if(void 0!==this._pool.getNode(d))return{modified:!1};if(2===b){let a=this.#aK.get(e);if(a===f)return this.#aK.delete(e),{modified:!1};if(void 0!==a)return{modified:!1}}else 1===b&&this.#aK.delete(e);let h=this.#aJ.get(e);if(h){let a=ps(this._id);c=h._toOps(a,e),h._detach()}else c=[{type:qX.DELETE_CRDT,id:d}];return g._setParentLink(this,e),g._attach(d,this._pool),this.#aJ.set(e,g),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[e]:{type:"update"}}},reverse:c}}_detach(){for(let a of(super._detach(),this.#aJ.values()))a._detach()}_detachChild(a){let b=ps(this._id),c=ps(a._parentKey),d=a._toOps(b,c);for(let[b,c]of this.#aJ)c===a&&(this.#aJ.delete(b),this.invalidate());return a._detach(),{modified:{node:this,type:"LiveMap",updates:{[c]:{type:"delete",deletedItem:rm(a)}}},reverse:d}}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveMap if parent is missing");return{type:q_.MAP,parentId:ps(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(a){let b=this.#aJ.get(a);if(void 0!==b)return rm(b)}set(a,b){this._pool?.assertStorageIsWritable();let c=this.#aJ.get(a);c&&c._detach();let d=rn(b);if(d._setParentLink(this,a),this.#aJ.set(a,d),this.invalidate(),this._pool&&this._id){let b=this._pool.generateId();d._attach(b,this._pool);let e=new Map;e.set(this._id,{node:this,type:"LiveMap",updates:{[a]:{type:"update"}}});let f=d._toOpsWithOpId(this._id,a,this._pool);this.#aK.set(a,ps(f[0].opId)),this._pool.dispatch(f,c?c._toOps(this._id,a):[{type:qX.DELETE_CRDT,id:b}],e)}}get size(){return this.#aJ.size}has(a){return this.#aJ.has(a)}delete(a){this._pool?.assertStorageIsWritable();let b=this.#aJ.get(a);if(void 0===b)return!1;if(b._detach(),this.#aJ.delete(a),this.invalidate(),this._pool&&b._id){let c=ps(this._id),d=new Map;d.set(c,{node:this,type:"LiveMap",updates:{[a]:{type:"delete",deletedItem:rm(b)}}}),this._pool.dispatch([{type:qX.DELETE_CRDT,id:b._id,opId:this._pool.generateOpId()}],b._toOps(c,a),d)}return!0}entries(){let a=this.#aJ.entries();return{[Symbol.iterator](){return this},next(){let b=a.next();return b.done?{done:!0,value:void 0}:{value:[b.value[0],rm(b.value[1])]}}}}[Symbol.iterator](){return this.entries()}keys(){return this.#aJ.keys()}values(){let a=this.#aJ.values();return{[Symbol.iterator](){return this},next(){let b=a.next();return b.done?{done:!0,value:void 0}:{value:rm(b.value)}}}}forEach(a){for(let b of this)a(b[1],b[0],this)}_toTreeNode(a){return{type:"LiveMap",id:this._id??pP(),key:a,payload:Array.from(this.#aJ.entries()).map(([a,b])=>b.toTreeNode(a))}}toImmutable(){return super.toImmutable()}_toImmutable(){let a=new Map;for(let[b,c]of this.#aJ)a.set(b,c.toImmutable());return a}clone(){return new a(Array.from(this.#aJ).map(([a,b])=>[a,b.clone()]))}},rf=class a extends q${#aJ;#aL;static detectLargeObjects=!1;static #aM(a){let b=new Map,c=null;for(let d of a)if("root"===d[0])c=d[1];else{let a=d[1],c=b.get(a.parentId);void 0!==c?c.push(d):b.set(a.parentId,[d])}if(null===c)throw Error("Root can't be null");return[c,b]}static _fromItems(b,c){let[d,e]=a.#aM(b);return a._deserialize(["root",d],e,c)}constructor(a={}){super(),this.#aL=new Map;const b=o0(a);for(const a of Object.keys(b)){const c=b[a];rk(c)&&c._setParentLink(this,a)}this.#aJ=new Map(Object.entries(b))}_toOps(a,b){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let c=[],d={type:qX.CREATE_OBJECT,id:this._id,parentId:a,parentKey:b,data:{}};for(let[a,b]of(c.push(d),this.#aJ))if(rk(b))for(let d of b._toOps(this._id,a))c.push(d);else d.data[a]=b;return c}static _deserialize([b,c],d,e){let f=new a(c.data);return f._attach(b,e),this._deserializeChildren(f,d,e)}static _deserializeChildren(a,b,c){let d=b.get(ps(a._id));if(void 0===d)return a;for(let e of d){let d=function(a,b,c){if(q0(a))return rf._deserialize(a,b,c);if(q1(a))return q6._deserialize(a,b,c);if(q2(a))return re._deserialize(a,b,c);if(q3(a))return a[1].data;throw Error("Unexpected CRDT type")}(e,b,c),f=e[1];rj(d)&&d._setParentLink(a,f.parentKey),a.#aJ.set(f.parentKey,d),a.invalidate()}return a}_attach(a,b){for(let[c,d]of(super._attach(a,b),this.#aJ))rk(d)&&d._attach(b.generateId(),b)}_attachChild(a,b){let c;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:d,opId:e,parentKey:f}=a,g=rh(a);if(void 0!==this._pool.getNode(d))return this.#aL.get(f)===e&&this.#aL.delete(f),{modified:!1};if(0===b)this.#aL.set(f,ps(e));else if(void 0===this.#aL.get(f));else if(this.#aL.get(f)===e)return this.#aL.delete(f),{modified:!1};else return{modified:!1};let h=ps(this._id),i=this.#aJ.get(f);return rk(i)?(c=i._toOps(h,f),i._detach()):c=void 0===i?[{type:qX.DELETE_OBJECT_KEY,id:h,key:f}]:[{type:qX.UPDATE_OBJECT,id:h,data:{[f]:i}}],this.#aJ.set(f,g),this.invalidate(),rj(g)&&(g._setParentLink(this,f),g._attach(d,this._pool)),{reverse:c,modified:{node:this,type:"LiveObject",updates:{[f]:{type:"update"}}}}}_detachChild(a){if(a){let b=ps(this._id),c=ps(a._parentKey),d=a._toOps(b,c);for(let[b,c]of this.#aJ)c===a&&(this.#aJ.delete(b),this.invalidate());return a._detach(),{modified:{node:this,type:"LiveObject",updates:{[c]:{type:"delete"}}},reverse:d}}return{modified:!1}}_detach(){for(let a of(super._detach(),this.#aJ.values()))rk(a)&&a._detach()}_apply(a,b){return a.type===qX.UPDATE_OBJECT?this.#aN(a,b):a.type===qX.DELETE_OBJECT_KEY?this.#aO(a,b):super._apply(a,b)}_serialize(){let a={};for(let[b,c]of this.#aJ)rk(c)||(a[b]=c);return"HasParent"===this.parent.type&&this.parent.node._id?{type:q_.OBJECT,parentId:this.parent.node._id,parentKey:this.parent.key,data:a}:{type:q_.OBJECT,data:a}}#aN(a,b){let c=!1,d=ps(this._id),e=[],f={type:qX.UPDATE_OBJECT,id:d,data:{}};for(let b in a.data){let a=this.#aJ.get(b);if(rk(a)){for(let c of a._toOps(d,b))e.push(c);a._detach()}else void 0!==a?f.data[b]=a:void 0===a&&e.push({type:qX.DELETE_OBJECT_KEY,id:d,key:b})}let g={};for(let d in a.data){let e=a.data[d];if(void 0===e)continue;if(b)this.#aL.set(d,ps(a.opId));else if(void 0===this.#aL.get(d))c=!0;else{if(this.#aL.get(d)!==a.opId)continue;this.#aL.delete(d);continue}let f=this.#aJ.get(d);rk(f)&&f._detach(),c=!0,g[d]={type:"update"},this.#aJ.set(d,e),this.invalidate()}return 0!==Object.keys(f.data).length&&e.unshift(f),c?{modified:{node:this,type:"LiveObject",updates:g},reverse:e}:{modified:!1}}#aO(a,b){let c=a.key,d=this.#aJ.get(c);if(void 0===d||!b&&void 0!==this.#aL.get(c))return{modified:!1};let e=ps(this._id),f=[];return rk(d)?(f=d._toOps(e,a.key),d._detach()):void 0!==d&&(f=[{type:qX.UPDATE_OBJECT,id:e,data:{[c]:d}}]),this.#aJ.delete(c),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[a.key]:{type:"delete",deletedItem:d}}},reverse:f}}toObject(){return Object.fromEntries(this.#aJ)}set(a,b){this._pool?.assertStorageIsWritable(),this.update({[a]:b})}get(a){return this.#aJ.get(a)}delete(a){let b;this._pool?.assertStorageIsWritable();let c=this.#aJ.get(a);if(void 0===c)return;if(void 0===this._pool||void 0===this._id){rk(c)&&c._detach(),this.#aJ.delete(a),this.invalidate();return}rk(c)?(c._detach(),b=c._toOps(this._id,a)):b=[{type:qX.UPDATE_OBJECT,data:{[a]:c},id:this._id}],this.#aJ.delete(a),this.invalidate();let d=new Map;d.set(this._id,{node:this,type:"LiveObject",updates:{[a]:{type:"delete",deletedItem:c}}}),this._pool.dispatch([{type:qX.DELETE_OBJECT_KEY,key:a,id:this._id,opId:this._pool.generateOpId()}],b,d)}update(b){if(this._pool?.assertStorageIsWritable(),a.detectLargeObjects){let a={};for(let[b,c]of this.#aJ)rk(c)||(a[b]=c);for(let c of Object.keys(b)){let d=b[c];void 0!==d&&(rk(d)||(a[c]=d))}let c=JSON.stringify(a);if(4*c.length>131072){let a=new TextEncoder().encode(c).length;if(a>131072)throw Error(`LiveObject size exceeded limit: ${a} bytes > 131072 bytes. See https://liveblocks.io/docs/platform/limits#Liveblocks-Storage-limits`)}}if(void 0===this._pool||void 0===this._id){for(let a in b){let c=b[a];if(void 0===c)continue;let d=this.#aJ.get(a);rk(d)&&d._detach(),rk(c)&&c._setParentLink(this,a),this.#aJ.set(a,c),this.invalidate()}return}let c=[],d=[],e=this._pool.generateOpId(),f={},g={id:this._id,type:qX.UPDATE_OBJECT,data:{}},h={};for(let a in b){let i=b[a];if(void 0===i)continue;let j=this.#aJ.get(a);if(rk(j)){for(let b of j._toOps(this._id,a))d.push(b);j._detach()}else void 0===j?d.push({type:qX.DELETE_OBJECT_KEY,id:this._id,key:a}):g.data[a]=j;if(rk(i)){i._setParentLink(this,a),i._attach(this._pool.generateId(),this._pool);let b=i._toOpsWithOpId(this._id,a,this._pool),d=b.find(a=>a.parentId===this._id);for(let e of(d&&this.#aL.set(a,ps(d.opId)),b))c.push(e)}else f[a]=i,this.#aL.set(a,e);this.#aJ.set(a,i),this.invalidate(),h[a]={type:"update"}}0!==Object.keys(g.data).length&&d.unshift(g),0!==Object.keys(f).length&&c.unshift({opId:e,id:this._id,type:qX.UPDATE_OBJECT,data:f});let i=new Map;i.set(this._id,{node:this,type:"LiveObject",updates:h}),this._pool.dispatch(c,d,i)}toImmutable(){return super.toImmutable()}toTreeNode(a){return super.toTreeNode(a)}_toTreeNode(a){let b=this._id??pP();return{type:"LiveObject",id:b,key:a,payload:Array.from(this.#aJ.entries()).map(([a,c])=>rk(c)?c.toTreeNode(a):{type:"Json",id:`${b}:${a}`,key:a,payload:c})}}_toImmutable(){let a={};for(let[b,c]of this.#aJ)a[b]=rj(c)?c.toImmutable():c;return a}clone(){return new a(Object.fromEntries(Array.from(this.#aJ).map(([a,b])=>[a,rj(b)?b.clone():o$(b)])))}};function rg(a){return rn(rh(a))}function rh(a){switch(a.type){case qX.CREATE_REGISTER:return a.data;case qX.CREATE_OBJECT:return new rf(a.data);case qX.CREATE_MAP:return new re;case qX.CREATE_LIST:return new q6([]);default:return pq(a,"Unknown creation Op")}}function ri(a,b,c){if(q0(a))return rf._deserialize(a,b,c);if(q1(a))return q6._deserialize(a,b,c);if(q2(a))return re._deserialize(a,b,c);if(q3(a))return q4._deserialize(a,b,c);throw Error("Unexpected CRDT type")}function rj(a){return rl(a)||a instanceof re||a instanceof rf}function rk(a){return rj(a)||a instanceof q4}function rl(a){return a instanceof q6}function rm(a){return a instanceof q4?a.data:a instanceof q6||a instanceof re||a instanceof rf?a:pq(a,"Unknown AbstractCrdt")}function rn(a){return a instanceof rf||a instanceof re||a instanceof q6?a:new q4(a)}function ro(a,b){if(void 0===a)return b;if("LiveObject"===a.type&&"LiveObject"===b.type){let c=a.updates;for(let[a,d]of oY(b.updates))c[a]=d;return{...b,updates:c}}if("LiveMap"===a.type&&"LiveMap"===b.type){let c=a.updates;for(let[a,d]of oY(b.updates))c[a]=d;return{...b,updates:c}}if("LiveList"===a.type&&"LiveList"===b.type){let c;return c=a.updates,{...b,updates:c.concat(b.updates)}}return b}var rp=class{#j;#aP;#aQ;#p;constructor(){this.#j={},this.#aP=0,this.#aQ=1,this.#p=0}get length(){return this.#p}*[Symbol.iterator](){let a=this.#p,b=this.#aP;for(let c=0;c<a;c++)yield this.#j[b+c]}push(a){let b=Array.isArray(a)?a:[a];for(let a of(this.#aQ>Number.MAX_SAFE_INTEGER-b.length-1&&oX("Deque full"),b))this.#j[this.#aQ++-1]=a;this.#p+=b.length}pop(){if(this.#p<1)return;this.#aQ--;let a=this.#j[this.#aQ-1];return delete this.#j[this.#aQ-1],this.#p--,a}pushLeft(a){let b=Array.isArray(a)?a:[a];this.#aP<Number.MIN_SAFE_INTEGER+b.length&&oX("Deque full");for(let a=b.length-1;a>=0;a--)this.#j[--this.#aP]=b[a];this.#p+=b.length}popLeft(){if(this.#p<1)return;let a=this.#j[this.#aP];return delete this.#j[this.#aP],this.#aP++,this.#p--,a}};function rq(a){return Array.isArray(a)}var rr=Object.freeze({UPDATE_PRESENCE:100,BROADCAST_EVENT:103,FETCH_STORAGE:200,UPDATE_STORAGE:201,FETCH_YDOC:300,UPDATE_YDOC:301}),rs=class{#aR;#aS;signal;constructor(){this.#aR=new pf({connections:new Map,presences:new Map}),this.signal=pe.from(this.#aR,a=>o_(Array.from(this.#aR.get().presences.keys()).map(a=>this.getUser(Number(a))))),this.#aS=new Map}get(){return this.signal.get()}connectionIds(){return this.#aR.get().connections.keys()}clearOthers(){this.#aR.mutate(a=>{a.connections.clear(),a.presences.clear(),this.#aS.clear()})}#aT(a){let b=this.#aR.get(),c=b.connections.get(a),d=b.presences.get(a);if(void 0!==c&&void 0!==d)return function(a,b){let{connectionId:c,id:d,info:e}=a,f=qG(a.scopes);return o0({connectionId:c,id:d,info:e,canWrite:f,canComment:qH(a.scopes),isReadOnly:!f,presence:b})}(c,d)}getUser(a){let b=this.#aS.get(a);if(b)return b;let c=this.#aT(a);if(c)return this.#aS.set(a,c),c}#aU(a){this.#aS.delete(a)}setConnection(a,b,c,d){this.#aR.mutate(e=>(e.connections.set(a,{connectionId:a,id:b,info:c,scopes:d}),!!e.presences.has(a)&&this.#aU(a)))}removeConnection(a){this.#aR.mutate(b=>{b.connections.delete(a),b.presences.delete(a),this.#aU(a)})}setOther(a,b){this.#aR.mutate(c=>(c.presences.set(a,o0(b)),!!c.connections.has(a)&&this.#aU(a)))}patchOther(a,b){this.#aR.mutate(c=>{let d=c.presences.get(a);if(void 0===d)return!1;let e=o9(d,b);return d!==e&&(c.presences.set(a,e),this.#aU(a))})}},rt=class a extends Error{context;constructor(a,b,c){super(a,{cause:c}),this.context=b,this.name="LiveblocksError"}get roomId(){return this.context.roomId}get code(){return this.context.code}static from(b,c){return new a(function(a){switch(a.type){case"ROOM_CONNECTION_ERROR":switch(a.code){case 4001:return"Not allowed to connect to the room";case 4005:return"Room is already full";case 4006:return"Kicked out of the room, because the room ID changed";default:return"Could not connect to the room"}case"AI_CONNECTION_ERROR":if(4001===a.code)return"Not allowed to connect to ai";return"Could not connect to the room";case"CREATE_THREAD_ERROR":return"Could not create new thread";case"DELETE_THREAD_ERROR":return"Could not delete thread";case"EDIT_THREAD_METADATA_ERROR":return"Could not edit thread metadata";case"EDIT_COMMENT_METADATA_ERROR":return"Could not edit comment metadata";case"MARK_THREAD_AS_RESOLVED_ERROR":return"Could not mark thread as resolved";case"MARK_THREAD_AS_UNRESOLVED_ERROR":return"Could not mark thread as unresolved";case"SUBSCRIBE_TO_THREAD_ERROR":return"Could not subscribe to thread";case"UNSUBSCRIBE_FROM_THREAD_ERROR":return"Could not unsubscribe from thread";case"CREATE_COMMENT_ERROR":return"Could not create new comment";case"EDIT_COMMENT_ERROR":return"Could not edit comment";case"DELETE_COMMENT_ERROR":return"Could not delete comment";case"ADD_REACTION_ERROR":return"Could not add reaction";case"REMOVE_REACTION_ERROR":return"Could not remove reaction";case"MARK_INBOX_NOTIFICATION_AS_READ_ERROR":return"Could not mark inbox notification as read";case"DELETE_INBOX_NOTIFICATION_ERROR":return"Could not delete inbox notification";case"MARK_ALL_INBOX_NOTIFICATIONS_AS_READ_ERROR":return"Could not mark all inbox notifications as read";case"DELETE_ALL_INBOX_NOTIFICATIONS_ERROR":return"Could not delete all inbox notifications";case"UPDATE_ROOM_SUBSCRIPTION_SETTINGS_ERROR":return"Could not update room subscription settings";case"UPDATE_NOTIFICATION_SETTINGS_ERROR":return"Could not update notification settings";case"LARGE_MESSAGE_ERROR":return"Could not send large message";default:return pq(a,"Unhandled case")}}(b),b,c)}};function ru(a,b){return{type:"User",id:`${b.connectionId}`,key:a,payload:{connectionId:b.connectionId,id:b.id,info:b.info,presence:b.presence,isReadOnly:!b.canWrite}}}function rv(a,b,c,d,e){if("number"!=typeof b||b<c||void 0!==d&&b>d)throw Error(void 0!==d?`${a} should be between ${e??c} and ${d}.`:`${a} should be at least ${e??c}.`);return b}function rw(a){if(void 0!==a)return rv("backgroundKeepAliveTimeout",a,15e3)}var rx={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ry=RegExp(Object.keys(rx).map(a=>`\\${a}`).join("|"),"g"),rz={_:"\\_","*":"\\*","#":"\\#","`":"\\`","~":"\\~","!":"\\!","|":"\\|","(":"\\(",")":"\\)","{":"\\{","}":"\\}","[":"\\[","]":"\\]"},rA=RegExp(Object.keys(rz).map(a=>`\\${a}`).join("|"),"g"),rB=[1e3,2e3,4e3,8e3,1e4];function rC(a,b,c){let d=performance.now(),e="u">typeof document?document:void 0,f,g=c?.maxStaleTimeMs??1/0,h={inForeground:e?.visibilityState!=="hidden",lastSuccessfulPollAt:d,count:0,backoff:0};function i(){return h.count>0&&h.inForeground}let j=new p4({}).addState("@idle").addState("@enabled").addState("@polling");function k(){i()?j.send({type:"START"}):j.send({type:"STOP"})}function l(){performance.now()-h.lastSuccessfulPollAt>g&&j.send({type:"POLL"})}function m(a){h.inForeground=a,k(),l()}function n(){m(e?.visibilityState!=="hidden")}return j.addTransitions("@idle",{START:"@enabled"}),j.addTransitions("@enabled",{STOP:"@idle",POLL:"@polling"}),j.addTimedTransition("@enabled",()=>Math.max(0,h.lastSuccessfulPollAt+b-performance.now())+h.backoff,"@polling"),j.onEnterAsync("@polling",async(b,c)=>{await a(c),c.aborted||(h.lastSuccessfulPollAt=performance.now())},()=>({target:i()?"@enabled":"@idle",effect:()=>{h.backoff=0}}),()=>({target:i()?"@enabled":"@idle",effect:()=>{h.backoff=rB.find(a=>a>h.backoff)??rB[rB.length-1]}}),3e4),e?.addEventListener("visibilitychange",n),f?.addEventListener("online",n),f?.addEventListener("focus",l),j.start(),{inc:function(){h.count++,k()},dec:function(){h.count--,h.count<0&&(h.count=0),k()},pollNowIfStale:l,markAsStale:function(){h.lastSuccessfulPollAt=performance.now()-g-1},setInForeground:m}}function rD(a,b){return"string"==typeof a?`${a}:${b}`:`${a.kind}:${a.subjectId}`}var rE=((G=rE||{}).Lexical="lexical",G.TipTap="tiptap",G.BlockNote="blocknote",G);v=Symbol.for(oS),w=`${oT||"dev"} (esm)`,oU[v]?oU[v]===w||oV(`Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See https://liveblocks.io/docs/errors/dupes 

Conflicts:
- ${oS} ${oU[v]} (already loaded)
- ${oS} ${w} (trying to load this now)`):oU[v]=w,oT&&oT&&oT!=oT&&oV(`Cross-linked versions of Liveblocks found, which will cause issues! See https://liveblocks.io/docs/errors/cross-linked 

Conflicts:
- ${oS} is at ${oT}
- ${oS} is at ${oT}

Always upgrade all Liveblocks packages to the same version number.`);var rF=(0,L.createContext)(null);function rG(){return(0,L.useContext)(rF)}function rH(){return rG()??oX("LiveblocksProvider is missing from the React tree.")}var rI=(0,L.createContext)(null);function rJ(){return(0,L.useContext)(rI)}function rK(){return null!==rJ()}function rL(a){let b=(0,L.useRef)(a);return(0,L.useEffect)(()=>{b.current=a},[a]),b}var rM=(0,L.memo)(function(a){let b=(0,L.useId)(),c=rH()[qp].ai,{description:d,value:e,chatId:f}=a,[g,h]=(0,L.useState)();(0,L.useEffect)(()=>{let{layerKey:a,deregister:d}=c.registerKnowledgeLayer(b,f);return h(a),()=>{d(),h(void 0)}},[c,b,f]);let i=(0,L.useState)(pP)[0],j=a.id??i;return(0,L.useEffect)(()=>{void 0!==g&&c.updateKnowledge(g,{description:d,value:e},j,f)},[c,g,j,d,e,f]),null}),rN=(0,L.memo)(function({chatId:a,name:b,tool:c,enabled:d}){let e=rH()[qp].ai;return(0,L.useEffect)(()=>{let f=void 0!==d?{...c,enabled:d}:c;return e.registerTool(b,f,a)},[e,a,b,c,d]),null});function rO(a,b,c,d,e){let f,g=(0,L.useRef)(null);null===g.current?g.current=f={hasValue:!1,value:null}:f=g.current;let[h,i]=(0,L.useMemo)(()=>{let a,g,h=!1,i=b=>{var c;if(!h){h=!0,a=b;let c=d(b);if(void 0!==e&&f.hasValue){let a=f.value;if(e(a,c))return g=a,a}return g=c,c}let i=g;if((c=a)===b&&(0!==c||1/c==1/b)||c!=c&&b!=b)return i;let j=d(b);return void 0!==e&&e(i,j)?(a=b,i):(a=b,g=j,j)},j=void 0===c?null:c;return[()=>i(b()),null===j?void 0:()=>i(j())]},[b,c,d,e]),j=(0,L.useSyncExternalStore)(a,h,i);return(0,L.useEffect)(()=>{f.hasValue=!0,f.value=j},[j]),(0,L.useDebugValue)(j),j}var rP=a=>a;function rQ(a,b,c){if(a instanceof pf)throw Error("Using a mutable Signal with useSignal will likely not work as expected.");return rO(a.subscribe,a.get,a.get,b??rP,c)}var rR=1e3,rS=3e5,rT=5e3,rU=6e4,rV=5e3,rW=6e4,rX=5e3,rY=Object.freeze({isLoading:!0}),rZ=a=>Object.freeze({isLoading:!1,error:a});function r$(a,b){return 1==arguments.length?Object.freeze({isLoading:!1,data:a}):Object.freeze({isLoading:!1,[a]:b})}function r_(){throw Error("You cannot use the Suspense version of Liveblocks hooks server side. Make sure to only call them client side by using a ClientSideSuspense wrapper.\nFor tips, see https://liveblocks.io/docs/api-reference/liveblocks-react#ClientSideSuspense")}function r0(a,b){return(0,L.useMemo)(()=>a,[b])}var r1=L[" use ".trim().toString()]??(a=>{if("pending"===a.status)throw a;if("fulfilled"===a.status)return a.value;if("rejected"===a.status)throw a.reason;throw a.status="pending",a.then(b=>{a.status="fulfilled",a.value=b},b=>{a.status="rejected",a.reason=b}),a});function r2(a){let b=new Set;b.add("constructor");let c=a.constructor.prototype;do for(let d of Reflect.ownKeys(c)){if(b.has(d))continue;let e=Reflect.getOwnPropertyDescriptor(c,d);"function"==typeof e?.value&&(b.add(d),a[d]=a[d].bind(a))}while((c=Reflect.getPrototypeOf(c))&&c!==Object.prototype)}var r3=class a{#l;#aV;#aW;signal;constructor(){this.#aV=pg.from([],(a,b)=>{let c=a.createdAt,d=b.createdAt;return c<d||c===d&&a.id<b.id}),this.#aW=pg.from([],(a,b)=>{let c=b.updatedAt,d=a.updatedAt;return c<d||c===d&&b.id<a.id}),this.#l=new Map,this.signal=new pf(this)}clone(){let b=new a;return b.#l=new Map(this.#l),b.#aV=this.#aV.clone(),b.#aW=this.#aW.clone(),b}get(a){let b=this.getEvenIfDeleted(a);return b?.deletedAt?void 0:b}getEvenIfDeleted(a){return this.#l.get(a)}upsert(a){this.signal.mutate(()=>{var b;let c=(a=(b=a).deletedAt&&b.comments.length>0?{...b,comments:[]}:!b.comments.some(a=>!a.deletedAt)?{...b,deletedAt:new Date,comments:[]}:b).id,d=this.#l.get(c);if(d){if(d.deletedAt)return!1;this.#aV.remove(d),this.#aW.remove(d)}return a.deletedAt||(this.#aV.add(a),this.#aW.add(a)),this.#l.set(c,a),!0})}upsertIfNewer(a){let b=this.get(a.id);(!b||a.updatedAt>=b.updatedAt)&&this.upsert(a)}applyDelta(a,b){o7(()=>{for(let b of a)this.upsertIfNewer(b);for(let{id:a,deletedAt:c}of b)this.getEvenIfDeleted(a)&&this.delete(a,c)})}delete(a,b){let c=this.#l.get(a);c&&!c.deletedAt&&this.upsert({...c,deletedAt:b,updatedAt:b})}findMany(a,b,c,d){let e="desc"===c?this.#aW:this.#aV,f=[];return void 0!==a&&f.push(b=>b.roomId===a),void 0!==b&&f.push(a=>{var c,e,f,g,h;let i,j;return c=a,e=b,(f=d)&&(i=f?.[rD("thread",c.id)]),(void 0===e.resolved||c.resolved===e.resolved)&&(void 0===e.subscribed||!0===e.subscribed&&void 0!==i||!1===e.subscribed&&void 0===i)&&(g=a,h=b,j=g.metadata,void 0===h.metadata||Object.entries(h.metadata).every(([a,b])=>void 0===b||function(a,b){var c,d;if(null===b)return void 0===a;if(pC(b))return"string"==typeof a&&a.startsWith(b.startsWith);if(!pD(b))return a===b;return"number"==typeof a&&(c=a,(void 0===(d=b).lt||c<d.lt)&&(void 0===d.gt||c>d.gt)&&(void 0===d.lte||c<=d.lte)&&(void 0===d.gte||c>=d.gte))}(j[a],b)))}),Array.from(e.filter(a=>f.every(b=>b(a))))}};function r4(a){return"status"in a||(a.status="pending",a.then(b=>{a.status="fulfilled",a.value=b},b=>{a.status="rejected",a.reason=b})),a}var r5=Promise.resolve(),r6=class{#aX;signal;#aY;#aZ;constructor(a){this.#aX=new pb(rY),this.#aY=a,this.#aZ=null,this.signal=this.#aX.asReadonly(),r2(this)}get(){return this.#aX.get()}#a$(a){let b=this.#aX.get();void 0!==b.data&&this.#aX.set(r$({...b.data,...a}))}async #a_(){let a=this.#aX.get();if(a.data?.cursor&&!a.data.isFetchingMore){this.#a$({isFetchingMore:!0});try{let b=await this.#aY(a.data.cursor);this.#a$({cursor:b,hasFetchedAll:null===b,fetchMoreError:void 0,isFetchingMore:!1})}catch(a){this.#a$({isFetchingMore:!1,fetchMoreError:a})}}}fetchMore(){let a=this.#aX.get();return a.data?.cursor?(this.#aZ||(this.#aZ=this.#a_().finally(()=>{this.#aZ=null})),this.#aZ):r5}#a0=null;waitUntilLoaded(){if(this.#a0)return this.#a0;let a=r4(pG(()=>this.#aY(void 0),5,[5e3,5e3,1e4,15e3]));return a.then(a=>{this.#aX.set(r$({cursor:a,hasFetchedAll:null===a,isFetchingMore:!1,fetchMoreError:void 0,fetchMore:this.fetchMore}))},a=>{this.#aX.set(rZ(a)),setTimeout(()=>{this.#a0=null,this.#aX.set(rY)},5e3)}),this.#a0=a,this.#a0}},r7=class{#aX;signal;#aY;#a1=!0;constructor(a,b=!0){this.#aX=new pb(rY),this.signal=this.#aX.asReadonly(),this.#aY=a,this.#a1=b,r2(this)}get(){return this.#aX.get()}#a0=null;waitUntilLoaded(){if(this.#a0)return this.#a0;let a=r4(this.#a1?pG(()=>this.#aY(),5,[5e3,5e3,1e4,15e3]):this.#aY());return a.then(()=>{this.#aX.set(r$(void 0))},a=>{this.#aX.set(rZ(a)),this.#a1&&setTimeout(()=>{this.#a0=null,this.#aX.set(rY)},5e3)}),this.#a0=a,a}},r8=new Set(["mark-inbox-notification-as-read"]),r9=class{#a2;threads;notifications;subscriptions;roomSubscriptionSettings;historyVersions;unreadNotificationsCount;urlsMetadata;permissionHints;notificationSettings;optimisticUpdates;outputs;#a3=null;#a4=new Map;#a5=null;#a6=new Map;#a7;constructor(a){this.#a2=a[qp].as(),this.optimisticUpdates=function(a){let b=new pb([]),c=a[qp].createSyncSource();return b.subscribe(()=>c.setSyncStatus(b.get().some(a=>!r8.has(a.type))?"synchronizing":"synchronized")),{signal:b.asReadonly(),add:function(a){let c=pP(),d={...a,id:c};return b.set(a=>[...a,d]),c},remove:function(a){b.set(b=>b.filter(b=>b.id!==a))}}}(this.#a2),this.permissionHints=function(){let a=new pS(()=>new pb(new Set));return{getPermissionForRoom:function(b){return a.getOrCreate(b)},update:function(b){o7(()=>{for(let[c,d]of Object.entries(b)){let b=a.getOrCreate(c),e=new Set(b.get());for(let a of d)e.add(a);b.set(e)}})}}}();const b=async()=>{let a=await this.#a2.getNotificationSettings();this.notificationSettings.update(a)};this.notificationSettings=function(a){let b=new pb(qN({}));return{signal:pe.from(b,a,(a,b)=>(function(a,b){let c=a;for(let a of b)"update-notification-settings"===a.type&&(c=function(a,b){let c=qN({...a[qM]});for(let a of Object.keys(b)){let d=b[a];if(void 0!==d){let b=Object.fromEntries(oY(d).filter(([,a])=>void 0!==a));c[qM][a]={...c[qM][a],...b}}}return c}(c,a.settings));return c})(a,b)),update:function(a){b.set(a)}}}(this.optimisticUpdates.signal),this.#a7=new r7(b),this.threads=new r3,this.subscriptions=function(a,b){let c=new pf(new Map);return{signal:pe.from(c,a,(a,c)=>(function(a,b,c){let d=Object.fromEntries(a);for(let a of c)if("update-room-subscription-settings"===a.type){if(!a.settings.threads)continue;for(let c of b.findMany(a.roomId,void 0,"desc",void 0)){let b=rD("thread",c.id);switch(a.settings.threads){case"all":d[b]={kind:"thread",subjectId:c.id,createdAt:new Date};break;case"none":delete d[b];break;case"replies_and_mentions":break;default:pq(a.settings.threads,"Unexpected thread subscription settings.")}}}return d})(a,b,c)),applyDelta:function(a,b){c.mutate(c=>{let d=!1;for(let b of a)c.set(rD(b),b),d=!0;for(let a of b)c.delete(rD(a)),d=!0;return d})},create:function(a){c.mutate(b=>{b.set(rD(a),a)})},delete:function(a){c.mutate(b=>{b.delete(a)})}}}(this.optimisticUpdates.signal,this.threads),this.notifications=function(){let a=new pf(new Map);return{signal:a.asReadonly(),markAllRead:function(b){a.mutate(a=>{for(let c of a.values())c.readAt=b})},markRead:function(b,c){a.mutate(a=>{let d=a.get(b);return!!d&&(a.set(b,{...d,readAt:c}),!0)})},delete:function(b){a.mutate(a=>a.delete(b))},applyDelta:function(b,c){a.mutate(a=>{let d=!1;for(let c of b){var e,f;let b=a.get(c.id);(!b||1!==(e=b,f=c,e.notifiedAt>f.notifiedAt?1:e.notifiedAt<f.notifiedAt?-1:e.readAt&&f.readAt?e.readAt>f.readAt?1:e.readAt<f.readAt?-1:0:e.readAt||f.readAt?e.readAt?1:-1:0))&&(a.set(c.id,c),d=!0)}for(let b of c)a.delete(b.id),d=!0;return d})},clear:function(){a.mutate(a=>a.clear())},updateAssociatedNotification:function(b){a.mutate(a=>{let c=function(a,b){for(let c of a)if(b(c))return c}(a.values(),a=>"thread"===a.kind&&a.threadId===b.threadId);return!!c&&(a.set(c.id,{...c,notifiedAt:b.createdAt,readAt:b.createdAt}),!0)})},upsert:function(b){a.mutate(a=>{a.set(b.id,b)})}}}(),this.roomSubscriptionSettings=function(a){let b=new pf(new Map);return{signal:pe.from(b,a,(a,b)=>(function(a,b){let c=Object.fromEntries(a);for(let a of b)switch(a.type){case"update-room-subscription-settings":{let b=c[a.roomId];if(void 0===b)break;c[a.roomId]={...b,...a.settings}}}return c})(a,b)),update:function(a,c){b.mutate(b=>{b.set(a,c)})}}}(this.optimisticUpdates.signal),this.historyVersions=function(){let a=new pf(new pS(()=>new Map));return{signal:pe.from(a,a=>Object.fromEntries([...a].map(([a,b])=>[a,Object.fromEntries(b)]))),update:function(b,c){a.mutate(a=>{let d=a.getOrCreate(b);for(let a of c)d.set(a.id,a)})}}}(),this.unreadNotificationsCount=function(){let a=new pf(new Map);return{signal:pe.from(a,a=>Object.fromEntries(a)),update:function(b,c){a.mutate(a=>{a.set(b,c)})}}}(),this.urlsMetadata=function(){let a=new pf(new Map);return{signal:pe.from(a,a=>Object.fromEntries(a)),update:function(b,c){a.mutate(a=>{a.set(b,c)})}}}();const c=pe.from(this.threads.signal,this.notifications.signal,this.optimisticUpdates.signal,(a,b,c)=>(function(a,b,c){let d=a.clone(),e=Object.fromEntries(b);for(let a of c)switch(a.type){case"create-thread":d.upsert(a.thread);break;case"edit-thread-metadata":{let b=d.get(a.threadId);if(void 0===b||b.updatedAt>a.updatedAt)break;d.upsert({...b,updatedAt:a.updatedAt,metadata:{...b.metadata,...a.metadata}});break}case"mark-thread-as-resolved":{let b=d.get(a.threadId);if(void 0===b)break;d.upsert({...b,resolved:!0});break}case"mark-thread-as-unresolved":{let b=d.get(a.threadId);if(void 0===b)break;d.upsert({...b,resolved:!1});break}case"create-comment":{let b=d.get(a.comment.threadId);if(void 0===b)break;d.upsert(sa(b,a.comment));let c=Object.values(e).find(a=>"thread"===a.kind&&a.threadId===b.id);if(void 0===c)break;e[c.id]={...c,notifiedAt:a.comment.createdAt,readAt:a.comment.createdAt};break}case"edit-comment":{let b=d.get(a.comment.threadId);if(void 0===b)break;d.upsert(sa(b,a.comment));break}case"edit-comment-metadata":{let b=d.get(a.threadId);if(void 0===b||b.updatedAt>a.updatedAt)break;let c=b.comments.find(b=>b.id===a.commentId);if(void 0===c)break;d.upsert(sa(b,{...c,metadata:{...c.metadata,...a.metadata}}));break}case"delete-comment":{let b=d.get(a.threadId);if(void 0===b)break;d.upsert(sb(b,a.commentId,a.deletedAt));break}case"delete-thread":{let b=d.get(a.threadId);if(void 0===b)break;d.upsert({...b,deletedAt:a.deletedAt,updatedAt:a.deletedAt,comments:[]});break}case"add-reaction":{let b=d.get(a.threadId);if(void 0===b)break;d.upsert(sc(b,a.commentId,a.reaction));break}case"remove-reaction":{let b=d.get(a.threadId);if(void 0===b)break;d.upsert(sd(b,a.commentId,a.emoji,a.userId,a.removedAt));break}case"mark-inbox-notification-as-read":{let b=e[a.inboxNotificationId];if(void 0===b)break;e[a.inboxNotificationId]={...b,readAt:a.readAt};break}case"mark-all-inbox-notifications-as-read":for(let b in e){let c=e[b];if(void 0===c)break;e[b]={...c,readAt:a.readAt}}break;case"delete-inbox-notification":delete e[a.inboxNotificationId];break;case"delete-all-inbox-notifications":e={}}return{sortedNotifications:Object.values(e).filter(a=>"thread"!==a.kind||void 0!==d.get(a.threadId)).sort((a,b)=>b.notifiedAt.getTime()-a.notifiedAt.getTime()),notificationsById:e,threadsDB:d}})(a,b,c)),d=pe.from(c,a=>a.threadsDB),e=pe.from(c,a=>({sortedNotifications:a.sortedNotifications,notificationsById:a.notificationsById}),qx),f=pe.from(e,this.subscriptions.signal,(a,b)=>({subscriptions:b,notifications:a.sortedNotifications})),g=new pS(a=>{let b=JSON.parse(a),c=new r6(async a=>{let c=await this.#a2[qp].httpClient.getUserThreads_experimental({cursor:a,query:b});return this.updateThreadifications(c.threads,c.inboxNotifications,c.subscriptions),this.permissionHints.update(c.permissionHints),null===this.#a5&&(this.#a5=c.requestedAt),c.nextCursor});return{signal:pe.from(()=>{let a=c.get();if(a.isLoading||a.error)return a;let d=f.get().subscriptions,e=this.outputs.threads.get().findMany(void 0,b??{},"desc",d),g=a.data;return{isLoading:!1,threads:e,hasFetchedAll:g.hasFetchedAll,isFetchingMore:g.isFetchingMore,fetchMoreError:g.fetchMoreError,fetchMore:g.fetchMore}},qy),waitUntilLoaded:c.waitUntilLoaded}}),h=new pS(a=>{let[b,c]=JSON.parse(a),d=new r6(async a=>{let d=await this.#a2[qp].httpClient.getThreads({roomId:b,cursor:a,query:c});this.updateThreadifications(d.threads,d.inboxNotifications,d.subscriptions),this.permissionHints.update(d.permissionHints);let e=this.#a4.get(b);return(void 0===e||e>d.requestedAt)&&this.#a4.set(b,d.requestedAt),d.nextCursor});return{signal:pe.from(()=>{let a=d.get();if(a.isLoading||a.error)return a;let e=f.get().subscriptions,g=this.outputs.threads.get().findMany(b,c??{},"asc",e),h=a.data;return{isLoading:!1,threads:g,hasFetchedAll:h.hasFetchedAll,isFetchingMore:h.isFetchingMore,fetchMoreError:h.fetchMoreError,fetchMore:h.fetchMore}},qy),waitUntilLoaded:d.waitUntilLoaded}}),i=new pS(a=>{let b=JSON.parse(a),c=new r6(async a=>{let c=await this.#a2.getInboxNotifications({cursor:a,query:b});return this.updateThreadifications(c.threads,c.inboxNotifications,c.subscriptions),null===this.#a3&&(this.#a3=c.requestedAt),c.nextCursor});return{signal:pe.from(()=>{let a=c.get();if(a.isLoading||a.error)return a;let d=[];void 0!==b&&d.push(a=>{var c,d;return c=a,(void 0===(d=b).roomId||d.roomId===c.roomId)&&(void 0===d.kind||d.kind===c.kind)});let e=this.outputs.notifications.get().sortedNotifications.filter(a=>d.every(b=>b(a))),f=a.data;return{isLoading:!1,inboxNotifications:e,hasFetchedAll:f.hasFetchedAll,isFetchingMore:f.isFetchingMore,fetchMoreError:f.fetchMoreError,fetchMore:f.fetchMore}},qy),waitUntilLoaded:c.waitUntilLoaded}}),j=new pS(a=>{let b=JSON.parse(a),c=new r7(async()=>{let c=await this.#a2.getUnreadInboxNotificationsCount({query:b});this.unreadNotificationsCount.update(a,c)});return{signal:pe.from(()=>{let b=c.get();return b.isLoading||b.error?b:r$("count",ps(this.unreadNotificationsCount.signal.get()[a]))},qx),waitUntilLoaded:c.waitUntilLoaded}}),k=new pS(a=>{let b=new r7(async()=>{let b=this.#a2.getRoom(a);if(null===b)throw Error(`Room '${a}' is not available on client`);let c=await b.getSubscriptionSettings();this.roomSubscriptionSettings.update(a,c)});return{signal:pe.from(()=>{let c=b.get();return c.isLoading||c.error?c:r$("settings",ps(this.roomSubscriptionSettings.signal.get()[a]))},qx),waitUntilLoaded:b.waitUntilLoaded}}),l=new pS(a=>{let b=new r7(async()=>{let b=this.#a2.getRoom(a);if(null===b)throw Error(`Room '${a}' is not available on client`);let c=await b[qp].listTextVersions();this.historyVersions.update(a,c.versions);let d=this.#a6.get(a);(void 0===d||d>c.requestedAt)&&this.#a6.set(a,c.requestedAt)});return{signal:pe.from(()=>{let c=b.get();return c.isLoading||c.error?c:r$("versions",Object.values(this.historyVersions.signal.get()[a]??{}))},qx),waitUntilLoaded:b.waitUntilLoaded}}),m={signal:pe.from(()=>{let a=this.#a7.get();return a.isLoading||a.error?a:r$("settings",ps(this.notificationSettings.signal.get()))},qx),waitUntilLoaded:this.#a7.waitUntilLoaded},n=new pS(a=>{let b=JSON.parse(a),c=new r6(async a=>(await this.#a2[qp].ai.getChats({cursor:a,query:b})).nextCursor);return{signal:pe.from(()=>{let a=c.get();return a.isLoading||a.error?a:{isLoading:!1,chats:this.#a2[qp].ai.queryChats(b),hasFetchedAll:a.data.hasFetchedAll,isFetchingMore:a.data.isFetchingMore,fetchMore:a.data.fetchMore,fetchMoreError:a.data.fetchMoreError}},qx),waitUntilLoaded:c.waitUntilLoaded}}),o=new pS(a=>{let b=new r7(async()=>{await this.#a2[qp].ai.getMessageTree(a)});return new pS(c=>({signal:pe.from(()=>{let d=b.get();return d.isLoading||d.error?d:r$("messages",this.#a2[qp].ai.signals.getChatMessagesForBranch(a,c??void 0).get())}),waitUntilLoaded:b.waitUntilLoaded}))}),p=new pS(a=>{let b=new r7(async()=>{await this.#a2[qp].ai.getOrCreateChat(a)});return{signal:pe.from(()=>{if(void 0!==this.#a2[qp].ai.getChatById(a))return r$("chat",ps(this.#a2[qp].ai.getChatById(a)));{let c=b.get();return c.isLoading||c.error?c:r$("chat",ps(this.#a2[qp].ai.getChatById(a)))}},qx),waitUntilLoaded:b.waitUntilLoaded}}),q=new pS(a=>{let b=new r7(async()=>{let b=await this.#a2[qp].httpClient.getUrlMetadata(a);this.urlsMetadata.update(a,b)},!1);return{signal:pe.from(()=>{let c=b.get();return c.isLoading||c.error?c:r$("metadata",ps(this.urlsMetadata.signal.get()[a]))},qx),waitUntilLoaded:b.waitUntilLoaded}});this.outputs={threadifications:c,threads:d,loadingRoomThreads:h,loadingUserThreads:g,notifications:e,loadingNotifications:i,unreadNotificationsCount:j,roomSubscriptionSettingsByRoomId:k,versionsByRoomId:l,notificationSettings:m,threadSubscriptions:f,aiChats:n,messagesByChatId:o,aiChatById:p,urlMetadataByUrl:q},r2(this)}markInboxNotificationRead(a,b,c){o7(()=>{this.optimisticUpdates.remove(c),this.notifications.markRead(a,b)})}markAllInboxNotificationsRead(a,b){o7(()=>{this.optimisticUpdates.remove(a),this.notifications.markAllRead(b)})}deleteInboxNotification(a,b){o7(()=>{this.optimisticUpdates.remove(b),this.notifications.delete(a)})}deleteAllInboxNotifications(a){o7(()=>{this.optimisticUpdates.remove(a),this.notifications.clear()})}createSubscription(a,b){o7(()=>{this.optimisticUpdates.remove(b),this.subscriptions.create(a)})}deleteSubscription(a,b){o7(()=>{this.optimisticUpdates.remove(b),this.subscriptions.delete(a)})}createThread(a,b){o7(()=>{this.optimisticUpdates.remove(a),this.threads.upsert(b)})}#a8(a,b,c,d){o7(()=>{null!==b&&this.optimisticUpdates.remove(b);let e=this.threads,f=e.get(a);!f||d&&f.updatedAt>d||e.upsert(c(f))})}patchThread(a,b,c,d){return this.#a8(a,b,a=>({...a,...o0(c)}),d)}addReaction(a,b,c,d,e){this.#a8(a,b,a=>sc(a,c,d),e)}removeReaction(a,b,c,d,e,f){this.#a8(a,b,a=>sd(a,c,d,e,f),f)}deleteThread(a,b){return this.#a8(a,b,a=>({...a,updatedAt:new Date,deletedAt:new Date}))}createComment(a,b){o7(()=>{this.optimisticUpdates.remove(b);let c=this.threads.get(a.threadId);c&&(this.threads.upsert(sa(c,a)),this.notifications.updateAssociatedNotification(a))})}editComment(a,b,c){return this.#a8(a,b,a=>sa(a,c))}editCommentMetadata(a,b,c,d,e){return this.#a8(a,c,a=>void 0===a.comments.find(a=>a.id===b)?a:{...a,updatedAt:e,comments:a.comments.map(a=>a.id===b?{...a,metadata:d}:a)},e)}deleteComment(a,b,c,d){return this.#a8(a,b,a=>sb(a,c,d),d)}updateThreadifications(a,b,c,d=[],e=[],f=[]){o7(()=>{this.threads.applyDelta(a,d),this.notifications.applyDelta(b,e),this.subscriptions.applyDelta(c,f)})}updateRoomSubscriptionSettings(a,b,c){o7(()=>{this.optimisticUpdates.remove(b),this.roomSubscriptionSettings.update(a,c)})}async fetchNotificationsDeltaUpdate(a){let b=this.#a3;if(null===b)return;let c=await this.#a2.getInboxNotificationsSince({since:b,signal:a});b<c.requestedAt&&(this.#a3=c.requestedAt),this.updateThreadifications(c.threads.updated,c.inboxNotifications.updated,c.subscriptions.updated,c.threads.deleted,c.inboxNotifications.deleted,c.subscriptions.deleted)}async fetchUnreadNotificationsCount(a,b){let c=JSON.parse(a),d=await this.#a2.getUnreadInboxNotificationsCount({query:c,signal:b});this.unreadNotificationsCount.update(a,d)}async fetchRoomThreadsDeltaUpdate(a,b){let c=this.#a4.get(a);if(void 0===c)return;let d=await this.#a2[qp].httpClient.getThreadsSince({roomId:a,since:c,signal:b});this.updateThreadifications(d.threads.updated,d.inboxNotifications.updated,d.subscriptions.updated,d.threads.deleted,d.inboxNotifications.deleted,d.subscriptions.deleted),this.permissionHints.update(d.permissionHints),c<d.requestedAt&&this.#a4.set(a,d.requestedAt)}async fetchUserThreadsDeltaUpdate(a){let b=this.#a5;if(null===b)return;let c=await this.#a2[qp].httpClient.getUserThreadsSince_experimental({since:b,signal:a});b<c.requestedAt&&(this.#a3=c.requestedAt),this.updateThreadifications(c.threads.updated,c.inboxNotifications.updated,c.subscriptions.updated,c.threads.deleted,c.inboxNotifications.deleted,c.subscriptions.deleted),this.permissionHints.update(c.permissionHints)}async fetchRoomVersionsDeltaUpdate(a,b){let c=this.#a6.get(a);if(void 0===c)return;let d=ps(this.#a2.getRoom(a),`Room with id ${a} is not available on client`),e=await d[qp].listTextVersionsSince({since:c,signal:b});this.historyVersions.update(a,e.versions),c<e.requestedAt&&this.#a6.set(a,e.requestedAt)}async refreshRoomSubscriptionSettings(a,b){let c=ps(this.#a2.getRoom(a),`Room with id ${a} is not available on client`),d=await c.getSubscriptionSettings({signal:b});this.roomSubscriptionSettings.update(a,d)}async refreshNotificationSettings(a){let b=await this.#a2.getNotificationSettings({signal:a});this.notificationSettings.update(b)}updateNotificationSettings_confirmOptimisticUpdate(a,b){o7(()=>{this.optimisticUpdates.remove(b),this.notificationSettings.update(a)})}};function sa(a,b){if(void 0!==a.deletedAt)return a;if(b.threadId!==a.id)return pt.warn(`Comment ${b.id} does not belong to thread ${a.id}`),a;let c=a.comments.find(a=>a.id===b.id);if(void 0===c){let c=new Date(Math.max(a.updatedAt.getTime(),b.createdAt.getTime()));return{...a,updatedAt:c,comments:[...a.comments,b]}}if(void 0!==c.deletedAt){let d={...c,metadata:{...c.metadata,...b.metadata}},e=a.comments.map(a=>a.id===b.id?d:a);return{...a,comments:e}}if(void 0===c.editedAt||void 0===b.editedAt||c.editedAt<=b.editedAt){let c=a.comments.map(a=>a.id===b.id?b:a);return{...a,updatedAt:new Date(Math.max(a.updatedAt.getTime(),b.editedAt?.getTime()||b.createdAt.getTime())),comments:c}}return a}function sb(a,b,c){if(void 0!==a.deletedAt)return a;let d=a.comments.find(a=>a.id===b);if(void 0===d||void 0!==d.deletedAt)return a;let e=a.comments.map(a=>a.id===b?{...a,deletedAt:c,body:void 0,attachments:[]}:a);return e.every(a=>void 0!==a.deletedAt)?{...a,deletedAt:c,updatedAt:c}:{...a,updatedAt:c,comments:e}}function sc(a,b,c){if(void 0!==a.deletedAt)return a;let d=a.comments.find(a=>a.id===b);if(void 0===d||void 0!==d.deletedAt)return a;let e=a.comments.map(a=>{var d,e;let f;return a.id===b?{...a,reactions:(d=a.reactions,e=c,void 0===(f=d.find(a=>a.emoji===e.emoji))?[...d,{emoji:e.emoji,createdAt:e.createdAt,users:[{id:e.userId}]}]:!1===f.users.some(a=>a.id===e.userId)?d.map(a=>a.emoji===e.emoji?{...a,users:[...a.users,{id:e.userId}]}:a):d)}:a});return{...a,updatedAt:new Date(Math.max(c.createdAt.getTime(),a.updatedAt.getTime())),comments:e}}function sd(a,b,c,d,e){if(void 0!==a.deletedAt)return a;let f=a.comments.find(a=>a.id===b);if(void 0===f||void 0!==f.deletedAt)return a;let g=a.comments.map(a=>a.id===b?{...a,reactions:a.reactions.map(a=>a.emoji===c?{...a,users:a.users.filter(a=>a.id!==d)}:a).filter(a=>a.users.length>0)}:a);return{...a,updatedAt:new Date(Math.max(e.getTime(),a.updatedAt.getTime())),comments:g}}function se(a){return Error(`resolveUsers didn't return anything for user '${a}'`)}function sf(a){return Error(`resolveRoomsInfo didn't return anything for room '${a}'`)}function sg(a){return Error(`resolveGroupsInfo didn't return anything for group '${a}'`)}var sh=new WeakMap;function si(a){let b=rG();if(!a?.allowNesting&&null!==b)throw Error("You cannot nest multiple LiveblocksProvider instances in the same React tree.");return(0,K.jsx)(rF.Provider,{value:a.client,children:a.children})}function sj(a){let b=rH(),c=rL(a);(0,L.useEffect)(()=>b.events.error.subscribe(a=>c.current(a)),[b,c])}Object.freeze({status:"disconnected"}),Object.freeze({status:"loading"}),Object.freeze({status:"idle"});var sk=()=>{},sl=a=>a,sm=Object.freeze([]);function sn(){return sm}function so(){return null}function sp(a){return a.map(a=>a.connectionId)}function sq(a){let b=a[qp].currentUserId.get();return void 0===b?"anonymous":b}var sr=new WeakMap,ss=new WeakMap;function st(a){var b,c;let d,e,f,g,h,i=sr.get(a);return i||(e=(c=b=a,(d=sh.get(c))||(d=new r9(c),sh.set(c,d)),d),f=new pS(a=>rC(async b=>{try{return await e.fetchRoomThreadsDeltaUpdate(a,b)}catch(b){throw pt.warn(`Polling new threads for '${a}' failed: ${String(b)}`),b}},rS,{maxStaleTimeMs:rT})),g=new pS(a=>rC(async b=>{try{return await e.fetchRoomVersionsDeltaUpdate(a,b)}catch(b){throw pt.warn(`Polling new history versions for '${a}' failed: ${String(b)}`),b}},rU,{maxStaleTimeMs:rV})),h=new pS(a=>rC(async b=>{try{return await e.refreshRoomSubscriptionSettings(a,b)}catch(b){throw pt.warn(`Polling subscription settings for '${a}' failed: ${String(b)}`),b}},rW,{maxStaleTimeMs:rX})),i={store:e,onMutationFailure:function(a,c,d){if(e.optimisticUpdates.remove(a),d instanceof pE){if(403===d.status){let a=[d.message,d.details?.suggestion,d.details?.docs].filter(Boolean).join("\n");pt.error(a)}b[qp].emitError(c,d)}else throw d},pollThreadsForRoomId:a=>{let b=f.getOrCreate(a);b&&(b.markAsStale(),b.pollNowIfStale())},getOrCreateThreadsPollerForRoomId:f.getOrCreate.bind(f),getOrCreateVersionsPollerForRoomId:g.getOrCreate.bind(g),getOrCreateSubscriptionSettingsPollerForRoomId:h.getOrCreate.bind(h)},sr.set(a,i)),i}function su(a){let b=rH(),[c]=(0,L.useState)(()=>new Map),d=(0,L.useCallback)((a,d)=>{let e=c.get(a);if(e)return e;let f=b.enterRoom(a,d),g=f.leave;return f.leave=()=>{g(),c.delete(a)},c.set(a,f),f},[b,c]);return(0,K.jsx)(sv,{...a,stableEnterRoom:d})}function sv(a){let b=rH(),{id:c,stableEnterRoom:d}=a,e=r0({initialPresence:a.initialPresence,initialStorage:a.initialStorage,autoConnect:a.autoConnect??!1,engine:a.engine},c),[{room:f},g]=(0,L.useState)(()=>d(c,{...e,autoConnect:!1}));return(0,L.useEffect)(()=>{let{store:a}=st(b);async function c(b){if(b.type===p5.THREAD_DELETED)return void a.deleteThread(b.threadId,null);let c=await f.getThread(b.threadId);if(!c.thread)return void a.deleteThread(b.threadId,null);let{thread:d,inboxNotification:e,subscription:g}=c,h=a.outputs.threads.get().getEvenIfDeleted(b.threadId);switch(b.type){case p5.COMMENT_EDITED:case p5.THREAD_METADATA_UPDATED:case p5.THREAD_UPDATED:case p5.COMMENT_REACTION_ADDED:case p5.COMMENT_REACTION_REMOVED:case p5.COMMENT_DELETED:case p5.COMMENT_METADATA_UPDATED:if(!h)break;a.updateThreadifications([d],e?[e]:[],g?[g]:[]);break;case p5.COMMENT_CREATED:a.updateThreadifications([d],e?[e]:[],g?[g]:[])}}return f.events.comments.subscribe(a=>void c(a))},[b,f]),(0,L.useEffect)(()=>{let a=d(c,e);g(a);let{room:b,leave:f}=a;return e.autoConnect&&b.connect(),()=>{f()}},[c,e,d]),(0,K.jsx)(rI.Provider,{value:f,children:a.children})}function sw(a){let b=rJ();if(null===b&&!a?.allowOutsideRoom)throw Error("RoomProvider is missing from the React tree.");return b}function sx(){let a=sw(),b=a.events.status.subscribe,c=a.getStatus,d=a.getStatus;return(0,L.useSyncExternalStore)(b,c,d)}function sy(){let a=sw();return(0,L.useCallback)((b,c={shouldQueueEventIfNotReady:!1})=>{a.broadcastEvent(b,c)},[a])}function sz(a){let b=sw(),c=rL(a);(0,L.useEffect)(()=>b.events.others.subscribe(a=>c.current(a)),[b,c])}function sA(a){let b=sw(),c=rL(a);(0,L.useEffect)(()=>b.events.lostConnection.subscribe(a=>c.current(a)),[b,c])}function sB(a){let b=sw(),c=rL(a);(0,L.useEffect)(()=>b.events.customEvent.subscribe(a=>{c.current(a)}),[b,c])}function sC(){return sw().history}function sD(){return sC().undo}function sE(){return sC().redo}function sF(){let a=sw(),b=a.events.history.subscribe,c=a.history.canUndo;return(0,L.useSyncExternalStore)(b,c,c)}function sG(){let a=sw(),b=a.events.history.subscribe,c=a.history.canRedo;return(0,L.useSyncExternalStore)(b,c,c)}function sH(a,b){let c=sw(),d=c.events.self.subscribe,e=c.getSelf,f=a??sl;return rO(d,e,so,(0,L.useCallback)(a=>null!==a?f(a):null,[f]),b)}function sI(){let a=sw(),b=a.events.myPresence.subscribe,c=a.getPresence;return[(0,L.useSyncExternalStore)(b,c,c),a.updatePresence]}function sJ(){return sw().updatePresence}function sK(a,b){let c=sw();return rO(c.events.others.subscribe,c.getOthers,sn,a??sl,b)}function sL(a,b){return sK((0,L.useCallback)(b=>b.map(b=>[b.connectionId,a(b)]),[a]),(0,L.useCallback)((a,c)=>{let d=b??Object.is;return a.length===c.length&&a.every((a,b)=>{let e=c[b];return a[0]===e[0]&&d(a[1],e[1])})},[b]))}function sM(){return sK(sp,qx)}var sN=Symbol();function sO(a,b,c){let d=sK((0,L.useCallback)(c=>{let d=c.find(b=>b.connectionId===a);return void 0!==d?b(d):sN},[a,b]),(0,L.useCallback)((a,b)=>a===sN||b===sN?a===b:(c??Object.is)(a,b),[c]));if(d===sN)throw Error(`No such other user with connection id ${a} exists`);return d}function sP(){let a=sw(),b=a.events.storageDidLoad.subscribeOnce,c=a.getStorageSnapshot;return(0,L.useSyncExternalStore)(b,c,so)}function sQ(){return[sP()]}function sR(a,b){let c=sw(),d=sP(),e=(0,L.useCallback)(b=>null!==b?a(b):null,[a]);return rO((0,L.useCallback)(a=>null!==d?c.subscribe(d,a,{isDeep:!0}):sk,[c,d]),(0,L.useCallback)(()=>null===d?null:d.toImmutable(),[d]),so,e,b)}function sS(a,b){let c=sw();return(0,L.useMemo)(()=>(...b)=>c.batch(()=>{let d,e,f;return a((d="This mutation cannot be used until",e=`${d} connected to the Liveblocks room`,f=`${d} storage has been loaded`,{get storage(){let a=c.getStorageSnapshot();if(null===a)throw Error(f);return a},get self(){let a=c.getSelf();if(null===a)throw Error(e);return a},get others(){let a=c.getOthers();if(null===c.getSelf())throw Error(e);return a},setMyPresence:c.updatePresence}),...b)}),[c,...b])}function sT(a={}){let{scrollOnLoad:b=!0}=a,c=rH(),d=sw(),{store:e,getOrCreateThreadsPollerForRoomId:f}=st(c),g=pK([d.id,a.query??{}]),h=f(d.id);(0,L.useEffect)(()=>void e.outputs.loadingRoomThreads.getOrCreate(g).waitUntilLoaded()),(0,L.useEffect)(()=>(h.inc(),h.pollNowIfStale(),()=>h.dec()),[h]);let i=rQ(e.outputs.loadingRoomThreads.getOrCreate(g).signal);return(0,L.useEffect)(()=>{!1===b||i.threads},[i.isLoading]),i}function sU(a){let[b,c]=(0,L.useState)({isLoading:!0}),d=(0,L.useRef)(null),e=(0,L.useRef)(null),f=rH(),g=sw(),h=pK([g.id,a.query]);return(0,L.useEffect)(()=>{let b=(d.current?.id??0)+1,h=new AbortController;return d.current={id:b,controller:h},c(a=>a.isLoading?a:{isLoading:!0}),e.current=window.setTimeout(()=>{f[qp].httpClient.searchComments({roomId:g.id,query:a.query},{signal:h.signal}).then(({data:a})=>{h.signal.aborted||d.current?.id===b&&(c({isLoading:!1,results:a}),d.current=null)}).catch(a=>{h.signal.aborted||d.current?.id===b&&(c({isLoading:!1,error:a}),d.current=null)})},300),()=>{null!==e.current&&window.clearTimeout(e.current),null!==d.current&&d.current.controller.abort()}},[h,f,g.id]),b}function sV(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{let d=c.body,e=c.metadata??{},f=c.commentMetadata??{},g=c.attachments,h=pQ("th"),i=pR(),j=new Date,k={id:i,threadId:h,roomId:a,createdAt:j,type:"comment",userId:sq(b),body:d,reactions:[],attachments:g??[],metadata:f},l={id:h,type:"thread",createdAt:j,updatedAt:j,roomId:a,metadata:e,comments:[k],resolved:!1},{store:m,onMutationFailure:n}=st(b),o=m.optimisticUpdates.add({type:"create-thread",thread:l,roomId:a}),p=g?.map(a=>a.id);return b[qp].httpClient.createThread({roomId:a,threadId:h,commentId:i,body:d,metadata:e,commentMetadata:f,attachmentIds:p}).then(a=>{m.createThread(o,a)},b=>n(o,{type:"CREATE_THREAD_ERROR",roomId:a,threadId:h,commentId:i,body:d,metadata:e,commentMetadata:f},b)),l},[b,a])}function sW(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{let{store:d,onMutationFailure:e}=st(b),f=sq(b),g=d.outputs.threads.get().get(c);if(g?.comments?.[0]?.userId!==f)throw Error("Only the thread creator can delete the thread");let h=d.optimisticUpdates.add({type:"delete-thread",roomId:a,threadId:c,deletedAt:new Date});b[qp].httpClient.deleteThread({roomId:a,threadId:c}).then(()=>{d.deleteThread(c,h)},b=>e(h,{type:"DELETE_THREAD_ERROR",roomId:a,threadId:c},b))},[b,a])}function sX(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{if(!c.metadata)return;let d=c.threadId,e=c.metadata,f=new Date,{store:g,onMutationFailure:h}=st(b),i=g.optimisticUpdates.add({type:"edit-thread-metadata",metadata:e,threadId:d,updatedAt:f});b[qp].httpClient.editThreadMetadata({roomId:a,threadId:d,metadata:e}).then(a=>g.patchThread(d,i,{metadata:a},f),b=>h(i,{type:"EDIT_THREAD_METADATA_ERROR",roomId:a,threadId:d,metadata:e},b))},[b,a])}function sY(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{if(!c.metadata)return;let d=c.threadId,e=c.commentId,f=c.metadata,g=new Date,{store:h,onMutationFailure:i}=st(b),j=h.optimisticUpdates.add({type:"edit-comment-metadata",threadId:d,commentId:e,metadata:f,updatedAt:g});b[qp].httpClient.editCommentMetadata({roomId:a,threadId:d,commentId:e,metadata:f}).then(a=>h.editCommentMetadata(d,e,j,a,g),b=>i(j,{type:"EDIT_COMMENT_METADATA_ERROR",roomId:a,threadId:d,commentId:e,metadata:f},b))},[b,a])}function sZ(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{let{threadId:d,body:e}=c,f=c.metadata??{},g=c.attachments??[],h=pR(),i={id:h,threadId:d,roomId:a,type:"comment",createdAt:new Date,userId:sq(b),body:e,reactions:[],attachments:g??[],metadata:f},{store:j,onMutationFailure:k}=st(b),l=j.optimisticUpdates.add({type:"create-comment",comment:i}),m=g?.map(a=>a.id);return b[qp].httpClient.createComment({roomId:a,threadId:d,commentId:h,body:e,metadata:f,attachmentIds:m}).then(a=>{j.createComment(a,l)},b=>k(l,{type:"CREATE_COMMENT_ERROR",roomId:a,threadId:d,commentId:h,body:e,metadata:f},b)),i},[b,a])}function s$(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(({threadId:c,commentId:d,body:e,attachments:f,metadata:g})=>{let h=new Date,{store:i,onMutationFailure:j}=st(b),k=i.outputs.threads.get().getEvenIfDeleted(c);if(void 0===k)return void pt.warn(`Internal unexpected behavior. Cannot edit comment in thread "${c}" because the thread does not exist in the cache.`);let l=k.comments.find(a=>a.id===d);if(void 0===l||void 0!==l.deletedAt)return void pt.warn(`Internal unexpected behavior. Cannot edit comment "${d}" in thread "${c}" because the comment does not exist in the cache.`);let m=void 0!==g?{...l.metadata,...g}:l.metadata,n=i.optimisticUpdates.add({type:"edit-comment",comment:{...l,editedAt:h,body:e,attachments:f??[],metadata:m}}),o=f?.map(a=>a.id);b[qp].httpClient.editComment({roomId:a,threadId:c,commentId:d,body:e,attachmentIds:o,metadata:g}).then(a=>{i.editComment(c,n,a)},b=>j(n,{type:"EDIT_COMMENT_ERROR",roomId:a,threadId:c,commentId:d,body:e,metadata:m},b))},[b,a])}function s_(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(({threadId:c,commentId:d})=>{let e=new Date,{store:f,onMutationFailure:g}=st(b),h=f.optimisticUpdates.add({type:"delete-comment",threadId:c,commentId:d,deletedAt:e,roomId:a});b[qp].httpClient.deleteComment({roomId:a,threadId:c,commentId:d}).then(()=>{f.deleteComment(c,h,d,e)},b=>g(h,{type:"DELETE_COMMENT_ERROR",roomId:a,threadId:c,commentId:d},b))},[b,a])}function s0(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(({threadId:c,commentId:d,emoji:e})=>{let f=new Date,g=sq(b),{store:h,onMutationFailure:i}=st(b),j=h.optimisticUpdates.add({type:"add-reaction",threadId:c,commentId:d,reaction:{emoji:e,userId:g,createdAt:f}});b[qp].httpClient.addReaction({roomId:a,threadId:c,commentId:d,emoji:e}).then(a=>{h.addReaction(c,j,d,a,f)},b=>i(j,{type:"ADD_REACTION_ERROR",roomId:a,threadId:c,commentId:d,emoji:e},b))},[b,a])}function s1(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(({threadId:c,commentId:d,emoji:e})=>{let f=sq(b),g=new Date,{store:h,onMutationFailure:i}=st(b),j=h.optimisticUpdates.add({type:"remove-reaction",threadId:c,commentId:d,emoji:e,userId:f,removedAt:g});b[qp].httpClient.removeReaction({roomId:a,threadId:c,commentId:d,emoji:e}).then(()=>{h.removeReaction(c,j,d,e,f,g)},b=>i(j,{type:"REMOVE_REACTION_ERROR",roomId:a,threadId:c,commentId:d,emoji:e},b))},[b,a])}function s2(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{let{store:d,onMutationFailure:e}=st(b),f=Object.values(d.outputs.notifications.get().notificationsById).find(a=>"thread"===a.kind&&a.threadId===c);if(!f)return;let g=new Date,h=d.optimisticUpdates.add({type:"mark-inbox-notification-as-read",inboxNotificationId:f.id,readAt:g});b[qp].httpClient.markRoomInboxNotificationAsRead({roomId:a,inboxNotificationId:f.id}).then(()=>{d.markInboxNotificationRead(f.id,g,h)},b=>{e(h,{type:"MARK_INBOX_NOTIFICATION_AS_READ_ERROR",roomId:a,inboxNotificationId:f.id},b)})},[b,a])}function s3(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{let d=new Date,{store:e,onMutationFailure:f}=st(b),g=e.optimisticUpdates.add({type:"mark-thread-as-resolved",threadId:c,updatedAt:d});b[qp].httpClient.markThreadAsResolved({roomId:a,threadId:c}).then(()=>{e.patchThread(c,g,{resolved:!0},d)},b=>f(g,{type:"MARK_THREAD_AS_RESOLVED_ERROR",roomId:a,threadId:c},b))},[b,a])}function s4(){var a;let b;return a=sw().id,b=rH(),(0,L.useCallback)(c=>{let d=new Date,{store:e,onMutationFailure:f}=st(b),g=e.optimisticUpdates.add({type:"mark-thread-as-unresolved",threadId:c,updatedAt:d});b[qp].httpClient.markThreadAsUnresolved({roomId:a,threadId:c}).then(()=>{e.patchThread(c,g,{resolved:!1},d)},b=>f(g,{type:"MARK_THREAD_AS_UNRESOLVED_ERROR",roomId:a,threadId:c},b))},[b,a])}function s5(){return s6(sw().id)}function s6(a){let b=rH();return(0,L.useCallback)(c=>{let d=new Date,{store:e,onMutationFailure:f}=st(b),g=e.optimisticUpdates.add({type:"subscribe-to-thread",threadId:c,subscribedAt:d});b[qp].httpClient.subscribeToThread({roomId:a,threadId:c}).then(a=>{e.createSubscription(a,g)},b=>f(g,{type:"SUBSCRIBE_TO_THREAD_ERROR",roomId:a,threadId:c},b))},[b,a])}function s7(){return s8(sw().id)}function s8(a){let b=rH();return(0,L.useCallback)(c=>{let d=new Date,{store:e,onMutationFailure:f}=st(b),g=e.optimisticUpdates.add({type:"unsubscribe-from-thread",threadId:c,unsubscribedAt:d});b[qp].httpClient.unsubscribeFromThread({roomId:a,threadId:c}).then(()=>{e.deleteSubscription(rD("thread",c),g)},b=>f(g,{type:"UNSUBSCRIBE_FROM_THREAD_ERROR",roomId:a,threadId:c},b))},[b,a])}function s9(a){return function(a,b){let{store:c}=st(rH()),d=(0,L.useMemo)(()=>rD("thread",b),[b]),e=s6(a),f=s8(a),g=(0,L.useCallback)(()=>e(b),[e,b]),h=(0,L.useCallback)(()=>f(b),[f,b]);return rQ(c.outputs.threadSubscriptions,(0,L.useCallback)(a=>{let c=a.subscriptions[d],e=a.notifications.find(a=>"thread"===a.kind&&a.threadId===b);return void 0===c?{status:"not-subscribed",subscribe:g,unsubscribe:h}:{status:"subscribed",unreadSince:e?.readAt??null,subscribe:g,unsubscribe:h}},[d,b,g,h]),qx)}(sw().id,a)}function ta(){let a=tf(),b=rH(),c=sw(),{store:d,getOrCreateSubscriptionSettingsPollerForRoomId:e}=st(b),f=e(c.id);(0,L.useEffect)(()=>void d.outputs.roomSubscriptionSettingsByRoomId.getOrCreate(c.id).waitUntilLoaded()),(0,L.useEffect)(()=>(f.inc(),f.pollNowIfStale(),()=>{f.dec()}),[f]);let g=rQ(d.outputs.roomSubscriptionSettingsByRoomId.getOrCreate(c.id).signal);return(0,L.useMemo)(()=>[g,a],[g,a])}function tb(){r_();let a=st(rH()).store,b=sw();r1(a.outputs.roomSubscriptionSettingsByRoomId.getOrCreate(b.id).waitUntilLoaded());let[c,d]=ta();return pr(!c.error,"Did not expect error"),pr(!c.isLoading,"Did not expect loading"),(0,L.useMemo)(()=>[c,d],[c,d])}function tc(a){let[b,c]=(0,L.useState)({isLoading:!0}),d=sw();return(0,L.useEffect)(()=>{c({isLoading:!0}),(async()=>{try{let b=await d[qp].getTextVersion(a),e=await b.arrayBuffer(),f=new Uint8Array(e);c({isLoading:!1,data:f})}catch(a){c({isLoading:!1,error:a instanceof Error?a:Error("An unknown error occurred while loading this version")})}})()},[d,a]),b}function td(){let a=rH(),b=sw(),{store:c,getOrCreateVersionsPollerForRoomId:d}=st(a),e=d(b.id);return(0,L.useEffect)(()=>(e.inc(),e.pollNowIfStale(),()=>e.dec()),[e]),(0,L.useEffect)(()=>void c.outputs.versionsByRoomId.getOrCreate(b.id).waitUntilLoaded()),rQ(c.outputs.versionsByRoomId.getOrCreate(b.id).signal)}function te(){r_();let a=rH(),b=sw();r1(st(a).store.outputs.versionsByRoomId.getOrCreate(b.id).waitUntilLoaded());let c=td();return pr(!c.error,"Did not expect error"),pr(!c.isLoading,"Did not expect loading"),c}function tf(){let a=rH(),b=sw();return(0,L.useCallback)(c=>{let{store:d,onMutationFailure:e,pollThreadsForRoomId:f}=st(a),g=sq(a),h=d.optimisticUpdates.add({type:"update-room-subscription-settings",roomId:b.id,userId:g,settings:c});b.updateSubscriptionSettings(c).then(a=>{d.updateRoomSubscriptionSettings(b.id,h,a),c.threads&&f(b.id)},a=>e(h,{type:"UPDATE_ROOM_SUBSCRIPTION_SETTINGS_ERROR",roomId:b.id},a))},[a,b])}function tg(){r_(),r1(sw().waitUntilPresenceReady())}function th(a,b){return tg(),sH(a,b)}function ti(a,b){return tg(),sK(a,b)}function tj(){return tg(),sM()}function tk(a,b){return tg(),sL(a,b)}function tl(a,b,c){return tg(),sO(a,b,c)}function tm(a,b){return r_(),r1(sw().waitUntilStorageReady()),sR(a,b)}function tn(a={}){r_();let b=rH(),c=sw(),{store:d}=st(b),e=pK([c.id,a.query??{}]);r1(d.outputs.loadingRoomThreads.getOrCreate(e).waitUntilLoaded());let f=sT(a);return pr(!f.error,"Did not expect error"),pr(!f.isLoading,"Did not expect loading"),f}function to(a){return void 0===a||a?.isLoading?a??{isLoading:!0}:a.error?a:(pr(void 0!==a.data,"Unexpected missing attachment URL"),{isLoading:!1,url:a.data})}function tp(a){var b,c;let d,e;return b=a,c=sw().id,d=rH()[qp].httpClient.getOrCreateAttachmentUrlsStore(c),e=(0,L.useCallback)(()=>d.getItemState(b),[d,b]),(0,L.useEffect)(()=>{d.enqueue(b)},[d,b]),rO(d.subscribe,e,e,to,qx)}function tq(a){let{attachmentUrlsStore:b}=sw()[qp],c=(0,L.useCallback)(()=>b.getItemState(a),[b,a]),d=c();if(!d||d.isLoading)throw b.enqueue(a);if(d.error)throw d.error;let e=(0,L.useSyncExternalStore)(b.subscribe,c,c);return pr(void 0!==e,"Unexpected missing state"),pr(!e.isLoading,"Unexpected loading state"),pr(!e.error,"Unexpected error state"),{isLoading:!1,url:e.data,error:void 0}}let{suspense:{RoomProvider:tr,useRoom:ts,useMyPresence:tt,useUpdateMyPresence:tu,useSelf:tv,useOthers:tw,useOthersMapped:tx,useOthersConnectionIds:ty,useOther:tz,useBroadcastEvent:tA,useEventListener:tB,useErrorListener:tC,useStorage:tD,useHistory:tE,useUndo:tF,useRedo:tG,useCanUndo:tH,useCanRedo:tI,useMutation:tJ,useStatus:tK,useLostConnectionListener:tL,useThreads:tM,useUser:tN,useRoomInfo:tO}}=(H=function(b){var c,d;let e=rv("throttle",b.throttle??100,16,1e3),f=rv("lostConnectionTimeout",b.lostConnectionTimeout??5e3,200,3e4,1e3),g=rw(b.backgroundKeepAliveTimeout),h="string"==typeof(c=b.baseUrl)&&c.startsWith("http")?c:"https://api.liveblocks.io",i=new pb(void 0),j=function(a,b){let c=function(a){let{publicApiKey:b,authEndpoint:c}=a;if(void 0!==c&&void 0!==b)throw Error("You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient");if("string"==typeof b){if(b.startsWith("sk_"))throw Error("Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");if(!b.startsWith("pk_"))throw Error("Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");return{type:"public",publicApiKey:b}}if("string"==typeof c)return{type:"private",url:c};if("function"==typeof c)return{type:"custom",callback:c};if(void 0!==c)throw Error("The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint");throw Error("Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient")}(a),d=new Set,e=[],f=[],g=new Map;function h(a,b){return"comments:read"===a?b.includes("comments:read")||b.includes("comments:write")||b.includes("room:read")||b.includes("room:write"):"room:read"===a&&(b.includes("room:read")||b.includes("room:write"))}async function i(e){let f=a.polyfills?.fetch??void 0;if("private"===c.type){if(void 0===f)throw new qd("To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.");let a=qI((await qK(f,c.url,{room:e.roomId})).token);if(d.has(a.raw))throw new qd("The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.");return b?.(a.parsed),a}if("custom"===c.type){let a=await c.callback(e.roomId);if(a&&"object"==typeof a){if("string"==typeof a.token){let c=qI(a.token);return b?.(c.parsed),c}else if("string"==typeof a.error){let b=`Authentication failed: ${"reason"in a&&"string"==typeof a.reason?a.reason:"Forbidden"}`;if("forbidden"===a.error)throw new qd(b);throw Error(b)}}throw Error('Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: "..." }')}throw Error("Unexpected authentication type. Must be private or custom.")}return{reset:function(){d.clear(),e.length=0,f.length=0,g.clear()},getAuthValue:async function(a){let b;if("public"===c.type)return{type:"public",publicApiKey:c.publicApiKey};let j=function(a){let b=Math.ceil(Date.now()/1e3);for(let c=e.length-1;c>=0;c--){let d=e[c];if(f[c]<=b){e.splice(c,1),f.splice(c,1);continue}if("id"===d.parsed.k)return d;if("acc"===d.parsed.k){if(!a.roomId&&0===Object.entries(d.parsed.perms).length)return d;for(let[b,c]of Object.entries(d.parsed.perms))if(a.roomId){if(b.includes("*")&&a.roomId.startsWith(b.replace("*",""))||a.roomId===b&&h(a.requestedScope,c))return d}else if(b.includes("*")&&h(a.requestedScope,c))return d}}}(a);if(void 0!==j)return{type:"secret",token:j};a.roomId?void 0===(b=g.get(a.roomId))&&(b=i(a),g.set(a.roomId,b)):void 0===(b=g.get("liveblocks-user-token"))&&(b=i(a),g.set("liveblocks-user-token",b));try{let a=await b,c=Math.floor(Date.now()/1e3)+(a.parsed.exp-a.parsed.iat)-30;return d.add(a.raw),e.push(a),f.push(c),{type:"secret",token:a}}finally{a.roomId?g.delete(a.roomId):g.delete("liveblocks-user-token")}}}}(b,a=>{i.set(()=>a.uid)}),k=function({baseUrl:a,authManager:b,currentUserId:c,fetchPolyfill:d}){let e=new p1(a,d);async function f(a){let c=await e.get(p_`/v2/c/rooms/${a.roomId}/threads/delta`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{since:a.since.toISOString()},{signal:a.signal});return{threads:{updated:c.data.map(pj),deleted:c.deletedThreads.map(pm)},inboxNotifications:{updated:c.inboxNotifications.map(pk),deleted:c.deletedInboxNotifications.map(pn)},subscriptions:{updated:c.subscriptions.map(pl),deleted:c.deletedSubscriptions.map(po)},requestedAt:new Date(c.meta.requestedAt),permissionHints:c.meta.permissionHints}}async function g(a){let c;a.query&&(c=pU(a.query));try{let d=await e.get(p_`/v2/c/rooms/${a.roomId}/threads`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{cursor:a.cursor,query:c,limit:50});return{threads:d.data.map(pj),inboxNotifications:d.inboxNotifications.map(pk),subscriptions:d.subscriptions.map(pl),nextCursor:d.meta.nextCursor,requestedAt:new Date(d.meta.requestedAt),permissionHints:d.meta.permissionHints}}catch(a){if(a instanceof pE&&404===a.status)return{threads:[],inboxNotifications:[],subscriptions:[],nextCursor:null,requestedAt:new Date(Date.now()-216e5),permissionHints:{}};throw a}}async function h(a,c){return await e.get(p_`/v2/c/rooms/${a.roomId}/threads/comments/search`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{text:a.query.text,query:pU({threadMetadata:a.query.threadMetadata,threadResolved:a.query.threadResolved,hasAttachments:a.query.hasAttachments,hasMentions:a.query.hasMentions})},{signal:c?.signal})}async function i(a){let c=a.commentId??pR(),d=a.threadId??pQ("th");return pj(await e.post(p_`/v2/c/rooms/${a.roomId}/threads`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{id:d,comment:{id:c,body:a.body,metadata:a.commentMetadata,attachmentIds:a.attachmentIds},metadata:a.metadata}))}async function j(a){await e.delete(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function k(a){let c=await e.rawGet(p_`/v2/c/rooms/${a.roomId}/thread-with-notification/${a.threadId}`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}));if(c.ok){let a=await c.json();return{thread:pj(a.thread),inboxNotification:a.inboxNotification?pk(a.inboxNotification):void 0,subscription:a.subscription?pl(a.subscription):void 0}}if(404===c.status)return{thread:void 0,inboxNotification:void 0,subscription:void 0};throw Error(`There was an error while getting thread ${a.threadId}.`)}async function l(a){return await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/metadata`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),a.metadata)}async function m(a){return await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/comments/${a.commentId}/metadata`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),a.metadata)}async function n(a){let c=a.commentId??pR();return pi(await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/comments`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{id:c,body:a.body,metadata:a.metadata,attachmentIds:a.attachmentIds}))}async function o(a){return pi(await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/comments/${a.commentId}`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{body:a.body,attachmentIds:a.attachmentIds,metadata:a.metadata}))}async function p(a){await e.delete(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/comments/${a.commentId}`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function q(a){var c;return{...c=await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/comments/${a.commentId}/reactions`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{emoji:a.emoji}),createdAt:new Date(c.createdAt)}}async function r(a){await e.delete(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/comments/${a.commentId}/reactions/${a.emoji}`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function s(a){await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/mark-as-resolved`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function t(a){await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/mark-as-unresolved`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function u(a){return pl(await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/subscribe`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId})))}async function v(a){await e.post(p_`/v2/c/rooms/${a.roomId}/threads/${a.threadId}/unsubscribe`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function w(a){let c=a.roomId,d=a.signal,f=a.attachment,g=d?new DOMException(`Upload of attachment ${a.attachment.id} was aborted.`,"AbortError"):void 0;if(d?.aborted)throw g;let h=a=>{if(d?.aborted)throw g;if(a instanceof pE&&413===a.status)throw a;return!1},i=[2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3];if(f.size<=5242880)return pG(async()=>e.putBlob(p_`/v2/c/rooms/${c}/attachments/${f.id}/upload/${encodeURIComponent(f.name)}`,await b.getAuthValue({requestedScope:"comments:read",roomId:c}),f.file,{fileSize:f.size},{signal:d}),10,i,h);{let a,j=[],k=await pG(async()=>e.post(p_`/v2/c/rooms/${c}/attachments/${f.id}/multipart/${encodeURIComponent(f.name)}`,await b.getAuthValue({requestedScope:"comments:read",roomId:c}),void 0,{signal:d},{fileSize:f.size}),10,i,h);try{a=k.uploadId;let l=function(a){let b=[],c=0;for(;c<a.size;){let d=Math.min(c+5242880,a.size);b.push({partNumber:b.length+1,part:a.slice(c,d)}),c=d}return b}(f.file);if(d?.aborted)throw g;for(let a of function(a,b){let c=[];for(let b=0,d=a.length;b<d;b+=5)c.push(a.slice(b,b+5));return c}(l,0)){let g=[];for(let{part:j,partNumber:l}of a)g.push(pG(async()=>e.putBlob(p_`/v2/c/rooms/${c}/attachments/${f.id}/multipart/${k.uploadId}/${String(l)}`,await b.getAuthValue({requestedScope:"comments:read",roomId:c}),j,void 0,{signal:d}),10,i,h));j.push(...await Promise.all(g))}if(d?.aborted)throw g;let m=j.sort((a,b)=>a.partNumber-b.partNumber);return e.post(p_`/v2/c/rooms/${c}/attachments/${f.id}/multipart/${a}/complete`,await b.getAuthValue({requestedScope:"comments:read",roomId:c}),{parts:m},{signal:d})}catch(d){if(a&&d?.name&&("AbortError"===d.name||"TimeoutError"===d.name))try{await e.rawDelete(p_`/v2/c/rooms/${c}/attachments/${f.id}/multipart/${a}`,await b.getAuthValue({requestedScope:"comments:read",roomId:c}))}catch(a){}throw d}}}let x=new pS(a=>pO(new pN(async c=>{let d=c.flat(),{urls:f}=await e.post(p_`/v2/c/rooms/${a}/attachments/presigned-urls`,await b.getAuthValue({requestedScope:"comments:read",roomId:a}),{attachmentIds:d});return f.map(a=>a??Error("There was an error while getting this attachment's URL"))},{delay:50})));function y(a){return x.getOrCreate(a)}async function z(a){let{chatId:d,attachment:f,signal:g}=a;if(void 0===c.get())throw Error("Attachment upload requires an authenticated user.");if(a.attachment.file.size<=5242880)await e.putBlob(p_`/v2/c/chats/${d}/attachments/${f.id}/upload/${encodeURIComponent(f.file.name)}`,await b.getAuthValue({requestedScope:"comments:read"}),f.file,{fileSize:f.file.size},{signal:g});else{let a=await e.post(p_`/v2/c/chats/${d}/attachments/${f.id}/multipart/${encodeURIComponent(f.file.name)}`,await b.getAuthValue({requestedScope:"comments:read"}),void 0,{signal:g},{fileSize:f.file.size});try{let c=[],h=[],i=0;for(;i<f.file.size;){let a=Math.min(i+5242880,f.file.size);h.push({number:h.length+1,part:f.file.slice(i,a)}),i=a}c.push(...await Promise.all(h.map(async({number:c,part:h})=>await e.putBlob(p_`/v2/c/chats/${d}/attachments/${f.id}/multipart/${a.uploadId}/${String(c)}`,await b.getAuthValue({requestedScope:"comments:read"}),h,void 0,{signal:g})))),await e.post(p_`/v2/c/chats/${d}/attachments/${f.id}/multipart/${a.uploadId}/complete`,await b.getAuthValue({requestedScope:"comments:read"}),{parts:c.sort((a,b)=>a.number-b.number)},{signal:g})}catch(c){try{await e.delete(p_`/v2/c/chats/${d}/attachments/${f.id}/multipart/${a.uploadId}`,await b.getAuthValue({requestedScope:"comments:read"}))}catch(a){}throw c}}}let A=new pS(a=>pO(new pN(async c=>{let d=c.flat(),{urls:f}=await e.post(p_`/v2/c/chats/${a}/attachments/presigned-urls`,await b.getAuthValue({requestedScope:"comments:read"}),{attachmentIds:d});return f.map(a=>a??Error("There was an error while getting this attachment's URL"))},{delay:50})));function B(a){return A.getOrCreate(a)}async function C(a){return e.get(p_`/v2/c/rooms/${a.roomId}/subscription-settings`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),void 0,{signal:a.signal})}async function D(a){return e.post(p_`/v2/c/rooms/${a.roomId}/subscription-settings`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),a.settings)}let E=new pS(a=>new pN(async c=>{let d=c.flat();return await e.post(p_`/v2/c/rooms/${a}/inbox-notifications/read`,await b.getAuthValue({requestedScope:"comments:read",roomId:a}),{inboxNotificationIds:d}),d},{delay:50}));async function F(a){return E.getOrCreate(a.roomId).get(a.inboxNotificationId)}async function G(a){if("user"!==a.mention.kind&&"group"!==a.mention.kind)return pq(a.mention,"Unexpected mention kind");await e.rawPost(p_`/v2/c/rooms/${a.roomId}/text-mentions`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{userId:"user"===a.mention.kind?a.mention.id:void 0,groupId:"group"===a.mention.kind?a.mention.id:void 0,userIds:"group"===a.mention.kind?a.mention.userIds:void 0,mentionId:a.mentionId})}async function H(a){await e.rawDelete(p_`/v2/c/rooms/${a.roomId}/text-mentions/${a.mentionId}`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function I(a){return e.rawGet(p_`/v2/c/rooms/${a.roomId}/y-version/${a.versionId}`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function J(a){await e.rawPost(p_`/v2/c/rooms/${a.roomId}/version`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}))}async function K(a){await e.rawPost(p_`/v2/c/rooms/${a.roomId}/text-metadata`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{type:a.type,rootKey:a.rootKey})}async function L(a){let c=await e.post(p_`/v2/c/rooms/${a.roomId}/ai/contextual-prompt`,await b.getAuthValue({requestedScope:"room:read",roomId:a.roomId}),{prompt:a.prompt,context:{beforeSelection:a.context.beforeSelection,selection:a.context.selection,afterSelection:a.context.afterSelection},previous:a.previous},{signal:a.signal});if(!c||0===c.content.length)throw Error("No content returned from server");return c.content[0].text}async function M(a){let c=await e.get(p_`/v2/c/rooms/${a.roomId}/versions`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}));return{versions:c.versions.map(({createdAt:a,...b})=>({createdAt:new Date(a),...b})),requestedAt:new Date(c.meta.requestedAt)}}async function N(a){let c=await e.get(p_`/v2/c/rooms/${a.roomId}/versions/delta`,await b.getAuthValue({requestedScope:"comments:read",roomId:a.roomId}),{since:a.since.toISOString()},{signal:a.signal});return{versions:c.versions.map(({createdAt:a,...b})=>({createdAt:new Date(a),...b})),requestedAt:new Date(c.meta.requestedAt)}}async function O(a){let c=await e.rawGet(p_`/v2/c/rooms/${a.roomId}/storage`,await b.getAuthValue({requestedScope:"room:read",roomId:a.roomId}));return await c.json()}async function P(a){let c;a?.query&&(c=pU(a.query));let d=await e.get(p_`/v2/c/inbox-notifications`,await b.getAuthValue({requestedScope:"comments:read"}),{cursor:a?.cursor,limit:50,query:c}),f=d.groups.map(pp);return ab.setData(f.map(a=>[a.id,a])),{inboxNotifications:d.inboxNotifications.map(pk),threads:d.threads.map(pj),subscriptions:d.subscriptions.map(pl),nextCursor:d.meta.nextCursor,requestedAt:new Date(d.meta.requestedAt)}}async function Q(a){let c;a?.query&&(c=pU(a.query));let d=await e.get(p_`/v2/c/inbox-notifications/delta`,await b.getAuthValue({requestedScope:"comments:read"}),{since:a.since.toISOString(),query:c},{signal:a.signal});return{inboxNotifications:{updated:d.inboxNotifications.map(pk),deleted:d.deletedInboxNotifications.map(pn)},threads:{updated:d.threads.map(pj),deleted:d.deletedThreads.map(pm)},subscriptions:{updated:d.subscriptions.map(pl),deleted:d.deletedSubscriptions.map(po)},requestedAt:new Date(d.meta.requestedAt)}}async function R(a){let c;a?.query&&(c=pU(a.query));let{count:d}=await e.get(p_`/v2/c/inbox-notifications/count`,await b.getAuthValue({requestedScope:"comments:read"}),{query:c},{signal:a?.signal});return d}async function S(){await e.post(p_`/v2/c/inbox-notifications/read`,await b.getAuthValue({requestedScope:"comments:read"}),{inboxNotificationIds:"all"})}async function T(a){await e.post(p_`/v2/c/inbox-notifications/read`,await b.getAuthValue({requestedScope:"comments:read"}),{inboxNotificationIds:a})}let U=new pN(async a=>{let b=a.flat();return await T(b),b},{delay:50});async function V(a){await U.get(a)}async function W(){await e.delete(p_`/v2/c/inbox-notifications`,await b.getAuthValue({requestedScope:"comments:read"}))}async function X(a){await e.delete(p_`/v2/c/inbox-notifications/${a}`,await b.getAuthValue({requestedScope:"comments:read"}))}async function Y(a){return e.get(p_`/v2/c/notification-settings`,await b.getAuthValue({requestedScope:"comments:read"}),void 0,{signal:a?.signal})}async function Z(a){return e.post(p_`/v2/c/notification-settings`,await b.getAuthValue({requestedScope:"comments:read"}),a)}async function $(a){let c;a?.query&&(c=pU(a.query));let d=await e.get(p_`/v2/c/threads`,await b.getAuthValue({requestedScope:"comments:read"}),{cursor:a?.cursor,query:c,limit:50});return{threads:d.threads.map(pj),inboxNotifications:d.inboxNotifications.map(pk),subscriptions:d.subscriptions.map(pl),nextCursor:d.meta.nextCursor,requestedAt:new Date(d.meta.requestedAt),permissionHints:d.meta.permissionHints}}async function _(a){let c=await e.get(p_`/v2/c/threads/delta`,await b.getAuthValue({requestedScope:"comments:read"}),{since:a.since.toISOString()},{signal:a.signal});return{threads:{updated:c.threads.map(pj),deleted:c.deletedThreads.map(pm)},inboxNotifications:{updated:c.inboxNotifications.map(pk),deleted:c.deletedInboxNotifications.map(pn)},subscriptions:{updated:c.subscriptions.map(pl),deleted:c.deletedSubscriptions.map(po)},requestedAt:new Date(c.meta.requestedAt),permissionHints:c.meta.permissionHints}}let aa=new pN(async a=>{let c=a.flat(),{groups:d}=await e.post(p_`/v2/c/groups/find`,await b.getAuthValue({requestedScope:"comments:read"}),{groupIds:c}),f=new Map;for(let a of d)f.set(a.id,pp(a));return c.map(a=>f.get(a))},{delay:50}),ab=pO(aa);return{getThreads:g,getThreadsSince:f,searchComments:h,createThread:i,getThread:k,deleteThread:j,editThreadMetadata:l,createComment:n,editComment:o,editCommentMetadata:m,deleteComment:p,addReaction:q,removeReaction:r,markThreadAsResolved:s,markThreadAsUnresolved:t,subscribeToThread:u,unsubscribeFromThread:v,markRoomInboxNotificationAsRead:F,getSubscriptionSettings:C,updateSubscriptionSettings:D,createTextMention:G,deleteTextMention:H,getTextVersion:I,createTextVersion:J,reportTextEditor:K,listTextVersions:M,listTextVersionsSince:N,getAttachmentUrl:function(a){return y(a.roomId).batch.get(a.attachmentId)},uploadAttachment:w,getOrCreateAttachmentUrlsStore:y,uploadChatAttachment:z,getOrCreateChatAttachmentUrlsStore:B,getChatAttachmentUrl:function(a){return B(a.chatId).batch.get(a.attachmentId)},streamStorage:O,getInboxNotifications:P,getInboxNotificationsSince:Q,getUnreadInboxNotificationsCount:R,markAllInboxNotificationsAsRead:S,markInboxNotificationAsRead:V,deleteAllInboxNotifications:W,deleteInboxNotification:X,getNotificationSettings:Y,updateNotificationSettings:Z,getUserThreads_experimental:$,getUserThreadsSince_experimental:_,groupsStore:ab,getGroup:function(a){return aa.get(a)},executeContextualPrompt:L,getUrlMetadata:async function(a){let{metadata:c}=await e.get(p_`/v2/c/urls/metadata`,await b.getAuthValue({requestedScope:"comments:read"}),{url:a});return c}}}({baseUrl:h,fetchPolyfill:b.polyfills?.fetch||globalThis.fetch?.bind(globalThis),currentUserId:i,authManager:j}),l=new Map,m=function(a){let b,c,d,e,f,g,h=new qo(a.delegates,a.enableDebugLogging,!1),i=(d=new ph,{getChatById:function(a){return d.getEvenIfDeleted(a)},findMany:function(a){return d.signal.get().findMany(a)},upsert:function(a){d.upsert(a)},upsertMany:function(a){o7(()=>{for(let b of a)d.upsert(b)})},markDeleted:function(a){d.markDeleted(a)}}),j=(e=new pS(a=>new pS(a=>new pb(void 0))),f=new pS(a=>{let[b,c]=oZ(a);return pe.from(()=>(void 0!==c?e.getOrCreate(c).getOrCreate(b):void 0)?.get()??e.getOrCreate(qC).getOrCreate(b).get())}),{getToolDescriptions:function(a){let b=e.get(qC),c=e.get(a);return Array.from([...b?.entries()??[],...c?.entries()??[]]).flatMap(([a,b])=>{let c=b.get();return c&&(c.enabled??!0)?[{name:a,description:c.description,parameters:c.parameters}]:[]})},getTool:function(a,b){let c=JSON.stringify(void 0!==b?[a,b]:[a]);return f.getOrCreate(c)},registerTool:function(a,b,c){if(!b.execute&&!b.render)throw Error("A tool definition must have an execute() function, a render() function, or both.");let d=c??qC;return e.getOrCreate(d).getOrCreate(a).set(b),()=>(function(a,b){let c=e.get(a);if(void 0===c)return;let d=c.get(b);void 0!==d&&d.set(void 0)})(d,a)}}),k=(g=new pS(a=>new qA),{getKnowledgeStack:function(a){return g.getOrCreate(a??qC)},getKnowledgeForChat:function(a){return[...g.getOrCreate(qC).get(),...g.get(a)?.get()??[]]}}),l=function(a,b){let c=new Set,d=new Set,e=new pS(a=>new pf(new qz(a=>a.id,a=>a.parentId,(a,b)=>a.createdAt<b.createdAt))),f=new pf(new Map);function g(a){o7(()=>{for(let b of a)h(b)})}function h(g){o7(()=>{if(e.getOrCreate(g.chatId).mutate(a=>a.upsert(g)),"assistant"===g.role&&"generating"===g.status?f.mutate(a=>{a.set(g.id,structuredClone(g))}):f.mutate(a=>{a.delete(g.id)}),"assistant"===g.role&&"awaiting-tool"===g.status){if(c.has(g.id))for(let c of g.contentSoFar.filter(a=>"tool-invocation"===a.type&&"executing"===a.stage)){if(d.has(c.invocationId))continue;d.add(c.invocationId);let e=a.getTool(c.name,g.chatId).get()?.execute;e&&(async()=>{let a=await e(c.args,{name:c.name,invocationId:c.invocationId});return await b(g.chatId,g.id,c.invocationId,a??{data:{}},{copilotId:g.copilotId})})().catch(a=>{px(`Error trying to respond to tool-call: ${String(a)} (in execute())`)})}}else"assistant"===g.role&&"generating"===g.status||c.delete(g.id)})}function i(a){for(let b of e.values()){let c=b.get().get(a);if(c)return c}}function j(a){let b=a.next();return b.done?void 0:b.value}let k=new pS(a=>new pS(b=>{let c=pe.from(()=>{var c=e.getOrCreate(a).get();function d(a){if(!a.deletedAt)return!0;for(let b of c.walkDown(a.id,a=>!a.deletedAt))return!0;return!1}function f(a){let b=[],e=null;for(let f of c.walkUp(a.id)){let a=j(c.walkLeft(f.id,d))?.id??null,g=j(c.walkRight(f.id,d))?.id??null;if(!f.deletedAt||a||g){let c={...f,navigation:{parent:null,prev:a,next:g}};null!==e&&(e.navigation.parent=c.id),e=c,b.push(c)}}return b.reverse()}function g(){let a=c.sorted.findRight(a=>!a.deletedAt);return a?f(a):[]}if(null===b)return g();let h=c.get(b);if(!h)return g();for(let a of c.walkUp(h.id)){for(let b of c.walkDown(a.id,a=>!a.deletedAt))return f(b);if(!a.deletedAt)return f(a)}return g()},qy);return pe.from(()=>{let a=f.get();return c.get().map(b=>{if("assistant"!==b.role||"generating"!==b.status)return b;let c=a.get(b.id);return void 0===c?b:{...b,contentSoFar:c.contentSoFar}})},qx)}));return{getMessageById:i,getChatMessagesForBranch:function(a,b){return k.getOrCreate(a).getOrCreate(b||null)},getLastUsedCopilotId:function(a){let b=e.getOrCreate(a).get().sorted.findRight(a=>"assistant"===a.role&&!a.deletedAt);return b?.copilotId},createOptimistically:function(a,b,c,d){let e=`ms_${pP()}`,f=qB();return"user"===b?h({id:e,chatId:a,role:b,parentId:c,createdAt:f,content:d,_optimistic:!0}):h({id:e,chatId:a,role:b,parentId:c,createdAt:f,status:"generating",contentSoFar:[],copilotId:d,_optimistic:!0}),e},upsert:h,upsertMany:g,remove:function(a,b){let c=e.get(a);if(!c)return;let d=c.get().get(b);d&&!d.deletedAt&&("assistant"===d.role&&"completed"!==d.status?h({...d,deletedAt:qB(),contentSoFar:[]}):h({...d,deletedAt:qB(),content:[]}))},removeByChatId:function(a){let b=e.get(a);void 0!==b&&b.mutate(a=>a.clear())},addDelta:function(a,b){f.mutate(c=>{let d=c.get(a);return void 0!==d&&(function(a,b){if(null===b)return;let c=a.filter(a=>"sources"!==a.type),d=a.filter(a=>"sources"===a.type).flatMap(a=>a.sources),e=new Date().toISOString(),f=c[c.length-1];switch(b.type){case"text-delta":f?.type==="text"?f.text+=b.textDelta:(qE(f,e),c.push({type:"text",text:b.textDelta}));break;case"reasoning-delta":f?.type==="reasoning"?f.text+=b.textDelta:(qE(f,e),c.push({type:"reasoning",text:b.textDelta,startedAt:e}));break;case"tool-stream":{let a=function(a,b,c=""){let d=new qw(c);return{type:"tool-invocation",stage:"receiving",invocationId:a,name:b,get partialArgsText(){return d.source},get partialArgs(){return d.json},__appendDelta(a){d.append(a)}}}(b.invocationId,b.name);c.push(a);break}case"tool-delta":f?.type==="tool-invocation"&&"receiving"===f.stage&&f.__appendDelta?.(b.delta);break;case"tool-invocation":qD(c,b,a=>a.invocationId,e);break;case"retrieval":qD(c,b,a=>a.id,e);break;case"source":d.push(b);break;default:return pq(b,"Unhandled case")}d.length>0&&c.push({type:"sources",sources:d}),a.length=0,a.push(...c)}(d.contentSoFar,b),c.set(a,d),!0)})},failAllPending:function(){o7(()=>{f.mutate(a=>{let b=!1;for(let[c,d]of a)d._optimistic||(a.delete(c),b=!0);return b}),g(Array.from(function*(){for(let a of e.values())for(let b of a.get())"assistant"!==b.role||"generating"!==b.status||b._optimistic||(yield b)}()).map(a=>({...a,status:"failed",errorReason:"Lost connection"})))})},markMine(a){c.add(a)},*getAutoExecutingMessageIds(){for(let b of c){let c=i(b);c?.role==="assistant"&&"awaiting-tool"===c.status&&c.contentSoFar.some(b=>{if("tool-invocation"===b.type&&"executing"===b.stage){let d=a.getTool(b.name,c.chatId).get();return"function"==typeof d?.execute}return!1})&&(yield c.id)}}}}(j,u),m={staticSessionInfoSig:new pb(null),dynamicSessionInfoSig:new pb(null),pendingCmds:new Map,chatsStore:i,messagesStore:l,toolsStore:j,knowledgeStore:k},n=new pb("initial"),o=[],p=null;function q(){let a=o;o=[],null!==p&&(clearTimeout(p),p=null),o7(()=>{for(let{id:b,delta:c}of a)m.messagesStore.addDelta(b,c)})}let r=!1;function s(){"initial"===h.getStatus()&&h.connect()}async function t(a){var b;s(),"connected"!==h.getStatus()&&await h.events.didConnect.waitUntil();let{promise:c,resolve:d,reject:e}=pI(),f=AbortSignal.timeout(4e3);f.addEventListener("abort",()=>e(f.reason),{once:!0});let g=pP(7);return m.pendingCmds.set(g,{resolve:d,reject:e}),b={...a,cmdId:g},h.send(JSON.stringify({...b})),c.finally(()=>{m.pendingCmds.delete(g)}).catch(a=>{throw px(a.message),a})}async function u(a,b,c,d,e){let f=m.knowledgeStore.getKnowledgeForChat(a),g=m.toolsStore.getToolDescriptions(a),h=await t({cmd:"set-tool-result",chatId:a,messageId:b,invocationId:c,result:d,generationOptions:{copilotId:e?.copilotId,stream:e?.stream,timeout:e?.timeout,knowledge:f.length>0?f:void 0,tools:g.length>0?g:void 0}});h.ok&&l.markMine(h.message.id)}return h.events.onMessage.subscribe(function(a){if("string"!=typeof a.data)return;let b=oZ(a.data);if(!b)return;let c="cmdId"in b?b.cmdId:"cmd-failed"===b.event?b.failedCmdId:void 0,d=m.pendingCmds.get(c);if(c&&!d)return void pw("Ignoring unexpected command response. Already timed out, or not for us?",b);if("event"in b)if("delta"===b.event){let{id:a,delta:c}=b;o.push({id:a,delta:c}),null===p&&(p=setTimeout(q,25))}else o7(()=>{switch(q(),b.event){case"cmd-failed":d?.reject(Error(b.error));break;case"settle":m.messagesStore.upsert(b.message);break;case"warning":pw(b.message);break;case"error":px(b.error);break;case"rebooted":m.messagesStore.failAllPending();break;case"sync":for(let a of b["-messages"]??[])m.messagesStore.remove(a.chatId,a.id);for(let a of b["-chats"]??[])m.chatsStore.markDeleted(a),m.messagesStore.removeByChatId(a);for(let a of b.clear??[])m.messagesStore.removeByChatId(a);b.chats&&m.chatsStore.upsertMany(b.chats),b.messages&&m.messagesStore.upsertMany(b.messages);break;default:return pq(b,"Unhandled case")}});else switch(b.cmd){case"get-chats":m.chatsStore.upsertMany(b.chats);break;case"get-or-create-chat":m.chatsStore.upsert(b.chat);break;case"delete-chat":m.chatsStore.markDeleted(b.chatId),m.messagesStore.removeByChatId(b.chatId);break;case"get-message-tree":m.chatsStore.upsert(b.chat),m.messagesStore.upsertMany(b.messages);break;case"delete-message":m.messagesStore.remove(b.chatId,b.messageId);break;case"clear-chat":m.messagesStore.removeByChatId(b.chatId);break;case"ask-in-chat":b.sourceMessage&&m.messagesStore.upsert(b.sourceMessage),m.messagesStore.upsert(b.targetMessage);break;case"abort-ai":break;case"set-tool-result":b.ok&&m.messagesStore.upsert(b.message);break;default:return pq(b,"Unhandled case")}d?.resolve(b)}),h.events.statusDidChange.subscribe(function(a){let c=h.authValue;if(null!==c){let a=p0(c);if(a!==b)if(b=a,"secret"===c.type){let a=c.token.parsed;m.staticSessionInfoSig.set({userId:a.uid,userInfo:a.ui})}else m.staticSessionInfoSig.set({userId:void 0,userInfo:void 0})}n.set(a)}),h.events.statusDidChange.subscribe(function(b){"reconnecting"===b?c=setTimeout(()=>{r=!0},a.lostConnectionTimeout):(clearTimeout(c),r&&(r=!1))}),h.events.didConnect.subscribe(function(){}),h.events.didDisconnect.subscribe(function(){q()}),h.events.onConnectionError.subscribe(({message:a,code:b})=>{}),Object.defineProperty({[qp]:{context:m},connectInitially:s,disconnect:()=>h.disconnect(),getChats:function(a={}){return t({cmd:"get-chats",cursor:a.cursor,query:a.query})},getOrCreateChat:function(a,b){return t({cmd:"get-or-create-chat",id:a,options:b})},deleteChat:a=>t({cmd:"delete-chat",chatId:a}),getMessageTree:function(a){return t({cmd:"get-message-tree",chatId:a})},deleteMessage:(a,b)=>t({cmd:"delete-message",chatId:a,messageId:b}),clearChat:a=>t({cmd:"clear-chat",chatId:a}),askUserMessageInChat:async(a,b,c,d)=>{let e=[...m.knowledgeStore.getKnowledgeForChat(a),...d?.knowledge||[]],f=m.toolsStore.getToolDescriptions(a);return l.markMine(c),await t({cmd:"ask-in-chat",chatId:a,sourceMessage:b,targetMessageId:c,generationOptions:{copilotId:d?.copilotId,stream:d?.stream,timeout:d?.timeout,knowledge:e.length>0?e:void 0,tools:f.length>0?f:void 0}})},abort:a=>t({cmd:"abort-ai",messageId:a}),setToolResult:u,getStatus:()=>h.getStatus(),signals:{getChatMessagesForBranch:m.messagesStore.getChatMessagesForBranch,getTool:m.toolsStore.getTool,status:n},getChatById:m.chatsStore.getChatById,queryChats:m.chatsStore.findMany,getLastUsedCopilotId:m.messagesStore.getLastUsedCopilotId,registerKnowledgeLayer:(a,b)=>{let c=m.knowledgeStore.getKnowledgeStack(b),d=c.registerLayer(a);return{layerKey:d,deregister:()=>c.deregisterLayer(d)}},updateKnowledge:(a,b,c,d)=>{m.knowledgeStore.getKnowledgeStack(d).updateKnowledge(a,c??pP(),b)},registerTool:m.toolsStore.registerTool},qp,{enumerable:!1})}({userId:i.get(),lostConnectionTimeout:f,backgroundKeepAliveTimeout:rw(b.backgroundKeepAliveTimeout),polyfills:b.polyfills,delegates:{createSocket:(d=b.polyfills?.WebSocket,a=>{let b=d??("u"<typeof WebSocket?void 0:WebSocket);if(void 0===b)throw new qd("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");let c=new URL(h);if(c.protocol="http:"===c.protocol?"ws":"wss",c.pathname="/ai/v7","secret"===a.type)c.searchParams.set("tok",a.token.raw);else if("public"!==a.type)return pq(a,"Unhandled case");else throw Error("Public key not supported with AI Copilots");return c.searchParams.set("version",oT||"dev"),new b(c.toString())}),authenticate:async()=>{let a=await j.getAuthValue({requestedScope:"room:read"});if("public"===a.type)throw new qd("Cannot use AI Copilots with a public API key");return a},canZombie:()=>!1}});function n(a){let b=()=>{if(a.unsubs.delete(b)){var c;0===a.unsubs.size&&((c=a.room).id,l.delete(c.id),c.destroy())}else pw("This leave function was already called. Calling it more than once has no effect.")};return a.unsubs.add(b),{room:a.room,leave:b}}let o=b.resolveUsers,p=pO(new pN(async a=>{let b=a.flat(),c=await o?.({userIds:b});return qL(!o,"Set the resolveUsers option in createClient to specify user info."),c??b.map(()=>void 0)},{delay:50})),q=b.resolveRoomsInfo,r=pO(new pN(async a=>{let b=a.flat(),c=await q?.({roomIds:b});return qL(!q,"Set the resolveRoomsInfo option in createClient to specify room info."),c??b.map(()=>void 0)},{delay:50})),s=b.resolveGroupsInfo,t=pO(new pN(async a=>{let b=a.flat(),c=await s?.({groupIds:b});return qL(!s,"Set the resolveGroupsInfo option in createClient to specify group info."),c??b.map(()=>void 0)},{delay:50})),u=new Map,v=[],w=new pb("synchronized"),x=oW();function y(){w.set(v.some(a=>"synchronizing"===a.get())?"synchronizing":v.some(a=>"has-local-changes"===a.get())?"has-local-changes":"synchronized")}function z(){let a=new pb("synchronized");v.push(a);let b=a.subscribe(()=>y());return{setSyncStatus:function(b){a.set(b)},destroy:function(){b();let c=v.findIndex(b=>b===a);if(c>-1){let[a]=v.splice(c,1);"synchronized"!==a.get()&&y()}}}}async function A(a){return qN(await k.getNotificationSettings(a))}async function B(a){return qN(await k.updateNotificationSettings(a))}let C=Object.defineProperty({enterRoom:function(c,...d){var i,m;let o=l.get(c);if(void 0!==o)return n(o);let p=d[0]??{},q=function(a,b){var c,d,e;let f,g,h,i,j=b.roomId,k=a.initialPresence,l=a.initialStorage,m=b.roomHttpClient,[n,o]=function(){let a="u">typeof document?document:void 0,b={current:null};function c(){a?.visibilityState==="hidden"?b.current=b.current??Date.now():b.current=null}return a?.addEventListener("visibilitychange",c),[b,()=>{a?.removeEventListener("visibilitychange",c)}]}(),p=new qo({...b.delegates,canZombie:()=>void 0!==b.backgroundKeepAliveTimeout&&null!==n.current&&Date.now()>n.current+b.backgroundKeepAliveTimeout&&"synchronizing"!==_()},b.enableDebugLogging),q={buffer:{flushTimerID:void 0,lastFlushedAt:0,presenceUpdates:{type:"full",data:k},messages:[],storageOperations:[]},staticSessionInfoSig:new pb(null),dynamicSessionInfoSig:new pb(null),myPresence:new pc(k),others:new rs,initialStorage:l,idFactory:null,yjsProvider:void 0,yjsProviderDidChange:oW(),pool:function(a,b){let{getCurrentConnectionId:c,onDispatch:d,isStorageWritable:e=()=>!0}=b,f=0,g=0,h=new Map;return{roomId:a,nodes:h,getNode:a=>h.get(a),addNode:(a,b)=>void h.set(a,b),deleteNode:a=>void h.delete(a),generateId:()=>`${c()}:${f++}`,generateOpId:()=>`${c()}:${g++}`,dispatch(a,b,c){d?.(a,b,c)},assertStorageIsWritable:()=>{if(!e())throw Error("Cannot write to storage with a read only user, please ensure the user has write permissions")}}}(j,{getCurrentConnectionId:function(){let a=q.dynamicSessionInfoSig.get();if(a)return a.actor;throw Error("Internal. Tried to get connection id but connection was never open")},onDispatch:function(a,b,c){if(q.activeBatch){for(let b of a)q.activeBatch.ops.push(b);for(let[a,b]of c)q.activeBatch.updates.storageUpdates.set(a,ro(q.activeBatch.updates.storageUpdates.get(a),b));q.activeBatch.reverseOps.pushLeft(b)}else I(b),q.redoStack.length=0,R(a),J({storageUpdates:c})},isStorageWritable:function(){let a=q.dynamicSessionInfoSig.get()?.scopes;return void 0===a||qG(a)}}),root:void 0,undoStack:[],redoStack:[],pausedHistory:null,activeBatch:null,unacknowledgedOps:new Map},r=(i=new Map,{append(a){for(let[b,c]of a)i.set(b,c)},take(){let a=i;return i=new Map,a}}),s=b.enableDebugLogging?function(){let a,b=0,c=0;function d(b=performance.now()){a.push(b-c),c=b}return{start:function(){a=[],c=b=performance.now()},lap:d,stop:function(){let c=performance.now();return d(c),{total:c-b,laps:a}}}}():void 0,t=!1;p.events.onMessage.subscribe(function(a){let c;if("string"!=typeof a.data)return;let d=void 0===(c=oZ(a.data))?null:rq(c)?o_(c.map(a=>P(a))):o_([P(c)]);if(null===d||0===d.length)return;let e={storageUpdates:new Map,others:[]};for(let a of d)switch(a.type){case p5.USER_JOINED:{let b=function(a){q.others.setConnection(a.actor,a.id,a.info,a.scopes),q.buffer.messages.push({type:rr.UPDATE_PRESENCE,data:q.myPresence.get(),targetActor:a.actor}),Q();let b=q.others.getUser(a.actor);return b?{type:"enter",user:b}:void 0}(a);b&&e.others.push(b);break}case p5.UPDATE_PRESENCE:{let b=function(a){if(void 0!==a.targetActor){let b=q.others.getUser(a.actor);q.others.setOther(a.actor,a.data);let c=q.others.getUser(a.actor);if(void 0===b&&void 0!==c)return{type:"enter",user:c}}else q.others.patchOther(a.actor,a.data);let b=q.others.getUser(a.actor);return b?{type:"update",updates:a.data,user:b}:void 0}(a);b&&e.others.push(b);break}case p5.BROADCASTED_EVENT:{let b=q.others.get();u.customEvent.notify({connectionId:a.actor,user:a.actor<0?null:b.find(b=>b.connectionId===a.actor)??null,event:a.event});break}case p5.USER_LEFT:{let b=function(a){let b=q.others.getUser(a.actor);return b?(q.others.removeConnection(a.actor),{type:"leave",user:b}):null}(a);b&&e.others.push(b);break}case p5.UPDATE_YDOC:u.ydoc.notify(a);break;case p5.ROOM_STATE:e.others.push(function(a){var c;let d;for(let e of(q.dynamicSessionInfoSig.set({actor:a.actor,nonce:a.nonce,scopes:a.scopes,meta:a.meta}),c=a.actor,d=0,q.idFactory=()=>`${c}:${d++}`,F(),!0===a.meta.showBrand&&((a="bottom-right")=>{if("u"<typeof document||document.getElementById("liveblocks-badge"))return;let b=document.createElement("div");switch(b.id="liveblocks-badge",b.style.position="fixed",b.style.opacity="0",b.style.transition="opacity 300ms",b.style.zIndex="9999",a){case"top-right":b.style.top=qO,b.style.right=qO;break;case"bottom-right":b.style.bottom=qO,b.style.right=qO;break;case"bottom-left":b.style.bottom=qO,b.style.left=qO;break;case"top-left":b.style.top=qO,b.style.left=qO}b.onmouseenter=()=>{let a=document.getElementById("liveblocks-badge-hide-button");a&&(a.style.opacity="0.3")},b.onmouseleave=()=>{let a=document.getElementById("liveblocks-badge-hide-button");a&&(a.style.opacity="0")};let c=document.createElement("a");c.href="https://lblcks.io/badge",c.target="_blank",c.rel="noopener noreferrer",c.title="Liveblocks";let d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("width","111"),d.setAttribute("height","38"),d.setAttribute("viewBox","0 0 111 38"),d.setAttribute("fill","none");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x","1"),e.setAttribute("y","1"),e.setAttribute("width","109"),e.setAttribute("height","36"),e.setAttribute("rx","8"),e.setAttribute("fill","white"),d.appendChild(e);let f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x","0.5"),f.setAttribute("y","0.5"),f.setAttribute("width","110"),f.setAttribute("height","37"),f.setAttribute("rx","8.5"),f.setAttribute("stroke","black"),f.setAttribute("stroke-opacity","0.1"),d.appendChild(f);let g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d","M39.8256 18.0832H38L38.0005 28.9009H39.8256V18.0832ZM43.213 21.1757H41.3879V28.9009H43.213V21.1757ZM43.213 18H41.3879V19.9688H43.213V18ZM45.8916 21.1757H43.9302L46.6915 28.9009H48.7283L51.4896 21.1757H49.5581L48.4039 24.8348C48.3739 24.93 48.2657 25.3024 48.0795 25.9511L47.7099 27.1959C47.4914 26.406 47.2626 25.6189 47.0237 24.8348L45.8916 21.1757ZM58.9659 23.59C58.8147 23.0721 58.5934 22.6317 58.3014 22.2694C57.9743 21.8628 57.5598 21.5482 57.0571 21.3268C56.5589 21.1004 56.0058 20.9877 55.3973 20.9877C54.2407 20.9877 53.3152 21.3495 52.6212 22.0735C52.275 22.4476 52.0103 22.8896 51.844 23.3715C51.6731 23.8691 51.5876 24.4199 51.5876 25.0233C51.5876 26.3157 51.9322 27.3142 52.6217 28.0184C53.3203 28.7323 54.2509 29.0894 55.4125 29.0894C56.4083 29.0894 57.2151 28.8658 57.8342 28.4181C58.453 27.9704 58.8628 27.3068 59.0638 26.4266L57.2834 26.2908C57.198 26.7685 57.0016 27.1257 56.6948 27.3618C56.3879 27.5933 55.9555 27.7093 55.3973 27.7093C54.1201 27.7093 53.4663 26.9899 53.4363 25.5514H59.1844L59.1922 25.295C59.1922 24.6763 59.1165 24.108 58.9659 23.59ZM53.8434 23.0471C54.1654 22.5943 54.6834 22.3679 55.3973 22.3679C55.7443 22.3679 56.0363 22.4155 56.2725 22.5111C56.509 22.6067 56.7128 22.7601 56.8837 22.9713C57.0167 23.1352 57.1189 23.3218 57.1855 23.5221C57.2605 23.731 57.3062 23.9493 57.3213 24.1708H53.451C53.4964 23.7231 53.6271 23.3484 53.8434 23.0471ZM66.2836 21.4779C65.7656 21.1406 65.1673 20.9724 64.4885 20.9724H64.4875C63.995 20.9724 63.5449 21.0727 63.1374 21.2742C62.7364 21.4696 62.3931 21.7659 62.1412 22.1341V18.0832H60.316V28.9009H62.1416V27.8373C62.373 28.2195 62.7008 28.5342 63.0921 28.7499C63.4996 28.9763 63.9497 29.0894 64.4422 29.0894C65.1266 29.0894 65.7324 28.9259 66.2614 28.5992C66.7891 28.2726 67.1989 27.8045 67.4905 27.1959C67.7871 26.5823 67.9359 25.8634 67.9359 25.0386C67.9359 24.2337 67.7895 23.5248 67.4984 22.9113C67.2115 22.2926 66.8066 21.8148 66.2836 21.4779ZM65.5064 27.0828C65.2148 27.5254 64.7172 27.7463 64.0125 27.7463C63.3786 27.7463 62.9013 27.5175 62.5797 27.0601C62.2576 26.6026 62.0968 25.9336 62.0968 25.0534C62.0968 24.2032 62.24 23.5397 62.5265 23.0619C62.8185 22.579 63.3088 22.3378 63.9978 22.3378C64.7019 22.3378 65.2023 22.5592 65.499 23.0013C65.7961 23.4389 65.944 24.1181 65.944 25.0386C65.944 25.9585 65.7985 26.6401 65.5064 27.0828ZM70.901 18.0832H69.0754V28.9009H70.901V18.0832ZM73.8582 28.6066C74.452 28.9286 75.1558 29.0894 75.9708 29.0894C76.7554 29.0894 77.4444 28.9208 78.0377 28.5844C78.6268 28.2569 79.1068 27.7637 79.4183 27.1659C79.745 26.5523 79.9086 25.843 79.9086 25.0386C79.9086 24.2642 79.7478 23.5697 79.4257 22.9565C79.117 22.3516 78.6404 21.8487 78.0529 21.508C77.4592 21.161 76.7652 20.9872 75.9708 20.9872C75.171 20.9872 74.4719 21.161 73.8735 21.508C73.2876 21.8472 72.811 22.3471 72.5002 22.9486C72.1837 23.5572 72.0252 24.254 72.0252 25.0386C72.0252 25.8735 72.181 26.5948 72.4929 27.2033C72.7962 27.798 73.2722 28.2871 73.8582 28.6066ZM77.4869 27.0906C77.18 27.5231 76.6746 27.7393 75.9708 27.7393C75.493 27.7393 75.1082 27.6437 74.8166 27.4524C74.5246 27.2565 74.3134 26.9621 74.1826 26.5699C74.0518 26.1725 73.9867 25.6619 73.9867 25.0381C73.9867 24.1029 74.1401 23.419 74.4469 22.9866C74.7588 22.5541 75.2667 22.3378 75.9708 22.3378C76.6699 22.3378 77.1727 22.5541 77.4795 22.9866C77.7914 23.419 77.9471 24.1029 77.9471 25.0386C77.9471 25.9738 77.7937 26.6576 77.4869 27.0906ZM82.3982 28.6066C82.9869 28.9286 83.6883 29.0894 84.5033 29.0894C85.1369 29.0894 85.7029 28.9791 86.2005 28.7577C86.6989 28.5364 87.1031 28.2272 87.4152 27.8299C87.7279 27.4249 87.9329 26.9471 88.0109 26.4414L86.2534 26.2607C86.1328 26.7431 85.9316 27.1031 85.6497 27.3392C85.3683 27.5757 84.9857 27.694 84.5033 27.694C84.0103 27.694 83.6232 27.5933 83.3413 27.3918C83.0598 27.1858 82.8635 26.8919 82.7531 26.5093C82.6422 26.1221 82.5872 25.6318 82.5872 25.0386C82.5872 24.455 82.6422 23.9722 82.7531 23.59C82.8635 23.2028 83.0571 22.9062 83.3339 22.6997C83.6157 22.4884 84.0053 22.3831 84.5033 22.3831C85.0362 22.3831 85.4312 22.5314 85.6877 22.8281C85.949 23.1196 86.1354 23.5193 86.2456 24.0276L87.9735 23.718C87.8078 22.8932 87.4326 22.232 86.8491 21.7344C86.2708 21.2363 85.489 20.9877 84.5033 20.9877C83.6985 20.9877 83.0021 21.1587 82.4134 21.5006C81.8322 21.8351 81.3625 22.3337 81.0633 22.9339C80.7514 23.5424 80.5952 24.2439 80.5952 25.0386C80.5952 25.8781 80.7486 26.6026 81.0554 27.2112C81.3673 27.8197 81.8151 28.285 82.3982 28.6066ZM90.8104 26.0343L91.6627 25.2192L93.9257 28.9009H96.0308L92.8999 24.0498L95.9328 21.1757H93.5634L90.8104 23.9976V18.0832H88.9845V28.9009H90.8104V26.0343ZM97.6304 28.8103C98.1436 28.9965 98.7142 29.0894 99.3428 29.0894C100.303 29.0894 101.095 28.8981 101.719 28.5165C102.348 28.1339 102.663 27.5101 102.663 26.6451C102.663 26.0818 102.516 25.6392 102.225 25.3176C101.933 24.9905 101.586 24.7566 101.184 24.6157C100.786 24.4702 100.245 24.3219 99.562 24.1707C99.1642 24.0853 98.8502 24.0049 98.6188 23.9295C98.3873 23.8538 98.201 23.7558 98.0604 23.6352C97.925 23.5141 97.8567 23.3584 97.8567 23.1676C97.8567 22.8858 97.9824 22.6723 98.2338 22.5263C98.4853 22.3803 98.7973 22.3073 99.1694 22.3073C99.6619 22.3073 100.047 22.4255 100.324 22.6621C100.605 22.8987 100.756 23.2531 100.776 23.7258L102.466 23.4467C102.385 22.5817 102.046 21.9556 101.447 21.568C100.854 21.1812 100.095 20.9872 99.1694 20.9872C98.6258 20.9872 98.1236 21.0699 97.6607 21.2362C97.2029 21.397 96.8335 21.6511 96.5517 21.9986C96.27 22.3451 96.1294 22.7827 96.1294 23.3109C96.1294 23.7988 96.25 24.1934 96.4911 24.4951C96.7368 24.8001 97.0527 25.0408 97.4118 25.1965C97.7838 25.3578 98.2512 25.5112 98.8147 25.6567L99.2828 25.7699C99.5949 25.844 99.9044 25.9295 100.211 26.0264C100.421 26.092 100.595 26.1826 100.731 26.2981C100.867 26.4136 100.935 26.5647 100.935 26.7509C100.935 27.0776 100.799 27.3294 100.527 27.505C100.261 27.6815 99.8708 27.7693 99.3583 27.7693C98.8347 27.7693 98.4176 27.6385 98.1055 27.377C97.7941 27.1154 97.6355 26.7384 97.6304 26.2454L95.9109 26.4413C95.9302 27.0351 96.094 27.5304 96.4009 27.9278C96.7129 28.3252 97.1223 28.619 97.6304 28.8103Z"),g.setAttribute("fill","black"),d.appendChild(g);let h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d","M37.6392 15V9.18182H39.7131C40.1657 9.18182 40.5407 9.2642 40.8381 9.42898C41.1354 9.59375 41.358 9.81913 41.5057 10.1051C41.6534 10.3892 41.7273 10.7093 41.7273 11.0653C41.7273 11.4233 41.6525 11.7453 41.5028 12.0312C41.3551 12.3153 41.1316 12.5407 40.8324 12.7074C40.535 12.8722 40.161 12.9545 39.7102 12.9545H38.2841V12.2102H39.6307C39.9167 12.2102 40.1487 12.161 40.3267 12.0625C40.5047 11.9621 40.6354 11.8258 40.7188 11.6534C40.8021 11.4811 40.8438 11.285 40.8438 11.0653C40.8438 10.8456 40.8021 10.6506 40.7188 10.4801C40.6354 10.3097 40.5038 10.1761 40.3239 10.0795C40.1458 9.98295 39.911 9.93466 39.6193 9.93466H38.517V15H37.6392ZM44.4716 15.0881C44.0625 15.0881 43.7055 14.9943 43.4006 14.8068C43.0956 14.6193 42.8589 14.357 42.6903 14.0199C42.5218 13.6828 42.4375 13.2888 42.4375 12.8381C42.4375 12.3854 42.5218 11.9896 42.6903 11.6506C42.8589 11.3116 43.0956 11.0483 43.4006 10.8608C43.7055 10.6733 44.0625 10.5795 44.4716 10.5795C44.8807 10.5795 45.2377 10.6733 45.5426 10.8608C45.8475 11.0483 46.0843 11.3116 46.2528 11.6506C46.4214 11.9896 46.5057 12.3854 46.5057 12.8381C46.5057 13.2888 46.4214 13.6828 46.2528 14.0199C46.0843 14.357 45.8475 14.6193 45.5426 14.8068C45.2377 14.9943 44.8807 15.0881 44.4716 15.0881ZM44.4744 14.375C44.7396 14.375 44.9593 14.3049 45.1335 14.1648C45.3078 14.0246 45.4366 13.8381 45.5199 13.6051C45.6051 13.3722 45.6477 13.1155 45.6477 12.8352C45.6477 12.5568 45.6051 12.3011 45.5199 12.0682C45.4366 11.8333 45.3078 11.6449 45.1335 11.5028C44.9593 11.3608 44.7396 11.2898 44.4744 11.2898C44.2074 11.2898 43.9858 11.3608 43.8097 11.5028C43.6354 11.6449 43.5057 11.8333 43.4205 12.0682C43.3371 12.3011 43.2955 12.5568 43.2955 12.8352C43.2955 13.1155 43.3371 13.3722 43.4205 13.6051C43.5057 13.8381 43.6354 14.0246 43.8097 14.1648C43.9858 14.3049 44.2074 14.375 44.4744 14.375ZM48.267 15L46.983 10.6364H47.8608L48.7159 13.8409H48.7585L49.6165 10.6364H50.4943L51.3466 13.8267H51.3892L52.2386 10.6364H53.1165L51.8352 15H50.9688L50.0824 11.8494H50.017L49.1307 15H48.267ZM55.6705 15.0881C55.2405 15.0881 54.8703 14.9962 54.5597 14.8125C54.2509 14.6269 54.0123 14.3665 53.8438 14.0312C53.6771 13.6941 53.5938 13.2992 53.5938 12.8466C53.5938 12.3996 53.6771 12.0057 53.8438 11.6648C54.0123 11.3239 54.2472 11.0578 54.5483 10.8665C54.8513 10.6752 55.2055 10.5795 55.6108 10.5795C55.857 10.5795 56.0956 10.6203 56.3267 10.7017C56.5578 10.7831 56.7652 10.911 56.9489 11.0852C57.1326 11.2595 57.2775 11.4858 57.3835 11.7642C57.4896 12.0407 57.5426 12.3769 57.5426 12.7727V13.0739H54.0739V12.4375H56.7102C56.7102 12.214 56.6648 12.0161 56.5739 11.8438C56.483 11.6695 56.3551 11.5322 56.1903 11.4318C56.0275 11.3314 55.8362 11.2812 55.6165 11.2812C55.3778 11.2812 55.1695 11.34 54.9915 11.4574C54.8153 11.5729 54.679 11.7244 54.5824 11.9119C54.4877 12.0975 54.4403 12.2992 54.4403 12.517V13.0142C54.4403 13.3059 54.4915 13.554 54.5938 13.7585C54.6979 13.9631 54.8428 14.1193 55.0284 14.2273C55.214 14.3333 55.4309 14.3864 55.679 14.3864C55.84 14.3864 55.9867 14.3636 56.1193 14.3182C56.2519 14.2708 56.3665 14.2008 56.4631 14.108C56.5597 14.0152 56.6335 13.9006 56.6847 13.7642L57.4886 13.9091C57.4242 14.1458 57.3087 14.3532 57.142 14.5312C56.9773 14.7074 56.7699 14.8447 56.5199 14.9432C56.2718 15.0398 55.9886 15.0881 55.6705 15.0881ZM58.4851 15V10.6364H59.3061V11.3295H59.3516C59.4311 11.0947 59.5713 10.91 59.772 10.7756C59.9747 10.6392 60.2038 10.571 60.4595 10.571C60.5125 10.571 60.575 10.5729 60.647 10.5767C60.7209 10.5805 60.7786 10.5852 60.8203 10.5909V11.4034C60.7862 11.3939 60.7256 11.3835 60.6385 11.3722C60.5514 11.3589 60.4643 11.3523 60.3771 11.3523C60.1764 11.3523 59.9974 11.3949 59.8402 11.4801C59.6849 11.5634 59.5618 11.6799 59.4709 11.8295C59.38 11.9773 59.3345 12.1458 59.3345 12.3352V15H58.4851ZM63.2798 15.0881C62.8499 15.0881 62.4796 14.9962 62.169 14.8125C61.8603 14.6269 61.6217 14.3665 61.4531 14.0312C61.2865 13.6941 61.2031 13.2992 61.2031 12.8466C61.2031 12.3996 61.2865 12.0057 61.4531 11.6648C61.6217 11.3239 61.8565 11.0578 62.1577 10.8665C62.4607 10.6752 62.8149 10.5795 63.2202 10.5795C63.4664 10.5795 63.705 10.6203 63.9361 10.7017C64.1671 10.7831 64.3745 10.911 64.5582 11.0852C64.742 11.2595 64.8868 11.4858 64.9929 11.7642C65.099 12.0407 65.152 12.3769 65.152 12.7727V13.0739H61.6832V12.4375H64.3196C64.3196 12.214 64.2741 12.0161 64.1832 11.8438C64.0923 11.6695 63.9645 11.5322 63.7997 11.4318C63.6368 11.3314 63.4455 11.2812 63.2259 11.2812C62.9872 11.2812 62.7789 11.34 62.6009 11.4574C62.4247 11.5729 62.2884 11.7244 62.1918 11.9119C62.0971 12.0975 62.0497 12.2992 62.0497 12.517V13.0142C62.0497 13.3059 62.1009 13.554 62.2031 13.7585C62.3073 13.9631 62.4522 14.1193 62.6378 14.2273C62.8234 14.3333 63.0402 14.3864 63.2884 14.3864C63.4493 14.3864 63.5961 14.3636 63.7287 14.3182C63.8613 14.2708 63.9759 14.2008 64.0724 14.108C64.169 14.0152 64.2429 13.9006 64.294 13.7642L65.098 13.9091C65.0336 14.1458 64.9181 14.3532 64.7514 14.5312C64.5866 14.7074 64.3793 14.8447 64.1293 14.9432C63.8812 15.0398 63.598 15.0881 63.2798 15.0881ZM67.728 15.0852C67.3757 15.0852 67.0613 14.9953 66.7848 14.8153C66.5102 14.6335 66.2943 14.375 66.1371 14.0398C65.9818 13.7027 65.9041 13.2983 65.9041 12.8267C65.9041 12.3551 65.9827 11.9517 66.1399 11.6165C66.299 11.2812 66.5168 11.0246 66.7933 10.8466C67.0698 10.6686 67.3833 10.5795 67.7337 10.5795C68.0045 10.5795 68.2223 10.625 68.3871 10.7159C68.5537 10.8049 68.6825 10.9091 68.7734 11.0284C68.8662 11.1477 68.9382 11.2528 68.9893 11.3438H69.0405V9.18182H69.8899V15H69.0604V14.321H68.9893C68.9382 14.4138 68.8643 14.5199 68.7678 14.6392C68.6731 14.7585 68.5424 14.8627 68.3757 14.9517C68.209 15.0407 67.9931 15.0852 67.728 15.0852ZM67.9155 14.3608C68.1598 14.3608 68.3662 14.2964 68.5348 14.1676C68.7053 14.0369 68.834 13.8561 68.9212 13.625C69.0102 13.3939 69.0547 13.125 69.0547 12.8182C69.0547 12.5152 69.0111 12.25 68.924 12.0227C68.8369 11.7955 68.709 11.6184 68.5405 11.4915C68.3719 11.3646 68.1636 11.3011 67.9155 11.3011C67.6598 11.3011 67.4467 11.3674 67.2763 11.5C67.1058 11.6326 66.977 11.8134 66.8899 12.0426C66.8047 12.2718 66.7621 12.5303 66.7621 12.8182C66.7621 13.1098 66.8056 13.3722 66.8928 13.6051C66.9799 13.8381 67.1087 14.0227 67.2791 14.1591C67.4515 14.2936 67.6636 14.3608 67.9155 14.3608ZM73.2876 15V9.18182H74.1371V11.3438H74.1882C74.2375 11.2528 74.3085 11.1477 74.4013 11.0284C74.4941 10.9091 74.6229 10.8049 74.7876 10.7159C74.9524 10.625 75.1702 10.5795 75.4411 10.5795C75.7933 10.5795 76.1077 10.6686 76.3842 10.8466C76.6607 11.0246 76.8776 11.2812 77.0348 11.6165C77.1939 11.9517 77.2734 12.3551 77.2734 12.8267C77.2734 13.2983 77.1948 13.7027 77.0376 14.0398C76.8804 14.375 76.6645 14.6335 76.3899 14.8153C76.1153 14.9953 75.8018 15.0852 75.4496 15.0852C75.1844 15.0852 74.9676 15.0407 74.799 14.9517C74.6323 14.8627 74.5017 14.7585 74.407 14.6392C74.3123 14.5199 74.2393 14.4138 74.1882 14.321H74.1172V15H73.2876ZM74.12 12.8182C74.12 13.125 74.1645 13.3939 74.2536 13.625C74.3426 13.8561 74.4714 14.0369 74.6399 14.1676C74.8085 14.2964 75.0149 14.3608 75.2592 14.3608C75.513 14.3608 75.7251 14.2936 75.8956 14.1591C76.0661 14.0227 76.1948 13.8381 76.282 13.6051C76.371 13.3722 76.4155 13.1098 76.4155 12.8182C76.4155 12.5303 76.3719 12.2718 76.2848 12.0426C76.1996 11.8134 76.0708 11.6326 75.8984 11.5C75.728 11.3674 75.5149 11.3011 75.2592 11.3011C75.013 11.3011 74.8047 11.3646 74.6342 11.4915C74.4657 11.6184 74.3378 11.7955 74.2507 12.0227C74.1636 12.25 74.12 12.5152 74.12 12.8182ZM78.6158 16.6364C78.4889 16.6364 78.3733 16.6259 78.2692 16.6051C78.165 16.5862 78.0874 16.5653 78.0362 16.5426L78.2408 15.8466C78.3961 15.8883 78.5343 15.9063 78.6555 15.9006C78.7768 15.8949 78.8838 15.8494 78.9766 15.7642C79.0713 15.679 79.1546 15.5398 79.2266 15.3466L79.3317 15.0568L77.7351 10.6364H78.6442L79.7493 14.0227H79.7947L80.8999 10.6364H81.8118L80.0135 15.5824C79.9302 15.8097 79.8241 16.0019 79.6953 16.1591C79.5665 16.3182 79.4131 16.4375 79.2351 16.517C79.0571 16.5966 78.8506 16.6364 78.6158 16.6364Z"),h.setAttribute("fill","black"),h.setAttribute("fill-opacity","0.5"),d.appendChild(h);let i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x","7"),i.setAttribute("y","7"),i.setAttribute("width","24"),i.setAttribute("height","24"),i.setAttribute("rx","3"),i.setAttribute("fill","black"),d.appendChild(i);let j=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("fill-rule","evenodd"),j.setAttribute("clip-rule","evenodd"),j.setAttribute("d","M22.0455 15H12.2273L15.1364 17.9091V21.9091L22.0455 15Z"),j.setAttribute("fill","white"),d.appendChild(j);let k=document.createElementNS("http://www.w3.org/2000/svg","path");k.setAttribute("fill-rule","evenodd"),k.setAttribute("clip-rule","evenodd"),k.setAttribute("d","M16.9546 22.9999H26.7728L23.8637 20.0908V16.0908L16.9546 22.9999Z"),k.setAttribute("fill","white"),d.appendChild(k),c.appendChild(d),b.appendChild(c);let l=document.createElement("button");l.id="liveblocks-badge-hide-button",l.style.position="absolute",l.style.top="0",l.style.right="0",l.style.border="none",l.style.padding="0",l.style.margin="0",l.style.background="none",l.style.font="inherit",l.style.cursor="pointer",l.style.outline="none",l.style.setProperty("-webkit-appearance","none"),l.style.setProperty("-moz-appearance","none"),l.style.setProperty("appearance","none"),l.style.opacity="0",l.onclick=()=>{let a=document.getElementById("liveblocks-badge");a&&(a.style.display="none")},l.onmouseenter=()=>{l.style.opacity="0.5"},l.onmouseleave=()=>{l.style.opacity="0.3"};let m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width","18"),m.setAttribute("height","18"),m.setAttribute("viewBox","0 0 18 18"),m.setAttribute("fill","none");let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M6 6L9 9M12 12L9 9M9 9L12 6M9 9L6 12"),n.setAttribute("stroke","black"),m.appendChild(n),l.appendChild(m),b.appendChild(l),document.body.appendChild(b),requestAnimationFrame(()=>{requestAnimationFrame(()=>{b.style.opacity="1"})})})(b.badgeLocation??"bottom-right"),q.others.connectionIds()))void 0===a.users[e]&&q.others.removeConnection(e);for(let b in a.users){let c=a.users[b],d=Number(b);q.others.setConnection(d,c.id,c.info,c.scopes)}return{type:"reset"}}(a));break;case p5.STORAGE_CHUNK:s?.lap(),r.append(function*(a){for(let b of a){if("root"===b[0]){yield[b[0],{type:q_.OBJECT,data:b[1]}];continue}switch(b[1]){case q_.OBJECT:yield[b[0],{type:q_.OBJECT,parentId:b[2],parentKey:b[3],data:b[4]}];break;case q_.LIST:yield[b[0],{type:q_.LIST,parentId:b[2],parentKey:b[3]}];break;case q_.MAP:yield[b[0],{type:q_.MAP,parentId:b[2],parentKey:b[3]}];break;case q_.REGISTER:yield[b[0],{type:q_.REGISTER,parentId:b[2],parentKey:b[3],data:b[4]}]}}}(a.nodes));break;case p5.STORAGE_STREAM_END:{let a=s?.stop();if(a){let b=a=>`${a.toFixed(1)}ms`,c=a.laps.slice(1);pw(`Storage chunk arrival: total=${b(a.total)}, first=${b(a.laps[0])}, rest.n=${c.length}, rest.avg=${b(c.reduce((a,b)=>a+b,0)/c.length)}, rest.max=${b(c.reduce((a,b)=>Math.max(a,b),0))}`)}U(r.take());break}case p5.UPDATE_STORAGE:for(let[b,c]of L([],a.ops,!1).updates.storageUpdates)e.storageUpdates.set(b,ro(e.storageUpdates.get(b),c));break;case p5.REJECT_STORAGE_OP:pz("Storage mutation rejection error",a.reason);break;case p5.THREAD_CREATED:case p5.THREAD_DELETED:case p5.THREAD_METADATA_UPDATED:case p5.THREAD_UPDATED:case p5.COMMENT_REACTION_ADDED:case p5.COMMENT_REACTION_REMOVED:case p5.COMMENT_CREATED:case p5.COMMENT_EDITED:case p5.COMMENT_DELETED:case p5.COMMENT_METADATA_UPDATED:u.comments.notify(a);case p5.STORAGE_STATE_V7:}J(e)}),p.events.statusDidChange.subscribe(function(a){let b=p.authValue;if(null!==b){let a=p0(b);if(a!==f)if(f=a,"secret"===b.type){let a=b.token.parsed;q.staticSessionInfoSig.set({userId:a.uid,userInfo:a.ui})}else q.staticSessionInfoSig.set({userId:void 0,userInfo:void 0})}u.status.notify(a),F()}),p.events.statusDidChange.subscribe(function(a){"reconnecting"===a?g=setTimeout(()=>{u.lostConnection.notify("lost"),t=!0,q.others.clearOthers(),J({others:[{type:"reset"}]})},b.lostConnectionTimeout):(clearTimeout(g),t&&("disconnected"===a?u.lostConnection.notify("failed"):u.lostConnection.notify("restored"),t=!1))}),p.events.didConnect.subscribe(function(){q.buffer.presenceUpdates={type:"full",data:{...q.myPresence.get()}},null!==S&&W({flush:!1}),Q()}),p.events.didDisconnect.subscribe(function(){clearTimeout(q.buffer.flushTimerID)}),p.events.onConnectionError.subscribe(({message:a,code:c})=>{let d=new rt(a,{type:"ROOM_CONNECTION_ERROR",code:c,roomId:j});b.errorEventSource.notify(d)});let u={status:oW(),lostConnection:oW(),customEvent:oW(),self:oW(),myPresence:oW(),others:oW(),storageBatch:oW(),history:oW(),storageDidLoad:oW(),storageStatus:oW(),ydoc:oW(),comments:oW(),roomWillDestroy:oW()};async function v(a,b){return m.createTextMention({roomId:j,mentionId:a,mention:b})}async function w(a){return m.deleteTextMention({roomId:j,mentionId:a})}async function x(a,b){await m.reportTextEditor({roomId:j,type:a,rootKey:b})}async function y(){return m.listTextVersions({roomId:j})}async function z(a){return m.listTextVersionsSince({roomId:j,since:a.since,signal:a.signal})}async function A(a){return m.getTextVersion({roomId:j,versionId:a})}async function B(){return m.createTextVersion({roomId:j})}async function C(a){return m.executeContextualPrompt({roomId:j,...a})}function D(a){p.send(pL(a))}let E=pe.from(q.staticSessionInfoSig,q.dynamicSessionInfoSig,q.myPresence,(a,b,c)=>{if(null===a||null===b)return null;{let d=qG(b.scopes);return{connectionId:b.actor,id:a.userId,info:a.userInfo,presence:c,canWrite:d,canComment:qH(b.scopes)}}});function F(){let a=E.get();null!==a&&a!==h&&(u.self.notify(a),h=a)}let G=pe.from(E,a=>null!==a?ru("Me",a):null);function H(a){q.undoStack.length>=50&&q.undoStack.shift(),q.undoStack.push(a),O()}function I(a){null!==q.pausedHistory?q.pausedHistory.pushLeft(a):H(a)}function J(a){let b=a.storageUpdates,c=a.others;if(void 0!==c&&c.length>0){let a=q.others.get();for(let b of c)u.others.notify({...b,others:a})}if(a.presence&&(F(),u.myPresence.notify(q.myPresence.get())),void 0!==b&&b.size>0){let a=Array.from(b.values());u.storageBatch.notify(a)}ab()}function K(a){let[b,c]=function(a,b){let c=[],d=[],e=0;for(let f of a)b(f,e++)?c.push(f):d.push(f);return[c,d]}(a,a=>"presence"===a.type),d=c.map(a=>void 0===a.opId?{...a,opId:q.pool.generateOpId()}:a),{reverse:e,updates:f}=L(b,d,!0);return{opsToEmit:d,reverse:e,updates:f}}function L(a,b,c){let d={reverse:new rp,storageUpdates:new Map,presence:!1};for(let b of a){let a={type:"presence",data:{}};for(let c in b.data)a.data[c]=q.myPresence.get()[c];if(q.myPresence.patch(b.data),null===q.buffer.presenceUpdates)q.buffer.presenceUpdates={type:"partial",data:b.data};else for(let a in b.data)q.buffer.presenceUpdates.data[a]=b.data[a];d.reverse.pushLeft(a),d.presence=!0}let e=new Set;for(let a of b){let b;c?b=0:void 0!==a.opId?(q.unacknowledgedOps.delete(a.opId),b=2):b=1;let f=function(a,b){if(a.type===qX.DELETE_CRDT&&"ACK"===a.id)return{modified:!1};switch(a.type){case qX.DELETE_OBJECT_KEY:case qX.UPDATE_OBJECT:case qX.DELETE_CRDT:{let c=q.pool.nodes.get(a.id);if(void 0===c)return{modified:!1};return c._apply(a,0===b)}case qX.SET_PARENT_KEY:{let c=q.pool.nodes.get(a.id);if(void 0===c)return{modified:!1};if("HasParent"===c.parent.type&&rl(c.parent.node))return c.parent.node._setChildKey(qW(a.parentKey),c,b);return{modified:!1}}case qX.CREATE_OBJECT:case qX.CREATE_LIST:case qX.CREATE_MAP:case qX.CREATE_REGISTER:{if(void 0===a.parentId)return{modified:!1};let c=q.pool.nodes.get(a.parentId);if(void 0===c)return{modified:!1};return c._attachChild(a,b)}}}(a,b);if(f.modified){let b=f.modified.node._id;b&&e.has(b)||(d.storageUpdates.set(ps(f.modified.node._id),ro(d.storageUpdates.get(ps(f.modified.node._id)),f.modified)),d.reverse.pushLeft(f.reverse)),(a.type===qX.CREATE_LIST||a.type===qX.CREATE_MAP||a.type===qX.CREATE_OBJECT)&&e.add(a.id)}}return{reverse:Array.from(d.reverse),updates:{storageUpdates:d.storageUpdates,presence:d.presence}}}function M(){return q.undoStack.length>0}function N(){return q.redoStack.length>0}function O(){u.history.notify({canUndo:M(),canRedo:N()})}function P(a){return null===a||"string"==typeof a||"number"==typeof a||"boolean"==typeof a||rq(a)?null:a}function Q(){let a=q.buffer.storageOperations;if(a.length>0){for(let b of a)q.unacknowledgedOps.set(b.opId,b);ab()}if("connected"!==p.getStatus()){q.buffer.storageOperations=[];return}let c=Date.now(),d=c-q.buffer.lastFlushedAt;if(d>=b.throttleDelay){let a=function(){let a=[];for(let b of(q.buffer.presenceUpdates&&a.push("full"===q.buffer.presenceUpdates.type?{type:rr.UPDATE_PRESENCE,targetActor:-1,data:q.buffer.presenceUpdates.data}:{type:rr.UPDATE_PRESENCE,data:q.buffer.presenceUpdates.data}),q.buffer.messages))a.push(b);return q.buffer.storageOperations.length>0&&a.push({type:rr.UPDATE_STORAGE,ops:q.buffer.storageOperations}),a}();if(0===a.length)return;D(a),q.buffer={flushTimerID:void 0,lastFlushedAt:c,messages:[],storageOperations:[],presenceUpdates:null}}else clearTimeout(q.buffer.flushTimerID),q.buffer.flushTimerID=setTimeout(Q,b.throttleDelay-d)}function R(a){let{storageOperations:b}=q.buffer;for(let c of a)b.push(c);Q()}let S=null,T=null;function U(a){let b=new Map(q.unacknowledgedOps);!function(a){var b;if(0===a.size)throw Error("Internal error: cannot load storage without items");if(void 0!==q.root){let b,c=new Map;for(let[a,b]of q.pool.nodes)c.set(a,b._serialize());J(L([],(b=[],c.forEach((c,d)=>{a.get(d)||b.push({type:qX.DELETE_CRDT,id:d})}),a.forEach((a,d)=>{let e=c.get(d);if(e)a.type===q_.OBJECT&&(e.type!==q_.OBJECT||pL(a.data)!==pL(e.data))&&b.push({type:qX.UPDATE_OBJECT,id:d,data:a.data}),a.parentKey!==e.parentKey&&b.push({type:qX.SET_PARENT_KEY,id:d,parentKey:ps(a.parentKey,"Parent key must not be missing")});else switch(a.type){case q_.REGISTER:b.push({type:qX.CREATE_REGISTER,id:d,parentId:a.parentId,parentKey:a.parentKey,data:a.data});break;case q_.LIST:b.push({type:qX.CREATE_LIST,id:d,parentId:a.parentId,parentKey:a.parentKey});break;case q_.OBJECT:if(void 0===a.parentId||void 0===a.parentKey)throw Error("Internal error. Cannot serialize storage root into an operation");b.push({type:qX.CREATE_OBJECT,id:d,parentId:a.parentId,parentKey:a.parentKey,data:a.data});break;case q_.MAP:b.push({type:qX.CREATE_MAP,id:d,parentId:a.parentId,parentKey:a.parentKey})}}),b),!1).updates)}else q.root=rf._fromItems(a,q.pool);let c=E.get()?.canWrite??!0,d=q.undoStack.length;for(let a in q.initialStorage)void 0===q.root.get(a)&&(c?q.root.set(a,void 0===(b=q.initialStorage[a])?void 0:rj(b)?b.clone():o$(b)):pw(`Attempted to populate missing storage key '${a}', but current user has no write access`));q.undoStack.length=d}(a),function(a){if(0===a.size)return;let b=[],c=K(Array.from(a.values()));b.push({type:rr.UPDATE_STORAGE,ops:c.opsToEmit}),J(c.updates),D(b)}(b),T?.(),ab(),u.storageDidLoad.notify()}async function V(){p.authValue&&U(new Map(await m.streamStorage({roomId:j})))}function W(a){let c=q.buffer.messages;b.unstable_streamData?V():c.some(a=>a.type===rr.FETCH_STORAGE)||(c.push({type:rr.FETCH_STORAGE}),r.take(),s?.start()),a.flush&&Q()}function X(){return null===S&&(W({flush:!0}),S=new Promise(a=>{T=a}),ab()),S}function Y(){let a=q.root;return void 0!==a?a:(X(),null)}async function Z(){return void 0!==q.root?Promise.resolve({root:q.root}):(await X(),{root:ps(q.root)})}let $=b.createSyncSource();function _(){return void 0===q.root?null===S?"not-loaded":"loading":0===q.unacknowledgedOps.size?"synchronized":"synchronizing"}let aa=_();function ab(){let a=_();aa!==a&&(aa=a,u.storageStatus.notify(a)),$.setSyncStatus("synchronizing"===a?"synchronizing":"synchronized")}function ac(){return null!==E.get()}async function ad(){for(;!ac();){let{promise:a,resolve:b}=pI(),c=ah.self.subscribeOnce(b),d=ah.status.subscribeOnce(b);await a,c(),d()}}function ae(){return null!==Y()}async function af(){for(;!ae();)await Z()}let ag=pe.from(q.others.signal,a=>a.map((a,b)=>ru(`Other ${b}`,a))),ah={status:u.status.observable,lostConnection:u.lostConnection.observable,customEvent:u.customEvent.observable,others:u.others.observable,self:u.self.observable,myPresence:u.myPresence.observable,storageBatch:u.storageBatch.observable,history:u.history.observable,storageDidLoad:u.storageDidLoad.observable,storageStatus:u.storageStatus.observable,ydoc:u.ydoc.observable,comments:u.comments.observable,roomWillDestroy:u.roomWillDestroy.observable};async function ai(a){return m.getThreadsSince({roomId:j,since:a.since,signal:a.signal})}async function aj(a){return m.getThreads({roomId:j,query:a?.query,cursor:a?.cursor})}async function ak(a){return m.getThread({roomId:j,threadId:a})}async function al(a){return m.createThread({roomId:j,threadId:a.threadId,commentId:a.commentId,metadata:a.metadata,body:a.body,commentMetadata:a.commentMetadata,attachmentIds:a.attachmentIds})}async function am(a){return m.deleteThread({roomId:j,threadId:a})}async function an({metadata:a,threadId:b}){return m.editThreadMetadata({roomId:j,threadId:b,metadata:a})}async function ao({threadId:a,commentId:b,metadata:c}){return m.editCommentMetadata({roomId:j,threadId:a,commentId:b,metadata:c})}async function ap(a){return m.markThreadAsResolved({roomId:j,threadId:a})}async function aq(a){return m.markThreadAsUnresolved({roomId:j,threadId:a})}async function ar(a){return m.subscribeToThread({roomId:j,threadId:a})}async function as(a){return m.unsubscribeFromThread({roomId:j,threadId:a})}async function at(a){return m.createComment({roomId:j,threadId:a.threadId,commentId:a.commentId,body:a.body,metadata:a.metadata,attachmentIds:a.attachmentIds})}async function au(a){return m.editComment({roomId:j,threadId:a.threadId,commentId:a.commentId,body:a.body,metadata:a.metadata,attachmentIds:a.attachmentIds})}async function av({threadId:a,commentId:b}){return m.deleteComment({roomId:j,threadId:a,commentId:b})}async function aw({threadId:a,commentId:b,emoji:c}){return m.addReaction({roomId:j,threadId:a,commentId:b,emoji:c})}async function ax({threadId:a,commentId:b,emoji:c}){return await m.removeReaction({roomId:j,threadId:a,commentId:b,emoji:c})}async function ay(a,b={}){return m.uploadAttachment({roomId:j,attachment:a,signal:b.signal})}function az(a){return m.getSubscriptionSettings({roomId:j,signal:a?.signal})}function aA(a){return m.updateSubscriptionSettings({roomId:j,settings:a})}async function aB(a){await m.markRoomInboxNotificationAsRead({roomId:j,inboxNotificationId:a})}let aC=b.createSyncSource();function aD(a){return aC.setSyncStatus("synchronizing"===a||"loading"===a?"synchronizing":"synchronized")}return Object.defineProperty({[qp]:{get presenceBuffer(){return o$(q.buffer.presenceUpdates?.data??null)},get undoStack(){return o$(q.undoStack)},get nodeCount(){return q.pool.nodes.size},getYjsProvider:()=>q.yjsProvider,setYjsProvider(a){q.yjsProvider?.off("status",aD),q.yjsProvider=a,a?.on("status",aD),q.yjsProviderDidChange.notify()},yjsProviderDidChange:q.yjsProviderDidChange.observable,reportTextEditor:x,createTextMention:v,deleteTextMention:w,listTextVersions:y,listTextVersionsSince:z,getTextVersion:A,createTextVersion:B,executeContextualPrompt:C,getSelf_forDevTools:()=>G.get(),getOthers_forDevTools:()=>ag.get(),simulate:{explicitClose:a=>p._privateSendMachineEvent({type:"EXPLICIT_SOCKET_CLOSE",event:a}),rawSend:a=>p.send(a)},attachmentUrlsStore:m.getOrCreateAttachmentUrlsStore(j)},id:j,subscribe:(c=j,d=ah,e=b.errorEventSource,function(a,b,f){var g;if("string"==typeof a&&("my-presence"===(g=a)||"others"===g||"event"===g||"error"===g||"history"===g||"status"===g||"storage-status"===g||"lost-connection"===g||"connection"===g||"comments"===g)){if("function"!=typeof b)throw Error("Second argument must be a callback function");switch(a){case"event":return d.customEvent.subscribe(b);case"my-presence":return d.myPresence.subscribe(b);case"others":return d.others.subscribe(a=>{let{others:c,...d}=a;return b(c,d)});case"error":return e.subscribe(a=>{if(a.roomId===c)return b(a)});case"status":return d.status.subscribe(b);case"lost-connection":return d.lostConnection.subscribe(b);case"history":return d.history.subscribe(b);case"storage-status":return d.storageStatus.subscribe(b);case"comments":return d.comments.subscribe(b);default:return pq(a,`"${String(a)}" is not a valid event name`)}}if(void 0===b||"function"==typeof a)if("function"==typeof a)return d.storageBatch.subscribe(a);else throw Error("Please specify a listener callback");if(rk(a))return f?.isDeep?d.storageBatch.subscribe(c=>{let d=c.filter(b=>(function a(b,c){return b===c||"HasParent"===b.parent.type&&a(b.parent.node,c)})(b.node,a));d.length>0&&b(d)}):d.storageBatch.subscribe(c=>{for(let d of c)d.node._id===a._id&&b(d.node)});throw Error(`${String(a)} is not a value that can be subscribed to.`)}),connect:()=>p.connect(),reconnect:()=>p.reconnect(),disconnect:()=>p.disconnect(),destroy:()=>{let{roomWillDestroy:a,...b}=u;for(let a of Object.values(b))a.dispose();u.roomWillDestroy.notify(),q.yjsProvider?.off("status",aD),$.destroy(),aC.destroy(),o(),p.destroy(),a.dispose()},updatePresence:function(a,b){let c={};for(let b in null===q.buffer.presenceUpdates&&(q.buffer.presenceUpdates={type:"partial",data:{}}),a){let d=a[b];void 0!==d&&(q.buffer.presenceUpdates.data[b]=d,c[b]=q.myPresence.get()[b])}q.myPresence.patch(a),q.activeBatch?(b?.addToHistory&&q.activeBatch.reverseOps.pushLeft({type:"presence",data:c}),q.activeBatch.updates.presence=!0):(Q(),b?.addToHistory&&I([{type:"presence",data:c}]),J({presence:!0}))},updateYDoc:function(a,b,c){let d={type:rr.UPDATE_YDOC,update:a,guid:b,v2:c};q.buffer.messages.push(d),u.ydoc.notify(d),Q()},broadcastEvent:function(a,b={shouldQueueEventIfNotReady:!1}){("connected"===p.getStatus()||b.shouldQueueEventIfNotReady)&&(q.buffer.messages.push({type:rr.BROADCAST_EVENT,event:a}),Q())},batch:function(a){let b;if(q.activeBatch)return a();q.activeBatch={ops:[],updates:{storageUpdates:new Map,presence:!1,others:[]},reverseOps:new rp};try{b=a()}finally{let a=q.activeBatch;q.activeBatch=null,a.reverseOps.length>0&&I(Array.from(a.reverseOps)),a.ops.length>0&&(q.redoStack.length=0),a.ops.length>0&&R(a.ops),J(a.updates),Q()}return b},history:{undo:function(){if(q.activeBatch)throw Error("undo is not allowed during a batch");let a=q.undoStack.pop();if(void 0===a)return;q.pausedHistory=null;let b=K(a);for(let a of(J(b.updates),q.redoStack.push(b.reverse),O(),b.opsToEmit))q.buffer.storageOperations.push(a);Q()},redo:function(){if(q.activeBatch)throw Error("redo is not allowed during a batch");let a=q.redoStack.pop();if(void 0===a)return;q.pausedHistory=null;let b=K(a);for(let a of(J(b.updates),q.undoStack.push(b.reverse),O(),b.opsToEmit))q.buffer.storageOperations.push(a);Q()},canUndo:M,canRedo:N,clear:function(){q.undoStack.length=0,q.redoStack.length=0},pause:function(){null===q.pausedHistory&&(q.pausedHistory=new rp)},resume:function(){let a=q.pausedHistory;q.pausedHistory=null,null!==a&&a.length>0&&H(Array.from(a))}},fetchYDoc:function(a,b,c){q.buffer.messages.find(d=>d.type===rr.FETCH_YDOC&&d.vector===a&&d.guid===b&&d.v2===c)||q.buffer.messages.push({type:rr.FETCH_YDOC,vector:a,guid:b,v2:c}),Q()},getStorage:Z,getStorageSnapshot:Y,getStorageStatus:_,isPresenceReady:ac,isStorageReady:ae,waitUntilPresenceReady:o2(ad),waitUntilStorageReady:o2(af),events:ah,getStatus:()=>p.getStatus(),getSelf:()=>E.get(),getPresence:()=>q.myPresence.get(),getOthers:()=>q.others.get(),getThreads:aj,getThreadsSince:ai,getThread:ak,createThread:al,deleteThread:am,editThreadMetadata:an,markThreadAsResolved:ap,markThreadAsUnresolved:aq,subscribeToThread:ar,unsubscribeFromThread:as,createComment:at,editComment:au,editCommentMetadata:ao,deleteComment:av,addReaction:aw,removeReaction:ax,prepareAttachment:function(a){return{type:"localAttachment",status:"idle",id:pQ("at"),name:a.name,size:a.size,mimeType:a.type,file:a}},uploadAttachment:ay,getAttachmentUrl:function(a){return m.getAttachmentUrl({roomId:j,attachmentId:a})},getNotificationSettings:az,getSubscriptionSettings:az,updateNotificationSettings:aA,updateSubscriptionSettings:aA,markInboxNotificationAsRead:aB},qp,{enumerable:!1})}({initialPresence:("function"==typeof p.initialPresence?p.initialPresence(c):p.initialPresence)??{},initialStorage:("function"==typeof p.initialStorage?p.initialStorage(c):p.initialStorage)??{}},{roomId:c,throttleDelay:e,lostConnectionTimeout:f,backgroundKeepAliveTimeout:g,polyfills:b.polyfills,delegates:b.mockedDelegates??{createSocket:(i=b.polyfills?.WebSocket,m=p.engine,a=>{let b=i??("u"<typeof WebSocket?void 0:WebSocket);if(void 0===b)throw new qd("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");let d=new URL(h);if(d.protocol="http:"===d.protocol?"ws":"wss",d.pathname="/v8",d.searchParams.set("roomId",c),"secret"===a.type)d.searchParams.set("tok",a.token.raw);else{if("public"!==a.type)return pq(a,"Unhandled case");d.searchParams.set("pubkey",a.publicApiKey)}return d.searchParams.set("version",oT||"dev"),void 0!==m&&d.searchParams.set("e",String(m)),new b(d.toString())}),authenticate:async()=>j.getAuthValue({requestedScope:"room:read",roomId:c})},enableDebugLogging:b.enableDebugLogging,baseUrl:h,errorEventSource:x,unstable_streamData:!!b.unstable_streamData,roomHttpClient:k,createSyncSource:z,badgeLocation:b.badgeLocation??"bottom-right"}),r={room:q,unsubs:new Set};if(l.set(c,r),p.autoConnect??!0){if("u"<typeof atob){if(b.polyfills?.atob===void 0)throw Error("You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill");a.g.atob=b.polyfills.atob}q.connect()}return n(r)},getRoom:function(a){return l.get(a)?.room||null},logout:function(){for(let{room:b}of(j.reset(),i.set(()=>void 0),l.values())){var a;"initial"!==(a=b.getStatus())&&"disconnected"!==a&&b.reconnect()}},getInboxNotifications:k.getInboxNotifications,getInboxNotificationsSince:k.getInboxNotificationsSince,getUnreadInboxNotificationsCount:k.getUnreadInboxNotificationsCount,markAllInboxNotificationsAsRead:k.markAllInboxNotificationsAsRead,markInboxNotificationAsRead:k.markInboxNotificationAsRead,deleteAllInboxNotifications:k.deleteAllInboxNotifications,deleteInboxNotification:k.deleteInboxNotification,getNotificationSettings:A,updateNotificationSettings:B,resolvers:{invalidateUsers:function(a){p.invalidate(a)},invalidateRoomsInfo:function(a){r.invalidate(a)},invalidateGroupsInfo:function(a){t.invalidate(a)},invalidateMentionSuggestions:function(){u.clear()}},getSyncStatus:function(){let a=w.get();return"synchronizing"===a?a:"synchronized"},events:{error:x,syncStatus:w},[qp]:{currentUserId:i,mentionSuggestionsCache:u,ai:m,resolveMentionSuggestions:b.resolveMentionSuggestions,usersStore:p,roomsInfoStore:r,groupsInfoStore:t,getRoomIds:()=>Array.from(l.keys()),httpClient:k,as:()=>C,createSyncSource:z,emitError:(a,b)=>{let c=rt.from(a,b);x.notify(c)||px(c.message)}}},qp,{enumerable:!1});return C}({authEndpoint:"/api/liveblocks-auth"}),(x=ss.get(H))||(x=function(a){function b(b){return(0,K.jsx)(si,{client:a,allowNesting:!0,children:(0,K.jsx)(su,{...b})})}let c=function(a){let b=()=>a;function c(b){var c,d,e;return c=a,d=b,r0(d?.smooth??!1)?function(a){let b=a.getSyncStatus,[c,d]=(0,L.useState)(b),e=rL(b());return(0,L.useEffect)(()=>{let c,f=a.events.syncStatus.subscribe(()=>{let a=b();"synchronizing"===e.current&&"synchronized"===a?c=setTimeout(()=>d(a),rR):(clearTimeout(c),d(a))});return()=>{clearTimeout(c),f()}},[a,b,e]),c}(c):(e=c,(0,L.useSyncExternalStore)(e.events.syncStatus.subscribe,e.getSyncStatus,e.getSyncStatus))}return{classic:{useClient:b,useUser:b=>{let c,d,e,f;return c=a[qp].usersStore,d=(0,L.useCallback)(()=>c.getItemState(b),[c,b]),e=(0,L.useCallback)(a=>void 0===a||a?.isLoading?a??{isLoading:!0}:a.error?a:a.data?{isLoading:!1,user:a.data}:{isLoading:!1,error:se(b)},[b]),f=rO(c.subscribe,d,d,e,qx),(0,L.useEffect)(()=>void c.enqueue(b)),f},useRoomInfo:b=>{let c,d,e,f;return c=a[qp].roomsInfoStore,d=(0,L.useCallback)(()=>c.getItemState(b),[c,b]),e=(0,L.useCallback)(a=>void 0===a||a?.isLoading?a??{isLoading:!0}:a.error?a:a.data?{isLoading:!1,info:a.data}:{isLoading:!1,error:sf(b)},[b]),f=rO(c.subscribe,d,d,e,qx),(0,L.useEffect)(()=>void c.enqueue(b)),f},useGroupInfo:b=>{let c,d,e,f;return c=a[qp].groupsInfoStore,d=(0,L.useCallback)(()=>c.getItemState(b),[c,b]),e=(0,L.useCallback)(a=>void 0===a||a?.isLoading?a??{isLoading:!0}:a.error?a:a.data?{isLoading:!1,info:a.data}:{isLoading:!1,error:sg(b)},[b]),f=rO(c.subscribe,d,d,e,qx),(0,L.useEffect)(()=>void c.enqueue(b)),f},useIsInsideRoom:rK,useErrorListener:sj,useSyncStatus:c,RegisterAiKnowledge:rM,RegisterAiTool:rN},suspense:{useClient:b,useUser:b=>(function(a,b){let c=a[qp].usersStore,d=(0,L.useCallback)(()=>c.getItemState(b),[c,b]),e=d();if(!e||e.isLoading)throw c.enqueue(b);if(e.error)throw e.error;if(!e.data)throw se(b);let f=(0,L.useSyncExternalStore)(c.subscribe,d,d);return pr(void 0!==f,"Unexpected missing state"),pr(!f.isLoading,"Unexpected loading state"),pr(!f.error,"Unexpected error state"),{isLoading:!1,user:f.data,error:void 0}})(a,b),useRoomInfo:b=>(function(a,b){let c=a[qp].roomsInfoStore,d=(0,L.useCallback)(()=>c.getItemState(b),[c,b]),e=d();if(!e||e.isLoading)throw c.enqueue(b);if(e.error)throw e.error;if(!e.data)throw sf(b);let f=(0,L.useSyncExternalStore)(c.subscribe,d,d);return pr(void 0!==f,"Unexpected missing state"),pr(!f.isLoading,"Unexpected loading state"),pr(!f.error,"Unexpected error state"),pr(void 0!==f.data,"Unexpected missing room info data"),{isLoading:!1,info:f.data,error:void 0}})(a,b),useGroupInfo:b=>(function(a,b){let c=a[qp].groupsInfoStore,d=(0,L.useCallback)(()=>c.getItemState(b),[c,b]),e=d();if(!e||e.isLoading)throw c.enqueue(b);if(e.error)throw e.error;if(!e.data)throw sg(b);let f=(0,L.useSyncExternalStore)(c.subscribe,d,d);return pr(void 0!==f,"Unexpected missing state"),pr(!f.isLoading,"Unexpected loading state"),pr(!f.error,"Unexpected error state"),pr(void 0!==f.data,"Unexpected missing group info data"),{isLoading:!1,info:f.data,error:void 0}})(a,b),useIsInsideRoom:rK,useErrorListener:sj,useSyncStatus:c,RegisterAiKnowledge:rM,RegisterAiTool:rN}}}(a);return Object.defineProperty({RoomContext:rI,RoomProvider:b,useRoom:sw,useStatus:sx,useBroadcastEvent:sy,useOthersListener:sz,useLostConnectionListener:sA,useEventListener:sB,useHistory:sC,useUndo:sD,useRedo:sE,useCanRedo:sG,useCanUndo:sF,useStorageRoot:sQ,useStorage:sR,useSelf:sH,useMyPresence:sI,useUpdateMyPresence:sJ,useOthers:sK,useOthersMapped:sL,useOthersConnectionIds:sM,useOther:sO,useMutation:sS,useThreads:sT,useSearchComments:sU,useCreateThread:sV,useDeleteThread:sW,useEditThreadMetadata:sX,useMarkThreadAsResolved:s3,useMarkThreadAsUnresolved:s4,useSubscribeToThread:s5,useUnsubscribeFromThread:s7,useCreateComment:sZ,useEditComment:s$,useEditCommentMetadata:sY,useDeleteComment:s_,useAddReaction:s0,useRemoveReaction:s1,useMarkThreadAsRead:s2,useThreadSubscription:s9,useAttachmentUrl:tp,useHistoryVersions:td,useHistoryVersionData:tc,useRoomSubscriptionSettings:ta,useUpdateRoomSubscriptionSettings:tf,...c.classic,suspense:{RoomContext:rI,RoomProvider:b,useRoom:sw,useStatus:sx,useBroadcastEvent:sy,useOthersListener:sz,useLostConnectionListener:sA,useEventListener:sB,useHistory:sC,useUndo:sD,useRedo:sE,useCanRedo:sG,useCanUndo:sF,useStorageRoot:sQ,useStorage:tm,useSelf:th,useMyPresence:sI,useUpdateMyPresence:sJ,useOthers:ti,useOthersMapped:tk,useOthersConnectionIds:tj,useOther:tl,useMutation:sS,useThreads:tn,useCreateThread:sV,useDeleteThread:sW,useEditThreadMetadata:sX,useMarkThreadAsResolved:s3,useMarkThreadAsUnresolved:s4,useSubscribeToThread:s5,useUnsubscribeFromThread:s7,useCreateComment:sZ,useEditComment:s$,useEditCommentMetadata:sY,useDeleteComment:s_,useAddReaction:s0,useRemoveReaction:s1,useMarkThreadAsRead:s2,useThreadSubscription:s9,useAttachmentUrl:tq,useHistoryVersions:te,useRoomSubscriptionSettings:tb,useUpdateRoomSubscriptionSettings:tf,...c.suspense}},qp,{enumerable:!1})}(H),ss.set(H,x)),x);function tP(a){let[b,c]=(0,L.useState)(!1);return(0,L.useEffect)(()=>{c(!0)},[]),(0,K.jsx)(L.Suspense,{fallback:a.fallback,children:b?"function"==typeof a.children?a.children():a.children:a.fallback})}let tQ=()=>{let{status:a,opponentName:b,opponentProgress:c,mistakes:d,mode:e,uid:f,playerName:g,setMultiplayerState:h,setRemoteBoard:i,setSyncAction:j,setCellOwners:k,setCurrentTurn:l,hoveredCell:m,selectedCell:n,currentTurn:o}=od(),p=tD(a=>a.status),q=tD(a=>a.winner),r=tD(a=>a.board),s=tD(a=>a.players),t=tD(a=>a.cellOwners);tD(a=>a.currentTurn);let[u,v]=tt(),w=tw();(0,L.useEffect)(()=>{v({hoveredCell:m||n||null})},[m,n,v]),(0,L.useEffect)(()=>{let a=w.map(a=>a.presence.hoveredCell).filter(Boolean);od.setState({opponentHoveredCells:a})},[w]);let x=tJ(({storage:a},b,c)=>{let d=a.get("players");if(d.has(b)||d.set(b,new rf({name:c,progress:0,mistakes:0,status:"playing"})),Array.from(d.keys()).length>=2&&"waiting"===a.get("status")){a.set("status","playing");let b=Array.from(d.keys())[0];a.set("currentTurn",b)}},[]),y=tJ(({storage:a},b)=>{if(!f)return;if(void 0!==b.r&&void 0!==b.c&&void 0!==b.val){let c=9*b.r+b.c;a.get("board").set(c,b.val),a.get("cellOwners").set(`${b.r},${b.c}`,f)}let c=a.get("players"),d=c.get(f);if(d&&d.update({progress:b.progress,mistakes:b.mistakes,status:b.status}),"won"===b.status)a.set("winner",g),a.set("status","finished"),a.set("currentTurn",null);else if(b.switchTurn){let b=Array.from(c.keys()).find(a=>a!==f);b&&a.set("currentTurn",b)}},[f,g]);return(0,L.useEffect)(()=>(j(y),()=>j(null)),[j,y]),(0,L.useEffect)(()=>{f&&g&&x(f,g)},[f,g,x]),(0,L.useEffect)(()=>{if(!s||!f)return;let b=null;if(s instanceof Map)for(let[a,c]of s.entries())a!==f&&(b=c);else for(let[a,c]of Object.entries(s))a!==f&&(b=c);if(b&&h({opponentName:b.name,opponentProgress:b.progress,opponentStatus:b.status}),p&&("playing"===p&&("waiting"===a||"idle"===a)&&h({status:"playing"}),q&&q!==g&&"lost"!==a&&"won"!==a&&h({status:"lost"})),r){let a=[];for(let b=0;b<9;b++)a.push(r.slice(9*b,9*b+9));i(a)}if(t){let a={};if(t&&"function"==typeof t.entries)for(let[b,c]of t.entries())a[b]=c;else a={...t};k(a)}},[s,p,q,r,t,f,g,a,h,i,k]),(0,K.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-center gap-4 w-full max-w-7xl h-dvh p-2 overflow-hidden select-none touch-none",children:[(0,K.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center w-full md:flex-1 min-h-0 min-w-0 max-w-2xl pt-2",children:[(0,K.jsxs)("div",{className:"flex w-full justify-between items-center text-slate-500 font-medium px-2 z-10 shrink-0 gap-2",children:[(0,K.jsxs)("div",{className:"flex items-center gap-3 bg-white/90 backdrop-blur-md px-4 py-2 rounded-2xl border border-slate-200 shadow-sm grow-0 shrink overflow-hidden max-w-[70%] transition-all hover:border-indigo-200",children:[(0,K.jsxs)("div",{className:"relative shrink-0 flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-50 to-indigo-100 text-indigo-600 border border-indigo-100",children:[(0,K.jsx)(oK,{size:16}),(0,K.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white shadow-sm transition-colors bg-emerald-500 animate-pulse",title:"Connected"})]}),(0,K.jsxs)("div",{className:"flex items-center gap-3 min-w-0 pr-1",children:[(0,K.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,K.jsx)("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.15em] mb-0.5",children:"Versus"}),(0,K.jsx)("span",{className:"text-sm font-bold text-slate-800 truncate leading-none mb-0.5",children:b||"Opponent"})]}),(0,K.jsxs)("div",{className:"flex flex-col items-end shrink-0 pl-2 border-l border-slate-100",children:[(0,K.jsx)("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.1em] mb-0.5",children:"Progress"}),(0,K.jsxs)("span",{className:`text-sm font-mono font-black tabular-nums leading-none ${c>50?"text-indigo-600":"text-slate-600"}`,children:[c,"%"]})]})]})]}),(0,K.jsx)("div",{className:"text-xl sm:text-2xl font-bold text-slate-800 font-mono bg-white px-3 py-1 rounded-lg border border-slate-100 shadow-sm shrink-0",children:(0,K.jsx)(ov,{})})]}),(0,K.jsx)("div",{className:"relative w-full aspect-square flex-1 min-h-0 flex justify-center items-center py-2",children:(0,K.jsx)("div",{className:"h-full w-full max-w-full aspect-square flex items-center justify-center",children:(0,K.jsx)(oi,{})})})]}),(0,K.jsxs)("div",{className:"flex flex-col gap-2 w-full md:w-80 md:h-full md:justify-center shrink-0",children:[(0,K.jsxs)("div",{className:"flex justify-between items-center text-slate-600 font-medium px-4 py-1",children:[(0,K.jsxs)("div",{className:"flex flex-col",children:[(0,K.jsx)("span",{className:"text-[10px] uppercase tracking-wider text-slate-400 font-bold",children:"Mistakes"}),(0,K.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,K.jsx)("span",{className:`text-2xl font-light ${d>=3?"text-rose-500":"text-slate-800"}`,children:d}),(0,K.jsx)("span",{className:"text-xs text-slate-300 font-bold",children:"/3"})]})]}),(0,K.jsxs)("div",{className:"flex flex-col items-end",children:[(0,K.jsx)("span",{className:"text-[10px] uppercase tracking-wider text-slate-400 font-bold",children:"Status"}),(0,K.jsx)("span",{className:"text-xs font-bold px-2 py-1 rounded-full text-indigo-600 bg-indigo-50",children:"LIVE SYNC"})]})]}),"pvp"===e&&o&&(0,K.jsx)("div",{className:"flex items-center justify-center w-full px-4 mb-2",children:(0,K.jsx)("div",{className:`w-full text-center py-2.5 rounded-xl font-bold uppercase tracking-wider text-sm transition-colors duration-300 ${o===f?"bg-emerald-50 text-emerald-600 border border-emerald-200 shadow-[0_0_15px_rgba(16,185,129,0.2)]":"bg-slate-100/80 text-slate-500 border border-slate-200"}`,children:o===f?" Your Turn":`${b}'s Turn`})}),(0,K.jsx)("div",{className:"scale-90 origin-center md:scale-100",children:(0,K.jsx)(os,{})}),(0,K.jsx)("div",{className:"w-full",children:(0,K.jsx)(ou,{})}),(0,K.jsxs)("button",{onClick:()=>{od.getState().setMultiplayerState({mode:"pvp",status:"idle",roomId:null})},className:"w-full py-3 bg-slate-100 text-slate-500 hover:text-rose-500 hover:bg-rose-50 border border-slate-200 hover:border-rose-200 rounded-lg text-sm font-bold transition-all active:scale-95 tracking-wide flex items-center justify-center gap-2 mt-auto md:mt-4",children:[(0,K.jsx)(oQ,{size:18}),"Leave"]})]}),(0,K.jsx)(oE,{children:("won"===a||"lost"===a)&&(0,K.jsx)(f$.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4",children:(0,K.jsxs)(f$.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white p-12 rounded-3xl shadow-2xl max-w-md w-full text-center border border-slate-100 relative overflow-hidden",children:[(0,K.jsx)("div",{className:`absolute top-0 left-0 w-full h-2 ${"won"===a?"bg-gradient-to-r from-indigo-400 to-cyan-400":"bg-gradient-to-r from-rose-500 to-orange-500"}`}),(0,K.jsx)("div",{className:`w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center ${"won"===a?"bg-indigo-50 text-indigo-600":"bg-rose-50 text-rose-500"}`,children:"won"===a?(0,K.jsx)(oP,{size:40}):(0,K.jsx)(oQ,{size:40})}),(0,K.jsx)("h2",{className:"text-4xl font-black mb-2 text-slate-800",children:"won"===a?"Victory!":"Defeat"}),(0,K.jsx)("p",{className:"text-slate-500 font-medium mb-8",children:"won"===a?`You crushed it! ${b} didn't stand a chance.`:`${b} solved it first. Better luck next time!`}),(0,K.jsx)("button",{onClick:()=>{od.getState().setMultiplayerState({mode:"single",status:"idle",roomId:null,currentTurn:null})},className:`w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg active:scale-95 ${"won"===a?"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200":"bg-slate-900 text-white hover:bg-slate-800 shadow-slate-300"}`,children:"Back to Lobby"})]})})})]})},tR=()=>{let a=od(a=>a.roomId),b=od(a=>a.difficulty),c=od(a=>a.mode),d=(0,L.useMemo)(()=>{let{initial:a,solved:c}=g2(b);return{board:new q6(a.flat()),initialBoard:new q6(a.flat()),solvedBoard:new q6(c.flat()),status:"waiting",difficulty:b,players:new re,winner:null,cellOwners:new re,currentTurn:null}},[b]);return a?"bot"===c?(0,K.jsx)(tS,{}):(0,K.jsx)(tr,{id:a,initialPresence:{cursor:null,hoveredCell:null},initialStorage:d,children:(0,K.jsx)(tP,{fallback:(0,K.jsxs)("div",{className:"h-dvh w-full flex flex-col items-center justify-center gap-4 text-indigo-600 font-medium bg-slate-50",children:[(0,K.jsx)(oM,{size:32,className:"animate-spin"}),(0,K.jsx)("p",{children:"Connecting to Arena..."})]}),children:(0,K.jsx)(tQ,{})})}):null},tS=()=>{let{status:a,opponentName:b,opponentProgress:c,mistakes:d,mode:e,uid:f,currentTurn:g,setMultiplayerState:h}=od();return(0,K.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-center gap-4 w-full max-w-7xl h-dvh p-2 overflow-hidden select-none touch-none",children:[(0,K.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center w-full md:flex-1 min-h-0 min-w-0 max-w-2xl pt-2",children:[(0,K.jsxs)("div",{className:"flex w-full justify-between items-center text-slate-500 font-medium px-2 z-10 shrink-0 gap-2",children:[(0,K.jsxs)("div",{className:"flex items-center gap-3 bg-white/90 backdrop-blur-md px-4 py-2 rounded-2xl border border-slate-200 shadow-sm grow-0 shrink overflow-hidden max-w-[70%] transition-all hover:border-indigo-200",children:[(0,K.jsxs)("div",{className:"relative shrink-0 flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-50 to-indigo-100 text-indigo-600 border border-indigo-100",children:[(0,K.jsx)(oK,{size:16}),(0,K.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white shadow-sm bg-indigo-500 transition-colors"})]}),(0,K.jsxs)("div",{className:"flex items-center gap-3 min-w-0 pr-1",children:[(0,K.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,K.jsx)("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.15em] mb-0.5",children:"Versus"}),(0,K.jsx)("span",{className:"text-sm font-bold text-slate-800 truncate leading-none mb-0.5",children:b||"AI Bot"})]}),(0,K.jsxs)("div",{className:"flex flex-col items-end shrink-0 pl-2 border-l border-slate-100",children:[(0,K.jsx)("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.1em] mb-0.5",children:"Progress"}),(0,K.jsxs)("span",{className:`text-sm font-mono font-black tabular-nums leading-none ${c>50?"text-indigo-600":"text-slate-600"}`,children:[c,"%"]})]})]})]}),(0,K.jsx)("div",{className:"text-xl sm:text-2xl font-bold text-slate-800 font-mono bg-white px-3 py-1 rounded-lg border border-slate-100 shadow-sm shrink-0",children:(0,K.jsx)(ov,{})})]}),(0,K.jsx)("div",{className:"relative w-full aspect-square flex-1 min-h-0 flex justify-center items-center py-2",children:(0,K.jsx)("div",{className:"h-full w-full max-w-full aspect-square flex items-center justify-center",children:(0,K.jsx)(oi,{})})})]}),(0,K.jsxs)("div",{className:"flex flex-col gap-2 w-full md:w-80 md:h-full md:justify-center shrink-0",children:[(0,K.jsx)("div",{className:"flex justify-between items-center text-slate-600 font-medium px-4 py-1",children:(0,K.jsxs)("div",{className:"flex flex-col",children:[(0,K.jsx)("span",{className:"text-[10px] uppercase tracking-wider text-slate-400 font-bold",children:"Mistakes"}),(0,K.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,K.jsx)("span",{className:`text-2xl font-light ${d>=3?"text-rose-500":"text-slate-800"}`,children:d}),(0,K.jsx)("span",{className:"text-xs text-slate-300 font-bold",children:"/3"})]})]})}),"bot"===e&&g&&(0,K.jsx)("div",{className:"flex items-center justify-center w-full px-4 mb-2",children:(0,K.jsx)("div",{className:`w-full text-center py-2.5 rounded-xl font-bold uppercase tracking-wider text-sm transition-colors duration-300 ${g===f?"bg-emerald-50 text-emerald-600 border border-emerald-200 shadow-[0_0_15px_rgba(16,185,129,0.2)]":"bg-slate-100/80 text-slate-500 border border-slate-200"}`,children:g===f?" Your Turn":`${b}'s Turn`})}),(0,K.jsx)("div",{className:"scale-90 origin-center md:scale-100",children:(0,K.jsx)(os,{})}),(0,K.jsx)("div",{className:"w-full flex justify-center pb-2 md:pb-0",children:(0,K.jsx)(ou,{})})]}),(0,K.jsx)(oE,{children:("won"===a||"lost"===a)&&(0,K.jsx)(f$.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4",children:(0,K.jsxs)(f$.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-12 rounded-3xl shadow-2xl max-w-md w-full text-center border border-slate-100 relative overflow-hidden",children:[(0,K.jsx)("div",{className:`absolute top-0 left-0 w-full h-2 ${"won"===a?"bg-gradient-to-r from-indigo-400 to-cyan-400":"bg-gradient-to-r from-rose-500 to-orange-500"}`}),(0,K.jsx)("div",{className:`w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center ${"won"===a?"bg-indigo-50 text-indigo-600":"bg-rose-50 text-rose-500"}`,children:"won"===a?(0,K.jsx)(oP,{size:40}):(0,K.jsx)(oQ,{size:40})}),(0,K.jsx)("h2",{className:"text-4xl font-black mb-2 text-slate-800",children:"won"===a?"Victory!":"Defeat"}),(0,K.jsx)("p",{className:"text-slate-500 font-medium mb-8",children:"won"===a?`You crushed it! ${b} didn't stand a chance.`:`${b} solved it first. Better luck next time!`}),(0,K.jsx)("button",{onClick:()=>{h({mode:"single",status:"idle",roomId:null,currentTurn:null})},className:`w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg active:scale-95 ${"won"===a?"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200":"bg-slate-900 text-white hover:bg-slate-800 shadow-slate-300"}`,children:"Back to Lobby"})]})})})]})},tT=on("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function tU(){let a=od(a=>a.startGame),b=od(a=>a.difficulty),c=od(a=>a.status),d=od(a=>a.mode),e=od(a=>a.setMultiplayerState),f=od(a=>a.mistakes),g=od(a=>a.tickTimer);return(0,L.useEffect)(()=>{"idle"===c&&"single"===d&&a(b)},[c,d,a,b]),(0,L.useEffect)(()=>{let a=(a=>s?hN(s).onAuthStateChanged(a,void 0,void 0):()=>{})(a=>{a&&od.setState({uid:a.uid,playerName:a.displayName||"Guest"})});return()=>{a()}},[]),(0,L.useEffect)(()=>{let a;return"playing"===c&&(a=setInterval(()=>{g()},1e3)),()=>clearInterval(a)},[c,g]),(0,K.jsxs)("main",{className:"flex h-dvh flex-col items-center justify-center p-2 lg:p-4 bg-slate-50 font-sans transition-colors overflow-hidden select-none touch-none",children:[(0,K.jsx)(oG,{}),(0,K.jsxs)("div",{className:"absolute top-2 left-2 lg:top-4 lg:left-4 flex gap-2 z-50 scale-75 lg:scale-100 origin-top-left",children:[(0,K.jsxs)("button",{onClick:()=>a("Medium","single"),className:`flex items-center gap-2 px-4 py-2 rounded-full transition-all border ${"single"===d?"bg-slate-900 text-white border-slate-900 shadow-lg shadow-slate-200":"bg-white/80 backdrop-blur text-slate-700 border-slate-200 shadow-sm hover:border-slate-300"}`,children:[(0,K.jsx)(tT,{size:16}),(0,K.jsx)("span",{className:"hidden sm:inline font-bold text-xs uppercase tracking-wider",children:"Single"})]}),(0,K.jsxs)("button",{onClick:()=>e({mode:"pvp",status:"idle"}),className:`flex items-center gap-2 px-4 py-2 rounded-full transition-all border ${"pvp"===d?"bg-indigo-600 text-white border-indigo-600 shadow-lg shadow-indigo-100":"bg-white/80 backdrop-blur text-slate-700 border-slate-200 shadow-sm hover:border-indigo-200 hover:text-indigo-600"}`,children:[(0,K.jsx)(oK,{size:16}),(0,K.jsx)("span",{className:"hidden sm:inline font-bold text-xs uppercase tracking-wider",children:"PvP"})]})]}),"pvp"===d||"bot"===d?"idle"===c||"waiting"===c?(0,K.jsx)(oO,{}):(0,K.jsx)(tR,{}):(0,K.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-center gap-4 w-full max-w-7xl h-full p-2 overflow-hidden",children:[(0,K.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center w-full md:flex-1 min-h-0 min-w-0 max-w-2xl",children:[(0,K.jsxs)("div",{className:"flex w-full justify-between items-center text-slate-500 font-medium px-2 shrink-0",children:[(0,K.jsx)("div",{className:"flex gap-1 sm:gap-2 text-xs sm:text-sm",children:["Easy","Medium","Hard","Expert"].map(c=>(0,K.jsx)("button",{onClick:()=>a(c,"single"),className:`px-2 py-1 rounded-md transition-colors ${b===c?"text-indigo-600 font-bold bg-indigo-50":"hover:text-indigo-600"}`,children:c},c))}),(0,K.jsx)("div",{className:"text-2xl sm:text-3xl font-bold text-slate-800 font-mono",children:(0,K.jsx)(ov,{})})]}),(0,K.jsx)("div",{className:"relative w-full aspect-square flex-1 min-h-0 flex justify-center items-center py-2",children:(0,K.jsx)("div",{className:"h-full w-full max-w-full aspect-square flex items-center justify-center",children:(0,K.jsx)(oi,{})})})]}),(0,K.jsxs)("div",{className:"flex flex-col gap-2 w-full md:w-80 md:h-full md:justify-center shrink-0",children:[(0,K.jsx)("div",{className:"flex justify-between items-center text-slate-600 font-medium px-4 py-1",children:(0,K.jsxs)("div",{className:"flex flex-col items-start",children:[(0,K.jsx)("span",{className:"text-[10px] uppercase tracking-wider text-slate-400 font-bold",children:"Mistakes"}),(0,K.jsx)("span",{className:`text-2xl font-light ${f>=3?"text-red-500":"text-slate-800"}`,children:"playing"===c?`${f}/3`:"-/-"})]})}),(0,K.jsx)("div",{className:"scale-90 origin-center md:scale-100",children:(0,K.jsx)(os,{})}),(0,K.jsx)("div",{className:"w-full",children:(0,K.jsx)(ou,{})}),(0,K.jsx)("button",{onClick:()=>a(b,d),className:"w-full py-3 bg-slate-900 text-white rounded-xl text-sm sm:text-lg font-bold shadow-lg hover:bg-slate-800 transition-all active:scale-95 tracking-wide mt-auto md:mt-4",children:"playing"===c?"Restart":"New Game"})]}),(0,K.jsx)(oE,{children:("won"===c||"lost"===c)&&(0,K.jsx)(f$.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4",children:(0,K.jsxs)(f$.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},className:"bg-white p-12 rounded-3xl shadow-2xl max-w-md w-full text-center border border-slate-100 relative overflow-hidden",children:[(0,K.jsx)("div",{className:`absolute top-0 left-0 w-full h-2 ${"won"===c?"bg-gradient-to-r from-indigo-400 to-cyan-400":"bg-gradient-to-r from-rose-500 to-orange-500"}`}),(0,K.jsx)("div",{className:`w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center ${"won"===c?"bg-indigo-50 text-indigo-600":"bg-rose-50 text-rose-500"}`,children:"won"===c?(0,K.jsx)(oP,{size:40}):(0,K.jsx)(oQ,{size:40})}),(0,K.jsx)("h2",{className:"text-4xl font-black mb-2 text-slate-800",children:"won"===c?"Victory!":"Failed"}),(0,K.jsx)("p",{className:"text-slate-500 font-medium mb-8 leading-relaxed",children:"won"===c?`Impressive! You've mastered the ${b} board.`:"The numbers got the better of you this time. Ready to try again?"}),(0,K.jsx)("button",{onClick:()=>a(b,d),className:`w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg active:scale-95 ${"won"===c?"bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200":"bg-slate-900 text-white hover:bg-slate-800 shadow-slate-300"}`,children:"Play Again"})]})})})]})]})}a.s(["default",()=>tU],60350)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__28675661._.js.map