module.exports=[24663,a=>{"use strict";function b(a){let b=Array.from({length:9},()=>Array(9).fill(0));!function a(b,c=!1){for(let d=0;d<9;d++)for(let e=0;e<9;e++)if(0===b[d][e]){let f=[1,2,3,4,5,6,7,8,9];if(c)for(let a=f.length-1;a>0;a--){let b=Math.floor(Math.random()*(a+1));[f[a],f[b]]=[f[b],f[a]]}for(let g of f)if(function(a,b,c,d){for(let e=0;e<9;e++){if(a[b][e]===d&&e!==c||a[e][c]===d&&e!==b)return!1;let f=3*Math.floor(b/3)+Math.floor(e/3),g=3*Math.floor(c/3)+e%3;if(a[f][g]===d&&(f!==b||g!==c))return!1}return!0}(b,d,e,g)){if(b[d][e]=g,a(b,c))return!0;b[d][e]=0}return!1}return!0}(b,!0);let c=b.map(a=>[...a]),d="Easy"===a?30:"Medium"===a?45:"Hard"===a?55:60;for(;d>0;){let a=Math.floor(9*Math.random()),b=Math.floor(9*Math.random());for(;0===c[a][b];)a=Math.floor(9*Math.random()),b=Math.floor(9*Math.random());c[a][b]=0,d--}return{initial:c,solved:b}}a.s(["BLANK",0,0,"GRID_SIZE",0,9,"generateSudoku",()=>b])},874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},74898,(a,b,c)=>{var d=a.r(874),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?b.exports=d:(f(d,c),c.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},66181,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(f,d),f.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},f.prototype.resume=function(){this._paused=!1,this.emit("drain");var a=this._driver.messages;a._paused=!1,a.emit("drain")},f.prototype.write=function(a){return!!this.writable&&(this._driver.parse(a),!this._paused)},f.prototype.end=function(a){if(this.writable){void 0!==a&&this.write(a),this.writable=!1;var b=this._driver.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))}},f.prototype.destroy=function(){this.end()};var g=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(g,d),g.prototype.pause=function(){this._driver.io._paused=!0},g.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},g.prototype.write=function(a){return!!this.writable&&("string"==typeof a?this._driver.text(a):this._driver.binary(a),!this._paused)},g.prototype.end=function(a){void 0!==a&&this.write(a)},g.prototype.destroy=function(){},c.IO=f,c.Messages=g},86562,(a,b,c)=>{"use strict";var d=function(){this.clear()};d.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],d.prototype.clear=function(){this._sent={},this._lines=[]},d.prototype.set=function(a,b){if(void 0!==b){a=this._strip(a),b=this._strip(b);var c=a.toLowerCase();(!this._sent.hasOwnProperty(c)||this.ALLOWED_DUPLICATES.indexOf(c)>=0)&&(this._sent[c]=!0,this._lines.push(a+": "+b+"\r\n"))}},d.prototype.toString=function(){return this._lines.join("")},d.prototype._strip=function(a){return a.toString().replace(/^ */,"").replace(/ *$/,"")},b.exports=d},94255,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this._queue=[],this._queueSize=0,this._offset=0};e.prototype.put=function(a){a&&0!==a.length&&(d.isBuffer(a)||(a=d.from(a)),this._queue.push(a),this._queueSize+=a.length)},e.prototype.read=function(a){if(a>this._queueSize)return null;if(0===a)return d.alloc(0);this._queueSize-=a;var b,c,e=this._queue,f=a,g=e[0];if(g.length>=a)if(g.length===a)return e.shift();else return c=g.slice(0,a),e[0]=g.slice(a),c;for(var h=0,i=e.length;h<i&&!(f<e[h].length);h++)f-=e[h].length;return b=e.splice(0,h),f>0&&e.length>0&&(b.push(e[0].slice(0,f)),e[0]=e[0].slice(f)),d.concat(b,a)},e.prototype.eachByte=function(a,b){for(var c,d,e;this._queue.length>0;){for(d=(c=this._queue[0]).length;this._offset<d;)e=this._offset,this._offset+=1,a.call(b,c[e]);this._offset=0,this._queue.shift()}},b.exports=e},30145,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(27699).EventEmitter,f=a.r(24361),g=a.r(66181),h=a.r(86562),i=a.r(94255),j=function(a,b,c){e.call(this),j.validateOptions(c||{},["maxLength","masking","requireMasking","protocols"]),this._request=a,this._reader=new i,this._options=c||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new h,this.__queue=[],this.readyState=0,this.url=b,this.io=new g.IO(this),this.messages=new g.Messages(this),this._bindEventListeners()};f.inherits(j,e),j.isWebSocket=function(a){var b=a.headers.connection||"",c=a.headers.upgrade||"";return"GET"===a.method&&b.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===c.toLowerCase()},j.validateOptions=function(a,b){for(var c in a)if(0>b.indexOf(c))throw Error("Unrecognized option: "+c)};var k={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var a=this;this.messages.on("error",function(){}),this.on("message",function(b){var c=a.messages;c.readable&&c.emit("data",b.data)}),this.on("error",function(b){var c=a.messages;c.readable&&c.emit("error",b)}),this.on("close",function(){var b=a.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(a){return!1},setHeader:function(a,b){return!(this.readyState>0)&&(this._headers.set(a,b),!0)},start:function(){var a;if(0!==this.readyState)return!1;if(!j.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{a=this._handshakeResponse()}catch(a){return this._failHandshake(a)}return this._write(a),-1!==this._stage&&this._open(),!0},_failHandshake:function(a){var b=new h;return b.set("Content-Type","text/plain"),b.set("Content-Length",d.byteLength(a.message,"utf8")),b=["HTTP/1.1 400 Bad Request",b.toString(),a.message],this._write(d.from(b.join("\r\n"),"utf8")),this._fail("protocol_error",a.message),!1},text:function(a){return this.frame(a)},binary:function(a){return!1},ping:function(){return!1},pong:function(){return!1},close:function(a,b){return 1===this.readyState&&(this.readyState=3,this.emit("close",new j.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(a){this.frame.apply(this,a)},this),this.__queue=[],this.emit("open",new j.OpenEvent)},_queue:function(a){return this.__queue.push(a),!0},_write:function(a){var b=this.io;b.readable&&b.emit("data",a)},_fail:function(a,b){this.readyState=2,this.emit("error",Error(b)),this.close()}};for(var l in k)j.prototype[l]=k[l];j.ConnectEvent=function(){},j.OpenEvent=function(){},j.CloseEvent=function(a,b){this.code=a,this.reason=b},j.MessageEvent=function(a){this.data=a},j.PingEvent=function(a){this.data=a},j.PongEvent=function(a){this.data=a},b.exports=j},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},92509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},58726,(a,b,c)=>{function d(a){if(void 0!==a&&a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===a||this.initialize(a),this.maxHeaderSize=d.maxHeaderSize}c.HTTPParser=d,d.prototype.initialize=function(a,b){if(a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=a,this.state=a+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},d.encoding="ascii",d.maxHeaderSize=81920,d.REQUEST="REQUEST",d.RESPONSE="RESPONSE";var e=d.kOnHeaders=1,f=d.kOnHeadersComplete=2,g=d.kOnBody=3,h=d.kOnMessageComplete=4;d.prototype[e]=d.prototype[f]=d.prototype[g]=d.prototype[h]=function(){};var i=!0;Object.defineProperty(d,"kOnExecute",{get:function(){return i=!1,99}});var j=c.methods=d.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],k=j.indexOf("CONNECT");d.prototype.reinitialize=d,d.prototype.close=d.prototype.pause=d.prototype.resume=d.prototype.remove=d.prototype.free=function(){},d.prototype._compatMode0_11=!1,d.prototype.getAsyncId=function(){return 0};var l={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};d.prototype.execute=function(a,b,c){if(!(this instanceof d))throw TypeError("not a HTTPParser");b=b||0,c="number"==typeof c?c:a.length,this.chunk=a,this.offset=b;var e=this.end=b+c;try{for(;this.offset<e&&!this[this.state](););}catch(a){if(this.isUserCall)throw a;return this.hadError=!0,a}return(this.chunk=null,c=this.offset-b,l[this.state]&&(this.headerSize+=c,this.headerSize>(this.maxHeaderSize||d.maxHeaderSize)))?Error("max header size exceeded"):c};var m={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};d.prototype.finish=function(){if(!this.hadError){if(!m[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[h]())}},d.prototype.consume=d.prototype.unconsume=d.prototype.getCurrentBuffer=function(){},d.prototype.userCall=function(){this.isUserCall=!0;var a=this;return function(b){return a.isUserCall=!1,b}},d.prototype.nextRequest=function(){this.userCall()(this[h]()),this.reinitialize(this.type)},d.prototype.consumeLine=function(){for(var a=this.end,b=this.chunk,c=this.offset;c<a;c++)if(10===b[c]){var e=this.line+b.toString(d.encoding,this.offset,c);return"\r"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),this.line="",this.offset=c+1,e}this.line+=b.toString(d.encoding,this.offset,this.end),this.offset=this.end};var n=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,o=/^[ \t]+(.*[^ \t])/;d.prototype.parseHeader=function(a,b){if(-1!==a.indexOf("\r"))throw r("HPE_LF_EXPECTED");var c=n.exec(a),d=c&&c[1];if(d)b.push(d),b.push(c[2]);else{var e=o.exec(a);e&&b.length&&(b[b.length-1]&&(b[b.length-1]+=" "),b[b.length-1]+=e[1])}};var p=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;d.prototype.REQUEST_LINE=function(){var a=this.consumeLine();if(a){var b=p.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?b[1]:j.indexOf(b[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=b[2],this.info.versionMajor=+b[3],this.info.versionMinor=+b[4],this.body_bytes=0,this.state="HEADER"}};var q=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function r(a){var b=Error("Parse Error");return b.code=a,b}d.prototype.RESPONSE_LINE=function(){var a=this.consumeLine();if(a){var b=q.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");this.info.versionMajor=+b[1],this.info.versionMinor=+b[2];var c=this.info.statusCode=+b[3];this.info.statusMessage=b[4],((c/100|0)==1||204===c||304===c)&&(this.body_bytes=0),this.state="HEADER"}},d.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},d.prototype.HEADER=function(){var a=this.consumeLine();if(void 0!==a){var b=this.info;if(a)this.parseHeader(a,b.headers);else{for(var c,e,g=b.headers,h=!1,j=!1,l=0;l<g.length;l+=2)switch(g[l].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===g[l+1].toLowerCase();break;case"content-length":if(c=+g[l+1],h){if(c!==this.body_bytes)throw r("HPE_UNEXPECTED_CONTENT_LENGTH")}else h=!0,this.body_bytes=c;break;case"connection":this.connection+=g[l+1].toLowerCase();break;case"upgrade":j=!0}if(this.isChunked&&h&&(h=!1,this.body_bytes=null),j&&-1!=this.connection.indexOf("upgrade")?b.upgrade=this.type===d.REQUEST||101===b.statusCode:b.upgrade=b.method===k,this.isChunked&&b.upgrade&&(this.isChunked=!1),b.shouldKeepAlive=this.shouldKeepAlive(),2===(e=i?this.userCall()(this[f](b)):this.userCall()(this[f](b.versionMajor,b.versionMinor,b.headers,b.method,b.url,b.statusCode,b.statusMessage,b.upgrade,b.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!e)this.state="BODY_CHUNKHEAD";else{if(e||0===this.body_bytes)return this.nextRequest(),b.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},d.prototype.BODY_CHUNKHEAD=function(){var a=this.consumeLine();void 0!==a&&(this.body_bytes=parseInt(a,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},d.prototype.BODY_CHUNK=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},d.prototype.BODY_CHUNKEMPTYLINE=function(){var a=this.consumeLine();if(void 0!==a){if(""!==a)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},d.prototype.BODY_CHUNKTRAILERS=function(){var a=this.consumeLine();void 0!==a&&(a?this.parseHeader(a,this.trailers):(this.trailers.length&&this.userCall()(this[e](this.trailers,"")),this.nextRequest()))},d.prototype.BODY_RAW=function(){this.userCall()(this[g](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},d.prototype.BODY_SIZED=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(a){var b=d["kOn"+a];Object.defineProperty(d.prototype,"on"+a,{get:function(){return this[b]},set:function(a){return this._compatMode0_11=!0,k="CONNECT",this[b]=a}})})},34867,(a,b,c)=>{"use strict";var d=a.r(58726).HTTPParser,e=a.r(74898).Buffer,f={request:d.REQUEST||"request",response:d.RESPONSE||"response"},g=function(a){this._type=a,this._parser=new d(f[a]),this._complete=!1,this.headers={};var b=null,c=this;this._parser.onHeaderField=function(a,c,d){b=a.toString("utf8",c,c+d).toLowerCase()},this._parser.onHeaderValue=function(a,d,e){var f=a.toString("utf8",d,d+e);c.headers.hasOwnProperty(b)?c.headers[b]+=", "+f:c.headers[b]=f},this._parser.onHeadersComplete=this._parser[d.kOnHeadersComplete]=function(a,b,d,e,f,h){var i=arguments[0];if("object"==typeof i&&(e=i.method,f=i.url,h=i.statusCode,d=i.headers),c.method="number"==typeof e?g.METHODS[e]:e,c.statusCode=h,c.url=f,d){for(var j,k,l=0,m=d.length;l<m;l+=2)j=d[l].toLowerCase(),k=d[l+1],c.headers.hasOwnProperty(j)?c.headers[j]+=", "+k:c.headers[j]=k;c._complete=!0}}};g.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var h=process.version?process.version.match(/[0-9]+/g).map(function(a){return parseInt(a,10)}):[];0===h[0]&&12===h[1]&&(g.METHODS[16]="REPORT",g.METHODS[17]="MKACTIVITY",g.METHODS[18]="CHECKOUT",g.METHODS[19]="MERGE",g.METHODS[20]="M-SEARCH",g.METHODS[21]="NOTIFY",g.METHODS[22]="SUBSCRIBE",g.METHODS[23]="UNSUBSCRIBE",g.METHODS[24]="PATCH",g.METHODS[25]="PURGE"),g.prototype.isComplete=function(){return this._complete},g.prototype.parse=function(a){var b=this._parser.execute(a,0,a.length);if("number"!=typeof b){this.error=b,this._complete=!0;return}this._complete&&(this.body=b<a.length?a.slice(b):e.alloc(0))},b.exports=g},6073,(a,b,c)=>{"use strict";var d=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,e=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,f=RegExp(d.source+"(?:=(?:"+d.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),g=RegExp(d.source+"(?: *; *"+f.source+")*","g"),h=RegExp("^"+g.source+"(?: *, *"+g.source+")*$"),i=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,j=Object.prototype.hasOwnProperty,k=function(){this._byName={},this._inOrder=[]};k.prototype.push=function(a,b){j.call(this._byName,a)||(this._byName[a]=[]),this._byName[a].push(b),this._inOrder.push({name:a,params:b})},k.prototype.eachOffer=function(a,b){for(var c=this._inOrder,d=0,e=c.length;d<e;d++)a.call(b,c[d].name,c[d].params)},k.prototype.byName=function(a){return this._byName[a]||[]},k.prototype.toArray=function(){return this._inOrder.slice()},b.exports={parseHeader:function(a){var b=new k;if(""===a||void 0===a)return b;if(!h.test(a))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+a);return a.match(g).forEach(function(a){var c=a.match(RegExp(f.source,"g")),d=c.shift(),e={};c.forEach(function(a){var b,c=a.match(f),d=c[1];b=void 0!==c[2]?c[2]:void 0===c[3]||c[3].replace(/\\/g,""),i.test(b)&&(b=parseFloat(b)),j.call(e,d)?(e[d]=[].concat(e[d]),e[d].push(b)):e[d]=b},this),b.push(d,e)},this),b},serializeParams:function(a,b){var c=[],d=function(a,b){b instanceof Array?b.forEach(function(b){d(a,b)}):!0===b?c.push(a):"number"==typeof b?c.push(a+"="+b):e.test(b)?c.push(a+'="'+b.replace(/"/g,'\\"')+'"'):c.push(a+"="+b)};for(var f in b)d(f,b[f]);return[a].concat(c).join("; ")}}},21777,(a,b,c)=>{"use strict";var d=function(a){this._bufferSize=a,this.clear()};d.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},d.prototype.push=function(a){var b=!1,c=!1;this._ringSize<this._bufferSize?b=0===this._tail:this._ringOffset===this._ringSize&&(b=!0,c=0===this._tail),b&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,c&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=a,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},d.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},d.prototype.shift=function(){if(0!==this.length){var a=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,a}},b.exports=d},76503,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(a,b){this._session=a,this._method=b,this._queue=new d(e.QUEUE_SIZE),this._stopped=!1,this.pending=0};e.QUEUE_SIZE=8,e.prototype.call=function(a,b,c,d){if(!this._stopped){var e={error:a,message:b,callback:c,context:d,done:!1},f=!1,g=this;if(this._queue.push(e),e.error)return e.done=!0,this._stop(),this._flushQueue();var h=function(a,b){f^(f=!0)&&(a?(g._stop(),e.error=a,e.message=null):e.message=b,e.done=!0,g._flushQueue())};try{this._session[this._method](b,h)}catch(a){h(a)}}},e.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},e.prototype._flushQueue=function(){for(var a,b=this._queue;b.length>0&&b.peek().done;)(a=b.shift()).error?(this.pending=0,b.clear()):this.pending-=1,a.callback.call(a.context,a.error,a.message)},b.exports=e},52681,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(){this._complete=!1,this._callbacks=new d(e.QUEUE_SIZE)};e.QUEUE_SIZE=4,e.all=function(a){var b=new e,c=a.length,d=c;for(0===c&&b.done();d--;)a[d].then(function(){0==(c-=1)&&b.done()});return b},e.prototype.then=function(a){this._complete?a():this._callbacks.push(a)},e.prototype.done=function(){this._complete=!0;for(var a,b=this._callbacks;a=b.shift();)a()},b.exports=e},4698,(a,b,c)=>{"use strict";var d=a.r(76503),e=a.r(52681),f=function(a){this._ext=a[0],this._session=a[1],this._functors={incoming:new d(this._session,"processIncomingMessage"),outgoing:new d(this._session,"processOutgoingMessage")}};f.prototype.pending=function(a){var b=this._functors[a];b._stopped||(b.pending+=1)},f.prototype.incoming=function(a,b,c,d){this._exec("incoming",a,b,c,d)},f.prototype.outgoing=function(a,b,c,d){this._exec("outgoing",a,b,c,d)},f.prototype.close=function(){return this._closed=this._closed||new e,this._doClose(),this._closed},f.prototype._exec=function(a,b,c,d,e){this._functors[a].call(b,c,function(a,b){a&&(a.message=this._ext.name+": "+a.message),d.call(e,a,b),this._doClose()},this)},f.prototype._doClose=function(){var a=this._functors.incoming,b=this._functors.outgoing;this._closed&&a.pending+b.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},b.exports=f},67900,(a,b,c)=>{"use strict";var d=a.r(4698),e=a.r(52681),f=function(a){this._cells=a.map(function(a){return new d(a)}),this._stopped={incoming:!1,outgoing:!1}};f.prototype.processIncomingMessage=function(a,b,c){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,a,b,c)},f.prototype.processOutgoingMessage=function(a,b,c){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,a,b,c)},f.prototype.close=function(a,b){this._stopped={incoming:!0,outgoing:!0};var c=this._cells.map(function(a){return a.close()});a&&e.all(c).then(function(){a.call(b)})},f.prototype._loop=function(a,b,c,d,e,f,g){for(var h=this._cells,i=h.length,j=this;i--;)h[i].pending(a);var k=function(b,e,i){if(b===c)return f.call(g,e,i);h[b][a](e,i,function(c,e){c&&(j._stopped[a]=!0),k(b+d,c,e)})};k(b,null,e)},b.exports=f},64081,(a,b,c)=>{"use strict";var d=a.r(6073),e=a.r(67900),f=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};f.MESSAGE_OPCODES=[1,2];var g={add:function(a){if("string"!=typeof a.name)throw TypeError("extension.name must be a string");if("permessage"!==a.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof a.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof a.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof a.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(a.name))throw TypeError('An extension with name "'+a.name+'" is already registered');this._byName[a.name]=a,this._inOrder.push(a)},generateOffer:function(){var a=[],b=[],c={};return this._inOrder.forEach(function(e){var f=e.createClientSession();if(f){var g=[e,f];a.push(g),c[e.name]=g;var h=f.generateOffer();(h=h?[].concat(h):[]).forEach(function(a){b.push(d.serializeParams(e.name,a))},this)}},this),this._sessions=a,this._index=c,b.length>0?b.join(", "):null},activate:function(a){var b=d.parseHeader(a),c=[];b.eachOffer(function(a,b){var e=this._index[a];if(!e)throw Error('Server sent an extension response for unknown extension "'+a+'"');var f=e[0],g=e[1],h=this._reserved(f);if(h)throw Error("Server sent two extension responses that use the RSV"+h[0]+' bit: "'+h[1]+'" and "'+f.name+'"');if(!0!==g.activate(b))throw Error("Server sent unacceptable extension parameters: "+d.serializeParams(a,b));this._reserve(f),c.push(e)},this),this._sessions=c,this._pipeline=new e(c)},generateResponse:function(a){var b=[],c=[],f=d.parseHeader(a);return this._inOrder.forEach(function(a){var e=f.byName(a.name);if(!(0===e.length||this._reserved(a))){var g=a.createServerSession(e);g&&(this._reserve(a),b.push([a,g]),c.push(d.serializeParams(a.name,g.generateResponse())))}},this),this._sessions=b,this._pipeline=new e(b),c.length>0?c.join(", "):null},validFrameRsv:function(a){var b,c={rsv1:!1,rsv2:!1,rsv3:!1};if(f.MESSAGE_OPCODES.indexOf(a.opcode)>=0)for(var d=0,e=this._sessions.length;d<e;d++)b=this._sessions[d][0],c.rsv1=c.rsv1||b.rsv1,c.rsv2=c.rsv2||b.rsv2,c.rsv3=c.rsv3||b.rsv3;return(c.rsv1||!a.rsv1)&&(c.rsv2||!a.rsv2)&&(c.rsv3||!a.rsv3)},processIncomingMessage:function(a,b,c){this._pipeline.processIncomingMessage(a,b,c)},processOutgoingMessage:function(a,b,c){this._pipeline.processOutgoingMessage(a,b,c)},close:function(a,b){if(!this._pipeline)return a.call(b);this._pipeline.close(a,b)},_reserve:function(a){this._rsv1=this._rsv1||a.rsv1&&a.name,this._rsv2=this._rsv2||a.rsv2&&a.name,this._rsv3=this._rsv3||a.rsv3&&a.name},_reserved:function(a){return this._rsv1&&a.rsv1?[1,this._rsv1]:this._rsv2&&a.rsv2?[2,this._rsv2]:!!this._rsv3&&!!a.rsv3&&[3,this._rsv3]}};for(var h in g)f.prototype[h]=g[h];b.exports=f},46256,(a,b,c)=>{"use strict";var d=function(){},e={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var f in e)d.prototype[f]=e[f];b.exports=d},55887,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},f={read:function(){return this.data=this.data||d.concat(this._chunks,this.length)},pushFrame:function(a){this.rsv1=this.rsv1||a.rsv1,this.rsv2=this.rsv2||a.rsv2,this.rsv3=this.rsv3||a.rsv3,null===this.opcode&&(this.opcode=a.opcode),this._chunks.push(a.payload),this.length+=a.length}};for(var g in f)e.prototype[g]=f[g];b.exports=e},46987,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(24361),g=a.r(64081),h=a.r(30145),i=a.r(46256),j=a.r(55887),k=function(a,b,c){if(h.apply(this,arguments),this._extensions=new g,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var d=this._request.headers["sec-websocket-protocol"],e=this._protocols;void 0!==d&&("string"==typeof d&&(d=d.split(/ *, */)),this.protocol=d.filter(function(a){return e.indexOf(a)>=0})[0]),this.version="hybi-"+k.VERSION}};f.inherits(k,h),k.VERSION="13",k.mask=function(a,b,c){if(!b||0===b.length)return a;c=c||0;for(var d=0,e=a.length-c;d<e;d++)a[c+d]=a[c+d]^b[d%4];return a},k.generateAccept=function(a){var b=e.createHash("sha1");return b.update(a+k.GUID),b.digest("base64")},k.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var l={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(a){return this._extensions.add(a),!0},parse:function(a){this._reader.put(a);for(var b=!0;b;)switch(this._stage){case 0:(b=this._reader.read(1))&&this._parseOpcode(b[0]);break;case 1:(b=this._reader.read(1))&&this._parseLength(b[0]);break;case 2:(b=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(b);break;case 3:(b=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=b);break;case 4:(b=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(b));break;default:b=null}},text:function(a){return!(this.readyState>1)&&this.frame(a,"text")},binary:function(a){return!(this.readyState>1)&&this.frame(a,"binary")},ping:function(a,b){return!(this.readyState>1)&&(a=a||"",b&&(this._pingCallbacks[a]=b),this.frame(a,"ping"))},pong:function(a){return!(this.readyState>1)&&(a=a||"",this.frame(a,"pong"))},close:function(a,b){return(a=a||"",b=b||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new h.CloseEvent(b,a)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(a,"close",b)},this),!0)},frame:function(a,b,c){if(this.readyState<=0)return this._queue([a,b,c]);if(this.readyState>2)return!1;a instanceof Array&&(a=d.from(a)),"number"==typeof a&&(a=a.toString());var f,g,h=new j,k="string"==typeof a;h.rsv1=h.rsv2=h.rsv3=!1,h.opcode=this.OPCODES[b||(k?"text":"binary")],f=k?d.from(a,"utf8"):a,c&&(g=f,(f=d.allocUnsafe(2+g.length)).writeUInt16BE(c,0),g.copy(f,2)),h.data=f;var l=function(a){var b=new i;b.final=!0,b.rsv1=a.rsv1,b.rsv2=a.rsv2,b.rsv3=a.rsv3,b.opcode=a.opcode,b.masked=!!this._masking,b.length=a.data.length,b.payload=a.data,b.masked&&(b.maskingKey=e.randomBytes(4)),this._sendFrame(b)};return this.MESSAGE_OPCODES.indexOf(h.opcode)>=0?this._extensions.processOutgoingMessage(h,function(a,b){if(a)return this._fail("extension_error",a.message);l.call(this,b)},this):l.call(this,h),!0},_sendFrame:function(a){var b=a.length,c=b<=125?2:b<=65535?4:10,e=c+4*!!a.masked,f=d.allocUnsafe(e+b),g=a.masked?this.MASK:0;f[0]=(a.final?this.FIN:0)|(a.rsv1?this.RSV1:0)|(a.rsv2?this.RSV2:0)|(a.rsv3?this.RSV3:0)|a.opcode,b<=125?f[1]=g|b:b<=65535?(f[1]=126|g,f.writeUInt16BE(b,2)):(f[1]=127|g,f.writeUInt32BE(Math.floor(b/0x100000000),2),f.writeUInt32BE(b%0x100000000,6)),a.payload.copy(f,e),a.masked&&(a.maskingKey.copy(f,c),k.mask(f,a.maskingKey,e)),this._write(f)},_handshakeResponse:function(){var a=this._request.headers["sec-websocket-key"],b=this._request.headers["sec-websocket-version"];if(b!==k.VERSION)throw Error("Unsupported WebSocket version: "+b);if("string"!=typeof a)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",k.generateAccept(a)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var c=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);c&&this._headers.set("Sec-WebSocket-Extensions",c);var e=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return d.from(e.join("\r\n"),"utf8")},_shutdown:function(a,b,c){delete this._frame,delete this._message,this._stage=5;var d=1===this.readyState;this.readyState=2,this._extensions.close(function(){d&&this.frame(b,"close",a),this.readyState=3,c&&this.emit("error",Error(b)),this.emit("close",new h.CloseEvent(a,b))},this)},_fail:function(a,b){this.readyState>1||this._shutdown(this.ERRORS[a],b,!0)},_parseOpcode:function(a){var b=[this.RSV1,this.RSV2,this.RSV3].map(function(b){return(a&b)===b}),c=this._frame=new i;return(c.final=(a&this.FIN)===this.FIN,c.rsv1=b[0],c.rsv2=b[1],c.rsv3=b[2],c.opcode=a&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(c))?0>this.OPCODE_CODES.indexOf(c.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+c.opcode):0>this.MESSAGE_OPCODES.indexOf(c.opcode)&&!c.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+c.opcode):this._message&&this.OPENING_OPCODES.indexOf(c.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!c.rsv1+", reserved2 = "+ +!!c.rsv2+", reserved3 = "+ +!!c.rsv3)},_parseLength:function(a){var b=this._frame;if(b.masked=(a&this.MASK)===this.MASK,b.length=a&this.LENGTH,b.length>=0&&b.length<=125){if(this._stage=b.masked?3:4,!this._checkFrameLength())return}else this._stage=2,b.lengthBytes=126===b.length?2:8;if(this._requireMasking&&!b.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(a){var b=this._frame;if(b.length=this._readUInt(a),this._stage=b.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(b.opcode)&&b.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+b.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(a){var b,c,d,e,f,g=this._frame,i=g.payload=k.mask(a,g.maskingKey),l=g.opcode;if(delete this._frame,l===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(g)}if((l===this.OPCODES.text||l===this.OPCODES.binary)&&(this._message=new j,this._message.pushFrame(g)),g.final&&this.MESSAGE_OPCODES.indexOf(l)>=0)return this._emitMessage(this._message);l===this.OPCODES.close&&(c=i.length>=2?i.readUInt16BE(0):null,d=i.length>2?this._encode(i.slice(2)):null,0!==i.length&&!(null!==c&&c>=this.MIN_RESERVED_ERROR&&c<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(c)&&(c=this.ERRORS.protocol_error),(i.length>125||i.length>2&&!d)&&(c=this.ERRORS.protocol_error),this._shutdown(c||this.DEFAULT_ERROR_CODE,d||"")),l===this.OPCODES.ping&&(this.frame(i,"pong"),this.emit("ping",new h.PingEvent(i.toString()))),l===this.OPCODES.pong&&(f=(e=this._pingCallbacks)[b=this._encode(i)],delete e[b],f&&f(),this.emit("pong",new h.PongEvent(i.toString())))},_emitMessage:function(a){var a=this._message;a.read(),delete this._message,this._extensions.processIncomingMessage(a,function(a,b){if(a)return this._fail("extension_error",a.message);var c=b.data;if(b.opcode===this.OPCODES.text&&(c=this._encode(c)),null===c)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new h.MessageEvent(c))},this)},_encode:function(a){try{var b=a.toString("binary",0,a.length);if(!this.UTF8_MATCH.test(b))return null}catch(a){}return a.toString("utf8",0,a.length)},_readUInt:function(a){return 2===a.length?a.readUInt16BE(0):0x100000000*a.readUInt32BE(0)+a.readUInt32BE(4)}};for(var m in l)k.prototype[m]=l[m];b.exports=k},27520,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(88947).Stream,f=a.r(92509),g=a.r(24361),h=a.r(30145),i=a.r(86562),j=a.r(34867),k={"ws:":80,"wss:":443},l=function(a,b,c){this._client=a,this._http=new j("response"),this._origin="object"==typeof a.url?a.url:f.parse(a.url),this._url="object"==typeof b?b:f.parse(b),this._options=c||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new i,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var e=this._url.auth&&d.from(this._url.auth,"utf8").toString("base64");e&&this._headers.set("Proxy-Authorization","Basic "+e)};g.inherits(l,e);var m={setHeader:function(a,b){return 0===this._state&&(this._headers.set(a,b),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var a=this._origin,b=a.port||k[a.protocol],c=["CONNECT "+a.hostname+":"+b+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",d.from(c.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(a){if(!this.writable)return!1;if(this._http.parse(a),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new h.ConnectEvent);else{var b="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(b))}return this.end(),!this._paused},end:function(a){this.writable&&(void 0!==a&&this.write(a),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var n in m)l.prototype[n]=m[n];b.exports=l},17737,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(92509),g=a.r(24361),h=a.r(34867),i=a.r(30145),j=a.r(46987),k=a.r(27520),l=function(a,b){this.version="hybi-"+j.VERSION,j.call(this,null,a,b),this.readyState=-1,this._key=l.generateKey(),this._accept=j.generateAccept(this._key),this._http=new h("response");var c=f.parse(this.url),e=c.auth&&d.from(c.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(c.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(c.pathname||"/")+(c.search||""),this._headers.set("Host",c.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",j.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),e&&this._headers.set("Authorization","Basic "+e)};g.inherits(l,j),l.generateKey=function(){return e.randomBytes(16).toString("base64")};var m={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(a,b){return new k(this,a,b)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(a){return 3===this.readyState?void 0:this.readyState>0?j.prototype.parse.call(this,a):(this._http.parse(a),this._http.isComplete())?void(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body))):void 0},_handshakeRequest:function(){var a=this._extensions.generateOffer();a&&this._headers.set("Sec-WebSocket-Extensions",a);var b=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return d.from(b.join("\r\n"),"utf8")},_failHandshake:function(a){a="Error during WebSocket handshake: "+a,this.readyState=3,this.emit("error",Error(a)),this.emit("close",new i.CloseEvent(this.ERRORS.protocol_error,a))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var a=this._http.headers,b=a.upgrade||"",c=a.connection||"",d=a["sec-websocket-accept"]||"",e=a["sec-websocket-protocol"]||"";if(""===b)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==b.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===c)return this._failHandshake("'Connection' header is missing");if("upgrade"!==c.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(d!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==e)if(0>this._protocols.indexOf(e))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=e;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(a){return this._failHandshake(a.message)}}};for(var n in m)l.prototype[n]=m[n];b.exports=l},10950,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(24361),g=function(a,b,c){e.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};f.inherits(g,e);var h={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},parse:function(a){this.readyState>1||(this._reader.put(a),this._reader.eachByte(function(a){var b;switch(this._stage){case -1:this._body.push(a),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(a);break;case 1:if(this._length=(127&a)+128*this._length,this._closing&&0===this._length)return this.close();(128&a)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===a)this._stage=0,b=d.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new e.MessageEvent(b));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(a),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(a){if(0===this.readyState)return this._queue([a]);if(this.readyState>1)return!1;"string"!=typeof a&&(a=a.toString());var b=d.byteLength(a),c=d.allocUnsafe(b+2);return c[0]=0,c.write(a,1),c[c.length-1]=255,this._write(c),!0},_handshakeResponse:function(){var a=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"utf8")},_parseLeadingByte:function(a){(128&a)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var i in h)g.prototype[i]=h[i];b.exports=g},61123,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(10950),g=a.r(54799),h=a.r(24361),i=function(a){return parseInt((a.match(/[0-9]/g)||[]).join(""),10)},j=function(a){return(a.match(/ /g)||[]).length},k=function(a,b,c){f.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};h.inherits(k,f);var l={BODY_SIZE:8,start:function(){return!!f.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(d.from([255,0])),this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,b=a["sec-websocket-key1"],c=a["sec-websocket-key2"];if(!b)throw Error("Missing required header: Sec-WebSocket-Key1");if(!c)throw Error("Missing required header: Sec-WebSocket-Key2");var e=i(b),f=j(b),g=i(c),h=j(c);if(e%f!=0||g%h!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[e/f,g/h];var a=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var a=g.createHash("md5"),b=d.allocUnsafe(8+this.BODY_SIZE);return b.writeUInt32BE(this._keyValues[0],0),b.writeUInt32BE(this._keyValues[1],4),d.from(this._body).copy(b,8,0,this.BODY_SIZE),a.update(b),d.from(a.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var a=this._handshakeSignature();a&&(this._write(a),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(a){if(255!==a)return f.prototype._parseLeadingByte.call(this,a);this._closing=!0,this._length=0,this._stage=1}};for(var m in l)k.prototype[m]=l[m];b.exports=k},89048,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(34867),f=a.r(30145),g=a.r(10950),h=a.r(61123),i=a.r(46987),j=function(a){f.call(this,null,null,a),this._http=new e("request")};d.inherits(j,f);var k={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(a){if(this._delegate)return this._delegate.parse(a);if(this._http.parse(a),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var b=this;this._delegate=j.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(a){this._delegate.on(a,function(c){b.emit(a,c)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new f.ConnectEvent)}},_open:function(){this.__queue.forEach(function(a){this._delegate[a[0]].apply(this._delegate,a[1])},this),this.__queue=[]}};for(var l in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(a){k[a]=function(){return this._delegate?this._delegate[a].apply(this._delegate,arguments):(this.__queue.push([a,arguments]),!0)}}),k)j.prototype[l]=k[l];j.isSecureRequest=function(a){if(a.connection&&void 0!==a.connection.authorized||a.socket&&a.socket.secure)return!0;var b=a.headers;return!!b&&("on"===b.https||"on"===b["x-forwarded-ssl"]||"https"===b["x-forwarded-scheme"]||"https"===b["x-forwarded-proto"])},j.determineUrl=function(a){return(this.isSecureRequest(a)?"wss:":"ws:")+"//"+a.headers.host+a.url},j.http=function(a,b){void 0===(b=b||{}).requireMasking&&(b.requireMasking=!0);var c=a.headers,d=c["sec-websocket-version"],e=c["sec-websocket-key"],f=c["sec-websocket-key1"],j=c["sec-websocket-key2"],k=this.determineUrl(a);return d||e?new i(a,k,b):f||j?new h(a,k,b):new g(a,k,b)},b.exports=j},38398,(a,b,c)=>{"use strict";var d=a.r(30145),e=a.r(17737),f=a.r(89048);b.exports={client:function(a,b){return void 0===(b=b||{}).masking&&(b.masking=!0),new e(a,b)},server:function(a){return void 0===(a=a||{}).requireMasking&&(a.requireMasking=!0),new f(a)},http:function(){return f.http.apply(f,arguments)},isSecureRequest:function(a){return f.isSecureRequest(a)},isWebSocket:function(a){return d.isWebSocket(a)},validateOptions:function(a,b){d.validateOptions(a,b)}}},59808,(a,b,c)=>{"use strict";var d=function(a,b){for(var c in this.type=a,b)this[c]=b[c]};d.prototype.initEvent=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},d.prototype.stopPropagation=function(){},d.prototype.preventDefault=function(){},d.CAPTURING_PHASE=1,d.AT_TARGET=2,d.BUBBLING_PHASE=3,b.exports=d},1738,(a,b,c)=>{"use strict";var d=a.r(59808);b.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(a,b,c){this.on(a,b)},removeEventListener:function(a,b,c){this.removeListener(a,b)},dispatchEvent:function(a){a.target=a.currentTarget=this,a.eventPhase=d.AT_TARGET,this["on"+a.type]&&this["on"+a.type](a),this.emit(a.type,a)}}},79136,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(1738),h=a.r(59808),i=function(a){a=a||{},f.validateOptions(a,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var b=a.headers;if(b)for(var c in b)this._driver.setHeader(c,b[c]);var d=a.extensions;d&&[].concat(d).forEach(this._driver.addExtension,this._driver),this._ping=a.ping,this._pingId=0,this.readyState=i.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var e=this;this._driver.on("open",function(a){e._open()}),this._driver.on("message",function(a){e._receiveMessage(a.data)}),this._driver.on("close",function(a){e._beginClose(a.reason,a.code)}),this._driver.on("error",function(a){e._emitError(a.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){e.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){e._pingId+=1,e.ping(e._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};e.inherits(i,d),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_TIMEOUT=3e4;var j={write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.send(a),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(a){return!(this.readyState>i.OPEN)&&(a instanceof Buffer||(a=String(a)),this._driver.messages.write(a))},ping:function(a,b){return!(this.readyState>i.OPEN)&&this._driver.ping(a,b)},close:function(a,b){if(void 0===a&&(a=1e3),void 0===b&&(b=""),1e3!==a&&(a<3e3||a>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+a+" is neither.");if(this.readyState<i.CLOSING){var c=this;this._closeTimer=setTimeout(function(){c._beginClose("",1006)},i.CLOSE_TIMEOUT)}this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING),this._driver.close(b,a)},_configureStream:function(){var a=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(b){this._stream.on(b,function(){a._finalizeClose()})},this),this._stream.on("error",function(b){a._emitError("Network error: "+a.url+": "+b.message),a._finalizeClose()})},_open:function(){if(this.readyState===i.CONNECTING){this.readyState=i.OPEN,this.protocol=this._driver.protocol||"";var a=new h("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},_receiveMessage:function(a){if(this.readyState>i.OPEN)return!1;this.readable&&this.emit("data",a);var b=new h("message",{data:a});b.initEvent("message",!1,!1),this.dispatchEvent(b)},_emitError:function(a){if(!(this.readyState>=i.CLOSING)){var b=new h("error",{message:a});b.initEvent("error",!1,!1),this.dispatchEvent(b)}},_beginClose:function(a,b){this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING,this._closeParams=[a,b],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==i.CLOSED){this.readyState=i.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var a=this._closeParams?this._closeParams[0]:"",b=new h("close",{code:this._closeParams?this._closeParams[1]:1006,reason:a});b.initEvent("close",!1,!1),this.dispatchEvent(b)}}};for(var k in j)i.prototype[k]=j[k];for(var l in g)i.prototype[l]=g[l];b.exports=i},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},85053,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(4446),f=a.r(55004),g=a.r(92509),h=a.r(38398),i=a.r(79136);a.r(59808);var j={"http:":80,"https:":443,"ws:":80,"wss:":443},k=["https:","wss:"],l=function(a,b,c){c=c||{},this.url=a,this._driver=h.client(this.url,{maxLength:c.maxLength,protocols:b}),["open","error"].forEach(function(a){this._driver.on(a,function(){s.headers=s._driver.headers,s.statusCode=s._driver.statusCode})},this);var d=c.proxy||{},l=g.parse(d.origin||this.url),m=l.port||j[l.protocol],n=k.indexOf(l.protocol)>=0,o=function(){s._onConnect()},p=c.net||{},q=c.tls||{},r=d.origin?d.tls||{}:q,s=this;p.host=r.host=l.hostname,p.port=r.port=m,q.ca=q.ca||c.ca,r.servername=r.servername||l.hostname,this._stream=n?f.connect(r,o):e.connect(p,o),d.origin&&this._configureProxy(d,q),i.call(this,c)};d.inherits(l,i),l.prototype._onConnect=function(){(this._proxy||this._driver).start()},l.prototype._configureProxy=function(a,b){var c,d=g.parse(this.url),e=k.indexOf(d.protocol)>=0,h=this;if(this._proxy=this._driver.proxy(a.origin),a.headers)for(c in a.headers)this._proxy.setHeader(c,a.headers[c]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(e){var a={socket:h._stream,servername:d.hostname};for(c in b)a[c]=b[c];h._stream=f.connect(a),h._configureStream()}h._driver.io.pipe(h._stream),h._stream.pipe(h._driver.io),h._driver.start()}),this._proxy.on("error",function(a){h._driver.emit("error",a)})},b.exports=l},92173,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(86562),h=a.r(79136),i=a.r(1738),j=a.r(59808),k=function(a,b,c){this.writable=!0,c=c||{},this._stream=b.socket,this._ping=c.ping||this.DEFAULT_PING,this._retry=c.retry||this.DEFAULT_RETRY;var d=f.isSecureRequest(a)?"https:":"http:";this.url=d+"//"+a.headers.host+a.url,this.lastEventId=a.headers["last-event-id"]||"",this.readyState=h.CONNECTING;var e=new g,i=this;if(c.headers)for(var j in c.headers)e.set(j,c.headers[j]);if(this._stream&&this._stream.writable){process.nextTick(function(){i._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var k="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+e.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(k),this._stream.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i.ping()},1e3*this._ping)),["error","end"].forEach(function(a){i._stream.on(a,function(){i.close()})})}};e.inherits(k,d),k.isEventSource=function(a){return"GET"===a.method&&(a.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var l={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(a){if(!this.writable)return!1;try{return this._stream.write(a,"utf8")}catch(a){return!1}},_open:function(){if(this.readyState===h.CONNECTING){this.readyState=h.OPEN;var a=new j("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.write(a),this.close()},send:function(a,b){if(this.readyState>h.OPEN)return!1;a=String(a).replace(/(\r\n|\r|\n)/g,"$1data: ");var c="";return(b=b||{}).event&&(c+="event: "+b.event+"\r\n"),b.id&&(c+="id: "+b.id+"\r\n"),c+="data: "+a+"\r\n\r\n",this._write(c)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>h.OPEN)return!1;this.readyState=h.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var a=new j("close");return a.initEvent("close",!1,!1),this.dispatchEvent(a),!0}};for(var m in l)k.prototype[m]=l[m];for(var n in i)k.prototype[n]=i[n];b.exports=k},47760,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(38398),f=a.r(79136),g=function(a,b,c,d,g){g=g||{},this._stream=b,this._driver=e.http(a,{maxLength:g.maxLength,protocols:d});var h=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var i=function(){h._stream.removeListener("data",i)};this._stream.on("data",i),f.call(this,g),process.nextTick(function(){h._driver.start(),h._driver.io.write(c)})}};d.inherits(g,f),g.isWebSocket=function(a){return e.isWebSocket(a)},g.validateOptions=function(a,b){e.validateOptions(a,b)},g.WebSocket=g,g.Client=a.r(85053),g.EventSource=a.r(92173),b.exports=g},73341,50455,72029,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(a,b){if(!a)throw t(b)},t=function(a){return Error("Firebase Database ("+r.SDK_VERSION+") INTERNAL ASSERT FAILED: "+a)},u=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},v=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=((7&e)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(f>>10)),b[d++]=String.fromCharCode(56320+(1023&f))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},w={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(u(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):v(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new x;let i=e<<2|f>>4;if(d.push(i),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class x extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let y=function(a){let b=u(a);return w.encodeByteArray(b,!0)},z=function(a){return y(a).replace(/\./g,"")},A=function(a){try{return w.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null},B=()=>{try{return("u">typeof self?self:a.g).__FIREBASE_DEFAULTS__||(()=>{if("u"<typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)})()||(()=>{let a;if("u"<typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&A(a[1]);return b&&JSON.parse(b)})()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},C=a=>B()?.emulatorHosts?.[a],D=()=>B()?.config;class E{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),"function"==typeof a&&(this.promise.catch(()=>{}),1===a.length?a(b):a(b,c))}}}function F(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function G(a){return(await fetch(a,{credentials:"include"})).ok}function H(a,b){}function I(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function J(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function K(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function L(){return!0===r.NODE_CLIENT||!0===r.NODE_ADMIN}class M extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name="FirebaseError",Object.setPrototypeOf(this,M.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,N.prototype.create)}}class N{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){var c,d;let e=b[0]||{},f=`${this.service}/${a}`,g=this.errors[a],h=g?(c=g,d=e,c.replace(O,(a,b)=>{let c=d[b];return null!=c?String(c):`<${b}?>`})):"Error",i=`${this.serviceName}: ${h} (${f}).`;return new M(f,i,e)}}let O=/\{\$([^}]+)}/g;function P(a){return JSON.parse(a)}function Q(a){return JSON.stringify(a)}let R=function(a){let b={},c={},d={},e="";try{let f=a.split(".");b=P(A(f[0])||""),c=P(A(f[1])||""),e=f[2],d=c.d||{},delete c.d}catch(a){}return{header:b,claims:c,data:d,signature:e}},S=function(a){let b=R(a).claims;return!!b&&"object"==typeof b&&b.hasOwnProperty("iat")},T=function(a){let b=R(a).claims;return"object"==typeof b&&!0===b.admin};function U(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function V(a,b){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:void 0}function W(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}function X(a,b,c){let d={};for(let e in a)Object.prototype.hasOwnProperty.call(a,e)&&(d[e]=b.call(c,a[e],e,a));return d}function Y(a,b){if(a===b)return!0;let c=Object.keys(a),d=Object.keys(b);for(let e of c){if(!d.includes(e))return!1;let c=a[e],f=b[e];if(Z(c)&&Z(f)){if(!Y(c,f))return!1}else if(c!==f)return!1}for(let a of d)if(!c.includes(a))return!1;return!0}function Z(a){return null!==a&&"object"==typeof a}function $(a){let b=[];for(let[c,d]of Object.entries(a))Array.isArray(d)?d.forEach(a=>{b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}):b.push(encodeURIComponent(c)+"="+encodeURIComponent(d));return b.length?"&"+b.join("&"):""}function _(a){let b={};return a.replace(/^\?/,"").split("&").forEach(a=>{if(a){let[c,d]=a.split("=");b[decodeURIComponent(c)]=decodeURIComponent(d)}}),b}function aa(a){let b=a.indexOf("?");if(!b)return"";let c=a.indexOf("#",b);return a.substring(b,c>0?c:void 0)}class ab{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let a=1;a<this.blockSize;++a)this.pad_[a]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(a,b){let c,d;b||(b=0);let e=this.W_;if("string"==typeof a)for(let c=0;c<16;c++)e[c]=a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3),b+=4;else for(let c=0;c<16;c++)e[c]=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3],b+=4;for(let a=16;a<80;a++){let b=e[a-3]^e[a-8]^e[a-14]^e[a-16];e[a]=(b<<1|b>>>31)&0xffffffff}let f=this.chain_[0],g=this.chain_[1],h=this.chain_[2],i=this.chain_[3],j=this.chain_[4];for(let a=0;a<80;a++){a<40?a<20?(c=i^g&(h^i),d=0x5a827999):(c=g^h^i,d=0x6ed9eba1):a<60?(c=g&h|i&(g|h),d=0x8f1bbcdc):(c=g^h^i,d=0xca62c1d6);let b=(f<<5|f>>>27)+c+j+d+e[a]|0;j=i,i=h,h=(g<<30|g>>>2)&0xffffffff,g=f,f=b}this.chain_[0]=this.chain_[0]+f|0,this.chain_[1]=this.chain_[1]+g|0,this.chain_[2]=this.chain_[2]+h|0,this.chain_[3]=this.chain_[3]+i|0,this.chain_[4]=this.chain_[4]+j|0}update(a,b){if(null==a)return;void 0===b&&(b=a.length);let c=b-this.blockSize,d=0,e=this.buf_,f=this.inbuf_;for(;d<b;){if(0===f)for(;d<=c;)this.compress_(a,d),d+=this.blockSize;if("string"==typeof a){for(;d<b;)if(e[f]=a.charCodeAt(d),++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}this.inbuf_=f,this.total_+=b}digest(){let a=[],b=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=255&b,b/=256;this.compress_(this.buf_);let c=0;for(let b=0;b<5;b++)for(let d=24;d>=0;d-=8)a[c]=this.chain_[b]>>d&255,++c;return a}}class ac{constructor(a,b){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=b,this.task.then(()=>{a(this)}).catch(a=>{this.error(a)})}next(a){this.forEachObserver(b=>{b.next(a)})}error(a){this.forEachObserver(b=>{b.error(a)}),this.close(a)}complete(){this.forEachObserver(a=>{a.complete()}),this.close()}subscribe(a,b,c){let d;if(void 0===a&&void 0===b&&void 0===c)throw Error("Missing Observer.");void 0===(d=!function(a,b){if("object"!=typeof a||null===a)return!1;for(let c of b)if(c in a&&"function"==typeof a[c])return!0;return!1}(a,["next","error","complete"])?{next:a,error:b,complete:c}:a).next&&(d.next=ad),void 0===d.error&&(d.error=ad),void 0===d.complete&&(d.complete=ad);let e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch(a){}}),this.observers.push(d),e}unsubscribeOne(a){void 0!==this.observers&&void 0!==this.observers[a]&&(delete this.observers[a],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(a){if(!this.finalized)for(let b=0;b<this.observers.length;b++)this.sendOne(b,a)}sendOne(a,b){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[a])try{b(this.observers[a])}catch(a){"u">typeof console&&console.error&&console.error(a)}})}close(a){this.finalized||(this.finalized=!0,void 0!==a&&(this.finalError=a),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ad(){}function ae(a,b){return`${a} failed: ${b} argument `}let af=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);if(e>=55296&&e<=56319){let b=e-55296;s(++d<a.length,"Surrogate pair missing trail surrogate."),e=65536+(b<<10)+(a.charCodeAt(d)-56320)}e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:(e<65536?b[c++]=e>>12|224:(b[c++]=e>>18|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},ag=function(a){let b=0;for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);d<128?b++:d<2048?b+=2:d>=55296&&d<=56319?(b+=4,c++):b+=3}return b};function ah(a){return a&&a._delegate?a._delegate:a}r.NODE_CLIENT=!0;class ai{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let aj="[DEFAULT]";class ak{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){let b=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(b)){let a=new E;if(this.instancesDeferred.set(b,a),this.isInitialized(b)||this.shouldAutoInitialize())try{let c=this.getOrInitializeService({instanceIdentifier:b});c&&a.resolve(c)}catch(a){}}return this.instancesDeferred.get(b).promise}getImmediate(a){let b=this.normalizeInstanceIdentifier(a?.identifier),c=a?.optional??!1;if(this.isInitialized(b)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:b})}catch(a){if(c)return null;throw a}if(c)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,this.shouldAutoInitialize()){if("EAGER"===a.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:aj})}catch(a){}for(let[a,b]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(a);try{let a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}}clearInstance(a=aj){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){let a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return null!=this.component}isInitialized(a=aj){return this.instances.has(a)}getOptions(a=aj){return this.instancesOptions.get(a)||{}}initialize(a={}){let{options:b={}}=a,c=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let d=this.getOrInitializeService({instanceIdentifier:c,options:b});for(let[a,b]of this.instancesDeferred.entries())c===this.normalizeInstanceIdentifier(a)&&b.resolve(d);return d}onInit(a,b){let c=this.normalizeInstanceIdentifier(b),d=this.onInitCallbacks.get(c)??new Set;d.add(a),this.onInitCallbacks.set(c,d);let e=this.instances.get(c);return e&&a(e,c),()=>{d.delete(a)}}invokeOnInitCallbacks(a,b){let c=this.onInitCallbacks.get(b);if(c)for(let d of c)try{d(a,b)}catch{}}getOrInitializeService({instanceIdentifier:a,options:b={}}){var c;let d=this.instances.get(a);if(!d&&this.component&&(d=this.component.instanceFactory(this.container,{instanceIdentifier:(c=a)===aj?void 0:c,options:b}),this.instances.set(a,d),this.instancesOptions.set(a,b),this.invokeOnInitCallbacks(d,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,d)}catch{}return d||null}normalizeInstanceIdentifier(a=aj){return this.component?this.component.multipleInstances?a:aj:a}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class al{constructor(a){this.name=a,this.providers=new Map}addComponent(a){let b=this.getProvider(a.name);if(b.isComponentSet())throw Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);let b=new ak(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}}let am=[];(bh=bi||(bi={}))[bh.DEBUG=0]="DEBUG",bh[bh.VERBOSE=1]="VERBOSE",bh[bh.INFO=2]="INFO",bh[bh.WARN=3]="WARN",bh[bh.ERROR=4]="ERROR",bh[bh.SILENT=5]="SILENT";let an={debug:bi.DEBUG,verbose:bi.VERBOSE,info:bi.INFO,warn:bi.WARN,error:bi.ERROR,silent:bi.SILENT},ao=bi.INFO,ap={[bi.DEBUG]:"log",[bi.VERBOSE]:"log",[bi.INFO]:"info",[bi.WARN]:"warn",[bi.ERROR]:"error"},aq=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=ap[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class ar{constructor(a){this.name=a,this._logLevel=ao,this._logHandler=aq,this._userLogHandler=null,am.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in bi))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?an[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,bi.DEBUG,...a),this._logHandler(this,bi.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,bi.VERBOSE,...a),this._logHandler(this,bi.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,bi.INFO,...a),this._logHandler(this,bi.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,bi.WARN,...a),this._logHandler(this,bi.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,bi.ERROR,...a),this._logHandler(this,bi.ERROR,...a)}}let as=new WeakMap,at=new WeakMap,au=new WeakMap,av=new WeakMap,aw=new WeakMap,ax={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return at.get(a);if("objectStoreNames"===b)return a.objectStoreNames||au.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return ay(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function ay(a){if(a instanceof IDBRequest){let b;return(b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(ay(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)})).then(b=>{b instanceof IDBCursor&&as.set(b,a)}).catch(()=>{}),aw.set(b,a),b}if(av.has(a))return av.get(a);let b=function(a){if("function"==typeof a)return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(d||(d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(az(this),b),ay(as.get(this))}:function(...b){return ay(a.apply(az(this),b))}:function(b,...c){let d=a.call(az(this),b,...c);return au.set(d,b.sort?b.sort():[b]),ay(d)};return a instanceof IDBTransaction&&function(a){if(at.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});at.set(a,b)}(a),(c||(c=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(b=>a instanceof b)?new Proxy(a,ax):a}(a);return b!==a&&(av.set(a,b),aw.set(b,a)),b}let az=a=>aw.get(a),aA=["get","getKey","getAll","getAllKeys","count"],aB=["put","add","delete","clear"],aC=new Map;function aD(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(aC.get(b))return aC.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=aB.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||aA.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return aC.set(b,f),f}ax={...b=ax,get:(a,c,d)=>aD(a,c)||b.get(a,c,d),has:(a,c)=>!!aD(a,c)||b.has(a,c)};class aE{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{let b;if(b=a.getComponent(),b?.type!=="VERSION")return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}let aF="@firebase/app",aG="0.14.8",aH=new ar("@firebase/app"),aI="[DEFAULT]",aJ={[aF]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},aK=new Map,aL=new Map,aM=new Map;function aN(a,b){try{a.container.addComponent(b)}catch(c){aH.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function aO(a,b){a.container.addOrOverwriteComponent(b)}function aP(a){let b=a.name;if(aM.has(b))return aH.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(aM.set(b,a),aK.values()))aN(c,a);for(let b of aL.values())aN(b,a);return!0}function aQ(a,b){let c=a.container.getProvider("heartbeat").getImmediate({optional:!0});return c&&c.triggerHeartbeat(),a.container.getProvider(b)}function aR(a,b,c=aI){aQ(a,b).clearInstance(c)}function aS(a){return void 0!==a.options}function aT(a){return!aS(a)&&("authIdToken"in a||"appCheckToken"in a||"releaseOnDeref"in a||"automaticDataCollectionEnabled"in a)}function aU(a){return null!=a&&void 0!==a.settings}function aV(){aM.clear()}let aW=new N("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class aX{constructor(a,b,c){this._isDeleted=!1,this._options={...a},this._config={...b},this._name=b.name,this._automaticDataCollectionEnabled=b.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new ai("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw aW.create("app-deleted",{appName:this._name})}}function aY(a,b){let c=A(a.split(".")[1]);null===c?console.error(`FirebaseServerApp ${b} is invalid: second part could not be parsed.`):void 0===JSON.parse(c).exp?console.error(`FirebaseServerApp ${b} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(c).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${b} is invalid: the token has expired.`)}class aZ extends aX{constructor(a,b,c,d){const e=void 0===b.automaticDataCollectionEnabled||b.automaticDataCollectionEnabled,f={name:c,automaticDataCollectionEnabled:e};void 0!==a.apiKey?super(a,f,d):super(a.options,f,d),this._serverConfig={automaticDataCollectionEnabled:e,...b},this._serverConfig.authIdToken&&aY(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&aY(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,b.releaseOnDeref=void 0,a4(aF,aG,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(a){this.isDeleted||(this._refCount++,void 0!==a&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(a,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){a3(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw aW.create("server-app-deleted")}}let a$="12.9.0";function a_(a,b={}){let c=a;"object"!=typeof b&&(b={name:b});let d={name:aI,automaticDataCollectionEnabled:!0,...b},e=d.name;if("string"!=typeof e||!e)throw aW.create("bad-app-name",{appName:String(e)});if(c||(c=D()),!c)throw aW.create("no-options");let f=aK.get(e);if(f)if(Y(c,f.options)&&Y(d,f.config))return f;else throw aW.create("duplicate-app",{appName:e});let g=new al(e);for(let a of aM.values())g.addComponent(a);let h=new aX(c,d,g);return aK.set(e,h),h}function a0(a,b={}){let c;if(J()&&!J())throw aW.create("invalid-server-app-environment");let d=b||{};if(a&&(aS(a)?c=a.options:aT(a)?d=a:c=a),void 0===d.automaticDataCollectionEnabled&&(d.automaticDataCollectionEnabled=!0),c||(c=D()),!c)throw aW.create("no-options");let e={...d,...c};if(void 0!==e.releaseOnDeref&&delete e.releaseOnDeref,void 0!==d.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw aW.create("finalization-registry-not-supported",{});let f=""+[...JSON.stringify(e)].reduce((a,b)=>Math.imul(31,a)+b.charCodeAt(0)|0,0),g=aL.get(f);if(g)return g.incRefCount(d.releaseOnDeref),g;let h=new al(f);for(let a of aM.values())h.addComponent(a);let i=new aZ(c,d,f,h);return aL.set(f,i),i}function a1(a=aI){let b=aK.get(a);if(!b&&a===aI&&D())return a_();if(!b)throw aW.create("no-app",{appName:a});return b}function a2(){return Array.from(aK.values())}async function a3(a){let b=!1,c=a.name;aK.has(c)?(b=!0,aK.delete(c)):aL.has(c)&&0>=a.decRefCount()&&(aL.delete(c),b=!0),b&&(await Promise.all(a.container.getProviders().map(a=>a.delete())),a.isDeleted=!0)}function a4(a,b,c){let d=aJ[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),aH.warn(a.join(" "));return}aP(new ai(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}function a5(a,b){if(null!==a&&"function"!=typeof a)throw aW.create("invalid-log-argument");for(let c of am){let d=null;b&&b.level&&(d=an[b.level]),null===a?c.userLogHandler=null:c.userLogHandler=(b,c,...e)=>{let f=e.map(a=>{if(null==a)return null;if("string"==typeof a)return a;if("number"==typeof a||"boolean"==typeof a)return a.toString();if(a instanceof Error)return a.message;try{return JSON.stringify(a)}catch(a){return null}}).filter(a=>a).join(" ");c>=(d??b.logLevel)&&a({level:bi[c].toLowerCase(),message:f,args:e,type:b.name})}}}function a6(a){am.forEach(b=>{b.setLogLevel(a)})}let a7="firebase-heartbeat-store",a8=null;function a9(){return a8||(a8=(function(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,1),h=ay(g);return d&&g.addEventListener("upgradeneeded",a=>{d(ay(g.result),a.oldVersion,a.newVersion,ay(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h})("firebase-heartbeat-database",0,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(a7)}catch(a){console.warn(a)}}}).catch(a=>{throw aW.create("idb-open",{originalErrorMessage:a.message})})),a8}async function ba(a){try{let b=(await a9()).transaction(a7),c=await b.objectStore(a7).get(bc(a));return await b.done,c}catch(a){if(a instanceof M)aH.warn(a.message);else{let b=aW.create("idb-get",{originalErrorMessage:a?.message});aH.warn(b.message)}}}async function bb(a,b){try{let c=(await a9()).transaction(a7,"readwrite"),d=c.objectStore(a7);await d.put(b,bc(a)),await c.done}catch(a){if(a instanceof M)aH.warn(a.message);else{let b=aW.create("idb-set",{originalErrorMessage:a?.message});aH.warn(b.message)}}}function bc(a){return`${a.name}!${a.options.appId}`}class bd{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new bf(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=be();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>30){let a=function(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){aH.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=be(),{heartbeatsToSend:b,unsentEntries:c}=function(a,b=1024){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),bg(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),bg(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}(this._heartbeatsCache.heartbeats),d=z(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return aH.warn(a),""}}}function be(){return new Date().toISOString().substring(0,10)}class bf{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(a){return!1}}()&&new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await ba(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bb(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bb(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function bg(a){return z(JSON.stringify({version:2,heartbeats:a})).length}aP(new ai("platform-logger",a=>new aE(a),"PRIVATE")),aP(new ai("heartbeat",a=>new bd(a),"PRIVATE")),a4(aF,aG,""),a4(aF,aG,"esm2020"),a4("fire-js",""),a.s(["SDK_VERSION",()=>a$,"_DEFAULT_ENTRY_NAME",()=>aI,"_addComponent",()=>aN,"_addOrOverwriteComponent",()=>aO,"_apps",()=>aK,"_clearComponents",()=>aV,"_components",()=>aM,"_getProvider",()=>aQ,"_isFirebaseApp",()=>aS,"_isFirebaseServerApp",()=>aU,"_isFirebaseServerAppSettings",()=>aT,"_registerComponent",()=>aP,"_removeServiceInstance",()=>aR,"_serverApps",()=>aL,"deleteApp",()=>a3,"getApp",()=>a1,"getApps",()=>a2,"initializeApp",()=>a_,"initializeServerApp",()=>a0,"onLog",()=>a5,"registerVersion",()=>a4,"setLogLevel",()=>a6],88156),a4("firebase","12.9.0","app"),a.i(88156);var bh,bi,bj,bk,bl,bm=a.i(47760);let bn=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,bo="websocket",bp="long_polling";class bq{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(a,b){null==b?delete this.cache_[a]:this.cache_[a]=b}get(a){return U(this.cache_,a)?this.cache_[a]:null}remove(a){delete this.cache_[a]}}let br=function(a){return new bq},bs=br("localStorage"),bt=br("sessionStorage"),bu=new ar("@firebase/database"),bv=(q=1,function(){return q++}),bw=function(a){let b=af(a),c=new ab;c.update(b);let d=c.digest();return w.encodeByteArray(d)},bx=function(...a){let b="";for(let c=0;c<a.length;c++){let d=a[c];Array.isArray(d)||d&&"object"==typeof d&&"number"==typeof d.length?b+=bx.apply(null,d):"object"==typeof d?b+=Q(d):b+=d,b+=" "}return b},by=null,bz=!0,bA=function(a,b){s(!b||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?(bu.logLevel=bi.VERBOSE,by=bu.log.bind(bu),b&&bt.set("logging_enabled",!0)):"function"==typeof a?by=a:(by=null,bt.remove("logging_enabled"))},bB=function(...a){if(!0===bz&&(bz=!1,null===by&&!0===bt.get("logging_enabled")&&bA(!0)),by){let b=bx.apply(null,a);by(b)}},bC=function(a){return function(...b){bB(a,...b)}},bD=function(...a){let b="FIREBASE INTERNAL ERROR: "+bx(...a);bu.error(b)},bE=function(...a){let b=`FIREBASE FATAL ERROR: ${bx(...a)}`;throw bu.error(b),Error(b)},bF=function(...a){let b="FIREBASE WARNING: "+bx(...a);bu.warn(b)},bG=function(){},bH=function(a){return"number"==typeof a&&(a!=a||a===1/0||a===-1/0)},bI=function(a){if(L()||"complete"===document.readyState)a();else{let b=!1,c=function(){document.body?b||(b=!0,a()):setTimeout(c,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}},bJ="[MIN_NAME]",bK="[MAX_NAME]",bL=function(a,b){if(a===b)return 0;{if(a===bJ||b===bK)return -1;if(b===bJ||a===bK)return 1;let c=bT(a),d=bT(b);if(null!==c)if(null!==d)return c-d==0?a.length-b.length:c-d;else return -1;return null!==d?1:a<b?-1:1}},bM=function(a,b){return a===b?0:a<b?-1:1},bN=function(a,b){if(b&&a in b)return b[a];throw Error("Missing required key ("+a+") in object: "+Q(b))},bO=function(a){if("object"!=typeof a||null===a)return Q(a);let b=[];for(let c in a)b.push(c);b.sort();let c="{";for(let d=0;d<b.length;d++)0!==d&&(c+=","),c+=Q(b[d]),c+=":",c+=bO(a[b[d]]);return c+"}"},bP=function(a,b){let c=a.length;if(c<=b)return[a];let d=[];for(let e=0;e<c;e+=b)e+b>c?d.push(a.substring(e,c)):d.push(a.substring(e,e+b));return d};function bQ(a,b){for(let c in a)a.hasOwnProperty(c)&&b(c,a[c])}let bR=function(a){let b,c,d,e,f;s(!bH(a),"Invalid JSON number");0===a?(c=0,d=0,b=+(1/a==-1/0)):(b=a<0,(a=Math.abs(a))>=22250738585072014e-324?(c=(e=Math.min(Math.floor(Math.log(a)/Math.LN2),1023))+1023,d=Math.round(a*Math.pow(2,52-e)-0x10000000000000)):(c=0,d=Math.round(a/5e-324)));let g=[];for(f=52;f;f-=1)g.push(d%2?1:0),d=Math.floor(d/2);for(f=11;f;f-=1)g.push(c%2?1:0),c=Math.floor(c/2);g.push(+!!b),g.reverse();let h=g.join(""),i="";for(f=0;f<64;f+=8){let a=parseInt(h.substr(f,8),2).toString(16);1===a.length&&(a="0"+a),i+=a}return i.toLowerCase()},bS=RegExp("^-?(0*)\\d{1,10}$"),bT=function(a){if(bS.test(a)){let b=Number(a);if(b>=-0x80000000&&b<=0x7fffffff)return b}return null},bU=function(a){try{a()}catch(a){setTimeout(()=>{throw bF("Exception was thrown by user callback.",a.stack||""),a},Math.floor(0))}},bV=function(a,b){let c=setTimeout(a,b);return"number"==typeof c&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(c):"object"==typeof c&&c.unref&&c.unref(),c};class bW{constructor(a,b,c,d,e=!1,f="",g=!1,h=!1,i=null){this.secure=b,this.namespace=c,this.webSocketOnly=d,this.nodeAdmin=e,this.persistenceKey=f,this.includeNamespaceInQueryParams=g,this.isUsingEmulator=h,this.emulatorOptions=i,this._host=a.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=bs.get("host:"+a)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&bs.set("host:"+this._host,this.internalHost))}toString(){let a=this.toURLString();return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a}toURLString(){let a=this.secure?"https://":"http://",b=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${a}${this.host}/${b}`}}function bX(a,b,c){let d;if(s("string"==typeof b,"typeof type must == string"),s("object"==typeof c,"typeof params must == object"),b===bo)d=(a.secure?"wss://":"ws://")+a.internalHost+"/.ws?";else if(b===bp)d=(a.secure?"https://":"http://")+a.internalHost+"/.lp?";else throw Error("Unknown connection type: "+b);(a.host!==a.internalHost||a.isCustomHost()||a.includeNamespaceInQueryParams)&&(c.ns=a.namespace);let e=[];return bQ(c,(a,b)=>{e.push(a+"="+b)}),d+e.join("&")}class bY{constructor(){this.counters_={}}incrementCounter(a,b=1){U(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=b}get(){return function a(b,c){if(!(c instanceof Object))return c;switch(c.constructor){case Date:return new Date(c.getTime());case Object:void 0===b&&(b={});break;case Array:b=[];break;default:return c}for(let d in c)c.hasOwnProperty(d)&&"__proto__"!==d&&(b[d]=a(b[d],c[d]));return b}(void 0,this.counters_)}}let bZ={},b$={};function b_(a){let b=a.toString();return bZ[b]||(bZ[b]=new bY),bZ[b]}let b0="",b1=null;"u">typeof MozWebSocket?b1=MozWebSocket:"u">typeof WebSocket&&(b1=WebSocket);class b2{constructor(a,b,c,d,e,f,g){this.connId=a,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=bC(this.connId),this.stats_=b_(b),this.connURL=b2.connectionURL_(b,f,g,d,c),this.nodeAdmin=b.nodeAdmin}static connectionURL_(a,b,c,d,e){let f={};return f.v="5",!L()&&"u">typeof location&&location.hostname&&bn.test(location.hostname)&&(f.r="f"),b&&(f.s=b),c&&(f.ls=c),d&&(f.ac=d),e&&(f.p=e),bX(a,bo,f)}open(a,b){this.onDisconnect=b,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,bs.set("previous_websocket_failure",!0);try{let a;if(L()){let b=this.nodeAdmin?"AdminNode":"Node";a={headers:{"User-Agent":`Firebase/5/${b0}/${process.platform}/${b}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(a.headers["X-Firebase-AppCheck"]=this.appCheckToken);let c=process.env,d=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;d&&(a.proxy={origin:d})}this.mySock=new b1(this.connURL,[],a)}catch(b){this.log_("Error instantiating WebSocket.");let a=b.message||b.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");let b=a.message||a.data;b&&this.log_(b),this.onClosed_()}}start(){}static forceDisallow(){b2.forceDisallow_=!0}static isAvailable(){let a=!1;if("u">typeof navigator&&navigator.userAgent){let b=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);b&&b.length>1&&4.4>parseFloat(b[1])&&(a=!0)}return!a&&null!==b1&&!b2.forceDisallow_}static previouslyFailed(){return bs.isInMemoryStorage||!0===bs.get("previous_websocket_failure")}markConnectionHealthy(){bs.remove("previous_websocket_failure")}appendFrame_(a){if(this.frames.push(a),this.frames.length===this.totalFrames){let a=this.frames.join("");this.frames=null;let b=P(a);this.onMessage(b)}}handleNewFrameCount_(a){this.totalFrames=a,this.frames=[]}extractFrameCount_(a){if(s(null===this.frames,"We already have a frame buffer"),a.length<=6){let b=Number(a);if(!isNaN(b))return this.handleNewFrameCount_(b),null}return this.handleNewFrameCount_(1),a}handleIncomingFrame(a){if(null===this.mySock)return;let b=a.data;if(this.bytesReceived+=b.length,this.stats_.incrementCounter("bytes_received",b.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(b);else{let a=this.extractFrameCount_(b);null!==a&&this.appendFrame_(a)}}send(a){this.resetKeepAlive();let b=Q(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=bP(b,16384);c.length>1&&this.sendString_(String(c.length));for(let a=0;a<c.length;a++)this.sendString_(c[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(a){try{this.mySock.send(a)}catch(a){this.log_("Exception thrown from WebSocket.send():",a.message||a.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}b2.responsesRequiredToBeHealthy=2,b2.healthyTimeout=3e4;let b3="@firebase/database",b4="1.1.0";class b5{constructor(a,b){this.appCheckProvider=b,this.appName=a.name,aU(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken),this.appCheck=b?.getImmediate({optional:!0}),this.appCheck||b?.get().then(a=>this.appCheck=a)}getToken(a){if(this.serverAppAppCheckToken){if(a)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(a):new Promise((b,c)=>{setTimeout(()=>{this.appCheck?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.appCheckProvider?.get().then(b=>b.addTokenListener(a))}notifyForInvalidToken(){bF(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class b6{constructor(a,b,c){this.appName_=a,this.firebaseOptions_=b,this.authProvider_=c,this.auth_=null,this.auth_=c.getImmediate({optional:!0}),this.auth_||c.onInit(a=>this.auth_=a)}getToken(a){return this.auth_?this.auth_.getToken(a).catch(a=>a&&"auth/token-not-initialized"===a.code?(bB("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(a)):new Promise((b,c)=>{setTimeout(()=>{this.auth_?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.auth_?this.auth_.addAuthTokenListener(a):this.authProvider_.get().then(b=>b.addAuthTokenListener(a))}removeTokenChangeListener(a){this.authProvider_.get().then(b=>b.removeAuthTokenListener(a))}notifyForInvalidToken(){let a='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?a+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?a+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':a+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',bF(a)}}class b7{constructor(a){this.accessToken=a}getToken(a){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(a){a(this.accessToken)}removeTokenChangeListener(a){}notifyForInvalidToken(){}}b7.OWNER="owner";class b8{constructor(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(a,b){this.closeAfterResponse=a,this.onClose=b,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(a,b){for(this.pendingResponses[a]=b;this.pendingResponses[this.currentResponseNum];){let a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let b=0;b<a.length;++b)a[b]&&bU(()=>{this.onMessage_(a[b])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let b9="start";class ca{constructor(a,b,c,d,e,f,g){this.connId=a,this.repoInfo=b,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.transportSessionId=f,this.lastSessionId=g,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=bC(a),this.stats_=b_(b),this.urlFn=a=>(this.appCheckToken&&(a.ac=this.appCheckToken),bX(b,bp,a))}open(a,b){this.curSegmentNum=0,this.onDisconnect_=b,this.myPacketOrderer=new b8(a),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),bI(()=>{if(this.isClosed_)return;this.scriptTagHolder=new cb((...a)=>{let[b,c,d,e,f]=a;if(this.incrementIncomingBytes_(a),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,b===b9)this.id=c,this.password=d;else if("close"===b)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+b)},(...a)=>{let[b,c]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(b,c)},()=>{this.onClosed_()},this.urlFn);let a={};a[b9]="t",a.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(a.cb=this.scriptTagHolder.uniqueCallbackIdentifier),a.v="5",this.transportSessionId&&(a.s=this.transportSessionId),this.lastSessionId&&(a.ls=this.lastSessionId),this.applicationId&&(a.p=this.applicationId),this.appCheckToken&&(a.ac=this.appCheckToken),"u">typeof location&&location.hostname&&bn.test(location.hostname)&&(a.r="f");let b=this.urlFn(a);this.log_("Connecting via long-poll to "+b),this.scriptTagHolder.addTag(b,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ca.forceAllow_=!0}static forceDisallow(){ca.forceDisallow_=!0}static isAvailable(){return!L()&&(!!ca.forceAllow_||!ca.forceDisallow_&&"u">typeof document&&null!=document.createElement&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(a){let b=Q(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=bP(y(b),1840);for(let a=0;a<c.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[a]),this.curSegmentNum++}addDisconnectPingFrame(a,b){if(L())return;this.myDisconnFrame=document.createElement("iframe");let c={};c.dframe="t",c.id=a,c.pw=b,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(a){let b=Q(a).length;this.bytesReceived+=b,this.stats_.incrementCounter("bytes_received",b)}}class cb{constructor(a,b,c,d){if(this.onDisconnect=c,this.urlFn=d,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,L())this.commandCB=a,this.onMessageCB=b;else{this.uniqueCallbackIdentifier=bv(),window["pLPCommand"+this.uniqueCallbackIdentifier]=a,window["pRTLPCB"+this.uniqueCallbackIdentifier]=b,this.myIFrame=cb.createIFrame_();let c="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(c='<script>document.domain="'+document.domain+'";</script>');const d="<html><body>"+c+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(a){bB("frame writing exception"),a.stack&&bB(a.stack),bB(a)}}}static createIFrame_(){let a=document.createElement("iframe");if(a.style.display="none",document.body){document.body.appendChild(a);try{a.contentWindow.document||bB("No IE domain setting required")}catch(b){a.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let a=this.onDisconnect;a&&(this.onDisconnect=null,a())}startLongPoll(a,b){for(this.myID=a,this.myPW=b,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let a={};a.id=this.myID,a.pw=this.myPW,a.ser=this.currentSerial;let b=this.urlFn(a),c="",d=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+c.length<=1870){let a=this.pendingSegs.shift();c=c+"&seg"+d+"="+a.seg+"&ts"+d+"="+a.ts+"&d"+d+"="+a.d,d++}else break;return b+=c,this.addLongPollTag_(b,this.currentSerial),!0}}enqueueSegment(a,b,c){this.pendingSegs.push({seg:a,ts:b,d:c}),this.alive&&this.newRequest_()}addLongPollTag_(a,b){this.outstandingRequests.add(b);let c=()=>{this.outstandingRequests.delete(b),this.newRequest_()},d=setTimeout(c,Math.floor(25e3));this.addTag(a,()=>{clearTimeout(d),c()})}addTag(a,b){L()?this.doNodeLongPoll(a,b):setTimeout(()=>{try{if(!this.sendNewPolls)return;let c=this.myIFrame.doc.createElement("script");c.type="text/javascript",c.async=!0,c.src=a,c.onload=c.onreadystatechange=function(){let a=c.readyState;a&&"loaded"!==a&&"complete"!==a||(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),b())},c.onerror=()=>{bB("Long-poll script failed to load: "+a),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(c)}catch(a){}},Math.floor(1))}}class cc{static get ALL_TRANSPORTS(){return[ca,b2]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(a){this.initTransports_(a)}initTransports_(a){let b=b2&&b2.isAvailable(),c=b&&!b2.previouslyFailed();if(a.webSocketOnly&&(b||bF("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[b2];else{let a=this.transports_=[];for(let b of cc.ALL_TRANSPORTS)b&&b.isAvailable()&&a.push(b);cc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}cc.globalTransportInitialized_=!1;class cd{constructor(a,b,c,d,e,f,g,h,i,j){this.id=a,this.repoInfo_=b,this.applicationId_=c,this.appCheckToken_=d,this.authToken_=e,this.onMessage_=f,this.onReady_=g,this.onDisconnect_=h,this.onKill_=i,this.lastSessionId=j,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=bC("c:"+this.id+":"),this.transportManager_=new cc(b),this.log_("Connection created"),this.start_()}start_(){let a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(b,c)},Math.floor(0));let d=a.healthyTimeout||0;d>0&&(this.healthyTimeout_=bV(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(d)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(a){return b=>{a===this.conn_?this.onConnectionLost_(b):a===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(a){return b=>{2!==this.state_&&(a===this.rx_?this.onPrimaryMessageReceived_(b):a===this.secondaryConn_?this.onSecondaryMessageReceived_(b):this.log_("message on old connection"))}}sendRequest(a){this.sendData_({t:"d",d:a})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(a){if("t"in a){let b=a.t;"a"===b?this.upgradeIfSecondaryHealthy_():"r"===b?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===b&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(a){let b=bN("t",a),c=bN("d",a);if("c"===b)this.onSecondaryControl_(c);else if("d"===b)this.pendingDataMessages.push(c);else throw Error("Unknown protocol layer: "+b)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(a){let b=bN("t",a),c=bN("d",a);"c"===b?this.onControl_(c):"d"===b&&this.onDataMessage_(c)}onDataMessage_(a){this.onPrimaryResponse_(),this.onMessage_(a)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(a){let b=bN("t",a);if("d"in a){let c=a.d;if("h"===b){let a={...c};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if("n"===b){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===b?this.onConnectionShutdown_(c):"r"===b?this.onReset_(c):"e"===b?bD("Server Error: "+c):"o"===b?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):bD("Unknown control packet command: "+b)}}onHandshake_(a){let b=a.ts,c=a.v,d=a.h;this.sessionId=a.s,this.repoInfo_.host=d,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,b),"5"!==c&&bF("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)}startUpgrade_(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(b,c),bV(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.host=a,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(a,b){this.log_("Realtime connection established."),this.conn_=a,this.state_=1,this.onReady_&&(this.onReady_(b,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):bV(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()}onConnectionLost_(a){this.conn_=null,a||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(bs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(a){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(a)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ce{put(a,b,c,d){}merge(a,b,c,d){}refreshAuthToken(a){}refreshAppCheckToken(a){}onDisconnectPut(a,b,c){}onDisconnectMerge(a,b,c){}onDisconnectCancel(a,b){}reportStats(a){}}class cf{constructor(a){this.allowedEvents_=a,this.listeners_={},s(Array.isArray(a)&&a.length>0,"Requires a non-empty array")}trigger(a,...b){if(Array.isArray(this.listeners_[a])){let c=[...this.listeners_[a]];for(let a=0;a<c.length;a++)c[a].callback.apply(c[a].context,b)}}on(a,b,c){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:b,context:c});let d=this.getInitialEvent(a);d&&b.apply(c,d)}off(a,b,c){this.validateEventType_(a);let d=this.listeners_[a]||[];for(let a=0;a<d.length;a++)if(d[a].callback===b&&(!c||c===d[a].context))return void d.splice(a,1)}validateEventType_(a){s(this.allowedEvents_.find(b=>b===a),"Unknown event: "+a)}}class cg extends cf{static getInstance(){return new cg}constructor(){super(["online"]),this.online_=!0}getInitialEvent(a){return s("online"===a,"Unknown event type: "+a),[this.online_]}currentlyOnline(){return this.online_}}class ch{constructor(a,b){if(void 0===b){this.pieces_=a.split("/");let b=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[b]=this.pieces_[a],b++);this.pieces_.length=b,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=b}toString(){let a="";for(let b=this.pieceNum_;b<this.pieces_.length;b++)""!==this.pieces_[b]&&(a+="/"+this.pieces_[b]);return a||"/"}}function ci(){return new ch("")}function cj(a){return a.pieceNum_>=a.pieces_.length?null:a.pieces_[a.pieceNum_]}function ck(a){return a.pieces_.length-a.pieceNum_}function cl(a){let b=a.pieceNum_;return b<a.pieces_.length&&b++,new ch(a.pieces_,b)}function cm(a){return a.pieceNum_<a.pieces_.length?a.pieces_[a.pieces_.length-1]:null}function cn(a,b=0){return a.pieces_.slice(a.pieceNum_+b)}function co(a){if(a.pieceNum_>=a.pieces_.length)return null;let b=[];for(let c=a.pieceNum_;c<a.pieces_.length-1;c++)b.push(a.pieces_[c]);return new ch(b,0)}function cp(a,b){let c=[];for(let b=a.pieceNum_;b<a.pieces_.length;b++)c.push(a.pieces_[b]);if(b instanceof ch)for(let a=b.pieceNum_;a<b.pieces_.length;a++)c.push(b.pieces_[a]);else{let a=b.split("/");for(let b=0;b<a.length;b++)a[b].length>0&&c.push(a[b])}return new ch(c,0)}function cq(a){return a.pieceNum_>=a.pieces_.length}function cr(a,b){let c=cj(a),d=cj(b);if(null===c)return b;if(c===d)return cr(cl(a),cl(b));throw Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")}function cs(a,b){let c=cn(a,0),d=cn(b,0);for(let a=0;a<c.length&&a<d.length;a++){let b=bL(c[a],d[a]);if(0!==b)return b}return c.length===d.length?0:c.length<d.length?-1:1}function ct(a,b){if(ck(a)!==ck(b))return!1;for(let c=a.pieceNum_,d=b.pieceNum_;c<=a.pieces_.length;c++,d++)if(a.pieces_[c]!==b.pieces_[d])return!1;return!0}function cu(a,b){let c=a.pieceNum_,d=b.pieceNum_;if(ck(a)>ck(b))return!1;for(;c<a.pieces_.length;){if(a.pieces_[c]!==b.pieces_[d])return!1;++c,++d}return!0}class cv{constructor(a,b){this.errorPrefix_=b,this.parts_=cn(a,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=ag(this.parts_[a]);cw(this)}}function cw(a){if(a.byteLength_>768)throw Error(a.errorPrefix_+"has a key path longer than 768 bytes ("+a.byteLength_+").");if(a.parts_.length>32)throw Error(a.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+cx(a))}function cx(a){return 0===a.parts_.length?"":"in property '"+a.parts_.join(".")+"'"}class cy extends cf{static getInstance(){return new cy}constructor(){let a,b;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(b="visibilitychange",a="hidden"):void 0!==document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):void 0!==document.msHidden?(b="msvisibilitychange",a="msHidden"):void 0!==document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,b&&document.addEventListener(b,()=>{let b=!document[a];b!==this.visible_&&(this.visible_=b,this.trigger("visible",b))},!1)}getInitialEvent(a){return s("visible"===a,"Unknown event type: "+a),[this.visible_]}}class cz extends ce{constructor(a,b,c,d,e,f,g,h){if(super(),this.repoInfo_=a,this.applicationId_=b,this.onDataUpdate_=c,this.onConnectStatus_=d,this.onServerInfoUpdate_=e,this.authTokenProvider_=f,this.appCheckTokenProvider_=g,this.authOverride_=h,this.id=cz.nextPersistentConnectionId_++,this.log_=bC("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!L())throw Error("Auth override specified in options, but not supported on non Node.js platforms");cy.getInstance().on("visible",this.onVisible_,this),-1===a.host.indexOf("fblocal")&&cg.getInstance().on("online",this.onOnline_,this)}sendRequest(a,b,c){let d=++this.requestNumber_,e={r:d,a:a,b:b};this.log_(Q(e)),s(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),c&&(this.requestCBHash_[d]=c)}get(a){this.initConnection_();let b=new E,c={p:a._path.toString(),q:a._queryObject};this.outstandingGets_.push({action:"g",request:c,onComplete:a=>{let c=a.d;"ok"===a.s?b.resolve(c):b.reject(c)}}),this.outstandingGetCount_++;let d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),b.promise}listen(a,b,c,d){this.initConnection_();let e=a._queryIdentifier,f=a._path.toString();this.log_("Listen called for "+f+" "+e),this.listens.has(f)||this.listens.set(f,new Map),s(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"listen() called for non-default but complete query"),s(!this.listens.get(f).has(e),"listen() called twice for same path/queryId.");let g={onComplete:d,hashFn:b,query:a,tag:c};this.listens.get(f).set(e,g),this.connected_&&this.sendListen_(g)}sendGet_(a){let b=this.outstandingGets_[a];this.sendRequest("g",b.request,c=>{delete this.outstandingGets_[a],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),b.onComplete&&b.onComplete(c)})}sendListen_(a){let b=a.query,c=b._path.toString(),d=b._queryIdentifier;this.log_("Listen on "+c+" for "+d);let e={p:c};a.tag&&(e.q=b._queryObject,e.t=a.tag),e.h=a.hashFn(),this.sendRequest("q",e,e=>{let f=e.d,g=e.s;cz.warnOnListenWarnings_(f,b),(this.listens.get(c)&&this.listens.get(c).get(d))===a&&(this.log_("listen response",e),"ok"!==g&&this.removeListen_(c,d),a.onComplete&&a.onComplete(g,f))})}static warnOnListenWarnings_(a,b){if(a&&"object"==typeof a&&U(a,"w")){let c=V(a,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){let a='".indexOn": "'+b._queryParams.getIndex().toString()+'"',c=b._path.toString();bF(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(a){this.authToken_=a,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(a)}reduceReconnectDelayIfAdminCredential_(a){(a&&40===a.length||T(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(a){this.appCheckToken_=a,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let a=this.authToken_,b=S(a)?"auth":"gauth",c={cred:a};null===this.authOverride_?c.noauth=!0:"object"==typeof this.authOverride_&&(c.authvar=this.authOverride_),this.sendRequest(b,c,b=>{let c=b.s,d=b.d||"error";this.authToken_===a&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},a=>{let b=a.s,c=a.d||"error";"ok"===b?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(b,c)})}unlisten(a,b){let c=a._path.toString(),d=a._queryIdentifier;this.log_("Unlisten called for "+c+" "+d),s(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,d)&&this.connected_&&this.sendUnlisten_(c,d,a._queryObject,b)}sendUnlisten_(a,b,c,d){this.log_("Unlisten on "+a+" for "+b);let e={p:a};d&&(e.q=c,e.t=d),this.sendRequest("n",e)}onDisconnectPut(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:b,onComplete:c})}onDisconnectMerge(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:b,onComplete:c})}onDisconnectCancel(a,b){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",a,null,b):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:b})}sendOnDisconnect_(a,b,c,d){let e={p:b,d:c};this.log_("onDisconnect "+a,e),this.sendRequest(a,e,a=>{d&&setTimeout(()=>{d(a.s,a.d)},Math.floor(0))})}put(a,b,c,d){this.putInternal("p",a,b,c,d)}merge(a,b,c,d){this.putInternal("m",a,b,c,d)}putInternal(a,b,c,d,e){this.initConnection_();let f={p:b,d:c};void 0!==e&&(f.h=e),this.outstandingPuts_.push({action:a,request:f,onComplete:d}),this.outstandingPutCount_++;let g=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(g):this.log_("Buffering put: "+b)}sendPut_(a){let b=this.outstandingPuts_[a].action,c=this.outstandingPuts_[a].request,d=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(b,c,c=>{this.log_(b+" response",c),delete this.outstandingPuts_[a],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),d&&d(c.s,c.d)})}reportStats(a){if(this.connected_){let b={c:a};this.log_("reportStats",b),this.sendRequest("s",b,a=>{if("ok"!==a.s){let b=a.d;this.log_("reportStats","Error sending stats: "+b)}})}}onDataMessage_(a){if("r"in a){this.log_("from server: "+Q(a));let b=a.r,c=this.requestCBHash_[b];c&&(delete this.requestCBHash_[b],c(a.b))}else if("error"in a)throw"A server-side error has occurred: "+a.error;else"a"in a&&this.onDataPush_(a.a,a.b)}onDataPush_(a,b){this.log_("handleServerMessage",a,b),"d"===a?this.onDataUpdate_(b.p,b.d,!1,b.t):"m"===a?this.onDataUpdate_(b.p,b.d,!0,b.t):"c"===a?this.onListenRevoked_(b.p,b.q):"ac"===a?this.onAuthRevoked_(b.s,b.d):"apc"===a?this.onAppCheckRevoked_(b.s,b.d):"sd"===a?this.onSecurityDebugPacket_(b):bD("Unrecognized action received from server: "+Q(a)+"\nAre you using the latest client?")}onReady_(a,b){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(a),this.lastSessionId=b,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(a){s(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(a))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=a}onOnline_(a){a?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let a=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),b=Math.max(0,this.reconnectDelay_-a);b=Math.random()*b,this.log_("Trying to reconnect in "+b+"ms"),this.scheduleConnect_(b),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let a=this.onDataMessage_.bind(this),b=this.onReady_.bind(this),c=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+cz.nextConnectionId_++,e=this.lastSessionId,f=!1,g=null,h=function(){g?g.close():(f=!0,c())};this.realtime_={close:h,sendRequest:function(a){s(g,"sendRequest call when we're not connected not allowed."),g.sendRequest(a)}};let i=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,j]=await Promise.all([this.authTokenProvider_.getToken(i),this.appCheckTokenProvider_.getToken(i)]);f?bB("getToken() completed but was canceled"):(bB("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=j&&j.token,g=new cd(d,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,a,b,c,a=>{bF(a+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},e))}catch(a){this.log_("Failed to get token: "+a),f||(this.repoInfo_.nodeAdmin&&bF(a),h())}}}interrupt(a){bB("Interrupting connection for reason: "+a),this.interruptReasons_[a]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(a){bB("Resuming connection for reason: "+a),delete this.interruptReasons_[a],W(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(a){let b=a-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:b})}cancelSentTransactions_(){for(let a=0;a<this.outstandingPuts_.length;a++){let b=this.outstandingPuts_[a];b&&"h"in b.request&&b.queued&&(b.onComplete&&b.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(a,b){let c;c=b?b.map(a=>bO(a)).join("$"):"default";let d=this.removeListen_(a,c);d&&d.onComplete&&d.onComplete("permission_denied")}removeListen_(a,b){let c,d=new ch(a).toString();if(this.listens.has(d)){let a=this.listens.get(d);c=a.get(b),a.delete(b),0===a.size&&this.listens.delete(d)}else c=void 0;return c}onAuthRevoked_(a,b){bB("Auth token revoked: "+a+"/"+b),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===a||"permission_denied"===a)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(a,b){bB("App check token revoked: "+a+"/"+b),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===a||"permission_denied"===a)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&console.log("FIREBASE: "+a.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let a of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let b of a.values())this.sendListen_(b);for(let a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){let a=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(a.action,a.pathString,a.data,a.onComplete)}for(let a=0;a<this.outstandingGets_.length;a++)this.outstandingGets_[a]&&this.sendGet_(a)}sendConnectStats_(){let a={},b="js";L()&&(b=this.repoInfo_.nodeAdmin?"admin_node":"node"),a["sdk."+b+"."+b0.replace(/\./g,"-")]=1,K()&&(a["framework.reactnative"]=1),this.reportStats(a)}shouldReconnect_(){let a=cg.getInstance().currentlyOnline();return W(this.interruptReasons_)&&a}}cz.nextPersistentConnectionId_=0,cz.nextConnectionId_=0;class cA{constructor(a,b){this.name=a,this.node=b}static Wrap(a,b){return new cA(a,b)}}class cB{getCompare(){return this.compare.bind(this)}indexedValueChanged(a,b){let c=new cA(bJ,a),d=new cA(bJ,b);return 0!==this.compare(c,d)}minPost(){return cA.MIN}}class cC extends cB{static get __EMPTY_NODE(){return e}static set __EMPTY_NODE(a){e=a}compare(a,b){return bL(a.name,b.name)}isDefinedOn(a){throw t("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(a,b){return!1}minPost(){return cA.MIN}maxPost(){return new cA(bK,e)}makePost(a,b){return s("string"==typeof a,"KeyIndex indexValue must always be a string."),new cA(a,e)}toString(){return".key"}}let cD=new cC;class cE{constructor(a,b,c,d,e=null){this.isReverse_=d,this.resultGenerator_=e,this.nodeStack_=[];let f=1;for(;!a.isEmpty();)if(f=b?c(a.key,b):1,d&&(f*=-1),f<0)a=this.isReverse_?a.left:a.right;else if(0===f){this.nodeStack_.push(a);break}else this.nodeStack_.push(a),a=this.isReverse_?a.right:a.left}getNext(){let a;if(0===this.nodeStack_.length)return null;let b=this.nodeStack_.pop();if(a=this.resultGenerator_?this.resultGenerator_(b.key,b.value):{key:b.key,value:b.value},this.isReverse_)for(b=b.left;!b.isEmpty();)this.nodeStack_.push(b),b=b.right;else for(b=b.right;!b.isEmpty();)this.nodeStack_.push(b),b=b.left;return a}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let a=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}}}class cF{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:cF.RED,this.left=null!=d?d:cG.EMPTY_NODE,this.right=null!=e?e:cG.EMPTY_NODE}copy(a,b,c,d,e){return new cF(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||!!a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp_()}removeMin_(){if(this.left.isEmpty())return cG.EMPTY_NODE;let a=this;return a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),(a=a.copy(null,null,null,a.left.removeMin_(),null)).fixUp_()}remove(a,b){let c,d;if(c=this,0>b(a,c.key))c.left.isEmpty()||c.left.isRed_()||c.left.left.isRed_()||(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(a,b),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),c.right.isEmpty()||c.right.isRed_()||c.right.left.isRed_()||(c=c.moveRedRight_()),0===b(a,c.key))if(c.right.isEmpty())return cG.EMPTY_NODE;else d=c.right.min_(),c=c.copy(d.key,d.value,null,null,c.right.removeMin_());c=c.copy(null,null,null,null,c.right.remove(a,b))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a}moveRedLeft_(){let a=this.colorFlip_();return a.right.left.isRed_()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight_())).rotateLeft_()).colorFlip_()),a}moveRedRight_(){let a=this.colorFlip_();return a.left.left.isRed_()&&(a=(a=a.rotateRight_()).colorFlip_()),a}rotateLeft_(){let a=this.copy(null,null,cF.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight_(){let a=this.copy(null,null,cF.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip_(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let a=this.left.check_();if(a===this.right.check_())return a+ +!this.isRed_();throw Error("Black depths differ")}}cF.RED=!0,cF.BLACK=!1;class cG{constructor(a,b=cG.EMPTY_NODE){this.comparator_=a,this.root_=b}insert(a,b){return new cG(this.comparator_,this.root_.insert(a,b,this.comparator_).copy(null,null,cF.BLACK,null,null))}remove(a){return new cG(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,cF.BLACK,null,null))}get(a){let b,c=this.root_;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))return c.value;b<0?c=c.left:b>0&&(c=c.right)}return null}getPredecessorKey(a){let b,c=this.root_,d=null;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))if(c.left.isEmpty())if(d)return d.key;else return null;else{for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}b<0?c=c.left:b>0&&(d=c,c=c.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(a){return this.root_.inorderTraversal(a)}reverseTraversal(a){return this.root_.reverseTraversal(a)}getIterator(a){return new cE(this.root_,null,this.comparator_,!1,a)}getIteratorFrom(a,b){return new cE(this.root_,a,this.comparator_,!1,b)}getReverseIteratorFrom(a,b){return new cE(this.root_,a,this.comparator_,!0,b)}getReverseIterator(a){return new cE(this.root_,null,this.comparator_,!0,a)}}function cH(a,b){return bL(a.name,b.name)}function cI(a,b){return bL(a,b)}cG.EMPTY_NODE=new class{copy(a,b,c,d,e){return this}insert(a,b,c){return new cF(a,b,null)}remove(a,b){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let cJ=function(a){return"number"==typeof a?"number:"+bR(a):"string:"+a},cK=function(a){if(a.isLeafNode()){let b=a.val();s("string"==typeof b||"number"==typeof b||"object"==typeof b&&U(b,".sv"),"Priority must be a string or number.")}else s(a===f||a.isEmpty(),"priority of unexpected type.");s(a===f||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class cL{static set __childrenNodeConstructor(a){g=a}static get __childrenNodeConstructor(){return g}constructor(a,b=cL.__childrenNodeConstructor.EMPTY_NODE){this.value_=a,this.priorityNode_=b,this.lazyHash_=null,s(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),cK(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(a){return new cL(this.value_,a)}getImmediateChild(a){return".priority"===a?this.priorityNode_:cL.__childrenNodeConstructor.EMPTY_NODE}getChild(a){return cq(a)?this:".priority"===cj(a)?this.priorityNode_:cL.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(a,b){return null}updateImmediateChild(a,b){return".priority"===a?this.updatePriority(b):b.isEmpty()&&".priority"!==a?this:cL.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(a,b).updatePriority(this.priorityNode_)}updateChild(a,b){let c=cj(a);return null===c?b:b.isEmpty()&&".priority"!==c?this:(s(".priority"!==c||1===ck(a),".priority must be the last token in a path"),this.updateImmediateChild(c,cL.__childrenNodeConstructor.EMPTY_NODE.updateChild(cl(a),b)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(a,b){return!1}val(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let a="";this.priorityNode_.isEmpty()||(a+="priority:"+cJ(this.priorityNode_.val())+":");let b=typeof this.value_;a+=b+":","number"===b?a+=bR(this.value_):a+=this.value_,this.lazyHash_=bw(a)}return this.lazyHash_}getValue(){return this.value_}compareTo(a){return a===cL.__childrenNodeConstructor.EMPTY_NODE?1:a instanceof cL.__childrenNodeConstructor?-1:(s(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))}compareToLeafNode_(a){let b=typeof a.value_,c=typeof this.value_,d=cL.VALUE_TYPE_ORDER.indexOf(b),e=cL.VALUE_TYPE_ORDER.indexOf(c);return(s(d>=0,"Unknown leaf type: "+b),s(e>=0,"Unknown leaf type: "+c),d!==e)?e-d:"object"===c?0:this.value_<a.value_?-1:1*(this.value_!==a.value_)}withIndex(){return this}isIndexed(){return!0}equals(a){return a===this||!!a.isLeafNode()&&this.value_===a.value_&&this.priorityNode_.equals(a.priorityNode_)}}cL.VALUE_TYPE_ORDER=["object","boolean","number","string"];let cM=new class extends cB{compare(a,b){let c=a.node.getPriority(),d=b.node.getPriority(),e=c.compareTo(d);return 0===e?bL(a.name,b.name):e}isDefinedOn(a){return!a.getPriority().isEmpty()}indexedValueChanged(a,b){return!a.getPriority().equals(b.getPriority())}minPost(){return cA.MIN}maxPost(){return new cA(bK,new cL("[PRIORITY-POST]",i))}makePost(a,b){return new cA(b,new cL("[PRIORITY-POST]",h(a)))}toString(){return".priority"}},cN=Math.log(2);class cO{constructor(a){this.count=(a=>parseInt(Math.log(a)/cN,10))(a+1),this.current_=this.count-1;const b=(a=>parseInt(Array(a+1).join("1"),2))(this.count);this.bits_=a+1&b}nextBitIsOne(){let a=!(this.bits_&1<<this.current_);return this.current_--,a}}let cP=function(a,b,c,d){a.sort(b);let e=function(b,d){let f,g=d-b;if(0===g)return null;if(1===g)return f=a[b],new cF(c?c(f):f,f.node,cF.BLACK,null,null);{let h=parseInt(g/2,10)+b,i=e(b,h),j=e(h+1,d);return f=a[h],new cF(c?c(f):f,f.node,cF.BLACK,i,j)}};return new cG(d||b,function(b){let d=null,f=null,g=a.length,h=function(b,d){let f=g-b,h=g;g-=b;let j=e(f+1,h),k=a[f];i(new cF(c?c(k):k,k.node,d,null,j))},i=function(a){d?d.left=a:f=a,d=a};for(let a=0;a<b.count;++a){let c=b.nextBitIsOne(),d=Math.pow(2,b.count-(a+1));c?h(d,cF.BLACK):(h(d,cF.BLACK),h(d,cF.RED))}return f}(new cO(a.length)))},cQ={};class cR{static get Default(){return s(cQ&&cM,"ChildrenNode.ts has not been loaded"),j=j||new cR({".priority":cQ},{".priority":cM})}constructor(a,b){this.indexes_=a,this.indexSet_=b}get(a){let b=V(this.indexes_,a);if(!b)throw Error("No index defined for "+a);return b instanceof cG?b:null}hasIndex(a){return U(this.indexSet_,a.toString())}addIndex(a,b){let c;s(a!==cD,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let d=[],e=!1,f=b.getIterator(cA.Wrap),g=f.getNext();for(;g;)e=e||a.isDefinedOn(g.node),d.push(g),g=f.getNext();c=e?cP(d,a.getCompare()):cQ;let h=a.toString(),i={...this.indexSet_};i[h]=a;let j={...this.indexes_};return j[h]=c,new cR(j,i)}addToIndexes(a,b){return new cR(X(this.indexes_,(c,d)=>{let e=V(this.indexSet_,d);if(s(e,"Missing index implementation for "+d),c===cQ)if(!e.isDefinedOn(a.node))return cQ;else{let c=[],d=b.getIterator(cA.Wrap),f=d.getNext();for(;f;)f.name!==a.name&&c.push(f),f=d.getNext();return c.push(a),cP(c,e.getCompare())}{let d=b.get(a.name),e=c;return d&&(e=e.remove(new cA(a.name,d))),e.insert(a,a.node)}}),this.indexSet_)}removeFromIndexes(a,b){return new cR(X(this.indexes_,c=>{if(c===cQ)return c;{let d=b.get(a.name);return d?c.remove(new cA(a.name,d)):c}}),this.indexSet_)}}class cS{static get EMPTY_NODE(){return k||(k=new cS(new cG(cI),null,cR.Default))}constructor(a,b,c){this.children_=a,this.priorityNode_=b,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&cK(this.priorityNode_),this.children_.isEmpty()&&s(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||k}updatePriority(a){return this.children_.isEmpty()?this:new cS(this.children_,a,this.indexMap_)}getImmediateChild(a){if(".priority"===a)return this.getPriority();{let b=this.children_.get(a);return null===b?k:b}}getChild(a){let b=cj(a);return null===b?this:this.getImmediateChild(b).getChild(cl(a))}hasChild(a){return null!==this.children_.get(a)}updateImmediateChild(a,b){if(s(b,"We should always be passing snapshot nodes"),".priority"===a)return this.updatePriority(b);{let c,d,e=new cA(a,b);b.isEmpty()?(c=this.children_.remove(a),d=this.indexMap_.removeFromIndexes(e,this.children_)):(c=this.children_.insert(a,b),d=this.indexMap_.addToIndexes(e,this.children_));let f=c.isEmpty()?k:this.priorityNode_;return new cS(c,f,d)}}updateChild(a,b){let c=cj(a);if(null===c)return b;{s(".priority"!==cj(a)||1===ck(a),".priority must be the last token in a path");let d=this.getImmediateChild(c).updateChild(cl(a),b);return this.updateImmediateChild(c,d)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(a){if(this.isEmpty())return null;let b={},c=0,d=0,e=!0;if(this.forEachChild(cM,(f,g)=>{b[f]=g.val(a),c++,e&&cS.INTEGER_REGEXP_.test(f)?d=Math.max(d,Number(f)):e=!1}),a||!e||!(d<2*c))return a&&!this.getPriority().isEmpty()&&(b[".priority"]=this.getPriority().val()),b;{let a=[];for(let c in b)a[c]=b[c];return a}}hash(){if(null===this.lazyHash_){let a="";this.getPriority().isEmpty()||(a+="priority:"+cJ(this.getPriority().val())+":"),this.forEachChild(cM,(b,c)=>{let d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.lazyHash_=""===a?"":bw(a)}return this.lazyHash_}getPredecessorChildName(a,b,c){let d=this.resolveIndex_(c);if(!d)return this.children_.getPredecessorKey(a);{let c=d.getPredecessorKey(new cA(a,b));return c?c.name:null}}getFirstChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.minKey();{let a=b.minKey();return a&&a.name}}getFirstChild(a){let b=this.getFirstChildName(a);return b?new cA(b,this.children_.get(b)):null}getLastChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.maxKey();{let a=b.maxKey();return a&&a.name}}getLastChild(a){let b=this.getLastChildName(a);return b?new cA(b,this.children_.get(b)):null}forEachChild(a,b){let c=this.resolveIndex_(a);return c?c.inorderTraversal(a=>b(a.name,a.node)):this.children_.inorderTraversal(b)}getIterator(a){return this.getIteratorFrom(a.minPost(),a)}getIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getIteratorFrom(a,a=>a);{let c=this.children_.getIteratorFrom(a.name,cA.Wrap),d=c.peek();for(;null!=d&&0>b.compare(d,a);)c.getNext(),d=c.peek();return c}}getReverseIterator(a){return this.getReverseIteratorFrom(a.maxPost(),a)}getReverseIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getReverseIteratorFrom(a,a=>a);{let c=this.children_.getReverseIteratorFrom(a.name,cA.Wrap),d=c.peek();for(;null!=d&&b.compare(d,a)>0;)c.getNext(),d=c.peek();return c}}compareTo(a){if(this.isEmpty())if(a.isEmpty())return 0;else return -1;return a.isLeafNode()||a.isEmpty()?1:a===cT?-1:0}withIndex(a){if(a===cD||this.indexMap_.hasIndex(a))return this;{let b=this.indexMap_.addIndex(a,this.children_);return new cS(this.children_,this.priorityNode_,b)}}isIndexed(a){return a===cD||this.indexMap_.hasIndex(a)}equals(a){if(a===this)return!0;if(a.isLeafNode()||!this.getPriority().equals(a.getPriority()))return!1;if(this.children_.count()!==a.children_.count())return!1;{let b=this.getIterator(cM),c=a.getIterator(cM),d=b.getNext(),e=c.getNext();for(;d&&e;){if(d.name!==e.name||!d.node.equals(e.node))return!1;d=b.getNext(),e=c.getNext()}return null===d&&null===e}}resolveIndex_(a){return a===cD?null:this.indexMap_.get(a.toString())}}cS.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let cT=new class extends cS{constructor(){super(new cG(cI),cS.EMPTY_NODE,cR.Default)}compareTo(a){return+(a!==this)}equals(a){return a===this}getPriority(){return this}getImmediateChild(a){return cS.EMPTY_NODE}isEmpty(){return!1}};function cU(a,b=null){if(null===a)return cS.EMPTY_NODE;if("object"==typeof a&&".priority"in a&&(b=a[".priority"]),s(null===b||"string"==typeof b||"number"==typeof b||"object"==typeof b&&".sv"in b,"Invalid priority type found: "+typeof b),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new cL(a,cU(b));if(a instanceof Array){let c=cS.EMPTY_NODE;return bQ(a,(b,d)=>{if(U(a,b)&&"."!==b.substring(0,1)){let a=cU(d);(a.isLeafNode()||!a.isEmpty())&&(c=c.updateImmediateChild(b,a))}}),c.updatePriority(cU(b))}{let c=[],d=!1;if(bQ(a,(a,b)=>{if("."!==a.substring(0,1)){let e=cU(b);e.isEmpty()||(d=d||!e.getPriority().isEmpty(),c.push(new cA(a,e)))}}),0===c.length)return cS.EMPTY_NODE;let e=cP(c,cH,a=>a.name,cI);if(!d)return new cS(e,cU(b),cR.Default);{let a=cP(c,cM.getCompare());return new cS(e,cU(b),new cR({".priority":a},{".priority":cM}))}}}Object.defineProperties(cA,{MIN:{value:new cA(bJ,cS.EMPTY_NODE)},MAX:{value:new cA(bK,cT)}}),cC.__EMPTY_NODE=cS.EMPTY_NODE,cL.__childrenNodeConstructor=cS,f=cT,i=cT,h=cU;class cV extends cB{constructor(a){super(),this.indexPath_=a,s(!cq(a)&&".priority"!==cj(a),"Can't create PathIndex with empty path or .priority key")}extractChild(a){return a.getChild(this.indexPath_)}isDefinedOn(a){return!a.getChild(this.indexPath_).isEmpty()}compare(a,b){let c=this.extractChild(a.node),d=this.extractChild(b.node),e=c.compareTo(d);return 0===e?bL(a.name,b.name):e}makePost(a,b){let c=cU(a);return new cA(b,cS.EMPTY_NODE.updateChild(this.indexPath_,c))}maxPost(){return new cA(bK,cS.EMPTY_NODE.updateChild(this.indexPath_,cT))}toString(){return cn(this.indexPath_,0).join("/")}}let cW=new class extends cB{compare(a,b){let c=a.node.compareTo(b.node);return 0===c?bL(a.name,b.name):c}isDefinedOn(a){return!0}indexedValueChanged(a,b){return!a.equals(b)}minPost(){return cA.MIN}maxPost(){return cA.MAX}makePost(a,b){return new cA(b,cU(a))}toString(){return".value"}};function cX(a){return{type:"value",snapshotNode:a}}function cY(a,b){return{type:"child_added",snapshotNode:b,childName:a}}function cZ(a,b){return{type:"child_removed",snapshotNode:b,childName:a}}function c$(a,b,c){return{type:"child_changed",snapshotNode:b,childName:a,oldSnap:c}}class c_{constructor(a){this.index_=a}updateChild(a,b,c,d,e,f){s(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");let g=a.getImmediateChild(b);return g.getChild(d).equals(c.getChild(d))&&g.isEmpty()===c.isEmpty()||(null!=f&&(c.isEmpty()?a.hasChild(b)?f.trackChildChange(cZ(b,g)):s(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):g.isEmpty()?f.trackChildChange(cY(b,c)):f.trackChildChange(c$(b,c,g))),a.isLeafNode()&&c.isEmpty())?a:a.updateImmediateChild(b,c).withIndex(this.index_)}updateFullNode(a,b,c){return null!=c&&(a.isLeafNode()||a.forEachChild(cM,(a,d)=>{b.hasChild(a)||c.trackChildChange(cZ(a,d))}),b.isLeafNode()||b.forEachChild(cM,(b,d)=>{if(a.hasChild(b)){let e=a.getImmediateChild(b);e.equals(d)||c.trackChildChange(c$(b,d,e))}else c.trackChildChange(cY(b,d))})),b.withIndex(this.index_)}updatePriority(a,b){return a.isEmpty()?cS.EMPTY_NODE:a.updatePriority(b)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class c0{constructor(a){this.indexedFilter_=new c_(a.getIndex()),this.index_=a.getIndex(),this.startPost_=c0.getStartPost_(a),this.endPost_=c0.getEndPost_(a),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(a){let b=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),a):0>this.index_.compare(this.getStartPost(),a),c=this.endIsInclusive_?0>=this.index_.compare(a,this.getEndPost()):0>this.index_.compare(a,this.getEndPost());return b&&c}updateChild(a,b,c,d,e,f){return this.matches(new cA(b,c))||(c=cS.EMPTY_NODE),this.indexedFilter_.updateChild(a,b,c,d,e,f)}updateFullNode(a,b,c){b.isLeafNode()&&(b=cS.EMPTY_NODE);let d=b.withIndex(this.index_);d=d.updatePriority(cS.EMPTY_NODE);let e=this;return b.forEachChild(cM,(a,b)=>{e.matches(new cA(a,b))||(d=d.updateImmediateChild(a,cS.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(a){if(!a.hasStart())return a.getIndex().minPost();{let b=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),b)}}static getEndPost_(a){if(!a.hasEnd())return a.getIndex().maxPost();{let b=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),b)}}}class c1{constructor(a){this.withinDirectionalStart=a=>this.reverse_?this.withinEndPost(a):this.withinStartPost(a),this.withinDirectionalEnd=a=>this.reverse_?this.withinStartPost(a):this.withinEndPost(a),this.withinStartPost=a=>{let b=this.index_.compare(this.rangedFilter_.getStartPost(),a);return this.startIsInclusive_?b<=0:b<0},this.withinEndPost=a=>{let b=this.index_.compare(a,this.rangedFilter_.getEndPost());return this.endIsInclusive_?b<=0:b<0},this.rangedFilter_=new c0(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft(),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}updateChild(a,b,c,d,e,f){return(this.rangedFilter_.matches(new cA(b,c))||(c=cS.EMPTY_NODE),a.getImmediateChild(b).equals(c))?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,b,c,d,e,f):this.fullLimitUpdateChild_(a,b,c,e,f)}updateFullNode(a,b,c){let d;if(b.isLeafNode()||b.isEmpty())d=cS.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<b.numChildren()&&b.isIndexed(this.index_)){let a;d=cS.EMPTY_NODE.withIndex(this.index_),a=this.reverse_?b.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):b.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;a.hasNext()&&c<this.limit_;){let b=a.getNext();if(this.withinDirectionalStart(b))if(this.withinDirectionalEnd(b))d=d.updateImmediateChild(b.name,b.node),c++;else break}}else{let a;d=(d=b.withIndex(this.index_)).updatePriority(cS.EMPTY_NODE),a=this.reverse_?d.getReverseIterator(this.index_):d.getIterator(this.index_);let c=0;for(;a.hasNext();){let b=a.getNext();c<this.limit_&&this.withinDirectionalStart(b)&&this.withinDirectionalEnd(b)?c++:d=d.updateImmediateChild(b.name,cS.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(a,b,c,d,e){let f;if(this.reverse_){let a=this.index_.getCompare();f=(b,c)=>a(c,b)}else f=this.index_.getCompare();s(a.numChildren()===this.limit_,"");let g=new cA(b,c),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),i=this.rangedFilter_.matches(g);if(a.hasChild(b)){let j=a.getImmediateChild(b),k=d.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=k&&(k.name===b||a.hasChild(k.name));)k=d.getChildAfterChild(this.index_,k,this.reverse_);let l=null==k?1:f(k,g);if(i&&!c.isEmpty()&&l>=0)return null!=e&&e.trackChildChange(c$(b,c,j)),a.updateImmediateChild(b,c);{null!=e&&e.trackChildChange(cZ(b,j));let c=a.updateImmediateChild(b,cS.EMPTY_NODE);return null!=k&&this.rangedFilter_.matches(k)?(null!=e&&e.trackChildChange(cY(k.name,k.node)),c.updateImmediateChild(k.name,k.node)):c}}return c.isEmpty()?a:i?f(h,g)>=0?(null!=e&&(e.trackChildChange(cZ(h.name,h.node)),e.trackChildChange(cY(b,c))),a.updateImmediateChild(b,c).updateImmediateChild(h.name,cS.EMPTY_NODE)):a:a}}class c2{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=cM}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return s(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(s(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:bJ}hasEnd(){return this.endSet_}getIndexEndValue(){return s(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(s(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:bK}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return s(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===cM}copy(){let a=new c2;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.startAfterSet_=this.startAfterSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.endBeforeSet_=this.endBeforeSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a.viewFrom_=this.viewFrom_,a}}function c3(a){let b,c={};if(a.isDefault())return c;if(a.index_===cM?b="$priority":a.index_===cW?b="$value":a.index_===cD?b="$key":(s(a.index_ instanceof cV,"Unrecognized index type!"),b=a.index_.toString()),c.orderBy=Q(b),a.startSet_){let b=a.startAfterSet_?"startAfter":"startAt";c[b]=Q(a.indexStartValue_),a.startNameSet_&&(c[b]+=","+Q(a.indexStartName_))}if(a.endSet_){let b=a.endBeforeSet_?"endBefore":"endAt";c[b]=Q(a.indexEndValue_),a.endNameSet_&&(c[b]+=","+Q(a.indexEndName_))}return a.limitSet_&&(a.isViewFromLeft()?c.limitToFirst=a.limit_:c.limitToLast=a.limit_),c}function c4(a){let b={};if(a.startSet_&&(b.sp=a.indexStartValue_,a.startNameSet_&&(b.sn=a.indexStartName_),b.sin=!a.startAfterSet_),a.endSet_&&(b.ep=a.indexEndValue_,a.endNameSet_&&(b.en=a.indexEndName_),b.ein=!a.endBeforeSet_),a.limitSet_){b.l=a.limit_;let c=a.viewFrom_;""===c&&(c=a.isViewFromLeft()?"l":"r"),b.vf=c}return a.index_!==cM&&(b.i=a.index_.toString()),b}class c5 extends ce{reportStats(a){throw Error("Method not implemented.")}static getListenId_(a,b){return void 0!==b?"tag$"+b:(s(a._queryParams.isDefault(),"should have a tag if it's not a default query."),a._path.toString())}constructor(a,b,c,d){super(),this.repoInfo_=a,this.onDataUpdate_=b,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.log_=bC("p:rest:"),this.listens_={}}listen(a,b,c,d){let e=a._path.toString();this.log_("Listen called for "+e+" "+a._queryIdentifier);let f=c5.getListenId_(a,c),g={};this.listens_[f]=g;let h=c3(a._queryParams);this.restRequest_(e+".json",h,(a,b)=>{let h=b;(404===a&&(h=null,a=null),null===a&&this.onDataUpdate_(e,h,!1,c),V(this.listens_,f)===g)&&d(a?401===a?"permission_denied":"rest_error:"+a:"ok",null)})}unlisten(a,b){let c=c5.getListenId_(a,b);delete this.listens_[c]}get(a){let b=c3(a._queryParams),c=a._path.toString(),d=new E;return this.restRequest_(c+".json",b,(a,b)=>{let e=b;404===a&&(e=null,a=null),null===a?(this.onDataUpdate_(c,e,!1,null),d.resolve(e)):d.reject(Error(e))}),d.promise}refreshAuthToken(a){}restRequest_(a,b={},c){return b.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([d,e])=>{d&&d.accessToken&&(b.auth=d.accessToken),e&&e.token&&(b.ac=e.token);let f=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+a+"?ns="+this.repoInfo_.namespace+$(b);this.log_("Sending REST request for "+f);let g=new XMLHttpRequest;g.onreadystatechange=()=>{if(c&&4===g.readyState){this.log_("REST Response for "+f+" received. status:",g.status,"response:",g.responseText);let a=null;if(g.status>=200&&g.status<300){try{a=P(g.responseText)}catch(a){bF("Failed to parse JSON response for "+f+": "+g.responseText)}c(null,a)}else 401!==g.status&&404!==g.status&&bF("Got unsuccessful REST response for "+f+" Status: "+g.status),c(g.status);c=null}},g.open("GET",f,!0),g.send()})}}class c6{constructor(){this.rootNode_=cS.EMPTY_NODE}getNode(a){return this.rootNode_.getChild(a)}updateSnapshot(a,b){this.rootNode_=this.rootNode_.updateChild(a,b)}}function c7(){return{value:null,children:new Map}}function c8(a,b,c){var d,e;null!==a.value?c(b,a.value):(d=a,e=(a,d)=>{c8(d,new ch(b.toString()+"/"+a),c)},d.children.forEach((a,b)=>{e(b,a)}))}class c9{constructor(a){this.collection_=a,this.last_=null}get(){let a=this.collection_.get(),b={...a};return this.last_&&bQ(this.last_,(a,c)=>{b[a]=b[a]-c}),this.last_=a,b}}class da{constructor(a,b){this.server_=b,this.statsToReport_={},this.statsListener_=new c9(a);const c=1e4+2e4*Math.random();bV(this.reportStats_.bind(this),Math.floor(c))}reportStats_(){let a=this.statsListener_.get(),b={},c=!1;bQ(a,(a,d)=>{d>0&&U(this.statsToReport_,a)&&(b[a]=d,c=!0)}),c&&this.server_.reportStats(b),bV(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function db(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function dc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function dd(a){return{fromUser:!1,fromServer:!0,queryId:a,tagged:!0}}(bk=bj||(bj={}))[bk.OVERWRITE=0]="OVERWRITE",bk[bk.MERGE=1]="MERGE",bk[bk.ACK_USER_WRITE=2]="ACK_USER_WRITE",bk[bk.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class de{constructor(a,b,c){this.path=a,this.affectedTree=b,this.revert=c,this.type=bj.ACK_USER_WRITE,this.source=db()}operationForChild(a){if(!cq(this.path))return s(cj(this.path)===a,"operationForChild called for unrelated child."),new de(cl(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return s(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let b=this.affectedTree.subtree(new ch(a));return new de(ci(),b,this.revert)}}}class df{constructor(a,b){this.source=a,this.path=b,this.type=bj.LISTEN_COMPLETE}operationForChild(a){return cq(this.path)?new df(this.source,ci()):new df(this.source,cl(this.path))}}class dg{constructor(a,b,c){this.source=a,this.path=b,this.snap=c,this.type=bj.OVERWRITE}operationForChild(a){return cq(this.path)?new dg(this.source,ci(),this.snap.getImmediateChild(a)):new dg(this.source,cl(this.path),this.snap)}}class dh{constructor(a,b,c){this.source=a,this.path=b,this.children=c,this.type=bj.MERGE}operationForChild(a){if(!cq(this.path))return s(cj(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new dh(this.source,cl(this.path),this.children);{let b=this.children.subtree(new ch(a));return b.isEmpty()?null:b.value?new dg(this.source,ci(),b.value):new dh(this.source,ci(),b)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class di{constructor(a,b,c){this.node_=a,this.fullyInitialized_=b,this.filtered_=c}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(a){if(cq(a))return this.isFullyInitialized()&&!this.filtered_;let b=cj(a);return this.isCompleteForChild(b)}isCompleteForChild(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)}getNode(){return this.node_}}class dj{constructor(a){this.query_=a,this.index_=this.query_._queryParams.getIndex()}}function dk(a,b,c,d,e,f){let g=d.filter(a=>a.type===c);g.sort((b,c)=>(function(a,b,c){if(null==b.childName||null==c.childName)throw t("Should only compare child_ events.");let d=new cA(b.childName,b.snapshotNode),e=new cA(c.childName,c.snapshotNode);return a.index_.compare(d,e)})(a,b,c)),g.forEach(c=>{var d,g,h;let i=(d=a,g=c,h=f,"value"===g.type||"child_removed"===g.type||(g.prevName=h.getPredecessorChildName(g.childName,g.snapshotNode,d.index_)),g);e.forEach(d=>{d.respondsTo(c.type)&&b.push(d.createEvent(i,a.query_))})})}function dl(a,b){return{eventCache:a,serverCache:b}}function dm(a,b,c,d){return dl(new di(b,c,d),a.serverCache)}function dn(a,b,c,d){return dl(a.eventCache,new di(b,c,d))}function dp(a){return a.eventCache.isFullyInitialized()?a.eventCache.getNode():null}function dq(a){return a.serverCache.isFullyInitialized()?a.serverCache.getNode():null}class dr{static fromObject(a){let b=new dr(null);return bQ(a,(a,c)=>{b=b.set(new ch(a),c)}),b}constructor(a,b=(!l&&(l=new cG(bM)),l)){this.value=a,this.children=b}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(a,b){if(null!=this.value&&b(this.value))return{path:ci(),value:this.value};{if(cq(a))return null;let c=cj(a),d=this.children.get(c);if(null===d)return null;{let e=d.findRootMostMatchingPathAndValue(cl(a),b);return null!=e?{path:cp(new ch(c),e.path),value:e.value}:null}}}findRootMostValueAndPath(a){return this.findRootMostMatchingPathAndValue(a,()=>!0)}subtree(a){if(cq(a))return this;{let b=cj(a),c=this.children.get(b);return null!==c?c.subtree(cl(a)):new dr(null)}}set(a,b){if(cq(a))return new dr(b,this.children);{let c=cj(a),d=(this.children.get(c)||new dr(null)).set(cl(a),b),e=this.children.insert(c,d);return new dr(this.value,e)}}remove(a){if(cq(a))if(this.children.isEmpty())return new dr(null);else return new dr(null,this.children);{let b=cj(a),c=this.children.get(b);if(!c)return this;{let d,e=c.remove(cl(a));return(d=e.isEmpty()?this.children.remove(b):this.children.insert(b,e),null===this.value&&d.isEmpty())?new dr(null):new dr(this.value,d)}}}get(a){if(cq(a))return this.value;{let b=cj(a),c=this.children.get(b);return c?c.get(cl(a)):null}}setTree(a,b){if(cq(a))return b;{let c,d=cj(a),e=(this.children.get(d)||new dr(null)).setTree(cl(a),b);return c=e.isEmpty()?this.children.remove(d):this.children.insert(d,e),new dr(this.value,c)}}fold(a){return this.fold_(ci(),a)}fold_(a,b){let c={};return this.children.inorderTraversal((d,e)=>{c[d]=e.fold_(cp(a,d),b)}),b(a,this.value,c)}findOnPath(a,b){return this.findOnPath_(a,ci(),b)}findOnPath_(a,b,c){let d=!!this.value&&c(b,this.value);if(d)return d;{if(cq(a))return null;let d=cj(a),e=this.children.get(d);return e?e.findOnPath_(cl(a),cp(b,d),c):null}}foreachOnPath(a,b){return this.foreachOnPath_(a,ci(),b)}foreachOnPath_(a,b,c){if(cq(a))return this;{this.value&&c(b,this.value);let d=cj(a),e=this.children.get(d);return e?e.foreachOnPath_(cl(a),cp(b,d),c):new dr(null)}}foreach(a){this.foreach_(ci(),a)}foreach_(a,b){this.children.inorderTraversal((c,d)=>{d.foreach_(cp(a,c),b)}),this.value&&b(a,this.value)}foreachChild(a){this.children.inorderTraversal((b,c)=>{c.value&&a(b,c.value)})}}class ds{constructor(a){this.writeTree_=a}static empty(){return new ds(new dr(null))}}function dt(a,b,c){if(cq(b))return new ds(new dr(c));{let d=a.writeTree_.findRootMostValueAndPath(b);if(null!=d){let e=d.path,f=d.value,g=cr(e,b);return f=f.updateChild(g,c),new ds(a.writeTree_.set(e,f))}{let d=new dr(c);return new ds(a.writeTree_.setTree(b,d))}}}function du(a,b,c){let d=a;return bQ(c,(a,c)=>{d=dt(d,cp(b,a),c)}),d}function dv(a,b){return cq(b)?ds.empty():new ds(a.writeTree_.setTree(b,new dr(null)))}function dw(a,b){return null!=dx(a,b)}function dx(a,b){let c=a.writeTree_.findRootMostValueAndPath(b);return null!=c?a.writeTree_.get(c.path).getChild(cr(c.path,b)):null}function dy(a){let b=[],c=a.writeTree_.value;return null!=c?c.isLeafNode()||c.forEachChild(cM,(a,c)=>{b.push(new cA(a,c))}):a.writeTree_.children.inorderTraversal((a,c)=>{null!=c.value&&b.push(new cA(a,c.value))}),b}function dz(a,b){if(cq(b))return a;{let c=dx(a,b);return new ds(null!=c?new dr(c):a.writeTree_.subtree(b))}}function dA(a){return a.writeTree_.isEmpty()}function dB(a,b){return function a(b,c,d){if(null!=c.value)return d.updateChild(b,c.value);{let e=null;return c.children.inorderTraversal((c,f)=>{".priority"===c?(s(null!==f.value,"Priority writes must always be leaf nodes"),e=f.value):d=a(cp(b,c),f,d)}),d.getChild(b).isEmpty()||null===e||(d=d.updateChild(cp(b,".priority"),e)),d}}(ci(),a.writeTree_,b)}function dC(a){return a.visible}function dD(a,b,c){let d=ds.empty();for(let e=0;e<a.length;++e){let f=a[e];if(b(f)){let a,b=f.path;if(f.snap)cu(c,b)?d=dt(d,a=cr(c,b),f.snap):cu(b,c)&&(a=cr(b,c),d=dt(d,ci(),f.snap.getChild(a)));else if(f.children){if(cu(c,b))d=du(d,a=cr(c,b),f.children);else if(cu(b,c))if(cq(a=cr(b,c)))d=du(d,ci(),f.children);else{let b=V(f.children,cj(a));if(b){let c=b.getChild(cl(a));d=dt(d,ci(),c)}}}else throw t("WriteRecord should have .snap or .children")}}return d}function dE(a,b,c,d,e){if(d||e){let f=dz(a.visibleWrites,b);return!e&&dA(f)?c:e||null!=c||dw(f,ci())?dB(dD(a.allWrites,function(a){return(a.visible||e)&&(!d||!~d.indexOf(a.writeId))&&(cu(a.path,b)||cu(b,a.path))},b),c||cS.EMPTY_NODE):null}{let d=dx(a.visibleWrites,b);if(null!=d)return d;{let d=dz(a.visibleWrites,b);return dA(d)?c:null!=c||dw(d,ci())?dB(d,c||cS.EMPTY_NODE):null}}}function dF(a,b,c,d){return dE(a.writeTree,a.treePath,b,c,d)}function dG(a,b){return function(a,b,c){let d=cS.EMPTY_NODE,e=dx(a.visibleWrites,b);if(e)return e.isLeafNode()||e.forEachChild(cM,(a,b)=>{d=d.updateImmediateChild(a,b)}),d;if(!c)return dy(dz(a.visibleWrites,b)).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d;{let e=dz(a.visibleWrites,b);return c.forEachChild(cM,(a,b)=>{let c=dB(dz(e,new ch(a)),b);d=d.updateImmediateChild(a,c)}),dy(e).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d}}(a.writeTree,a.treePath,b)}function dH(a,b,c,d){return function(a,b,c,d,e){s(d||e,"Either existingEventSnap or existingServerSnap must exist");let f=cp(b,c);if(dw(a.visibleWrites,f))return null;{let b=dz(a.visibleWrites,f);return dA(b)?e.getChild(c):dB(b,e.getChild(c))}}(a.writeTree,a.treePath,b,c,d)}function dI(a,b){var c,d;return c=a.writeTree,d=cp(a.treePath,b),dx(c.visibleWrites,d)}function dJ(a,b,c){var d,e;let f,g;return d=a.writeTree,e=a.treePath,f=cp(e,b),null!=(g=dx(d.visibleWrites,f))?g:c.isCompleteForChild(b)?dB(dz(d.visibleWrites,f),c.getNode().getImmediateChild(b)):null}function dK(a,b){return dL(cp(a.treePath,b),a.writeTree)}function dL(a,b){return{treePath:a,writeTree:b}}class dM{constructor(){this.changeMap=new Map}trackChildChange(a){let b=a.type,c=a.childName;s("child_added"===b||"child_changed"===b||"child_removed"===b,"Only child changes supported for tracking"),s(".priority"!==c,"Only non-priority child changes can be tracked.");let d=this.changeMap.get(c);if(d){let e=d.type;if("child_added"===b&&"child_removed"===e)this.changeMap.set(c,c$(c,a.snapshotNode,d.snapshotNode));else if("child_removed"===b&&"child_added"===e)this.changeMap.delete(c);else if("child_removed"===b&&"child_changed"===e)this.changeMap.set(c,cZ(c,d.oldSnap));else if("child_changed"===b&&"child_added"===e)this.changeMap.set(c,cY(c,a.snapshotNode));else if("child_changed"===b&&"child_changed"===e)this.changeMap.set(c,c$(c,a.snapshotNode,d.oldSnap));else throw t("Illegal combination of changes: "+a+" occurred after "+d)}else this.changeMap.set(c,a)}getChanges(){return Array.from(this.changeMap.values())}}let dN=new class{getCompleteChild(a){return null}getChildAfterChild(a,b,c){return null}};class dO{constructor(a,b,c=null){this.writes_=a,this.viewCache_=b,this.optCompleteServerCache_=c}getCompleteChild(a){let b=this.viewCache_.eventCache;if(b.isCompleteForChild(a))return b.getNode().getImmediateChild(a);{let b=null!=this.optCompleteServerCache_?new di(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return dJ(this.writes_,a,b)}}getChildAfterChild(a,b,c){var d;let e=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:dq(this.viewCache_),f=(d=this.writes_,function(a,b,c,d,e,f,g){let h,i=dz(a.visibleWrites,b),j=dx(i,ci());if(null!=j)h=j;else{if(null==c)return[];h=dB(i,c)}if((h=h.withIndex(g)).isEmpty()||h.isLeafNode())return[];{let a=[],b=g.getCompare(),c=f?h.getReverseIteratorFrom(d,g):h.getIteratorFrom(d,g),e=c.getNext();for(;e&&a.length<1;)0!==b(e,d)&&a.push(e),e=c.getNext();return a}}(d.writeTree,d.treePath,e,b,1,c,a));return 0===f.length?null:f[0]}}function dP(a,b,c,d,e,f){let g=b.eventCache;if(null!=dI(d,c))return b;{let h,i;if(cq(c))if(s(b.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),b.serverCache.isFiltered()){let c=dq(b),e=dG(d,c instanceof cS?c:cS.EMPTY_NODE);h=a.filter.updateFullNode(b.eventCache.getNode(),e,f)}else{let c=dF(d,dq(b));h=a.filter.updateFullNode(b.eventCache.getNode(),c,f)}else{let j=cj(c);if(".priority"===j){s(1===ck(c),"Can't have a priority with additional path components");let e=g.getNode(),f=dH(d,c,e,i=b.serverCache.getNode());h=null!=f?a.filter.updatePriority(e,f):g.getNode()}else{let k,l=cl(c);if(g.isCompleteForChild(j)){i=b.serverCache.getNode();let a=dH(d,c,g.getNode(),i);k=null!=a?g.getNode().getImmediateChild(j).updateChild(l,a):g.getNode().getImmediateChild(j)}else k=dJ(d,j,b.serverCache);h=null!=k?a.filter.updateChild(g.getNode(),j,k,l,e,f):g.getNode()}}return dm(b,h,g.isFullyInitialized()||cq(c),a.filter.filtersNodes())}}function dQ(a,b,c,d,e,f,g,h){let i,j=b.serverCache,k=g?a.filter:a.filter.getIndexedFilter();if(cq(c))i=k.updateFullNode(j.getNode(),d,null);else if(k.filtersNodes()&&!j.isFiltered()){let a=j.getNode().updateChild(c,d);i=k.updateFullNode(j.getNode(),a,null)}else{let a=cj(c);if(!j.isCompleteForPath(c)&&ck(c)>1)return b;let e=cl(c),f=j.getNode().getImmediateChild(a).updateChild(e,d);i=".priority"===a?k.updatePriority(j.getNode(),f):k.updateChild(j.getNode(),a,f,e,dN,null)}let l=dn(b,i,j.isFullyInitialized()||cq(c),k.filtersNodes()),m=new dO(e,l,f);return dP(a,l,c,e,m,h)}function dR(a,b,c,d,e,f,g){let h,i,j=b.eventCache,k=new dO(e,b,f);if(cq(c))i=a.filter.updateFullNode(b.eventCache.getNode(),d,g),h=dm(b,i,!0,a.filter.filtersNodes());else{let e=cj(c);if(".priority"===e)i=a.filter.updatePriority(b.eventCache.getNode(),d),h=dm(b,i,j.isFullyInitialized(),j.isFiltered());else{let f,i=cl(c),l=j.getNode().getImmediateChild(e);if(cq(i))f=d;else{let a=k.getCompleteChild(e);f=null!=a?".priority"===cm(i)&&a.getChild(co(i)).isEmpty()?a:a.updateChild(i,d):cS.EMPTY_NODE}h=l.equals(f)?b:dm(b,a.filter.updateChild(j.getNode(),e,f,i,k,g),j.isFullyInitialized(),a.filter.filtersNodes())}}return h}function dS(a,b){return a.eventCache.isCompleteForChild(b)}function dT(a,b,c){return c.foreach((a,c)=>{b=b.updateChild(a,c)}),b}function dU(a,b,c,d,e,f,g,h){let i;if(b.serverCache.getNode().isEmpty()&&!b.serverCache.isFullyInitialized())return b;let j=b;i=cq(c)?d:new dr(null).setTree(c,d);let k=b.serverCache.getNode();return i.children.inorderTraversal((c,d)=>{if(k.hasChild(c)){let i=dT(a,b.serverCache.getNode().getImmediateChild(c),d);j=dQ(a,j,new ch(c),i,e,f,g,h)}}),i.children.inorderTraversal((c,d)=>{let i=!b.serverCache.isCompleteForChild(c)&&null===d.value;if(!k.hasChild(c)&&!i){let i=dT(a,b.serverCache.getNode().getImmediateChild(c),d);j=dQ(a,j,new ch(c),i,e,f,g,h)}}),j}class dV{constructor(a,b){this.query_=a,this.eventRegistrations_=[];const c=this.query_._queryParams,d=new c_(c.getIndex()),e=function(a){return a.loadsAllData()?new c_(a.getIndex()):a.hasLimit()?new c1(a):new c0(a)}(c);this.processor_=function(a){return{filter:a}}(e);const f=b.serverCache,g=b.eventCache,h=d.updateFullNode(cS.EMPTY_NODE,f.getNode(),null),i=e.updateFullNode(cS.EMPTY_NODE,g.getNode(),null),j=new di(h,f.isFullyInitialized(),d.filtersNodes()),k=new di(i,g.isFullyInitialized(),e.filtersNodes());this.viewCache_=dl(k,j),this.eventGenerator_=new dj(this.query_)}get query(){return this.query_}}function dW(a){return 0===a.eventRegistrations_.length}function dX(a,b,c){let d=[];if(c){s(null==b,"A cancel should cancel all event registrations.");let e=a.query._path;a.eventRegistrations_.forEach(a=>{let b=a.createCancelEvent(c,e);b&&d.push(b)})}if(b){let c=[];for(let d=0;d<a.eventRegistrations_.length;++d){let e=a.eventRegistrations_[d];if(e.matches(b)){if(b.hasAnyCallback()){c=c.concat(a.eventRegistrations_.slice(d+1));break}}else c.push(e)}a.eventRegistrations_=c}else a.eventRegistrations_=[];return d}function dY(a,b,c,d){var e,f;b.type===bj.MERGE&&null!==b.source.queryId&&(s(dq(a.viewCache_),"We should always have a full cache before handling merges"),s(dp(a.viewCache_),"Missing event cache, even though we have a server cache"));let g=a.viewCache_,h=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;let r,u,v=new dM;if(c.type===bj.OVERWRITE)c.source.fromUser?r=dR(a,b,c.path,c.snap,d,e,v):(s(c.source.fromServer,"Unknown source."),u=c.source.tagged||b.serverCache.isFiltered()&&!cq(c.path),r=dQ(a,b,c.path,c.snap,d,e,u,v));else if(c.type===bj.MERGE){let m;c.source.fromUser?(f=a,g=b,h=c.path,i=c.children,j=d,k=e,l=v,m=g,i.foreach((a,b)=>{let c=cp(h,a);dS(g,cj(c))&&(m=dR(f,m,c,b,j,k,l))}),i.foreach((a,b)=>{let c=cp(h,a);dS(g,cj(c))||(m=dR(f,m,c,b,j,k,l))}),r=m):(s(c.source.fromServer,"Unknown source."),u=c.source.tagged||b.serverCache.isFiltered(),r=dU(a,b,c.path,c.children,d,e,u,v))}else if(c.type===bj.ACK_USER_WRITE)r=c.revert?function(a,b,c,d,e,f){let g;if(null!=dI(d,c))return b;{let h,i=new dO(d,b,e),j=b.eventCache.getNode();if(cq(c)||".priority"===cj(c)){let c;if(b.serverCache.isFullyInitialized())c=dF(d,dq(b));else{let a=b.serverCache.getNode();s(a instanceof cS,"serverChildren would be complete if leaf node"),c=dG(d,a)}h=a.filter.updateFullNode(j,c,f)}else{let e=cj(c),k=dJ(d,e,b.serverCache);null==k&&b.serverCache.isCompleteForChild(e)&&(k=j.getImmediateChild(e)),(h=null!=k?a.filter.updateChild(j,e,k,cl(c),i,f):b.eventCache.getNode().hasChild(e)?a.filter.updateChild(j,e,cS.EMPTY_NODE,cl(c),i,f):j).isEmpty()&&b.serverCache.isFullyInitialized()&&(g=dF(d,dq(b))).isLeafNode()&&(h=a.filter.updateFullNode(h,g,f))}return g=b.serverCache.isFullyInitialized()||null!=dI(d,ci()),dm(b,h,g,a.filter.filtersNodes())}}(a,b,c.path,d,e,v):function(a,b,c,d,e,f,g){if(null!=dI(e,c))return b;let h=b.serverCache.isFiltered(),i=b.serverCache;if(null!=d.value)if(cq(c)&&i.isFullyInitialized()||i.isCompleteForPath(c))return dQ(a,b,c,i.getNode().getChild(c),e,f,h,g);else{if(!cq(c))return b;let d=new dr(null);return i.getNode().forEachChild(cD,(a,b)=>{d=d.set(new ch(a),b)}),dU(a,b,c,d,e,f,h,g)}{let j=new dr(null);return d.foreach((a,b)=>{let d=cp(c,a);i.isCompleteForPath(d)&&(j=j.set(a,i.getNode().getChild(d)))}),dU(a,b,c,j,e,f,h,g)}}(a,b,c.path,c.affectedTree,d,e,v);else if(c.type===bj.LISTEN_COMPLETE){let e;m=a,n=b,o=c.path,p=d,q=v,e=n.serverCache,r=dP(m,dn(n,e.getNode(),e.isFullyInitialized()||cq(o),e.isFiltered()),o,p,dN,q)}else throw t("Unknown operation type: "+c.type);let w=v.getChanges();return function(a,b,c){let d=b.eventCache;if(d.isFullyInitialized()){let e=d.getNode().isLeafNode()||d.getNode().isEmpty(),f=dp(a);!(c.length>0)&&a.eventCache.isFullyInitialized()&&(!e||d.getNode().equals(f))&&d.getNode().getPriority().equals(f.getPriority())||c.push(cX(dp(b)))}}(b,r,w),{viewCache:r,changes:w}}(a.processor_,g,b,c,d);return e=a.processor_,s((f=h.viewCache).eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),s(f.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed"),s(h.viewCache.serverCache.isFullyInitialized()||!g.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),a.viewCache_=h.viewCache,dZ(a,h.changes,h.viewCache.eventCache.getNode(),null)}function dZ(a,b,c,d){var e;let f,g,h=d?[d]:a.eventRegistrations_;return e=a.eventGenerator_,f=[],g=[],b.forEach(a=>{var b;"child_changed"===a.type&&e.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&g.push((b=a.childName,{type:"child_moved",snapshotNode:a.snapshotNode,childName:b}))}),dk(e,f,"child_removed",b,h,c),dk(e,f,"child_added",b,h,c),dk(e,f,"child_moved",g,h,c),dk(e,f,"child_changed",b,h,c),dk(e,f,"value",b,h,c),f}class d${constructor(){this.views=new Map}}function d_(a,b,c,d){let e=b.source.queryId;if(null!==e){let f=a.views.get(e);return s(null!=f,"SyncTree gave us an op for an invalid query."),dY(f,b,c,d)}{let e=[];for(let f of a.views.values())e=e.concat(dY(f,b,c,d));return e}}function d0(a,b,c,d,e){let f=b._queryIdentifier,g=a.views.get(f);if(!g){let a=dF(c,e?d:null),f=!1;return a?f=!0:(a=d instanceof cS?dG(c,d):cS.EMPTY_NODE,f=!1),new dV(b,dl(new di(a,f,!1),new di(d,e,!1)))}return g}function d1(a){let b=[];for(let c of a.views.values())c.query._queryParams.loadsAllData()||b.push(c);return b}function d2(a,b){let c=null;for(let d of a.views.values())c=c||function(a,b){let c=dq(a.viewCache_);return c&&(a.query._queryParams.loadsAllData()||!cq(b)&&!c.getImmediateChild(cj(b)).isEmpty())?c.getChild(b):null}(d,b);return c}function d3(a,b){if(b._queryParams.loadsAllData())return d5(a);{let c=b._queryIdentifier;return a.views.get(c)}}function d4(a){return null!=d5(a)}function d5(a){for(let b of a.views.values())if(b.query._queryParams.loadsAllData())return b;return null}let d6=1;class d7{constructor(a){this.listenProvider_=a,this.syncPointTree_=new dr(null),this.pendingWriteTree_={visibleWrites:ds.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function d8(a,b,c,d,e){var f,g;return(f=a.pendingWriteTree_,g=e,s(d>f.lastWriteId,"Stacking an older write on top of newer ones"),void 0===g&&(g=!0),f.allWrites.push({path:b,snap:c,writeId:d,visible:g}),g&&(f.visibleWrites=dt(f.visibleWrites,b,c)),f.lastWriteId=d,e)?ef(a,new dg(db(),b,c)):[]}function d9(a,b,c=!1){let d=function(a,b){for(let c=0;c<a.allWrites.length;c++){let d=a.allWrites[c];if(d.writeId===b)return d}return null}(a.pendingWriteTree_,b);if(!function(a,b){var c;let d=a.allWrites.findIndex(a=>a.writeId===b);s(d>=0,"removeWrite called with nonexistent writeId.");let e=a.allWrites[d];a.allWrites.splice(d,1);let f=e.visible,g=!1,h=a.allWrites.length-1;for(;f&&h>=0;){let b=a.allWrites[h];b.visible&&(h>=d&&function(a,b){if(a.snap)return cu(a.path,b);for(let c in a.children)if(a.children.hasOwnProperty(c)&&cu(cp(a.path,c),b))return!0;return!1}(b,e.path)?f=!1:cu(e.path,b.path)&&(g=!0)),h--}return!!f&&(g?((c=a).visibleWrites=dD(c.allWrites,dC,ci()),c.allWrites.length>0?c.lastWriteId=c.allWrites[c.allWrites.length-1].writeId:c.lastWriteId=-1):e.snap?a.visibleWrites=dv(a.visibleWrites,e.path):bQ(e.children,b=>{a.visibleWrites=dv(a.visibleWrites,cp(e.path,b))}),!0)}(a.pendingWriteTree_,b))return[];{let b=new dr(null);return null!=d.snap?b=b.set(ci(),!0):bQ(d.children,a=>{b=b.set(new ch(a),!0)}),ef(a,new de(d.path,b,c))}}function ea(a,b,c){return ef(a,new dg(dc(),b,c))}function eb(a,b,c,d,e=!1){let f=b._path,g=a.syncPointTree_.get(f),h=[];if(g&&("default"===b._queryIdentifier||null!=d3(g,b))){let k=function(a,b,c,d){let e=b._queryIdentifier,f=[],g=[],h=d4(a);if("default"===e)for(let[b,e]of a.views.entries())g=g.concat(dX(e,c,d)),dW(e)&&(a.views.delete(b),e.query._queryParams.loadsAllData()||f.push(e.query));else{let b=a.views.get(e);b&&(g=g.concat(dX(b,c,d)),dW(b)&&(a.views.delete(e),b.query._queryParams.loadsAllData()||f.push(b.query)))}return h&&!d4(a)&&f.push(new(s(m,"Reference.ts has not been loaded"),m)(b._repo,b._path)),{removed:f,events:g}}(g,b,c,d);0===g.views.size&&(a.syncPointTree_=a.syncPointTree_.remove(f));let l=k.removed;if(h=k.events,!e){let c=-1!==l.findIndex(a=>a._queryParams.loadsAllData()),e=a.syncPointTree_.findOnPath(f,(a,b)=>d4(b));if(c&&!e){let b=a.syncPointTree_.subtree(f);if(!b.isEmpty()){let c=b.fold((a,b,c)=>{if(b&&d4(b))return[d5(b)];{let a=[];return b&&(a=d1(b)),bQ(c,(b,c)=>{a=a.concat(c)}),a}});for(let b=0;b<c.length;++b){let d=c[b],e=d.query,f=eg(a,d);a.listenProvider_.startListening(em(e),eh(a,e),f.hashFn,f.onComplete)}}}e||!(l.length>0)||d||(c?a.listenProvider_.stopListening(em(b),null):l.forEach(b=>{let c=a.queryToTagMap.get(ei(b));a.listenProvider_.stopListening(em(b),c)}))}var i=a,j=l;for(let a=0;a<j.length;++a){let b=j[a];if(!b._queryParams.loadsAllData()){let a=ei(b),c=i.queryToTagMap.get(a);i.queryToTagMap.delete(a),i.tagToQueryMap.delete(c)}}}return h}function ec(a,b,c,d){let e=ej(a,d);if(null==e)return[];{let d=ek(e),f=d.path,g=d.queryId,h=cr(f,b);return el(a,f,new dg(dd(g),h,c))}}function ed(a,b,c,d=!1){var e;let f,g,h,i,j=b._path,k=null,l=!1;a.syncPointTree_.foreachOnPath(j,(a,b)=>{let c=cr(a,j);k=k||d2(b,c),l=l||d4(b)});let m=a.syncPointTree_.get(j);m?(l=l||d4(m),k=k||d2(m,ci())):(m=new d$,a.syncPointTree_=a.syncPointTree_.set(j,m)),null!=k?f=!0:(f=!1,k=cS.EMPTY_NODE,a.syncPointTree_.subtree(j).foreachChild((a,b)=>{let c=d2(b,ci());c&&(k=k.updateImmediateChild(a,c))}));let n=null!=d3(m,b);if(!n&&!b._queryParams.loadsAllData()){let c=ei(b);s(!a.queryToTagMap.has(c),"View does not exist, but we have a tag");let d=d6++;a.queryToTagMap.set(c,d),a.tagToQueryMap.set(d,c)}let o=dL(j,a.pendingWriteTree_),p=(g=d0(e=m,b,o,k,f),e.views.has(b._queryIdentifier)||e.views.set(b._queryIdentifier,g),g.eventRegistrations_.push(c),h=g.viewCache_.eventCache,i=[],h.getNode().isLeafNode()||h.getNode().forEachChild(cM,(a,b)=>{i.push(cY(a,b))}),h.isFullyInitialized()&&i.push(cX(h.getNode())),dZ(g,i,h.getNode(),c));if(!n&&!l&&!d){let c=d3(m,b);p=p.concat(function(a,b,c){let d=b._path,e=eh(a,b),f=eg(a,c),g=a.listenProvider_.startListening(em(b),e,f.hashFn,f.onComplete),h=a.syncPointTree_.subtree(d);if(e)s(!d4(h.value),"If we're adding a query, it shouldn't be shadowed");else{let b=h.fold((a,b,c)=>{if(!cq(a)&&b&&d4(b))return[d5(b).query];{let a=[];return b&&(a=a.concat(d1(b).map(a=>a.query))),bQ(c,(b,c)=>{a=a.concat(c)}),a}});for(let c=0;c<b.length;++c){let d=b[c];a.listenProvider_.stopListening(em(d),eh(a,d))}}return g}(a,b,c))}return p}function ee(a,b,c){let d=a.pendingWriteTree_,e=a.syncPointTree_.findOnPath(b,(a,c)=>{let d=d2(c,cr(a,b));if(d)return d});return dE(d,b,e,c,!0)}function ef(a,b){var c;return function a(b,c,d,e){if(cq(b.path))return function a(b,c,d,e){let f=c.get(ci());null==d&&null!=f&&(d=d2(f,ci()));let g=[];return c.children.inorderTraversal((c,f)=>{let h=d?d.getImmediateChild(c):null,i=dK(e,c),j=b.operationForChild(c);j&&(g=g.concat(a(j,f,h,i)))}),f&&(g=g.concat(d_(f,b,e,d))),g}(b,c,d,e);{let f=c.get(ci());null==d&&null!=f&&(d=d2(f,ci()));let g=[],h=cj(b.path),i=b.operationForChild(h),j=c.children.get(h);if(j&&i){let b=d?d.getImmediateChild(h):null,c=dK(e,h);g=g.concat(a(i,j,b,c))}return f&&(g=g.concat(d_(f,b,e,d))),g}}(b,a.syncPointTree_,null,(c=a.pendingWriteTree_,dL(ci(),c)))}function eg(a,b){let c=b.query,d=eh(a,c);return{hashFn:()=>(b.viewCache_.serverCache.getNode()||cS.EMPTY_NODE).hash(),onComplete:b=>{var e;if("ok"===b)if(d)return function(a,b,c){let d=ej(a,c);if(!d)return[];{let c=ek(d),e=c.path,f=c.queryId,g=cr(e,b);return el(a,e,new df(dd(f),g))}}(a,c._path,d);else return e=c._path,ef(a,new df(dc(),e));{let d,e,f=(d="Unknown Error","too_big"===b?d="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===b?d="Client doesn't have permission to access the desired data.":"unavailable"===b&&(d="The service is unavailable"),(e=Error(b+" at "+c._path.toString()+": "+d)).code=b.toUpperCase(),e);return eb(a,c,null,f)}}}}function eh(a,b){let c=ei(b);return a.queryToTagMap.get(c)}function ei(a){return a._path.toString()+"$"+a._queryIdentifier}function ej(a,b){return a.tagToQueryMap.get(b)}function ek(a){let b=a.indexOf("$");return s(-1!==b&&b<a.length-1,"Bad queryKey."),{queryId:a.substr(b+1),path:new ch(a.substr(0,b))}}function el(a,b,c){let d=a.syncPointTree_.get(b);return s(d,"Missing sync point for query tag that we're tracking"),d_(d,c,dL(b,a.pendingWriteTree_),null)}function em(a){return a._queryParams.loadsAllData()&&!a._queryParams.isDefault()?new(s(n,"Reference.ts has not been loaded"),n)(a._repo,a._path):a}class en{constructor(a){this.node_=a}getImmediateChild(a){return new en(this.node_.getImmediateChild(a))}node(){return this.node_}}class eo{constructor(a,b){this.syncTree_=a,this.path_=b}getImmediateChild(a){let b=cp(this.path_,a);return new eo(this.syncTree_,b)}node(){return ee(this.syncTree_,this.path_)}}let ep=function(a,b,c){return a&&"object"==typeof a?(s(".sv"in a,"Unexpected leaf node or priority contents"),"string"==typeof a[".sv"])?eq(a[".sv"],b,c):"object"==typeof a[".sv"]?er(a[".sv"],b):void s(!1,"Unexpected server value: "+JSON.stringify(a,null,2)):a},eq=function(a,b,c){if("timestamp"===a)return c.timestamp;s(!1,"Unexpected server value: "+a)},er=function(a,b,c){a.hasOwnProperty("increment")||s(!1,"Unexpected server value: "+JSON.stringify(a,null,2));let d=a.increment;"number"!=typeof d&&s(!1,"Unexpected increment value: "+d);let e=b.node();if(s(null!=e,"Expected ChildrenNode.EMPTY_NODE for nulls"),!e.isLeafNode())return d;let f=e.getValue();return"number"!=typeof f?d:f+d},es=function(a,b,c,d){return eu(b,new eo(c,a),d)},et=function(a,b,c){return eu(a,new en(b),c)};function eu(a,b,c){let d,e=ep(a.getPriority().val(),b.getImmediateChild(".priority"),c);if(!a.isLeafNode())return d=a,e!==a.getPriority().val()&&(d=d.updatePriority(new cL(e))),a.forEachChild(cM,(a,e)=>{let f=eu(e,b.getImmediateChild(a),c);f!==e&&(d=d.updateImmediateChild(a,f))}),d;{let d=ep(a.getValue(),b,c);return d!==a.getValue()||e!==a.getPriority().val()?new cL(d,cU(e)):a}}class ev{constructor(a="",b=null,c={children:{},childCount:0}){this.name=a,this.parent=b,this.node=c}}function ew(a,b){let c=b instanceof ch?b:new ch(b),d=a,e=cj(c);for(;null!==e;){let a=V(d.node.children,e)||{children:{},childCount:0};d=new ev(e,d,a),e=cj(c=cl(c))}return d}function ex(a){return a.node.value}function ey(a,b){a.node.value=b,function a(b){null!==b.parent&&function(b,c,d){let e=void 0===ex(d)&&!ez(d),f=U(b.node.children,c);e&&f?(delete b.node.children[c],b.node.childCount--,a(b)):e||f||(b.node.children[c]=d.node,b.node.childCount++,a(b))}(b.parent,b.name,b)}(a)}function ez(a){return a.node.childCount>0}function eA(a,b){bQ(a.node.children,(c,d)=>{b(new ev(c,a,d))})}function eB(a){return new ch(null===a.parent?a.name:eB(a.parent)+"/"+a.name)}let eC=/[\[\].#$\/\u0000-\u001F\u007F]/,eD=/[\[\].#$\u0000-\u001F\u007F]/,eE=function(a){return"string"==typeof a&&0!==a.length&&!eC.test(a)},eF=function(a){return"string"==typeof a&&0!==a.length&&!eD.test(a)},eG=function(a,b,c,d){d&&void 0===b||eH(ae(a,"value"),b,c)},eH=function(a,b,c){let d=c instanceof ch?new cv(c,a):c;if(void 0===b)throw Error(a+"contains undefined "+cx(d));if("function"==typeof b)throw Error(a+"contains a function "+cx(d)+" with contents = "+b.toString());if(bH(b))throw Error(a+"contains "+b.toString()+" "+cx(d));if("string"==typeof b&&b.length>3495253.3333333335&&ag(b)>0xa00000)throw Error(a+"contains a string greater than 10485760 utf8 bytes "+cx(d)+" ('"+b.substring(0,50)+"...')");if(b&&"object"==typeof b){let c=!1,e=!1;if(bQ(b,(b,f)=>{let g;if(".value"===b)c=!0;else if(".priority"!==b&&".sv"!==b&&(e=!0,!eE(b)))throw Error(a+" contains an invalid key ("+b+") "+cx(d)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');d.parts_.length>0&&(d.byteLength_+=1),d.parts_.push(b),d.byteLength_+=ag(b),cw(d),eH(a,f,d),g=d.parts_.pop(),d.byteLength_-=ag(g),d.parts_.length>0&&(d.byteLength_-=1)}),c&&e)throw Error(a+' contains ".value" child '+cx(d)+" in addition to actual children.")}},eI=function(a,b){let c,d;for(c=0;c<b.length;c++){let e=cn(d=b[c]);for(let b=0;b<e.length;b++)if(".priority"===e[b]&&b===e.length-1);else if(!eE(e[b]))throw Error(a+"contains an invalid key ("+e[b]+") in path "+d.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}b.sort(cs);let e=null;for(c=0;c<b.length;c++){if(d=b[c],null!==e&&cu(e,d))throw Error(a+"contains a path "+e.toString()+" that is ancestor of another path "+d.toString());e=d}},eJ=function(a,b,c,d){if(d&&void 0===b)return;let e=ae(a,"values");if(!(b&&"object"==typeof b)||Array.isArray(b))throw Error(e+" must be an object containing the children to replace.");let f=[];bQ(b,(a,b)=>{let d=new ch(a);if(eH(e,b,cp(c,d)),".priority"===cm(d)&&!(null===b||"string"==typeof b||"number"==typeof b&&!bH(b)||b&&"object"==typeof b&&U(b,".sv")))throw Error(e+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");f.push(d)}),eI(e,f)},eK=function(a,b,c,d){if((!d||void 0!==c)&&!eF(c))throw Error(ae(a,b)+'was an invalid path = "'+c+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},eL=function(a,b,c,d){c&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),eK(a,b,c,d)},eM=function(a,b){if(".info"===cj(b))throw Error(a+" failed = Can't modify data under /.info/")},eN=function(a,b){var c;let d=b.path.toString();if("string"!=typeof b.repoInfo.host||0===b.repoInfo.host.length||!eE(b.repoInfo.namespace)&&"localhost"!==b.repoInfo.host.split(":")[0]||0!==d.length&&((c=d)&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),!eF(c)))throw Error(ae(a,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class eO{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function eP(a,b){let c=null;for(let d=0;d<b.length;d++){let e=b[d],f=e.getPath();null===c||ct(f,c.path)||(a.eventLists_.push(c),c=null),null===c&&(c={events:[],path:f}),c.events.push(e)}c&&a.eventLists_.push(c)}function eQ(a,b,c){eP(a,c),eS(a,a=>ct(a,b))}function eR(a,b,c){eP(a,c),eS(a,a=>cu(a,b)||cu(b,a))}function eS(a,b){a.recursionDepth_++;let c=!0;for(let d=0;d<a.eventLists_.length;d++){let e=a.eventLists_[d];e&&(b(e.path)?(function(a){for(let b=0;b<a.events.length;b++){let c=a.events[b];if(null!==c){a.events[b]=null;let d=c.getEventRunner();by&&bB("event: "+c.toString()),bU(d)}}}(a.eventLists_[d]),a.eventLists_[d]=null):c=!1)}c&&(a.eventLists_=[]),a.recursionDepth_--}class eT{constructor(a,b,c,d){this.repoInfo_=a,this.forceRestClient_=b,this.authTokenProvider_=c,this.appCheckProvider_=d,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new eO,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=c7(),this.transactionQueueTree_=new ev,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function eU(a){var b;let c;return(b=b={timestamp:(c=a.infoData_.getNode(new ch(".info/serverTimeOffset")).val()||0,new Date().getTime()+c)}).timestamp=b.timestamp||new Date().getTime(),b}function eV(a,b,c,d,e){a.dataUpdateCount++;let f=new ch(b);c=a.interceptServerDataCallback_?a.interceptServerDataCallback_(b,c):c;let g=[];if(e)if(d){let b=X(c,a=>cU(a));g=function(a,b,c,d){let e=ej(a,d);if(!e)return[];{let d=ek(e),f=d.path,g=d.queryId,h=cr(f,b),i=dr.fromObject(c);return el(a,f,new dh(dd(g),h,i))}}(a.serverSyncTree_,f,b,e)}else{let b=cU(c);g=ec(a.serverSyncTree_,f,b,e)}else if(d){var h;let b,d=X(c,a=>cU(a));h=a.serverSyncTree_,b=dr.fromObject(d),g=ef(h,new dh(dc(),f,b))}else{let b=cU(c);g=ea(a.serverSyncTree_,f,b)}let i=f;g.length>0&&(i=e1(a,f)),eR(a.eventQueue_,i,g)}function eW(a,b){var c;let d,e,f;eX(a,"connected",b),!1===b&&(e$(c=a,"onDisconnectEvents"),d=eU(c),e=c7(),c8(c.onDisconnect_,ci(),(a,b)=>{let f=es(a,b,c.serverSyncTree_,d);!function a(b,c,d){if(cq(c))b.value=d,b.children.clear();else if(null!==b.value)b.value=b.value.updateChild(c,d);else{let e=cj(c);b.children.has(e)||b.children.set(e,c7()),a(b.children.get(e),c=cl(c),d)}}(e,a,f)}),f=[],c8(e,ci(),(a,b)=>{f=f.concat(ea(c.serverSyncTree_,a,b));let d=e5(c,a);e1(c,d)}),c.onDisconnect_=c7(),eR(c.eventQueue_,ci(),f))}function eX(a,b,c){let d=new ch("/.info/"+b),e=cU(c);a.infoData_.updateSnapshot(d,e);let f=ea(a.infoSyncTree_,d,e);eR(a.eventQueue_,d,f)}function eY(a){return a.nextWriteId_++}function eZ(a,b,c){let d;d=".info"===cj(b._path)?eb(a.infoSyncTree_,b,c):eb(a.serverSyncTree_,b,c),eQ(a.eventQueue_,b._path,d)}function e$(a,...b){let c="";a.persistentConnection_&&(c=a.persistentConnection_.id+":"),bB(c,...b)}function e_(a,b,c,d){b&&bU(()=>{if("ok"===c)b(null);else{let a=(c||"error").toUpperCase(),e=a;d&&(e+=": "+d);let f=Error(e);f.code=a,b(f)}})}function e0(a,b,c){return ee(a.serverSyncTree_,b,c)||cS.EMPTY_NODE}function e1(a,b){let c=e2(a,b),d=eB(c),e=e3(a,c);return function(a,b,c){if(0===b.length)return;let d=[],e=[],f=b.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let g=0;g<b.length;g++){let h=b[g],i=cr(c,h.path),j=!1,k;if(s(null!==i,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)j=!0,k=h.abortReason,e=e.concat(d9(a.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=25)j=!0,k="maxretry",e=e.concat(d9(a.serverSyncTree_,h.currentWriteId,!0));else{let c=e0(a,h.path,f);h.currentInputSnapshot=c;let d=b[g].update(c.val());if(void 0!==d){eH("transaction failed: Data returned ",d,h.path);let b=cU(d);"object"==typeof d&&null!=d&&U(d,".priority")||(b=b.updatePriority(c.getPriority()));let g=h.currentWriteId,i=et(b,c,eU(a));h.currentOutputSnapshotRaw=b,h.currentOutputSnapshotResolved=i,h.currentWriteId=eY(a),f.splice(f.indexOf(g),1),e=(e=e.concat(d8(a.serverSyncTree_,h.path,i,h.currentWriteId,h.applyLocally))).concat(d9(a.serverSyncTree_,g,!0))}else j=!0,k="nodata",e=e.concat(d9(a.serverSyncTree_,h.currentWriteId,!0))}eR(a.eventQueue_,c,e),e=[],j&&(b[g].status=2,setTimeout(b[g].unwatcher,Math.floor(0)),b[g].onComplete&&("nodata"===k?d.push(()=>b[g].onComplete(null,!1,b[g].currentInputSnapshot)):d.push(()=>b[g].onComplete(Error(k),!1,null))))}e4(a,a.transactionQueueTree_);for(let a=0;a<d.length;a++)bU(d[a]);!function a(b,c=b.transactionQueueTree_){if(c||e4(b,c),ex(c)){let d=e3(b,c);s(d.length>0,"Sending zero length transaction queue"),d.every(a=>0===a.status)&&function(b,c,d){let e=e0(b,c,d.map(a=>a.currentWriteId)),f=e,g=e.hash();for(let a=0;a<d.length;a++){let b=d[a];s(0===b.status,"tryToSendTransactionQueue_: items in queue should all be run."),b.status=1,b.retryCount++;let e=cr(c,b.path);f=f.updateChild(e,b.currentOutputSnapshotRaw)}let h=f.val(!0);b.server_.put(c.toString(),h,e=>{e$(b,"transaction put response",{path:c.toString(),status:e});let f=[];if("ok"===e){let e=[];for(let a=0;a<d.length;a++)d[a].status=2,f=f.concat(d9(b.serverSyncTree_,d[a].currentWriteId)),d[a].onComplete&&e.push(()=>d[a].onComplete(null,!0,d[a].currentOutputSnapshotResolved)),d[a].unwatcher();e4(b,ew(b.transactionQueueTree_,c)),a(b,b.transactionQueueTree_),eR(b.eventQueue_,c,f);for(let a=0;a<e.length;a++)bU(e[a])}else{if("datastale"===e)for(let a=0;a<d.length;a++)3===d[a].status?d[a].status=4:d[a].status=0;else{bF("transaction at "+c.toString()+" failed: "+e);for(let a=0;a<d.length;a++)d[a].status=4,d[a].abortReason=e}e1(b,c)}},g)}(b,eB(c),d)}else ez(c)&&eA(c,c=>{a(b,c)})}(a,a.transactionQueueTree_)}(a,e,d),d}function e2(a,b){let c,d=a.transactionQueueTree_;for(c=cj(b);null!==c&&void 0===ex(d);)d=ew(d,c),c=cj(b=cl(b));return d}function e3(a,b){let c=[];return function a(b,c,d){let e=ex(c);if(e)for(let a=0;a<e.length;a++)d.push(e[a]);eA(c,c=>{a(b,c,d)})}(a,b,c),c.sort((a,b)=>a.order-b.order),c}function e4(a,b){let c=ex(b);if(c){let a=0;for(let b=0;b<c.length;b++)2!==c[b].status&&(c[a]=c[b],a++);c.length=a,ey(b,c.length>0?c:void 0)}eA(b,b=>{e4(a,b)})}function e5(a,b){let c=eB(e2(a,b)),d=ew(a.transactionQueueTree_,b);return!function(a,b,c){let d=a.parent;for(;null!==d;){if(b(d))return!0;d=d.parent}}(d,b=>{e6(a,b)}),e6(a,d),!function a(b,c,d,e){d&&!e&&c(b),eA(b,b=>{a(b,c,!0,e)}),d&&e&&c(b)}(d,b=>{e6(a,b)}),c}function e6(a,b){let c=ex(b);if(c){let d=[],e=[],f=-1;for(let b=0;b<c.length;b++)3===c[b].status||(1===c[b].status?(s(f===b-1,"All SENT items should be at beginning of queue."),f=b,c[b].status=3,c[b].abortReason="set"):(s(0===c[b].status,"Unexpected transaction status in abort"),c[b].unwatcher(),e=e.concat(d9(a.serverSyncTree_,c[b].currentWriteId,!0)),c[b].onComplete&&d.push(c[b].onComplete.bind(null,Error("set"),!1,null))));-1===f?ey(b,void 0):c.length=f+1,eR(a.eventQueue_,eB(b),e);for(let a=0;a<d.length;a++)bU(d[a])}}let e7=function(a,b){let c=e8(a),d=c.namespace;"firebase.com"===c.domain&&bE(c.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),d&&"undefined"!==d||"localhost"===c.domain||bE("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),c.secure||bG();let e="ws"===c.scheme||"wss"===c.scheme;return{repoInfo:new bW(c.host,c.secure,d,e,b,"",d!==c.subdomain),path:new ch(c.pathString)}},e8=function(a){let b="",c="",d="",e="",f="",g=!0,h="https",i=443;if("string"==typeof a){let j=a.indexOf("//");j>=0&&(h=a.substring(0,j-1),a=a.substring(j+2));let k=a.indexOf("/");-1===k&&(k=a.length);let l=a.indexOf("?");-1===l&&(l=a.length),b=a.substring(0,Math.min(k,l)),k<l&&(e=function(a){let b="",c=a.split("/");for(let a=0;a<c.length;a++)if(c[a].length>0){let d=c[a];try{d=decodeURIComponent(d.replace(/\+/g," "))}catch(a){}b+="/"+d}return b}(a.substring(k,l)));let m=function(a){let b={};for(let c of("?"===a.charAt(0)&&(a=a.substring(1)),a.split("&"))){if(0===c.length)continue;let d=c.split("=");2===d.length?b[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):bF(`Invalid query segment '${c}' in query '${a}'`)}return b}(a.substring(Math.min(a.length,l)));(j=b.indexOf(":"))>=0?(g="https"===h||"wss"===h,i=parseInt(b.substring(j+1),10)):j=b.length;let n=b.slice(0,j);if("localhost"===n.toLowerCase())c="localhost";else if(n.split(".").length<=2)c=n;else{let a=b.indexOf(".");d=b.substring(0,a).toLowerCase(),c=b.substring(a+1),f=d}"ns"in m&&(f=m.ns)}return{host:b,port:i,domain:c,subdomain:d,secure:g,scheme:h,pathString:e,namespace:f}};class e9{constructor(a,b,c,d){this.eventType=a,this.eventRegistration=b,this.snapshot=c,this.prevName=d}getPath(){let a=this.snapshot.ref;return"value"===this.eventType?a._path:a.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Q(this.snapshot.exportVal())}}class fa{constructor(a,b,c){this.eventRegistration=a,this.error=b,this.path=c}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class fb{constructor(a,b){this.snapshotCallback=a,this.cancelCallback=b}onValue(a,b){this.snapshotCallback.call(null,a,b)}onCancel(a){return s(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,a)}get hasCancelCallback(){return!!this.cancelCallback}matches(a){return this.snapshotCallback===a.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===a.snapshotCallback.userCallback&&this.snapshotCallback.context===a.snapshotCallback.context}}class fc{constructor(a,b,c,d){this._repo=a,this._path=b,this._queryParams=c,this._orderByCalled=d}get key(){return cq(this._path)?null:cm(this._path)}get ref(){return new fd(this._repo,this._path)}get _queryIdentifier(){let a=bO(c4(this._queryParams));return"{}"===a?"default":a}get _queryObject(){return c4(this._queryParams)}isEqual(a){if(!((a=ah(a))instanceof fc))return!1;let b=this._repo===a._repo,c=ct(this._path,a._path),d=this._queryIdentifier===a._queryIdentifier;return b&&c&&d}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(a){let b="";for(let c=a.pieceNum_;c<a.pieces_.length;c++)""!==a.pieces_[c]&&(b+="/"+encodeURIComponent(String(a.pieces_[c])));return b||"/"}(this._path)}}class fd extends fc{constructor(a,b){super(a,b,new c2,!1)}get parent(){let a=co(this._path);return null===a?null:new fd(this._repo,a)}get root(){let a=this;for(;null!==a.parent;)a=a.parent;return a}}class fe{constructor(a,b,c){this._node=a,this.ref=b,this._index=c}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(a){let b=new ch(a),c=fg(this.ref,a);return new fe(this._node.getChild(b),c,cM)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(a){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(b,c)=>a(new fe(c,fg(this.ref,b),cM)))}hasChild(a){let b=new ch(a);return!this._node.getChild(b).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ff(a,b){return(a=ah(a))._checkNotDeleted("ref"),void 0!==b?fg(a._root,b):a._root}function fg(a,b){return null===cj((a=ah(a))._path)?eL("child","path",b,!1):eK("child","path",b,!1),new fd(a._repo,cp(a._path,b))}function fh(a,b){var c,d,e;let f,g,h,i,j,k;eM("set",(a=ah(a))._path),eG("set",b,a._path,!1);let l=new E;return c=a._repo,d=a._path,e=l.wrapCallback(()=>{}),e$(c,"set",{path:d.toString(),value:b,priority:null}),f=eU(c),h=et(g=cU(b,null),ee(c.serverSyncTree_,d),f),i=eY(c),j=d8(c.serverSyncTree_,d,h,i,!0),eP(c.eventQueue_,j),c.server_.put(d.toString(),g.val(!0),(a,b)=>{let f="ok"===a;f||bF("set at "+d+" failed: "+a);let g=d9(c.serverSyncTree_,i,!f);eR(c.eventQueue_,d,g),e_(c,e,a,b)}),k=e5(c,d),e1(c,k),eR(c.eventQueue_,k,[]),l.promise}function fi(a,b){eJ("update",b,a._path,!1);let c=new E;return!function(a,b,c,d){e$(a,"update",{path:b.toString(),value:c});let e=!0,f=eU(a),g={};if(bQ(c,(c,d)=>{e=!1,g[c]=es(cp(b,c),cU(d),a.serverSyncTree_,f)}),e)bB("update() called with empty data.  Don't do anything."),e_(a,d,"ok",void 0);else{var h,i;let e,f=eY(a),j=(h=a.serverSyncTree_,i=h.pendingWriteTree_,s(f>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:b,children:g,writeId:f,visible:!0}),i.visibleWrites=du(i.visibleWrites,b,g),i.lastWriteId=f,e=dr.fromObject(g),ef(h,new dh(db(),b,e)));eP(a.eventQueue_,j),a.server_.merge(b.toString(),c,(c,e)=>{let g="ok"===c;g||bF("update at "+b+" failed: "+c);let h=d9(a.serverSyncTree_,f,!g),i=h.length>0?e1(a,b):b;eR(a.eventQueue_,i,h),e_(a,d,c,e)}),bQ(c,c=>{let d=e5(a,cp(b,c));e1(a,d)}),eR(a.eventQueue_,b,[])}}(a._repo,a._path,b,c.wrapCallback(()=>{})),c.promise}function fj(a){var b,c,d,e,f;let g,h,i,j,k,l,m;a=ah(a);let n=new fk(new fb(()=>{}));return(b=a._repo,c=a,d=b.serverSyncTree_,h=(e=c)._path,i=null,d.syncPointTree_.foreachOnPath(h,(a,b)=>{let c=cr(a,h);i=i||d2(b,c)}),(j=d.syncPointTree_.get(h))?i=i||d2(j,ci()):(j=new d$,d.syncPointTree_=d.syncPointTree_.set(h,j)),l=(k=null!=i)?new di(i,!0,!1):null,m=(f=d.pendingWriteTree_,dL(e._path,f)),null!=(g=dp(d0(j,e,m,k?l.getNode():cS.EMPTY_NODE,k).viewCache_))?Promise.resolve(g):b.server_.get(c).then(a=>{let d,e=cU(a).withIndex(c._queryParams.getIndex());if(ed(b.serverSyncTree_,c,n,!0),c._queryParams.loadsAllData())d=ea(b.serverSyncTree_,c._path,e);else{let a=eh(b.serverSyncTree_,c);d=ec(b.serverSyncTree_,c._path,e,a)}return eR(b.eventQueue_,c._path,d),eb(b.serverSyncTree_,c,n,null,!0),e},a=>(e$(b,"get for query "+Q(c)+" failed: "+a),Promise.reject(Error(a))))).then(b=>new fe(b,new fd(a._repo,a._path),a._queryParams.getIndex()))}class fk{constructor(a){this.callbackContext=a}respondsTo(a){return"value"===a}createEvent(a,b){let c=b._queryParams.getIndex();return new e9("value",this,new fe(a.snapshotNode,new fd(b._repo,b._path),c))}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,null)}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new fa(this,a,b):null}matches(a){return a instanceof fk&&(!a.callbackContext||!this.callbackContext||a.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class fl{constructor(a,b){this.eventType=a,this.callbackContext=b}respondsTo(a){let b="children_added"===a?"child_added":a;return b="children_removed"===b?"child_removed":b,this.eventType===b}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new fa(this,a,b):null}createEvent(a,b){s(null!=a.childName,"Child events should have a childName.");let c=fg(new fd(b._repo,b._path),a.childName),d=b._queryParams.getIndex();return new e9(a.type,this,new fe(a.snapshotNode,c,d),a.prevName)}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,a.prevName)}matches(a){return a instanceof fl&&this.eventType===a.eventType&&(!this.callbackContext||!a.callbackContext||this.callbackContext.matches(a.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function fm(a,b,c,d){return function(a,b,c,d,e){var f;let g,h;if("object"==typeof d&&(g=void 0,e=d),"function"==typeof d&&(g=d),e&&e.onlyOnce){let b=c,d=(c,d)=>{eZ(a._repo,a,j),b(c,d)};d.userCallback=c.userCallback,d.context=c.context,c=d}let i=new fb(c,g||void 0),j="value"===b?new fk(i):new fl(b,i);return f=a._repo,h=".info"===cj(a._path)?ed(f.infoSyncTree_,a,j):ed(f.serverSyncTree_,a,j),eQ(f.eventQueue_,a._path,h),()=>eZ(a._repo,a,j)}(a,"value",b,c,d)}s(!m,"__referenceConstructor has already been defined"),m=fd,s(!n,"__referenceConstructor has already been defined"),n=fd;let fn={};class fo{constructor(a,b){this._repoInternal=a,this.app=b,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(a,b,c){var d;let e;if(a.stats_=b_(a.repoInfo_),a.forceRestClient_||"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)a.server_=new c5(a.repoInfo_,(b,c,d,e)=>{eV(a,b,c,d,e)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>eW(a,!0),0);else{if(null!=c){if("object"!=typeof c)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{Q(c)}catch(a){throw Error("Invalid authOverride provided: "+a)}}a.persistentConnection_=new cz(a.repoInfo_,b,(b,c,d,e)=>{eV(a,b,c,d,e)},b=>{eW(a,b)},b=>{var c;c=a,bQ(b,(a,b)=>{eX(c,a,b)})},a.authTokenProvider_,a.appCheckProvider_,c),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(b=>{a.server_.refreshAuthToken(b)}),a.appCheckProvider_.addTokenChangeListener(b=>{a.server_.refreshAppCheckToken(b.token)}),d=a.repoInfo_,b$[e=d.toString()]||(b$[e]=(()=>new da(a.stats_,a.server_))()),a.statsReporter_=b$[e],a.infoData_=new c6,a.infoSyncTree_=new d7({startListening:(b,c,d,e)=>{let f=[],g=a.infoData_.getNode(b._path);return g.isEmpty()||(f=ea(a.infoSyncTree_,b._path,g),setTimeout(()=>{e("ok")},0)),f},stopListening:()=>{}}),eX(a,"connected",!1),a.serverSyncTree_=new d7({startListening:(b,c,d,e)=>(a.server_.listen(b,d,c,(c,d)=>{let f=e(c,d);eR(a.eventQueue_,b._path,f)}),[]),stopListening:(b,c)=>{a.server_.unlisten(b,c)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new fd(this._repo,ci())),this._rootInternal}_delete(){if(null!==this._rootInternal){var a,b;let c;a=this._repo,(c=fn[b=this.app.name])&&c[a.key]===a||bE(`Database ${b}(${a.repoInfo_}) has already been deleted.`),a.persistentConnection_&&a.persistentConnection_.interrupt("repo_interrupt"),delete c[a.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(a){null===this._rootInternal&&bE("Cannot call "+a+" on a deleted database.")}}function fp(a=a1(),b){let c=aQ(a,"database").getImmediate({identifier:b});if(!c._instanceStarted){let a=(a=>{let b=C(a);if(!b)return;let c=b.lastIndexOf(":");if(c<=0||c+1===b.length)throw Error(`Invalid host ${b} with no separate hostname and port!`);let d=parseInt(b.substring(c+1),10);return"["===b[0]?[b.substring(1,c-1),d]:[b.substring(0,c),d]})("database");a&&function(a,b,c,d={}){var e;let f,g,h;(a=ah(a))._checkNotDeleted("useEmulator");let i=`${b}:${c}`,j=a._repoInternal;if(a._instanceStarted){if(i===a._repoInternal.repoInfo_.host&&Y(d,j.repoInfo_.emulatorOptions))return;bE("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}j.repoInfo_.nodeAdmin?(d.mockUserToken&&bE('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),f=new b7(b7.OWNER)):d.mockUserToken&&(f=new b7("string"==typeof d.mockUserToken?d.mockUserToken:function(a,b){if(a.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let c=b||"demo-project",d=a.iat||0,e=a.sub||a.user_id;if(!e)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let f={iss:`https://securetoken.google.com/${c}`,aud:c,iat:d,exp:d+3600,auth_time:d,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}},...a};return[z(JSON.stringify({alg:"none",type:"JWT"})),z(JSON.stringify(f)),""].join(".")}(d.mockUserToken,a.app.options.projectId))),F(b)&&(G(b),H("Database",!0)),e=f,g=i.lastIndexOf(":"),h=F(i.substring(0,g)),j.repoInfo_=new bW(i,h,j.repoInfo_.namespace,j.repoInfo_.webSocketOnly,j.repoInfo_.nodeAdmin,j.repoInfo_.persistenceKey,j.repoInfo_.includeNamespaceInQueryParams,!0,d),e&&(j.authTokenProvider_=e)}(c,...a)}return c}cz.prototype.simpleListen=function(a,b){this.sendRequest("q",{p:a},b)},cz.prototype.echo=function(a,b){this.sendRequest("echo",{d:a},b)},b1=bm.default.Client;function fq(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}b0=a$,aP(new ai("database",(a,{instanceIdentifier:b})=>{var c,d,e,f;let g,h,i,j,k,l,m,n=a.getProvider("app").getImmediate(),o=a.getProvider("auth-internal"),p=a.getProvider("app-check-internal");return void 0===(i=b||n.options.databaseURL)&&(n.options.projectId||bE("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),bB("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`),k=(j=e7(i,void 0)).repoInfo,"u">typeof process&&process.env&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?k=(j=e7(i=`http://${l}?ns=${k.namespace}`,void 0)).repoInfo:!j.repoInfo.secure,m=new b6(n.name,n.options,o),eN("Invalid Firebase Database URL",j),cq(j.path)||bE("Database URL must point to the root of a Firebase Database (not including a child path)."),new fo((c=k,d=n,e=m,f=new b5(n,p),(g=fn[d.name])||(g={},fn[d.name]=g),(h=g[c.toURLString()])&&bE("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),h=new eT(c,!1,e,f),g[c.toURLString()]=h,h),n)},"PUBLIC").setMultipleInstances(!0)),a4(b3,b4,"node"),a4(b3,b4,"esm2020"),a.s(["get",()=>fj,"getDatabase",()=>fp,"onValue",()=>fm,"ref",()=>ff,"set",()=>fh,"update",()=>fi],50455),a.s([],72029);let fr=new N("auth","Firebase",fq()),fs=new ar("@firebase/auth");function ft(a,...b){fs.logLevel<=bi.ERROR&&fs.error(`Auth (${a$}): ${a}`,...b)}function fu(a,...b){throw fy(a,...b)}function fv(a,...b){return fy(a,...b)}function fw(a,b,c){return new N("auth","Firebase",{...fq(),[b]:c}).create(b,{appName:a.name})}function fx(a){return fw(a,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function fy(a,...b){if("string"!=typeof a){let c=b[0],d=[...b.slice(1)];return d[0]&&(d[0].appName=a.name),a._errorFactory.create(c,...d)}return fr.create(a,...b)}function fz(a,b,...c){if(!a)throw fy(b,...c)}function fA(a){let b="INTERNAL ASSERTION FAILED: "+a;throw ft(b),Error(b)}function fB(){return"u">typeof self&&self.location?.protocol||null}class fC{static initialize(a,b,c){this.fetchImpl=a,b&&(this.headersImpl=b),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void fA("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void fA("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void fA("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let fD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},fE=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],fF=new class{constructor(a,b){this.shortDelay=a,this.longDelay=b,function(a,b){a||fA(b)}(b>a,"Short delay should be less than long delay!"),this.isMobile=K()}get(){let a;return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===fB()||"https:"===fB()||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}(3e4,6e4);function fG(a,b){return a.tenantId&&!b.tenantId?{...b,tenantId:a.tenantId}:b}async function fH(a,b,c,d,e={}){return fI(a,e,async()=>{let e={},f={};d&&("GET"===b?f=d:e={body:JSON.stringify(d)});let g=$({key:a.config.apiKey,...f}).slice(1),h=await a._getAdditionalHeaders();h["Content-Type"]="application/json",a.languageCode&&(h["X-Firebase-Locale"]=a.languageCode);let i={method:b,headers:h,...e};return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(i.referrerPolicy="no-referrer"),a.emulatorConfig&&F(a.emulatorConfig.host)&&(i.credentials="include"),fC.fetch()(await fK(a,a.config.apiHost,c,g),i)})}async function fI(a,b,c){a._canInitEmulator=!1;let d={...fD,...b};try{let b=new fL(a),e=await Promise.race([c(),b.promise]);b.clearNetworkTimeout();let f=await e.json();if("needConfirmation"in f)throw fM(a,"account-exists-with-different-credential",f);if(e.ok&&!("errorMessage"in f))return f;{let[b,c]=(e.ok?f.errorMessage:f.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===b)throw fM(a,"credential-already-in-use",f);if("EMAIL_EXISTS"===b)throw fM(a,"email-already-in-use",f);if("USER_DISABLED"===b)throw fM(a,"user-disabled",f);let g=d[b]||b.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw fw(a,g,c);fu(a,g)}}catch(b){if(b instanceof M)throw b;fu(a,"network-request-failed",{message:String(b)})}}async function fJ(a,b,c,d,e={}){let f=await fH(a,b,c,d,e);return"mfaPendingCredential"in f&&fu(a,"multi-factor-auth-required",{_serverResponse:f}),f}async function fK(a,b,c,d){let e=`${b}${c}?${d}`,f=a.config.emulator?function(a,b){var c;c=a.emulator,c||fA("Emulator should always be set here");let{url:d}=a.emulator;return b?`${d}${b.startsWith("/")?b.slice(1):b}`:d}(a.config,e):`${a.config.apiScheme}://${e}`;return fE.includes(c)&&(await a._persistenceManagerAvailable,"COOKIE"===a._getPersistenceType())?a._getPersistence()._getFinalTarget(f).toString():f}class fL{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((a,b)=>{this.timer=setTimeout(()=>b(fv(this.auth,"network-request-failed")),fF.get())})}}function fM(a,b,c){let d={appName:a.name};c.email&&(d.email=c.email),c.phoneNumber&&(d.phoneNumber=c.phoneNumber);let e=fv(a,b,d);return e.customData._tokenResponse=c,e}function fN(a){return void 0!==a&&void 0!==a.enterprise}class fO{constructor(a){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===a.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=a.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=a.recaptchaEnforcementState}getProviderEnforcementState(a){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let b of this.recaptchaEnforcementState)if(b.provider&&b.provider===a)switch(b.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(a){return"ENFORCE"===this.getProviderEnforcementState(a)||"AUDIT"===this.getProviderEnforcementState(a)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function fP(a,b){return fH(a,"GET","/v2/recaptchaConfig",fG(a,b))}async function fQ(a,b){return fH(a,"POST","/v1/accounts:delete",b)}async function fR(a,b){return fH(a,"POST","/v1/accounts:lookup",b)}function fS(a){if(a)try{let b=new Date(Number(a));if(!isNaN(b.getTime()))return b.toUTCString()}catch(a){}}async function fT(a,b=!1){let c=ah(a),d=await c.getIdToken(b),e=fV(d);fz(e&&e.exp&&e.auth_time&&e.iat,c.auth,"internal-error");let f="object"==typeof e.firebase?e.firebase:void 0,g=f?.sign_in_provider;return{claims:e,token:d,authTime:fS(fU(e.auth_time)),issuedAtTime:fS(fU(e.iat)),expirationTime:fS(fU(e.exp)),signInProvider:g||null,signInSecondFactor:f?.sign_in_second_factor||null}}function fU(a){return 1e3*Number(a)}function fV(a){let[b,c,d]=a.split(".");if(void 0===b||void 0===c||void 0===d)return ft("JWT malformed, contained fewer than 3 sections"),null;try{let a=A(c);if(!a)return ft("Failed to decode base64 JWT payload"),null;return JSON.parse(a)}catch(a){return ft("Caught error parsing JWT payload as JSON",a?.toString()),null}}function fW(a){let b=fV(a);return fz(b,"internal-error"),fz(void 0!==b.exp,"internal-error"),fz(void 0!==b.iat,"internal-error"),Number(b.exp)-Number(b.iat)}async function fX(a,b,c=!1){if(c)return b;try{return await b}catch(b){throw b instanceof M&&function({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}(b)&&a.auth.currentUser===a&&await a.auth.signOut(),b}}class fY{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(a){if(!a)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let a=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),a}}schedule(a=!1){if(!this.isRunning)return;let b=this.getInterval(a);this.timerId=setTimeout(async()=>{await this.iteration()},b)}async iteration(){try{await this.user.getIdToken(!0)}catch(a){a?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class fZ{constructor(a,b){this.createdAt=a,this.lastLoginAt=b,this._initializeTime()}_initializeTime(){this.lastSignInTime=fS(this.lastLoginAt),this.creationTime=fS(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function f$(a){var b,c;let d=a.auth,e=await a.getIdToken(),f=await fX(a,fR(d,{idToken:e}));fz(f?.users.length,d,"internal-error");let g=f.users[0];a._notifyReloadListener(g);let h=g.providerUserInfo?.length?f0(g.providerUserInfo):[],i=(b=a.providerData,c=h,[...b.filter(a=>!c.some(b=>b.providerId===a.providerId)),...c]),j=a.isAnonymous,k=!(a.email&&g.passwordHash)&&!i?.length;Object.assign(a,{uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:i,metadata:new fZ(g.createdAt,g.lastLoginAt),isAnonymous:!!j&&k})}async function f_(a){let b=ah(a);await f$(b),await b.auth._persistUserIfCurrent(b),b.auth._notifyListenersIfCurrent(b)}function f0(a){return a.map(({providerId:a,...b})=>({providerId:a,uid:b.rawId||"",displayName:b.displayName||null,email:b.email||null,phoneNumber:b.phoneNumber||null,photoURL:b.photoUrl||null}))}async function f1(a,b){let c=await fI(a,{},async()=>{let c=$({grant_type:"refresh_token",refresh_token:b}).slice(1),{tokenApiHost:d,apiKey:e}=a.config,f=await fK(a,d,"/v1/token",`key=${e}`),g=await a._getAdditionalHeaders();g["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:g,body:c};return a.emulatorConfig&&F(a.emulatorConfig.host)&&(h.credentials="include"),fC.fetch()(f,h)});return{accessToken:c.access_token,expiresIn:c.expires_in,refreshToken:c.refresh_token}}async function f2(a,b){return fH(a,"POST","/v2/accounts:revokeToken",fG(a,b))}class f3{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){fz(a.idToken,"internal-error"),fz(void 0!==a.idToken,"internal-error"),fz(void 0!==a.refreshToken,"internal-error");let b="expiresIn"in a&&void 0!==a.expiresIn?Number(a.expiresIn):fW(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,b)}updateFromIdToken(a){fz(0!==a.length,"internal-error");let b=fW(a);this.updateTokensAndExpiration(a,null,b)}async getToken(a,b=!1){return b||!this.accessToken||this.isExpired?(fz(this.refreshToken,a,"user-token-expired"),this.refreshToken)?(await this.refresh(a,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(a,b){let{accessToken:c,refreshToken:d,expiresIn:e}=await f1(a,b);this.updateTokensAndExpiration(c,d,Number(e))}updateTokensAndExpiration(a,b,c){this.refreshToken=b||null,this.accessToken=a||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(a,b){let{refreshToken:c,accessToken:d,expirationTime:e}=b,f=new f3;return c&&(fz("string"==typeof c,"internal-error",{appName:a}),f.refreshToken=c),d&&(fz("string"==typeof d,"internal-error",{appName:a}),f.accessToken=d),e&&(fz("number"==typeof e,"internal-error",{appName:a}),f.expirationTime=e),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new f3,this.toJSON())}_performRefresh(){return fA("not implemented")}}function f4(a,b){fz("string"==typeof a||void 0===a,"internal-error",{appName:b})}class f5{constructor({uid:a,auth:b,stsTokenManager:c,...d}){this.providerId="firebase",this.proactiveRefresh=new fY(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=b,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new fZ(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(a){let b=await fX(this,this.stsTokenManager.getToken(this.auth,a));return fz(b,this.auth,"internal-error"),this.accessToken!==b&&(this.accessToken=b,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),b}getIdTokenResult(a){return fT(this,a)}reload(){return f_(this)}_assign(a){this!==a&&(fz(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(a=>({...a})),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){let b=new f5({...this,auth:a,stsTokenManager:this.stsTokenManager._clone()});return b.metadata._copy(this.metadata),b}_onReload(a){fz(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(a,b=!1){let c=!1;a.idToken&&a.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(a),c=!0),b&&await f$(this),await this.auth._persistUserIfCurrent(this),c&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(aU(this.auth.app))return Promise.reject(fx(this.auth));let a=await this.getIdToken();return await fX(this,fQ(this.auth,{idToken:a})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>({...a})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,b){let c=b.displayName??void 0,d=b.email??void 0,e=b.phoneNumber??void 0,f=b.photoURL??void 0,g=b.tenantId??void 0,h=b._redirectEventId??void 0,i=b.createdAt??void 0,j=b.lastLoginAt??void 0,{uid:k,emailVerified:l,isAnonymous:m,providerData:n,stsTokenManager:o}=b;fz(k&&o,a,"internal-error");let p=f3.fromJSON(this.name,o);fz("string"==typeof k,a,"internal-error"),f4(c,a.name),f4(d,a.name),fz("boolean"==typeof l,a,"internal-error"),fz("boolean"==typeof m,a,"internal-error"),f4(e,a.name),f4(f,a.name),f4(g,a.name),f4(h,a.name),f4(i,a.name),f4(j,a.name);let q=new f5({uid:k,auth:a,email:d,emailVerified:l,displayName:c,isAnonymous:m,photoURL:f,phoneNumber:e,tenantId:g,stsTokenManager:p,createdAt:i,lastLoginAt:j});return n&&Array.isArray(n)&&(q.providerData=n.map(a=>({...a}))),h&&(q._redirectEventId=h),q}static async _fromIdTokenResponse(a,b,c=!1){let d=new f3;d.updateFromServerResponse(b);let e=new f5({uid:b.localId,auth:a,stsTokenManager:d,isAnonymous:c});return await f$(e),e}static async _fromGetAccountInfoResponse(a,b,c){let d=b.users[0];fz(void 0!==d.localId,"internal-error");let e=void 0!==d.providerUserInfo?f0(d.providerUserInfo):[],f=!(d.email&&d.passwordHash)&&!e?.length,g=new f3;g.updateFromIdToken(c);let h=new f5({uid:d.localId,auth:a,stsTokenManager:g,isAnonymous:f});return Object.assign(h,{uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:e,metadata:new fZ(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!e?.length}),h}}let f6=new Map;function f7(a){a instanceof Function||fA("Expected a class definition");let b=f6.get(a);return b?(b instanceof a||fA("Instance stored in cache mismatched with class"),b):(b=new a,f6.set(a,b),b)}class f8{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(a,b){this.storage[a]=b}async _get(a){let b=this.storage[a];return void 0===b?null:b}async _remove(a){delete this.storage[a]}_addListener(a,b){}_removeListener(a,b){}}function f9(a,b,c){return`firebase:${a}:${b}:${c}`}f8.type="NONE";class ga{constructor(a,b,c){this.persistence=a,this.auth=b,this.userKey=c;const{config:d,name:e}=this.auth;this.fullUserKey=f9(this.userKey,d.apiKey,e),this.fullPersistenceKey=f9("persistence",d.apiKey,e),this.boundEventHandler=b._onStorageEvent.bind(b),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}async getCurrentUser(){let a=await this.persistence._get(this.fullUserKey);if(!a)return null;if("string"==typeof a){let b=await fR(this.auth,{idToken:a}).catch(()=>void 0);return b?f5._fromGetAccountInfoResponse(this.auth,b,a):null}return f5._fromJSON(this.auth,a)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(a){if(this.persistence===a)return;let b=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=a,b)return this.setCurrentUser(b)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(a,b,c="authUser"){if(!b.length)return new ga(f7(f8),a,c);let d=(await Promise.all(b.map(async a=>{if(await a._isAvailable())return a}))).filter(a=>a),e=d[0]||f7(f8),f=f9(c,a.config.apiKey,a.name),g=null;for(let c of b)try{let b=await c._get(f);if(b){let d;if("string"==typeof b){let c=await fR(a,{idToken:b}).catch(()=>void 0);if(!c)break;d=await f5._fromGetAccountInfoResponse(a,c,b)}else d=f5._fromJSON(a,b);c!==e&&(g=d),e=c;break}}catch{}let h=d.filter(a=>a._shouldAllowMigration);return e._shouldAllowMigration&&h.length&&(e=h[0],g&&await e._set(f,g.toJSON()),await Promise.all(b.map(async a=>{if(a!==e)try{await a._remove(f)}catch{}}))),new ga(e,a,c)}}function gb(a){let b=a.toLowerCase();if(b.includes("opera/")||b.includes("opr/")||b.includes("opios/"))return"Opera";{if(function(a=I()){return/iemobile/i.test(a)}(b))return"IEMobile";if(b.includes("msie")||b.includes("trident/"))return"IE";if(b.includes("edge/"))return"Edge";if(function(a=I()){return/firefox\//i.test(a)}(b))return"Firefox";if(b.includes("silk/"))return"Silk";if(function(a=I()){return/blackberry/i.test(a)}(b))return"Blackberry";if(function(a=I()){return/webos/i.test(a)}(b))return"Webos";if(function(a=I()){let b=a.toLowerCase();return b.includes("safari/")&&!b.includes("chrome/")&&!b.includes("crios/")&&!b.includes("android")}(b))return"Safari";if((b.includes("chrome/")||function(a=I()){return/crios\//i.test(a)}(b))&&!b.includes("edge/"))return"Chrome";if(function(a=I()){return/android/i.test(a)}(b))return"Android";let c=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(c?.length===2)return c[1]}return"Other"}function gc(a,b=[]){let c;switch(a){case"Browser":c=gb(I());break;case"Worker":c=`${gb(I())}-${a}`;break;default:c=a}let d=b.length?b.join(","):"FirebaseCore-web";return`${c}/JsCore/${a$}/${d}`}class gd{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,b){let c=b=>new Promise((c,d)=>{try{let d=a(b);c(d)}catch(a){d(a)}});c.onAbort=b,this.queue.push(c);let d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(a){if(this.auth.currentUser===a)return;let b=[];try{for(let c of this.queue)await c(a),c.onAbort&&b.push(c.onAbort)}catch(a){for(let a of(b.reverse(),b))try{a()}catch(a){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a?.message})}}}async function ge(a,b={}){return fH(a,"GET","/v2/passwordPolicy",fG(a,b))}class gf{constructor(a){const b=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=b.minPasswordLength??6,b.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=b.maxPasswordLength),void 0!==b.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=b.containsLowercaseCharacter),void 0!==b.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=b.containsUppercaseCharacter),void 0!==b.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=b.containsNumericCharacter),void 0!==b.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=b.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=a.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=a.forceUpgradeOnSignin??!1,this.schemaVersion=a.schemaVersion}validatePassword(a){let b={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,b),this.validatePasswordCharacterOptions(a,b),b.isValid&&(b.isValid=b.meetsMinPasswordLength??!0),b.isValid&&(b.isValid=b.meetsMaxPasswordLength??!0),b.isValid&&(b.isValid=b.containsLowercaseLetter??!0),b.isValid&&(b.isValid=b.containsUppercaseLetter??!0),b.isValid&&(b.isValid=b.containsNumericCharacter??!0),b.isValid&&(b.isValid=b.containsNonAlphanumericCharacter??!0),b}validatePasswordLengthOptions(a,b){let c=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;c&&(b.meetsMinPasswordLength=a.length>=c),d&&(b.meetsMaxPasswordLength=a.length<=d)}validatePasswordCharacterOptions(a,b){let c;this.updatePasswordCharacterOptionsStatuses(b,!1,!1,!1,!1);for(let d=0;d<a.length;d++)c=a.charAt(d),this.updatePasswordCharacterOptionsStatuses(b,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(a,b,c,d,e){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=b)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=e))}}class gg{constructor(a,b,c,d){this.app=a,this.heartbeatServiceProvider=b,this.appCheckServiceProvider=c,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gh(this),this.idTokenSubscription=new gh(this),this.beforeStateQueue=new gd(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=fr,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=d.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(a,b){return b&&(this._popupRedirectResolver=f7(b)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await ga.create(this,a),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(a){}await this.initializeCurrentUser(b),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let a=await this.assertedPersistence.getCurrentUser();if(this.currentUser||a){if(this.currentUser&&a&&this.currentUser.uid===a.uid){this._currentUser._assign(a),await this.currentUser.getIdToken();return}await this._updateCurrentUser(a,!0)}}async initializeCurrentUserFromIdToken(a){try{let b=await fR(this,{idToken:a}),c=await f5._fromGetAccountInfoResponse(this,b,a);await this.directlySetCurrentUser(c)}catch(a){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",a),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(a){if(aU(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(b=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(b,b))}):this.directlySetCurrentUser(null)}let b=await this.assertedPersistence.getCurrentUser(),c=b,d=!1;if(a&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let b=this.redirectUser?._redirectEventId,e=c?._redirectEventId,f=await this.tryRedirectSignIn(a);(!b||b===e)&&f?.user&&(c=f.user,d=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(c)}catch(a){c=b,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return(fz(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId)?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(a){let b=null;try{b=await this._popupRedirectResolver._completeRedirectFn(this,a,!0)}catch(a){await this._setRedirectUser(null)}return b}async reloadAndSetCurrentUserOrClear(a){try{await f$(a)}catch(a){if(a?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(a)}useDeviceLanguage(){this.languageCode=function(){if("u"<typeof navigator)return null;let a=navigator;return a.languages&&a.languages[0]||a.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(a){if(aU(this.app))return Promise.reject(fx(this));let b=a?ah(a):null;return b&&fz(b.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(b&&b._clone(this))}async _updateCurrentUser(a,b=!1){if(!this._deleted)return a&&fz(this.tenantId===a.tenantId,this,"tenant-id-mismatch"),b||await this.beforeStateQueue.runMiddleware(a),this.queue(async()=>{await this.directlySetCurrentUser(a),this.notifyAuthListeners()})}async signOut(){return aU(this.app)?Promise.reject(fx(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(a){return aU(this.app)?Promise.reject(fx(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(f7(a))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(a){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let b=this._getPasswordPolicyInternal();return b.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):b.validatePassword(a)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let a=new gf(await ge(this));null===this.tenantId?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(a){this._errorFactory=new N("auth","Firebase",a())}onAuthStateChanged(a,b,c){return this.registerStateListener(this.authStateSubscription,a,b,c)}beforeAuthStateChanged(a,b){return this.beforeStateQueue.pushCallback(a,b)}onIdTokenChanged(a,b,c){return this.registerStateListener(this.idTokenSubscription,a,b,c)}authStateReady(){return new Promise((a,b)=>{if(this.currentUser)a();else{let c=this.onAuthStateChanged(()=>{c(),a()},b)}})}async revokeAccessToken(a){if(this.currentUser){let b={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(b.tenantId=this.tenantId),await f2(this,b)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(a,b){let c=await this.getOrInitRedirectPersistenceManager(b);return null===a?c.removeCurrentUser():c.setCurrentUser(a)}async getOrInitRedirectPersistenceManager(a){if(!this.redirectPersistenceManager){let b=a&&f7(a)||this._popupRedirectResolver;fz(b,this,"argument-error"),this.redirectPersistenceManager=await ga.create(this,[f7(b._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(a){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===a)?this._currentUser:this.redirectUser?._redirectEventId===a?this.redirectUser:null}async _persistUserIfCurrent(a){if(a===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(a))}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let a=this.currentUser?.uid??null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,b,c,d){if(this._deleted)return()=>{};let e="function"==typeof b?b:b.next.bind(b),f=!1,g=this._isInitialized?Promise.resolve():this._initializationPromise;if(fz(g,this,"internal-error"),g.then(()=>{f||e(this.currentUser)}),"function"==typeof b){let e=a.addObserver(b,c,d);return()=>{f=!0,e()}}{let c=a.addObserver(b);return()=>{f=!0,c()}}}async directlySetCurrentUser(a){this.currentUser&&this.currentUser!==a&&this._currentUser._stopProactiveRefresh(),a&&this.isProactiveRefreshEnabled&&a._startProactiveRefresh(),this.currentUser=a,a?await this.assertedPersistence.setCurrentUser(a):await this.assertedPersistence.removeCurrentUser()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return fz(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=gc(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let a={"X-Client-Version":this.clientVersion};this.app.options.appId&&(a["X-Firebase-gmpid"]=this.app.options.appId);let b=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();b&&(a["X-Firebase-Client"]=b);let c=await this._getAppCheckToken();return c&&(a["X-Firebase-AppCheck"]=c),a}async _getAppCheckToken(){if(aU(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let a=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return a?.error&&function(a,...b){fs.logLevel<=bi.WARN&&fs.warn(`Auth (${a$}): ${a}`,...b)}(`Error while retrieving App Check token: ${a.error}`),a?.token}}class gh{constructor(a){this.auth=a,this.observer=null,this.addObserver=function(a,b){let c=new ac(a,void 0);return c.subscribe.bind(c)}(a=>this.observer=a)}get next(){return fz(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class gi{constructor(){this.enterprise=new gj}ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}class gj{ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}let gk="NO_RECAPTCHA";class gl{constructor(a){this.type="recaptcha-enterprise",this.auth=function(a){return ah(a)}(a)}async verify(a="verify",b=!1){async function c(a){if(!b){if(null==a.tenantId&&null!=a._agentRecaptchaConfig)return a._agentRecaptchaConfig.siteKey;if(null!=a.tenantId&&void 0!==a._tenantRecaptchaConfigs[a.tenantId])return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(b,c)=>{fP(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(void 0===d.recaptchaKey)c(Error("recaptcha Enterprise site key undefined"));else{let c=new fO(d);return null==a.tenantId?a._agentRecaptchaConfig=c:a._tenantRecaptchaConfigs[a.tenantId]=c,b(c.siteKey)}}).catch(a=>{c(a)})})}return this.auth.settings.appVerificationDisabledForTesting?new gi().execute("siteKey",{action:"verify"}):new Promise((d,e)=>{c(this.auth).then(c=>{let f;if(!(!b&&fN(window.grecaptcha)))return void e(Error("RecaptchaVerifier is only supported in browser"));fN(f=window.grecaptcha)?f.enterprise.ready(()=>{f.enterprise.execute(c,{action:a}).then(a=>{d(a)}).catch(()=>{d(gk)})}):e(Error("No reCAPTCHA enterprise script loaded."))}).catch(a=>{e(a)})})}}async function gm(a,b,c,d=!1,e=!1){let f,g=new gl(a);if(e)f=gk;else try{f=await g.verify(c)}catch(a){f=await g.verify(c,!0)}let h={...b};if("mfaSmsEnrollment"===c||"mfaSmsSignIn"===c){if("phoneEnrollmentInfo"in h){let a=h.phoneEnrollmentInfo.phoneNumber,b=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){let a=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:a,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return d?Object.assign(h,{captchaResp:f}):Object.assign(h,{captchaResponse:f}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function gn(a,b,c,d,e){if("EMAIL_PASSWORD_PROVIDER"===e)if(!a._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return d(a,b).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log(`${c} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let e=await gm(a,b,c,"getOobCode"===c);return d(a,e)}});else{let e=await gm(a,b,c,"getOobCode"===c);return d(a,e)}if("PHONE_PROVIDER"!==e)return Promise.reject(e+" provider is not supported.");if(a._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let e=await gm(a,b,c);return d(a,e).catch(async e=>{if(a._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===e.code||"auth/invalid-app-credential"===e.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${c} flow.`);let e=await gm(a,b,c,!1,!0);return d(a,e)}return Promise.reject(e)})}{let e=await gm(a,b,c,!1,!0);return d(a,e)}}function go(a){let b=a.indexOf(":");return b<0?"":a.substr(0,b+1)}function gp(a){if(!a)return null;let b=Number(a);return isNaN(b)?null:b}class gq{constructor(a,b){this.providerId=a,this.signInMethod=b}toJSON(){return fA("not implemented")}_getIdTokenResponse(a){return fA("not implemented")}_linkToIdToken(a,b){return fA("not implemented")}_getReauthenticationResolver(a){return fA("not implemented")}}async function gr(a,b){return fH(a,"POST","/v1/accounts:signUp",b)}async function gs(a,b){return fJ(a,"POST","/v1/accounts:signInWithPassword",fG(a,b))}async function gt(a,b){return fJ(a,"POST","/v1/accounts:signInWithEmailLink",fG(a,b))}async function gu(a,b){return fJ(a,"POST","/v1/accounts:signInWithEmailLink",fG(a,b))}class gv extends gq{constructor(a,b,c,d=null){super("password",c),this._email=a,this._password=b,this._tenantId=d}static _fromEmailAndPassword(a,b){return new gv(a,b,"password")}static _fromEmailAndCode(a,b,c=null){return new gv(a,b,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(a){let b="string"==typeof a?JSON.parse(a):a;if(b?.email&&b?.password){if("password"===b.signInMethod)return this._fromEmailAndPassword(b.email,b.password);else if("emailLink"===b.signInMethod)return this._fromEmailAndCode(b.email,b.password,b.tenantId)}return null}async _getIdTokenResponse(a){switch(this.signInMethod){case"password":return gn(a,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",gs,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return gt(a,{email:this._email,oobCode:this._password});default:fu(a,"internal-error")}}async _linkToIdToken(a,b){switch(this.signInMethod){case"password":return gn(a,{idToken:b,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",gr,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return gu(a,{idToken:b,email:this._email,oobCode:this._password});default:fu(a,"internal-error")}}_getReauthenticationResolver(a){return this._getIdTokenResponse(a)}}async function gw(a,b){return fJ(a,"POST","/v1/accounts:signInWithIdp",fG(a,b))}class gx extends gq{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){let b=new gx(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(b.idToken=a.idToken),a.accessToken&&(b.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(b.nonce=a.nonce),a.pendingToken&&(b.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(b.accessToken=a.oauthToken,b.secret=a.oauthTokenSecret):fu("argument-error"),b}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){let{providerId:b,signInMethod:c,...d}="string"==typeof a?JSON.parse(a):a;if(!b||!c)return null;let e=new gx(b,c);return e.idToken=d.idToken||void 0,e.accessToken=d.accessToken||void 0,e.secret=d.secret,e.nonce=d.nonce,e.pendingToken=d.pendingToken||null,e}_getIdTokenResponse(a){return gw(a,this.buildRequest())}_linkToIdToken(a,b){let c=this.buildRequest();return c.idToken=b,gw(a,c)}_getReauthenticationResolver(a){let b=this.buildRequest();return b.autoCreate=!1,gw(a,b)}buildRequest(){let a={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{let b={};this.idToken&&(b.id_token=this.idToken),this.accessToken&&(b.access_token=this.accessToken),this.secret&&(b.oauth_token_secret=this.secret),b.providerId=this.providerId,this.nonce&&!this.pendingToken&&(b.nonce=this.nonce),a.postBody=$(b)}return a}}class gy{constructor(a){const b=_(aa(a)),c=b.apiKey??null,d=b.oobCode??null,e=function(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(b.mode??null);fz(c&&d&&e,"argument-error"),this.apiKey=c,this.operation=e,this.code=d,this.continueUrl=b.continueUrl??null,this.languageCode=b.lang??null,this.tenantId=b.tenantId??null}static parseLink(a){let b,c,d,e=(c=(b=_(aa(a)).link)?_(aa(b)).deep_link_id:null,((d=_(aa(a)).deep_link_id)?_(aa(d)).link:null)||d||c||b||a);try{return new gy(e)}catch{return null}}}class gz{constructor(){this.providerId=gz.PROVIDER_ID}static credential(a,b){return gv._fromEmailAndPassword(a,b)}static credentialWithLink(a,b){let c=gy.parseLink(b);return fz(c,"argument-error"),gv._fromEmailAndCode(a,c.code,c.tenantId)}}gz.PROVIDER_ID="password",gz.EMAIL_PASSWORD_SIGN_IN_METHOD="password",gz.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class gA{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}class gB extends gA{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}class gC extends gB{constructor(){super("facebook.com")}static credential(a){return gx._fromParams({providerId:gC.PROVIDER_ID,signInMethod:gC.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return gC.credentialFromTaggedObject(a)}static credentialFromError(a){return gC.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return gC.credential(a.oauthAccessToken)}catch{return null}}}gC.FACEBOOK_SIGN_IN_METHOD="facebook.com",gC.PROVIDER_ID="facebook.com";class gD extends gB{constructor(){super("google.com"),this.addScope("profile")}static credential(a,b){return gx._fromParams({providerId:gD.PROVIDER_ID,signInMethod:gD.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:b})}static credentialFromResult(a){return gD.credentialFromTaggedObject(a)}static credentialFromError(a){return gD.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthIdToken:b,oauthAccessToken:c}=a;if(!b&&!c)return null;try{return gD.credential(b,c)}catch{return null}}}gD.GOOGLE_SIGN_IN_METHOD="google.com",gD.PROVIDER_ID="google.com";class gE extends gB{constructor(){super("github.com")}static credential(a){return gx._fromParams({providerId:gE.PROVIDER_ID,signInMethod:gE.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return gE.credentialFromTaggedObject(a)}static credentialFromError(a){return gE.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return gE.credential(a.oauthAccessToken)}catch{return null}}}gE.GITHUB_SIGN_IN_METHOD="github.com",gE.PROVIDER_ID="github.com";class gF extends gB{constructor(){super("twitter.com")}static credential(a,b){return gx._fromParams({providerId:gF.PROVIDER_ID,signInMethod:gF.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:b})}static credentialFromResult(a){return gF.credentialFromTaggedObject(a)}static credentialFromError(a){return gF.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthAccessToken:b,oauthTokenSecret:c}=a;if(!b||!c)return null;try{return gF.credential(b,c)}catch{return null}}}gF.TWITTER_SIGN_IN_METHOD="twitter.com",gF.PROVIDER_ID="twitter.com";class gG{constructor(a,b){this.factorId=a,this.uid=b.mfaEnrollmentId,this.enrollmentTime=new Date(b.enrolledAt).toUTCString(),this.displayName=b.displayName}static _fromServerResponse(a,b){return"phoneInfo"in b?gH._fromServerResponse(a,b):"totpInfo"in b?gI._fromServerResponse(a,b):fu(a,"internal-error")}}class gH extends gG{constructor(a){super("phone",a),this.phoneNumber=a.phoneInfo}static _fromServerResponse(a,b){return new gH(b)}}class gI extends gG{constructor(a){super("totp",a)}static _fromServerResponse(a,b){return new gI(b)}}new WeakMap;var gJ="@firebase/auth",gK="1.12.0";class gL{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(a){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(a)}:null}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;let b=this.auth.onIdTokenChanged(b=>{a(b?.stsTokenManager.accessToken||null)});this.internalListeners.set(a,b),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();let b=this.internalListeners.get(a);b&&(this.internalListeners.delete(a),b(),this.updateProactiveRefresh())}assertAuthConfigured(){fz(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}fC.initialize(fetch,Headers,Response),bl="Node",aP(new ai("auth",(a,{options:b})=>{let c,d,e=a.getProvider("app").getImmediate(),f=a.getProvider("heartbeat"),g=a.getProvider("app-check-internal"),{apiKey:h,authDomain:i}=e.options;fz(h&&!h.includes(":"),"invalid-api-key",{appName:e.name});let j=new gg(e,f,g,{apiKey:h,authDomain:i,clientPlatform:bl,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gc(bl)});return d=(Array.isArray(c=b?.persistence||[])?c:[c]).map(f7),b?.errorMap&&j._updateErrorMap(b.errorMap),j._initializeWithPersistence(d,b?.popupRedirectResolver),j},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,b,c)=>{a.getProvider("auth-internal").initialize()})),aP(new ai("auth-internal",a=>new gL(ah(a.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),a4(gJ,gK,function(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(bl)),a4(gJ,gK,"esm2020"),fv("operation-not-supported-in-this-environment"),gg.prototype.setPersistence=async()=>{};a.s([],48641),a.i(48641);let gM={apiKey:"AIzaSyCZoA63Ujp-AYb9jMx4XTeCfY4tB8Qc2Qc",authDomain:"sudoku-fb1a9.firebaseapp.com",databaseURL:"https://sudoku-fb1a9-default-rtdb.firebaseio.com",projectId:"sudoku-fb1a9",storageBucket:"sudoku-fb1a9.firebasestorage.app",messagingSenderId:"876606712356",appId:"1:876606712356:web:cdb27894402e24c74586b1"};try{gM.apiKey?(console.log("Initializing Firebase with config:",{...gM,apiKey:"HIDDEN"}),o=a2().length?a1():a_(gM),p=fp(o),function(a=a1()){let b=aQ(a,"auth");if(b.isInitialized())return b.getImmediate();let c=function(a,b){let c=aQ(a,"auth");if(c.isInitialized()){let a=c.getImmediate();if(Y(c.getOptions(),(void 0)??{}))return a;fu(a,"already-initialized")}return c.initialize({options:void 0})}(a),d=C("auth");d&&function(a,b,c){let d=ah(a);fz(/^https?:\/\//.test(b),d,"invalid-emulator-scheme");let e=go(b),{host:f,port:g}=function(a){let b=go(a),c=/(\/\/)?([^?#/]+)/.exec(a.substr(b.length));if(!c)return{host:"",port:null};let d=c[2].split("@").pop()||"",e=/^(\[[^\]]+\])(:|$)/.exec(d);if(e){let a=e[1];return{host:a,port:gp(d.substr(a.length+1))}}{let[a,b]=d.split(":");return{host:a,port:gp(b)}}}(b),h=null===g?"":`:${g}`,i={url:`${e}//${f}${h}/`},j=Object.freeze({host:f,port:g,protocol:e.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!d._canInitEmulator){fz(d.config.emulator&&d.emulatorConfig,d,"emulator-config-failed"),fz(Y(i,d.config.emulator)&&Y(j,d.emulatorConfig),d,"emulator-config-failed");return}d.config.emulator=i,d.emulatorConfig=j,d.settings.appVerificationDisabledForTesting=!0,F(f)?(G(`${e}//${f}${h}`),H("Auth",!0)):"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.")}(c,`http://${d}`)}(o),console.log("Firebase initialized successfully. DB URL:",p.app.options.databaseURL)):console.warn("Firebase config missing. Firebase features will not work.")}catch(a){console.warn("Firebase initialization failed:",a)}a.s(["db",()=>p],73341)},71009,a=>{"use strict";var b=a.i(73341);a.i(72029);var c=a.i(50455),d=a.i(24663);let e=()=>{if(!b.db)throw Error("Firebase database is not initialized");return b.db},f=a=>a.replace(/[^a-zA-Z0-9_ -]/g,"").trim(),g=async(a,b)=>{let g="",h=0;for(;h<5;){console.log("Checking Room ID:",g=function(){let a="ABCDEFGHJKMNPQRSTUVWXYZ23456789",b="";for(let c=0;c<6;c++)b+=a[Math.floor(Math.random()*a.length)];return b}());try{let a=(0,c.ref)(e(),`rooms/${g}`);if(!(await (0,c.get)(a)).exists())break}catch(a){throw console.error("Error accessing Firebase:",a),a}h++}let{initial:i,solved:j}=(0,d.generateSudoku)(b),k=i.map(a=>[...a]);return await (0,c.set)((0,c.ref)(e(),`rooms/${g}`),{id:g,status:"waiting",difficulty:b,initialBoard:i,currentBoard:k,solvedBoard:j,players:{[f(a)]:{name:a,progress:0,mistakes:0,status:"playing"}},winner:null,createdAt:Date.now()}),g},h=async(a,b)=>{let d=(0,c.ref)(e(),`rooms/${a}`),g=await (0,c.get)(d);if(!g.exists())throw Error("Room not found. Check the code and try again.");let h=g.val();if("waiting"!==h.status)throw Error("This game has already started.");let i=Object.keys(h.players||{}),j=f(b);if(!j)throw Error("Name contains invalid characters. Please use letters and numbers.");if(Object.values(h.players||{}).some(a=>a.name===b))throw Error("That name is already taken in this room.");await (0,c.update)((0,c.ref)(e(),`rooms/${a}/players/${j}`),{name:b,progress:0,mistakes:0,status:"playing"}),i.length>=1&&await (0,c.update)((0,c.ref)(e(),`rooms/${a}`),{status:"playing"})},i=async(a,b,d,g,h)=>{let i=f(b);if(await (0,c.update)((0,c.ref)(e(),`rooms/${a}/players/${i}`),{progress:d,mistakes:g,status:h}),"won"===h){let d=(0,c.ref)(e(),`rooms/${a}`),f=await (0,c.get)(d);f.val()&&!f.val().winner&&await (0,c.update)(d,{winner:b,status:"finished"})}},j=async(a,b,d,f)=>{await (0,c.set)((0,c.ref)(e(),`rooms/${a}/currentBoard/${b}/${d}`),f)};a.s(["createRoom",0,g,"joinRoom",0,h,"subscribeToBoard",0,(a,b)=>{let d=(0,c.ref)(e(),`rooms/${a}/currentBoard`);return(0,c.onValue)(d,a=>{let c=a.val();c&&b(c)})},"subscribeToPlayers",0,(a,b)=>{let d=(0,c.ref)(e(),`rooms/${a}/players`);return(0,c.onValue)(d,a=>{let c=a.val();c&&b(c)})},"subscribeToRoom",0,(a,b)=>{let d=(0,c.ref)(e(),`rooms/${a}`);return(0,c.onValue)(d,a=>{let c=a.val();c&&b(c)})},"updateBoardCell",0,j,"updateProgress",0,i])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__21ed32fd._.js.map